!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("BulbEditor",[],t):"object"==typeof exports?exports.BulbEditor=t():e.BulbEditor=t()}(this,function(){return webpackJsonpBulbEditor([0],[,function(e,t,n){(function(o){var i;void 0!==(i=function(){for(var e,t=this&&this.DEBUG?this:window,n=t.DEBUG||null!=t.logLevel,o=t.console,i={},r=function(){},a="log warn error time timeEnd profile profileEnd".split(" "),l=a.length;--l>=0;)e=a[l],n&&o[e]?i[e]=o[e].bind(o):i[e]=r;return n&&t.alert?i.debugAlert=function(e){t.alert(e)}:i.debugAlert=i.error,i.DEBUG=n,i}.call(t,n,t,e))&&(e.exports=i)}).call(t,n(83))},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";return function(){function e(){}return e.getAllBlockTypes=function(){return[e.ATTACHMENT,e.BLOCK,e.CATALOGUE,e.HANDWRITE,e.HEADING,e.HR,e.IMAGE,e.LIST_ITEM,e.PARAGRAPH,e.TABLE,e.TODO,e.QUOTE,e.UNKNOWN]},e.getType=function(e){if(e)return e.getType()},e.isParagraph=function(t){return e.getType(t)===e.PARAGRAPH},e.isParagraphCluster=function(t){return this.isParagraphClusterType(e.getType(t))},e.isParagraphClusterType=function(t){return t===e.PARAGRAPH||t===e.LIST_ITEM||t===e.HEADING||t===e.CATALOGUE||t===e.TODO||t===e.QUOTE},e.isListItem=function(t){return e.getType(t)===e.LIST_ITEM},e.isAttachment=function(t){return e.getType(t)===e.ATTACHMENT},e.isHeaderFooter=function(e){return this.getType(e)===this.HEADER_FOOTER},e.isTable=function(t){return e.getType(t)===e.TABLE},e.isImage=function(t){return e.getType(t)===e.IMAGE},e.isHr=function(t){return e.getType(t)===e.HR},e.isUnknown=function(t){return this.getType(t)===e.UNKNOWN},e.isHeading=function(t){return e.getType(t)===e.HEADING},e.isCatalogue=function(t){return e.getType(t)===e.CATALOGUE},e.isTodo=function(t){return e.getType(t)===e.TODO},e.isQuote=function(t){return e.getType(t)===e.QUOTE},e.isTextBlock=function(t){return e.isParagraphCluster(t)},e.isTextOrTableBlock=function(t){return e.isTextBlock(t)||e.isTable(t)},e.isHandWrite=function(t){return e.getType(t)===e.HANDWRITE},e.ATTACHMENT="attachment",e.BLOCK="block",e.CATALOGUE="catalogue",e.HANDWRITE="handwrite",e.HEADER_FOOTER="header-footer",e.HEADING="heading",e.HR="horizontal-line",e.IMAGE="image",e.LIST_ITEM="list-item",e.PARAGRAPH="paragraph",e.QUOTE="quote",e.TABLE="table",e.TODO="todo",e.UNKNOWN="unknown",e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";return function(){function e(){}return e.isCollabCommand=function(e){var t=!1;return null!=e&&null!=e.collabProperties&&(t=e.collabProperties.isCollabCmd),t},e.isGUID=function(e){return!!e&&/^[\w\-]+$/.test(e)},e.isInlineStateSetCommand=function(e){return null!=e.isInlineStateSet&&!0===e.isInlineStateSet()},e.newGUID=function(){var e="";return e+=(Math.floor(100*Math.random())+"00").substr(0,2),e+=(Math.floor(100*Math.random())+"00").substr(0,2),e+="-",e+=Date.now().toString()},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(1),o=n(0);return{_map:{},add:function(e){var n=this,o=e.prototype.name,i=n._map;return o?i[o]?void t.error("Command class ["+o+"] exists!"):void(i[o]=e):void t.error("The Command class has no name!",e)},get:function(e){var n=this,o=n._map,i=o[e];return i||t.error("Command class ["+e+"] does not exist!"),i},getAllNames:function(){var e=this;return o.keys(e._map)}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(17),o=n(1),i=n(0),r={_keyHandlerMap:{},_parseKey:function(e){return e+="",e=e.replace(/[\s\uFEFF\xA0]/g,""),e=e.toLowerCase()},_makeMapKey:function(e,t){return(e=e||"main")+"-"+t},getHandler:function(e,t){return this._keyHandlerMap[this._makeMapKey(e,t)]},register:function(e){if(!(e&&e.name&&e.key&&e.action))return void o.warn("The param is not valid!",e);var t,n,r,a=this._keyHandlerMap;return n=i.defaults({},e,{scope:"main",read:!1,preventDefault:!0}),n.key=t=this._parseKey(e.key),t?(r=this._makeMapKey(n.scope,n.name),a[r]||i.some(a,function(e){return e.key===t&&e.scope===n.scope})?void o.error("The key handler is conflict with other",n):void(a[r]=n)):void o.warn("The key is not valid!",e)},exec:function(e,t,n,i){var r=this._makeMapKey(e,t),a=this._keyHandlerMap[r];return a?n.isReadOnly&&n.isReadOnly()&&!a.read?void(i&&i.preventDefault&&i.preventDefault()):(a.preventDefault&&i&&i.preventDefault&&i.preventDefault(),void a.action.apply(a,[n,i,t])):void o.warn("No key handler for scope/name: ",e,t)},matchKey:function(e,t){if(t){var n,r=this._keyHandlerMap;return n=i.find(r,function(n){return n.key===t&&n.scope===e}),n?n.name:void o.warn("Can not find the key handler with key: "+t)}},getAllHandlerNamesOfScope:function(e){var t=[];return i.each(this._keyHandlerMap,function(n){n.scope===e&&t.push(n.name)}),t}};return t.extend({initialize:function(e){var t=this;e=i.defaults(e||{},{scope:"main"}),t._scope=e.scope,t._customMap={},delete t.options},getKey:function(e){var t=this;return(t._customMap[e]||r.getHandler(t._scope,e)||{}).key},bind:function(e){var t=this,n=t.getKey(e);n&&t.trigger("bind-key",n)},unbind:function(e){var t=this,n=t.getKey(e);n&&t.trigger("unbind-key",n)},updateKey:function(e,t){if(e&&t){var n=this;r.getHandler(n._scope,e)&&(n.unbind(e),n._customMap[e]={key:t},n.bind(e))}},hasHandler:function(e){var t=this;return!!r.getHandler(t._scope,e)},execWithKey:function(e,t,n){var a,l=this;if(i.some(l._customMap,function(t,n){if(t.key===e)return a=n,!0}),a||(a=r.matchKey(l._scope,e)),!a)return void o.warn("no handler for scope/key ",l._scope,e);r.exec(l._scope,a,t,n)},execWithName:function(e,t,n){r.exec(this._scope,e,t,n)},getAvailableHandlerNames:function(){return r.getAllHandlerNamesOfScope(this._scope)}},{register:function(e){r.register(e)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";return{COMPAT:"compat",DEFAULT_BACKGROUND:"NoBackground",INTERM:"interm",INDENT_WIDTH:28,MAX_LIST_ITEM_LEVEL:9,LINE_BREAK:/Windows/.test(window.navigator.userAgent)?"\r\n":"\n",IS_MAC:/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),QUOTE_PADDING:"0 10px 0 8.5px",QUOTE_BORDER_LEFT:"1.5px solid #e8e8e8",QUOTE_MARGIN:"0 5px",PLATFORM_LINE_HEIGHT:1.75,PAGE_TYPE_A4:"A4",PAGE_TYPE_B5:"B5",PAGE_TYPE_NONE:"NONE",PAGE_TYPE_TEST:"TEST",PAGE_HEIGHT_A4:1123,PAGE_HEIGHT_B5:945,PAGE_HEIGHT_NONE:Number.MAX_VALUE,PAGE_HEIGHT_TEST:100,PAGE_WIDTH_A4:792,PAGE_WIDTH_B5:663,PAGE_WIDTH_NONE:Number.MAX_VALUE,PAGE_WIDTH_TEST:792,PAGE_SPLIT_BLANK_HEIGHT:70,PAGE_SPLIT_MIDDLE_HEIGHT:10,TOLERABLE_HEIGHT_CHANGE:3,PAGE_CLASS_A4:"page-A4",PAGE_CLASS_B5:"page-B5",PAGE_CLASS_TEST:"page-TEST",WSClientStatusCode:{Connecting:0,Open:1,Closing:2,Closed:3,Ready:5,Disabled:10,Intializing:11},WSEVENTID_HOST_CLOSE:4500,MAX_MESSAGE_SIZE:5e3,MAX_UNDO_STACK_SIZE:20,MAX_CMD_DELAY_MILLIS:4e3,MAX_INIT_DELAY_MILLIS:2e3,MAX_LOCAL_CMD_COUNT_PER_SEC:20,REGULAR_CMD_SENT_MILLIS:2e3,LATENCY_TO_SHOW_SET_CONTENT_PROGRESS:2e3,CJSON_ACTION:"action",CJSON_COMMANDID:"cmdId",CJSON_COMMANDOWNER:"cmdOwner",CJSON_COLLABCOMMANDS:"collabCmds",CJSON_COLLAB_NOTE_READY:"collabNoteReady",CJSON_COLLAB_VERSION:"collabVersion",CJSON_DATA_CMD_ERROR:"dataCmdError",CJSON_ENDVERSION:"endVersion",CJSON_ERROR_TO_CLOSE:"errToClose",CJSON_FINALVERSION:"finalVersion",CJSON_INITIALIZE_COLLABSTARTED:"collabStarted",CJSON_INITIALIZE_DONE:"done",CJSON_INITIALIZE_RESULT:"initResult",CJSON_IS_HISTORY_SAVE:"isHistorySave",CJSON_IS_SERVER_CMD:"isServerCmd",CJSON_LOCKCOLOR:"lockColor",CJSON_LOCK_BLOCK_ID:"lockedBlkId",CJSON_MODIFIERS:"modifiers",CJSON_NICKNAME:"nickname",CJSON_NONDATACOMMANDS:"nondataCmds",CJSON_NOTEVERSIONUPDATE:"versionUpdate",CJSON_PORTRAIT:"portraitUrl",CJSON_READONLY:"readOnly",CJSON_SESSIONID:"sessionId",CJSON_SESSIONPROPERTY:"sessionProp",CJSON_STARTVERSION:"startVersion",NONDATACMD_BLOCKSELECTION:"nb_BlkSelection",NONDATACMD_CLINTPONG:"nb_clientPong",NONDATACMD_COLLABCLOSE:"nb_CollabClose",NONDATACMD_COLLABINFO:"nb_CollabInfo",NONDATACMD_DATACMDFAILED:"nb_dataCmdFailed",NONDATACMD_GETMODIFIERS:"nb_getModifiers",NONDATACMD_NOTESAVE:"nb_noteSave",NONDATACMD_LOCKRELEASE:"nb_lockRelease",NONDATACMD_SESSIONINITIALIZED:"nb_sessionInitialized",NONDATACMD_SEVERPING:"nb_serverPing",OPTIONS_COLLABID:"collabId",OPTIONS_NICKNAME:"nickname",OPTIONS_NOTEVERSION:"noteVersion",OPTIONS_PORTRAIT:"portraitUrl",OPTIONS_SESSIONTYPE:"sessionType",OPTIONS_SESSIONID:"sessionId",OPTIONS_USERID:"userId",OPTIONS_BUILDVERSION:"buildVersion",OPTIONS_RECONNECT:"reconn",ERRORID_FAILED_RECEIVE_COLLAB_CMD:4001,ERRORID_FAILED_SEND_LOCAL_CMD:4002,ERRORID_COLLAB_ENGINE_NULL:4003,CONNECTION_FAILED_SEND:"发送协同命令失败：",CONNECTION_NO_CONNECTED:"当前没有与协同服务器连接",CONNECTION_REFUSED:"协同服务器连接被拒绝",CONNECTION_SERVER_CLOSED:"协同服务器已经关闭",ERROR_CODE:"错误编码：",ERROR_CONFLICT_EXECUTION:"编辑区域冲突",ERROR_FAILED_SEND_LOCAL_CMD:"发送本地已执行命令失败",ERROR_FAILED_RECEIVE_COLLAB_CMD:"接收协同命令超时",ERROR_EXCEPTION:"未知错误：",ERROR_REASON:"原因：",ERROR_UNMATCHED_VERSION:"本地笔记版本与服务器端不匹配，本地/服务器：",INVALIDACTION_BLANK_NOTE:"笔记还没有加载",INVALIDACTION_BLOCKS_DIRTY:"目标段落已经被人修改过",INVALIDACTION_COLLAB_NOT_READY:"笔记内容不满足协同的要求",INVALIDACTION_EDIT_READ_ONLY:"只读模式下不可以编辑",INVALIDACTION_EDIT_NOT_READY:"笔记还没有进入编辑状态，如果此状态持续数秒，请刷新页面",INVALIDACTION_FINALVERSION_NOTREADY:"被撤销命令正在同步中，请稍后再试",INVALIDACTION_EMPTY_CMDJSON:"空协同操作指令，将被忽略",INVALIDACTION_EMPTY_LOCALCMD:"空本地操作指令，将被忽略",INVALIDACTION_INVALID_LOCALCMD:"无效的本地命令",INVALIDACTION_FAILED_COLLABCMD:"协同命令执行失败",INVALIDACTION_FAILED_LOCALCMD:"本地命令执行失败",INVALIDACTION_INVALID_CMD_VERSION:"被撤销命令版本无效，丢弃此命令",INVALIDACTION_INVALID_RANGE:"命令所操作区域已经被删除或者无效",INVALIDACTION_TOO_MANY_CMD:"命令操作过快，请稍候，等待处理命令个数：",INVALIDACTION_TOO_LARGE_MESSAGE:"操作所含数据过多，请减少操作数据：",INVALIDACTION_UNSUPPORTED_CMD:"不支持的操作指令：",INVALIDACTION_WORK_ON_LOCKED_BLOCK:"当前或相邻的段落或目标段落被锁定或删除，请稍后操作",LOADING_IMAGE_PATH:"http://note.youdao.com/editor/collab/loading.gif?47",INSERT_BLANK_CATALOGUE_TEXT:"目录为空，请插入标题（字体左侧）后点击刷新按钮"}}.apply(t,o))&&(e.exports=i)},,function(e,t,n){var o;void 0!==(o=function(e){var t=n(108),o=n(0),i=n(1),r=new RegExp("^/yws/res/|^https?://"+t.getNamespace()+"/yws/res"),a=new RegExp("^/yws/api/group|^https?://"+t.getNamespace()+"/yws/api/group"),l={UNKNOWN:-1,WEB_NOTE:1,WEB_GROUP:2,PC:3,IPHONE:4,ANDROID:5,MAC:6},s=window.YNE_PLATFORM||l.UNKNOWN,c=o.keys(l),u={};return l.name=s,o.each(c,function(e){var t=e.toLowerCase(),n=s[e];l["IS_"+e]=s===n||s===t}),s.IS_UNKNOWN&&i.error("The platform is unknown!"),u.isFromWebNote=function(e){return r.test(e)},u.isFromWebGroup=function(e){return a.test(e)},o.extend(l,u),l}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(0),i=n(156),r=n(3),a=n(1),l=n(14),s=n(55),c=n(2);return t=i.extend({name:"UnknownCompositeCommand",_args:null,_cmds:null,_affectedBlockIds:null,_note:null,isSimple:!1,startingRange:null,endingRange:null,effected:!1,isLocalExecutedCmd:null,finalNoteVersion:null,originalNoteVersion:null,skipBlockLocking:!1,isOriginalCmd:!1,sendingToCollabServerMillis:null,isReadyToApply:null,initialize:function(){var e,n=this;n._args=n.options.args||{},n._args.collabProperties=n._args.collabProperties||{},e=n._args.collabProperties,n._cmds=[],n._affectedBlockIds=[],t.__super__.initialize.apply(n),!0===e.isCollabEnabled&&(e.isCollabCmd&&(n.finalNoteVersion=e.finalNoteVersion),n._initializeAffectedBlocks(),n.rangeIsRequired=!0,n.isReadyToApply=!0,n._args.isOriginalCmd&&(n.isOriginalCmd=!0))},finilize:function(){},_applyCommandToComposite:function(e,t){var n,o=this,i=o._cmds;i||(i=o._cmds=[]),n=e.apply(),e.isSimple?o.effected=!1!==n:(o.effected=o.effected||e.effected,o._affectedBlockIds||a.error("_affectedBlockIds cannot be null. please check the cmd("+o.name+") initialize has invoked its parent method")),t?o.setEndingRange(t):!e.isSimple&&e.getEndingRange()&&o.setEndingRange(e.getEndingRange()),i.push(e)},apply:function(){throw"Method not implemented."},doReapply:function(e){var t,n,o=this,i=o._cmds;if(a.log("doReapply(): `"+o.name+"`"),r.isCollabCommand(e))return o._reapplyCollabCmd(e);if(!i||!i.length)return a.warn("doReapply(): the composite command `"+o.name+"`no _cmds"),!0;for(t=i.length,n=0;n<t;++n)i[n].doReapply(e);return!0},doUnapply:function(e){var t,n=this,o=n._cmds;if(a.log("doUnapply(): `"+n.name+"`"),r.isCollabCommand(e))return n._unapplyCollabCmd(e);if(!o||!o.length)return a.warn("doUnapply(): the composite command `"+n.name+"`no _cmds"),!0;for(t=o.length-1;t>=0;--t)o[t].doUnapply(e);return!0},setStartingRange:function(e){var t=this;if(!l.isNoteRange(e))return void a.warn("noteRange is not a NoteRange",e);t.startingRange=e,t.options.args.range=t.startingRange},setEndingRange:function(e){var t=this,n=[];if(!l.isNoteRange(e))return void a.warn("noteRange is not a NoteRange",e);t.endingRange=e,n=t._getAffectedBlockIdsFromRange(t.options.note,t.endingRange),t.pushAffectedBlockIds(n)},getStartingRange:function(){return this.startingRange},getEndingRange:function(){return this.endingRange},canBeMerged:function(e){var t=this,n=["comp.KeyTextInput"];return!!o.contains(n,t.name)&&(!t.isCollabUndo&&!t.isCollabRedo&&e.name===t.name&&e.getCmdId()!==t.getCmdId()&&e.isLocalExecutedCmd===t.isLocalExecutedCmd)},executeAtomicCommand:function(e,t){this._applyCommandToComposite(e,t)},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties.cmdJSON,i=n.collabProperties.coreEditor;t.__super__.fromCollabJSON.apply(e),o&&(o.startNoteRange&&(n.range=s.buildNoteRangeFromJSON(o.startNoteRange,i),n.range?e.setStartingRange(n.range):a.warn("Failed to re-build the startNoteRange",o.startNoteRange)),o.endNoteRange&&(n.endRange=s.buildNoteRangeFromJSON(o.endNoteRange,i),n.endRange&&e.setEndingRange(n.endRange)),o.cmdNoteVersion&&(e.originalNoteVersion=o.cmdNoteVersion),e.skipBlockLocking=o.skipBlockLocking)},getAffectedBlockIds:function(){return o.clone(this._affectedBlockIds)},getCmdFinalNoteVersion:function(){return this.finalNoteVersion},getCmdOriginalNoteVersion:function(){return this.originalNoteVersion},getCollabProps:function(){return this._args.collabProperties},getLockedBlockIds:function(){var e=this,t=[],n=e.endingRange;return e.isCollabUndo?n=e.startingRange:e.skipBlockLocking&&(n=null),l.isNoteRange(n)?t.push(n.getEndBlockRange().getBlockId()):n&&a.error("locked targetRange should be a NOTE range",n),t},getIgnoreUndoRedo:function(){return this._args.ignoreUndoRedo},isSingleBlockAffected:function(){var e=this,t=!0;return e._args.range?l.isNoteRange(e._args.range)&&e._args.range.isInMultiBlock()&&(t=!1):t=!1,t},isValidStartNoteRange:function(){return!0},mergeLocalCmd:function(e){a.log("targetCmd:",e)},pushAffectedBlockIds:function(e){var t=this;e&&(t._affectedBlockIds=o.union(t._affectedBlockIds,e))},resetAffectedBlockIds:function(e){var t=this;t._affectedBlockIds=[],t.pushAffectedBlockIds(e)},setCmdFinalNoteVersion:function(e){this.finalNoteVersion=e},setCmdOriginalNoteVersion:function(e){this.originalNoteVersion=e},setIgnoreUndoRedo:function(e){this._args.ignoreUndoRedo=e},toCollabJSON:function(){var e,n=this,i=t.__super__.toCollabJSON.apply(n),s=[],c=n.getStartingRange(),u=!1;if(n.isOriginalCmd)if(l.isNoteRange(c))i.startNoteRange=c.toCollabJSON();else if(n.rangeIsRequired)return a.error("startingRange should be noteRange",c),null;if(n.isCollabUndo&&(i.isCollabUndo=n.isCollabUndo),n.isCollabRedo&&(i.isCollabRedo=n.isCollabRedo),n.originalNoteVersion&&(i.cmdNoteVersion=n.originalNoteVersion),n.isCollabUndo||n.isCollabRedo){if(n.cmdId=r.newGUID(),i.cmdId=n.cmdId,n.isOriginalCmd)if(l.isNoteRange(n.endingRange))i.endNoteRange=n.endingRange.toCollabJSON();else if(n.rangeIsRequired)return a.error("endingRange should be a noteRange:",n.endingRange),null;o.each(n._cmds,function(t){u||(t.rangeIsRequired=!1,n.isCollabUndo?(t.setCollabRedo(!1),t.setCollabUndo(!0)):(t.setCollabRedo(!0),t.setCollabUndo(!1)),e=t.toCollabJSON(),e?s.push(e):(u=!0,a.error("Failed to get cmdJSON",t)))}),i.affectedBlockIds=n._affectedBlockIds.join(",")}return u?null:(s.length>0&&(i.innerCmds=s),n.isLocalExecutedCmd&&(i.isLocalExecutedCmd=!0),i.skipBlockLocking=n.skipBlockLocking,i)},_getAffectedBlockIdsFromRange:function(e,t){var n=[],i=[];if(e&&t){switch(t.getType()){case l.TYPE:n=e.getInterBlocks(t.getStartBlockRange().block,t.getEndBlockRange().block,!0);break;case c.PARAGRAPH:t.block&&n.push(t.block);break;default:a.error("pending supported range type:"+t.getType())}n&&n.length>0&&o.each(n,function(e){i.push(e.getId())})}return i},_initializeAffectedBlocks:function(){var e=this,t=[],n=e.options.note,o=e._args.range;o&&(t=e._getAffectedBlockIdsFromRange(n,o),e.pushAffectedBlockIds(t))},_reapplyCollabCmd:function(e){var t=e.collabProperties.cmdJSON;if(t&&t.innerCmds){var n,o=t.innerCmds,i=o.length;for(n=0;n<i;++n){var r=e.collabProperties.coreEditor.buildInnerCommandFromJSON(o[n],e);r&&(r.doReapply(r._args),r.isSimple&&(e.collabProperties.redoUndoEffected=!0))}}},_unapplyCollabCmd:function(e){var t=e.collabProperties.cmdJSON;if(t&&t.innerCmds){var n,o=t.innerCmds,i=o.length;for(n=i-1;n>=0;--n){var r=e.collabProperties.coreEditor.buildInnerCommandFromJSON(o[n],e);r&&(r.doUnapply(r._args),r.isSimple&&(e.collabProperties.redoUndoEffected=!0))}}}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(59),n(17),n(114),n(6),n(1),n(227),n(112),n(20),n(146),n(147)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.create=function(e,n){return new t({keepLineBreak:!1!==n,text:e})},t.createBlank=function(e){return t.create("",e)},t.fromCollabJSON=function(e){if(!e||!e.text)return t.createBlank(!0);var o=t.create(e.text,e.keepLineBreak);return n.each(e.inlineStyles,function(e,t){n.each(e,function(e){d.isSupport(t)?o.setStyle(e.from,e.to,t,e.value):o.setUnknownStyle(e.from,e.to,t,e.value)})}),o},t.fromJSON=function(e){if(e&&e.isRichText&&e.data){var o,i=[];return n.each(e.data,function(e){var t=c.fromJSON(e);t&&i.push(t)}),o=new t({keepLineBreak:e.keepLineBreak,text:""}),o.appendRichChars(i),o}},t.fromXml=function(e){var n=$(e),o=new t({text:n.find("text").text()});return n.find("inline-styles").children().each(function(e,t){var n,i,r=t.nodeName.toLowerCase(),a=$(t),s=parseInt(a.find("from").text(),10),c=parseInt(a.find("to").text(),10),p=a.find("value");0!==p.length&&(n=p.text(),d.isSupport(r)?o.setStyle(s,c,r,n):(i=a.attr(l.COMPAT),u.isCompatible(i)&&(h.add(r),n=i+"|"+n,o.setUnknownStyle(s,c,r,n))))}),o},t.CLONE_DATA=function(e){var t,n=e.length,o=new Array(n);for(t=0;t<n;++t)o[t]=e[t].clone();return o},t.EXTRACT_UNKNOWN_VALUE=function(e){var t=e.indexOf("|");return-1===t?{value:e}:{compat:e.substring(0,t),value:e.substring(t+1)}},t.prototype.append=function(e){e&&e.getClonedData||s.warn("no richText"),this.appendRichChars(e.getClonedData())},t.prototype.appendRichChars=function(e){if(!e||0===e.length)return void s.warn("richChars is not valid",e);this.isKeepLineBreak()||(e=this._removeLineBreak(e)),this.richTextProps.data=this.richTextProps.data.concat(e)},t.prototype.clone=function(){var e=new t({keepLineBreak:this.isKeepLineBreak(),text:""});return e.appendRichChars(this.getClonedData()),e},t.prototype.getClonedData=function(){return t.CLONE_DATA(this.richTextProps.data)},t.prototype.getCommonStyle=function(e,t,n,o){var i,r,a=this.richTextProps.data,c=null;if(this.isEmpty())return d.getDefault(n);if(e<0)return void s.warn("start should not be less than 0",e);if(e>t)return void s.warn("start should not greater than end",e,t);if(t>a.length)return void s.warn("end should not geater than data.length",t,a);if(e===t)0===e&&a[0]?c=a[0].getStyle(n):a[e-1]&&(c=a[e-1].getStyle(n));else for(i=e;i<t;++i)if(a&&a[i]){if(r=a[i].getStyle(n),null===c)c=r;else if(c!==r)return o?null:l.INTERM}else s.warn("unexpected undefine in data",a);return!o||c!==l.INTERM&&c!==d.getDefault(n)?c:null},t.prototype.getCommonStyles=function(e,t,o){var i=this,r={},a=d.getAllConfig();return n.each(a,function(n,a){var l=i.getCommonStyle(e,t,a,o);null!=l&&(r[a]=l)}),r},t.prototype.getLength=function(e){var t,n=this.richTextProps.data,o=n.length;if(e)for(t=0;t<n.length;t++)$.trim(n[t].toString())||o--;return o},t.prototype.getReadOnlyData=function(){return this.richTextProps.data},t.prototype.getReadOnlyStylesList=function(e,t){var o=this.richTextProps.data,i=[],r=d.getAllConfig();return e=!1!==e,n.each(o,function(o){var a={};n.each(r,function(n,i){var r=o.getStyle(i,e,t);(e||!e&&null!=r)&&(a[i]=r)}),i.push(a)}),i},t.prototype.getStyle=function(e,t,n){var i,r,a,l=this.richTextProps.data;if(o(e>=0),o(e<=t),o(t<=l.length),void 0===e||e<0||void 0===t||e>t||t>l.length)return s.error("unexpected params:",e,t,l.length),null;for(a=new Array(t-e),i=e;i<t;++i)r=l[i].getStyle(n),a[i-e]=r;return a},t.prototype.getStyleRanges=function(e,t){if(e){if(t=!0===t,d.isSupport(e))t=!1;else if(!t)return;var o,i,r,a,l=this.richTextProps.data,s=l.length,c=[],u=!1;for(o=0;o<s;o++)i=l[o],r=t?i.getUnknownStyle(e):i.getStyle(e,!1),r?(a=n.last(c),!u&&a&&a.value===r?a.to=o+1:c.push({from:o,to:o+1,value:r}),u=!1):u=!0;return c}},t.prototype.getStylesAtIndex=function(e){var t=this.richTextProps.data,n=t.length;return e<0||e>=n?void s.warn("invlid index of the text",e,t):t[e].getStyles()},t.prototype.indexOf=function(e,t,n){var o,i,r,a,l,s=e.getReadOnlyData(),c=s.length,u=this.getReadOnlyData(),d=u.length;if(c>d)return-1;for(i=t;i<d;i++){for(o=!0,r=0;r<c;r++){if(a=u[i+r],l=s[r],!a){o=!1;break}if((!0!==n||a.char.toLowerCase()!==l.char.toLowerCase())&&a.char!==l.char){o=!1;break}}if(o)return i}return-1},t.prototype.insert=function(e,t){if(e&&e.getClonedData){var n=this.richTextProps.data,o=n.splice(t),i=e.getClonedData();s.log("insert ...",e,t),!1===this.isKeepLineBreak()&&!0===e.isKeepLineBreak()&&(i=this._removeLineBreak(i)),this.richTextProps.data=n.concat(i,o)}},t.prototype.isEmpty=function(){return this.getLength(!1)<=0},t.prototype.isKeepLineBreak=function(){return this.richTextProps.keepLineBreak},t.prototype.removeLineBreak=function(){this.richTextProps.data=this._removeLineBreak(this.richTextProps.data)},t.prototype.removeStyles=function(){var e,t=this.richTextProps.data,n=t.length;for(e=0;e<n;++e)t[e].removeStyles()},t.prototype.setKeepLineBreak=function(e){(e=!!e)!==this.richTextProps.keepLineBreak&&(this.richTextProps.keepLineBreak=e,!1===this.richTextProps.keepLineBreak&&this.removeLineBreak())},t.prototype.setStyle=function(e,t,o,i){if(o&&null!=i){var r,a=this.richTextProps.data,l=n.isArray(i);for(t=Math.min(t,a.length),r=e;r<t;++r)a[r].setStyle(o,l?i[r-e]:i)}},t.prototype.setStyles=function(e,t,o){var i=this;o&&n.each(o,function(n,o){i.setStyle(e,t,o,n)})},t.prototype.setUnknownStyle=function(e,t,o,i){var r,a=this.richTextProps.data,l=n.isArray(i);for(t=Math.min(t,a.length),r=e;r<t;++r)a[r].setUnknownStyle(o,l?i[r-e]:i)},t.prototype.slice=function(e,n,o){var i=this.richTextProps.data.slice(e,n),r=new t({});return!1!==o&&(i=t.CLONE_DATA(i)),r.appendRichChars(i),r},t.prototype.toCollabJSON=function(){return this.toJSON(!0)},t.prototype.toJSON=function(e){var t;return!0===e?this._toSimplifyJSON():(t=n.map(this.richTextProps.data,function(e){return e.toJSON()}),{data:t,isRichText:!0,keepLineBreak:this.isKeepLineBreak()})},t.prototype.toString=function(){return this.richTextProps.data.join("")},t.prototype.toXml=function(e){var t,o=this,i=e.createElement("inline-styles"),r=d.getAllConfig();return n.each(r,function(t,n){var r=o.getStyleRanges(n,!1);o._handleStyleRangesForXML(e,i,n,r,!1)}),t=h.get(),n.each(t,function(t){var n=o.getStyleRanges(t,!0);o._handleStyleRangesForXML(e,i,t,n,!0)}),i},t.prototype.initialize=function(e){var t=this;this.richTextProps=n.clone(e),this.richTextProps=n.defaults(this.richTextProps||{},{keepLineBreak:!0,text:""}),this.richTextProps.data=[],this.richTextProps.text=a.clear(this.richTextProps.text),this.richTextProps.keepLineBreak||(this.richTextProps.text=this.richTextProps.text.replace(/[\r\n]/g,"")),n.each(p(this.richTextProps.text),function(e){t.richTextProps.data.push(new c(e))})},t.prototype._handleStyleRangesForXML=function(e,o,i,r,a){r&&r.length&&n.each(r,function(n){if(n&&n.value){var r,s,c,u=e.createElement(i),d=e.createElement("from"),p=e.createElement("to"),h=e.createElement("value");d.appendChild(e.createTextNode(n.from)),u.appendChild(d),p.appendChild(e.createTextNode(n.to)),u.appendChild(p),a?(r=t.EXTRACT_UNKNOWN_VALUE(n.value),c=r.compat,c&&u.setAttribute(l.COMPAT,c),s=r.value):s=n.value,h.appendChild(e.createTextNode(s)),u.appendChild(h),o.appendChild(u)}})},t.prototype._handleStyleRangesForJSON=function(e,o,i,r){i&&i.length&&n.each(i,function(n){if(n&&n.value){var i,a,l=e[o];l||(l=e[o]=[]),r?(i=t.EXTRACT_UNKNOWN_VALUE(n.value),a=i.value):a=n.value,l.push({from:n.from,to:n.to,value:a})}})},t.prototype._removeLineBreak=function(e){return e&&0!==e.length?e=n.filter(e,function(e){return!1===e.isLineBreak()}):[]},t.prototype._toSimplifyJSON=function(){var e,t,o=this,i={},r=d.getAllConfig();return n.each(r,function(e,t){var n=o.getStyleRanges(t,!1);o._handleStyleRangesForJSON(i,t,n,!1)}),e=h.get(),n.each(e,function(e){var t=o.getStyleRanges(e,!0);o._handleStyleRangesForJSON(i,e,t,!0)}),t={keepLineBreak:o.isKeepLineBreak(),text:o.toString()},n.isEmpty(i)||(t.inlineStyles=i),t},t}(i)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(55),o=n(26),i=n(2),r=n(92),a=n(20),l=n(111),s=n(0),c=n(10),u=n(1),d=n(19),p=n(34),h=n(72),g=n(51),f=n(45),m=n(93),_=n(47),y=n(23),v=n(21),b=n(56),k=n(125),C=n(126),S=n(157),I=n(98),w=n(127),E=n(6),T=n(14),N=n(42);return{createNewListItem:function(e,t,n){var o=new p({id:t,level:e.getLevel(),list:e.getOwnerList(),text:n});return o.setBlockStyles(e.getBlockStyles()),o},createNewParagraph:function(e,t,n,o){var r=new d({blockId:t,text:o?new c({text:n.toString()}):n});return!e||i.isHeading(e)||i.isCatalogue(e)?e&&(r.setBlockStyle("back-color",e.getBlockStyle("back-color")),r.setBlockStyle("padding",e.getBlockStyle("padding"))):r.setBlockStyles(e.getBlockStyles()),r},createNewTodo:function(e,t){var n=new f(t);return e&&n.setBlockStyles(e.getBlockStyles()),n},createNewQuote:function(e,t){var n=new m(t);return e&&n.setBlockStyles(e.getBlockStyles()),n},createNewHeading:function(e,t,n,o,r){var a,s;return n.getLength&&!r&&(s=n.getLength(),i.isHeading(e)&&"b"===e.getLevel()&&(n=this._clearHeadingInlineStyle("color",e,n)),n.setStyles(0,s,l.headingInlineStyles[o])),a=new h({id:t,text:n,level:o}),a.setBlockStyles(e.getBlockStyles()),l.headingBlockStyles[o]&&!r&&a.setBlockStyles(l.headingBlockStyles[o]),a},_clearHeadingInlineStyle:function(e,t,n){var o,i=t.getLevel(),r=l.headingInlineStyles[i],a=r[e];for(o=0;o<n.getLength();o++)a===n.getStylesAtIndex(o)[e]&&delete n._data[o].styles[e];return n},createNewCatalogue:function(e,t){var n=new g(t);return!t.ownerList&&i.isCatalogue(e)&&(t.ownerList=e.getOwnerList()),n=new g(t),e&&n.setBlockStyles(e.getBlockStyles()),n},isForCatalogueBlock:function(e){return i.isHeading(e)&&e.getLevel()<4&&!e.isEmpty()&&e.getText().toString().trim()},deleteSelectedContent:function(e,t,n){var o,r,a,l,s;if(!T.isNoteRange(n))return void u.error("deleteSelectedContent: selectedNoteRange should be a NoteRange",n);o=n.getStartBlockRange(),a=n.getEndBlockRange(),r=o.block,l=a.block,i.isTextBlock(r)&&e.executeAtomicCommand(new _({block:r,start:o.start,end:o.end})),n.isInMultiBlock()&&(s=t.getInterBlocks(r,l),s&&s.length>0&&e.executeAtomicCommand(new y({note:t,blocks:s})),i.isTextBlock(l)&&e.executeAtomicCommand(new _({block:l,start:a.start,end:a.end})))},getBackwardBlockRange:function(e,t){var n=e.getPreBlock(t);if(n)return o.createRangeByBlock({block:n,allContent:!1,collapseToStart:!1})},getForwardBlockRange:function(e,t){var n=e.getNextBlock(t);if(n)return o.createRangeByBlock({block:n,allContent:!1,collapseToStart:!0})},insertTabChar:function(e,t,n,o){var i;i=new c({text:"\t"}),i.setStyles(0,i.getLength(),o),e.executeAtomicCommand(new b({block:t,start:n,text:i}))},isInSameList:function(e){var t,n=!1;return i.isListItem(e[0])?n=s.every(e,function(e,n){if(i.isListItem(e)){if(0===n)return t=e.getOwnerList(),!0;if(e.getOwnerList()===t)return!0}return!1}):n},recogLink:function(e,t,n,o){var i,a,l={color:"#003884",underline:!0};i=t.getText().toString().slice(n,o);for(var s=o-1;s>=n;s--)if(t.getTextStyle("href",s,s+1)[0]){n=s;break}i=i.slice(n,o),(a=r.matchEnd(i))&&a.result&&(l.href=a.fullURI,e.executeAtomicCommand(new k({blocks:[t],styleNameValues:l,start:n+a.result.index,end:o})))},replaceBlockWithListItem:function(e,t,n,o,i,r){var a,l=this,s=o.getId();return e.executeAtomicCommand(new y({note:t,blocks:[o]})),a=l.createNewListItem(n,s,i),e.executeAtomicCommand(new v({note:t,newBlks:[a],preBlk:r})),a},replaceBlockWithParagraph:function(e,t,n,o,i){var r,a=this,l=n.getId(),s=t.getPreBlock(n);return r=a.createNewParagraph(n,l,o,i),r.setInlineStylesForEmpty(i),e.executeAtomicCommand(new y({note:t,blocks:[n]})),e.executeAtomicCommand(new v({note:t,newBlks:[r],preBlk:s})),r},replaceBlockWithHeading:function(e,t,n,o,i){var r,a=this,l=n.getId(),s=t.getPreBlock(n);return r=a.createNewHeading(n,l,o,i),e.executeAtomicCommand(new y({note:t,blocks:[n]})),e.executeAtomicCommand(new v({note:t,newBlks:[r],preBlk:s})),r},deleteHref:function(e,t,n,o){var i={href:"",color:"#393939",underline:!1};e.executeAtomicCommand(new k({blocks:[t],styleNameValues:i,start:n,end:o}))},resetAllStyles:function(e,t,n,o,i,r){this.setStylesOnNoteRange(e,t,n,o,i,r)},setNonTextBlockAsEndingRange:function(e,n){var o=t.buildNoteRangeFromNonTextBlock(n);e.setEndingRange(o)},setBlockStyle:function(e,t){e&&e.setInlineStylesForEmpty&&e.isEmpty()&&e.setInlineStylesForEmpty(t)},setResourceBlockStyleByPreBlock:function(e,t){e&&t&&(e.setBlockStyle("back-color",t.getBlockStyle("back-color")),e.setBlockStyle("padding",t.getBlockStyle("padding")))},setStylesOnNoteRange:function(e,t,n,o,r,l){var c,u=this,d=n.getStartBlockRange(),p=d.block,h=n.getEndBlockRange(),g=h.block,f=[],m=[],_=[],y=[],v=!!l&&l.resetAllStyles,b=!!l&&l.isRemoveFormat;return(void 0===o&&void 0===r||v)&&(c=!0,r||(r=a.getAllDefault(["href"]))),o=o||{},r=r||{},u._isFullSelected(d)?m.push(p):(c&&(o=p.getDefaultBlockStyles()),b||u._setBlocksBlockStyles(e,[p],o)),n.isInMultiBlock()&&(f=t.getInterBlocks(p,g),m=s.union(m,f),u._isFullSelected(h)?m.push(g):(c&&(o=g.getDefaultBlockStyles()),b||u._setBlocksBlockStyles(e,[g],o))),s.each(m,function(t){c&&(o=t.getDefaultBlockStyles()),u._setBlocksBlockStyles(e,[t],o),i.isTextBlock(t)&&_.push(t),i.isTable(t)&&y.push(t)}),s.isEmpty(r)||(i.isTextBlock(p)&&!u._isFullSelected(d)&&e.executeAtomicCommand(new k({blocks:[p],styleNameValues:c&&i.isHeading(p)?p.getDefaultInlineStyles():r,start:d.start,end:d.end})),n.isInMultiBlock()&&i.isTextBlock(g)&&!u._isFullSelected(h)&&e.executeAtomicCommand(new k({blocks:[g],styleNameValues:c&&i.isHeading(g)?g.getDefaultInlineStyles():r,start:h.start,end:h.end})),m.length>0&&(_=u._filterHeadingBlock(e,_,r,c),e.executeAtomicCommand(new k({blocks:_,styleNameValues:r,fullText:!0})))),this._filterTableBlocks({isStyleReset:c,startBlockRange:d,endBlockRange:h,noteRange:n,fullSelectedTableBlocks:y,inlineStyles:r,blockStyles:o,targetCmd:e})},_filterHeadingBlock:function(e,t,n,o){if(!o)return t;var r=t.filter(function(e){if(!i.isHeading(e))return e}),a=t.filter(function(e){if(i.isHeading(e))return e});return a.length>0&&a.forEach(function(t){e.executeAtomicCommand(new k({blocks:[t],styleNameValues:t.getDefaultInlineStyles(),fullText:!0}))}),r},_filterTableBlocks:function(e){var t=this,n=e.startBlockRange,o=e.endBlockRange,r=e.noteRange,a=e.fullSelectedTableBlocks,l=e.inlineStyles,c=e.blockStyles,u=e.targetCmd,d=n.block,p=o.block;n.isOnCellEdit&&n.isOnCellEdit()||t._adaptTableStylesInlineToBlock(l,c,e.isStyleReset),s.isEmpty(l)||(i.isTable(d)&&t._setTableCellInlineStyles({table:d,range:n,styles:l,cmd:u}),r.isInMultiBlock()&&i.isTable(p)&&t._setTableCellInlineStyles({table:p,range:o,styles:l,cmd:u}),a.forEach(function(e){t._setTableCellInlineStyles({table:e,styles:l,isAll:!0,cmd:u})})),s.isEmpty(c)||(i.isTable(d)&&t._setTableCellBlockStyles({table:d,range:n,styles:c,cmd:u}),r.isInMultiBlock()&&i.isTable(p)&&t._setTableCellBlockStyles({table:p,range:o,styles:c,cmd:u}),a.forEach(function(e){t._setTableCellBlockStyles({table:e,isAll:!0,styles:c,cmd:u})}))},_adaptTableStylesInlineToBlock:function(e,t,n){!s.isEmpty(e)&&e["back-color"]&&(t.backColor=e["back-color"],n||delete e["back-color"])},_setTableCellInlineStyles:function(e){var t,n,o=e.isAll,i=e.range,r=e.cmd,a=o?N.TYPES.ALL:N.TYPES.NORMAL;i?t=i.getAsRectRange():a===N.TYPES.ALL&&(i=N.create({block:e.table,type:N.TYPES.ALL}),t=i.getAsRectRange()),n=t?t.getRect():null,r.executeAtomicCommand(new S({table:e.table,styles:e.styles,type:a,rect:n}))},_setTableCellBlockStyles:function(e){var t=e.isAll,n=e.range?e.range:N.create({block:e.table,type:N.TYPES.ALL}),o=e.cmd,i=n.getAsRectRange(),r=t?N.ALL:N.NORMAL,a=n&&i?i.getRect():null;o.executeAtomicCommand(new I({table:e.table,styles:e.styles,type:r,rect:a}))},setTextBlockAsEndingRange:function(e,n,o,i){var r=t.buildNoteRangeFromParagraph(n,o,i);e.setEndingRange(r)},updateBlocksIndentLevel:function(e,t,n){var o,i,r={},a={};s.each(t,function(e){o=e.getBlockStyle("indent"),!s.isNumber(o)||0===o&&n<0||(i=parseInt(e.getBlockStyle("text-indent"),10)||0,o=o<0?0:o+n,o=Math.min(o,E.MAX_LIST_ITEM_LEVEL-i),r[o]||(r[o]=[]),r[o].push(e))}),s.each(r,function(t,n){a.indent=n,e.executeAtomicCommand(new C({blocks:t,styleNameValues:a}))})},updateBlockTextIndentLevel:function(e,t,n){var o,i,r;o=t.getBlockStyle("text-indent"),r=parseInt(t.getBlockStyle("indent"),10)||0,o||(o=0),i=o+n,(i=Math.min(i,E.MAX_LIST_ITEM_LEVEL-r))>=0&&e.executeAtomicCommand(new C({blocks:[t],styleNameValues:{"text-indent":i}}))},_isFullSelected:function(e){var t=e.block;return i.isTextBlock(t)?0===e.start&&e.end===t.getLength()||void 0:!i.isTable(t)||e.isFullSelected()},_setBlocksBlockStyles:function(e,t,n){s.isEmpty(n)||e.executeAtomicCommand(new C({blocks:t,styleNameValues:n}))},fixMergeCellBeforeRowColChange:function(e){e.isCol?this._fixMergeCellColChange(e):this._fixMergeCellRowChange(e)},_fixMergeCellRowChange:function(e){var t,n,o,i,r=this,a=e.table,l=e.isCol,s=e.insertData,c=e.isDelete,d=e.index,p=a.getCells();if(p[d])for(n=0;n<p[d].length;n++)if((t=a.getCell(d,n))&&(t.isMergePoint()&&c&&(i=r._fixMergePointCellWhenDel({cell:t,row:d,col:n,table:a,isCol:l,cmd:e.cmd})),t.isMergedCell())){if(o=r._findMergePointCell({cell:t,row:d,col:n,table:a}),o.row===d)continue;if(i=r._fixMergePointWithMergeCell({pointCellInfo:o,table:a,isCol:l,isDelete:c,insertData:s,cmd:e.cmd,cellInfo:{row:d,col:n}}),i.col<n)return void u.error("New index should more then i");n=i.col}},_fixMergeCellColChange:function(e){var t,n,o,i,r=this,a=e.table,l=e.isCol,s=e.insertData,c=e.isDelete,d=e.index,p=a.getCells();for(n=0;n<p.length;n++)if((t=a.getCell(n,d))&&(t.isMergePoint()&&c&&(i=r._fixMergePointCellWhenDel({cell:t,row:n,col:d,table:a,isCol:l,cmd:e.cmd}),n=i.row),t.isMergedCell())){if(o=r._findMergePointCell({cell:t,row:n,col:d,table:a}),o.col===d)continue;if(i=r._fixMergePointWithMergeCell({pointCellInfo:o,table:a,isCol:l,isDelete:c,insertData:s,cmd:e.cmd,cellInfo:{row:n,col:d}}),i.row<n)return void u.error("New index should more then i");n=i.row}},_findMergePointCell:function(e){var t=e.row,n=e.col,o=e.table;return o.getCell(t,n,{findMergePointIfNeeded:!0,withPosition:!0})},_fixMergePointWithMergeCell:function(e){var t,n,o,i,r=e.table,a=e.pointCellInfo,l=e.cellInfo,s=e.isDelete,c=e.isCol,u=e.cmd,d=e.insertData,p=a.cell,h=a.row,g=a.col,f=p.getMergePointAttr(),m=l.row,_=l.col,y=0,v=0;for(s?c?y=-1:v=-1:c?y=1:v=1,u.executeAtomicCommand(new w({table:r,type:w.TYPES.POINT,value:{width:f.width+y,height:f.height+v,fireChange:!1},rect:{row:h,col:g}})),t=m;t<h+f.height;t++)for(n=_;n<g+f.width;n++)o=r.getCell(t,n),i=o.getMergedCellAttr(),n===_&&!s&&c&&d[t]&&d[t].setMergedCellAttr(i.dx,i.dy),t!==m||s||c||!d[n]||d[n].setMergedCellAttr(i.dx,i.dy),u.executeAtomicCommand(new w({table:r,type:w.TYPES.CELL,value:{dx:i.dx+y,dy:i.dy+v,fireChange:!1},rect:{row:t,col:n}}));return{row:h+f.height-1,col:g+f.width-1}},_fixMergePointCellWhenDel:function(e){var t,n,o,i,r=e.cell,a=e.row,l=e.col,s=e.table,c=e.isCol,u=e.cmd,d=r.getMergePointAttr(),p=0,h=0;for(c?h=1:p=1,t=a+p;t<a+d.height;t++)for(n=l+h;n<l+d.width;n++)(o=s.getCell(t,n))&&(t!==a+p||n!==l+h?(i=o.getMergedCellAttr(),u.executeAtomicCommand(new w({table:s,type:w.TYPES.CELL,value:{dx:i.dx-h,dy:i.dy-p},rect:{row:t,col:n}}))):u.executeAtomicCommand(new w({table:s,type:w.TYPES.POINT,value:{width:d.width-h,height:d.height-p},rect:{row:t,col:n}})));return{row:a+d.height-1,col:l+d.width-1}}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(1)],void 0!==(i=function(e,t,n){"use strict";return function(){function e(){}return e.getTemplate=function(e,t){var o=e+"/"+t,i=this&&this.JST?this:window,r=i.JST[o];if(!r){if(n.DEBUG)throw new Error("JST has no template: "+o);n.error("JST has no template: "+o)}return r},e.render=function(e,t,o){var i=this.getTemplate(e,t);if(i)return i(o);n.error("no tempalte: "+e+"/"+t+".jst","template/jst.js")},e.trimTempalte=function(e){if(e=e||""){var t,n,o=e.split(/[\r\n]/),i=o.length;for(t=0;t<i;t++)n=o[t]||"",n=n.trim(),o[t]=n;return o.join("")}},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(15),n(1),n(6)],void 0!==(i=function(e,t,n,o,i,a){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.checkStatus=function(e,o){this.resetStatus(),!1===this.queryAction(e,o)&&(this.isDisabled=this.isHidden=!0),this.isHidden||this.type===t.TYPE.SUBMENU&&(n.invoke(this.items,"checkStatus",e,o),this.isDisabled=0===this.items.filter(function(e){return!e.isHidden&&!e.isDisabled}).length)},t.prototype.onSelected=function(){if(this.keyHandlerName)return void this.editor.getController().execKeyHandler(this.keyHandlerName);this.selectAction()},t.prototype.queryAction=function(e,t){i.error("The queryAction() of "+this.name+" should be implemented by options!")},t.prototype.reset=function(){this.resetStatus()},t.prototype.select=function(){this.onSelected()},t.prototype.selectAction=function(){i.error("The selectAction() of "+this.name+" should be implemented by options!")},t.prototype.simplify=function(){var e={index:this.index,type:this.type,isDisabled:this.isDisabled,isHidden:this.isHidden,isDefault:this.isDefault,label:this.label,key:this._getKey()};return this.items&&this.items.length&&(e.items=n.map(this.items,function(e){if(e&&e.simplify)return e.simplify()})),e},t.prototype.initialize=function(e){e=e||{},this.name=e.name,this.label=e.label,this.type=e.type||t.TYPE.ITEM,this.isDefault=!!e.isDefault,this.isDisabled=!!e.isDisabled,this.isHidden=!!e.isHidden,this.key=e.key||"",this.keyHandlerName=e.keyHandlerName||"",this.items=e.items,null!=e.queryAction&&(this.queryAction=e.queryAction),null!=e.selectAction&&(this.selectAction=e.selectAction)},t.prototype.resetStatus=function(){this.isDefault=!1,this.isDisabled=!1,this.isHidden=!1},t.prototype._getKey=function(){var e=this.key||"",o={meta:"⌘",ctrl:"⌃",alt:"⌥",shift:"⇧"},r=this.editor.getController().keyHandlerManager;return this.keyHandlerName&&r&&(e=r.getKey(this.keyHandlerName)),e?(e=e.replace(/[\s\uFEFF\xA0]/g,""))?(e=e.toLowerCase(),e=e.replace(/mod/,t.MOD),a.IS_MAC&&n.each(o,function(t,n){e=e.replace(n,t)}),e=e.replace(/^([a-z])/g,function(e,t){return t.toUpperCase()}),e=e.replace(/\+([a-z])/g,function(e,t){return"+"+t.toUpperCase()})):"":(i.warn("no key for ContextMenuItem: "+this.name),"")},t.TYPE={ITEM:0,SUBMENU:1,SPLIT:2},t.MOD=a.IS_MAC?"meta":"ctrl",t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(19),n(94),n(35),n(8),n(15),n(1),n(6),n(2),n(263)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.create=function(e){return e&&e.startRange&&e.endRange?new t(e):void c.warn("options is unvalid!")},t.createForHeaderFooter=function(e){return new t({blockRanges:[new i({block:e})]})},t.createMock=function(){var e={},n=new o({}),i=new a({block:n,end:0,start:0});return e.startRange=i,e.endRange=e.startRange,new t(e)},t.fromCollabJSON=function(e,n){var o=null;if(e){var i=e.startBlockRange,r=e.endBlockRange,a={};a.startRange=n.buildBlockRangeFromJSON(i),e.isInSingleBlock?a.endRange=a.startRange:a.endRange=n.buildBlockRangeFromJSON(r),a.startRange&&a.endRange&&(o=t.create(a))}return o},t.fromNativeRange=function(e,o){if(!e)return void c.warn("no range");if(e instanceof t)return e;c.log("NoteRange.fromNativeRange()",e);var i,r=o.parseNativeRange(e);return r&&r.length?(i=new t({endRange:n.last(r),startRange:n.first(r)}),c.log("noteRange fromNativeRange",i),i):void c.warn("Failed to parse native range to note range!")},t.isNoteRange=function(e){var n=!1;return e&&e.type===t.TYPE&&e.getStartBlockRange()&&e.getEndBlockRange()&&(n=!0),n},t.isValidType=function(e){return e===t.DATA_TYPES.JSON||e===t.DATA_TYPES.HTML||e===t.DATA_TYPES.PLAIN},t._getMethodName=function(e){var n="";switch(e){case t.DATA_TYPES.JSON:n="JSON";break;case t.DATA_TYPES.HTML:n="Html";break;case t.DATA_TYPES.PLAIN:n="Plain"}return n},t.getBlockRangeMethodName=function(e){var n=t._getMethodName(e);if(n)return"getDataAs"+n},t.prototype.canDrawedByNative=function(){var e;return!this.isInSingleBlock()||(e=this.getStartBlockRange(),e.canDrawedByNative())},t.prototype.clone=function(e){var n,o;return!1===e?(n=this.startRange,o=this.endRange):(n=this.startRange.clone(),o=this.isInSingleBlock()?n:this.endRange.clone()),t.create({startRange:n,endRange:o})},t.prototype.collapse=function(e){var t=!1===e?this.getEndBlockRange():this.getStartBlockRange();t&&t.collapse?(t.collapse(e),this.startRange=t,this.endRange=t):c.warn("There is no blockRange or blockRange has no `collapse` method")},t.prototype.createWalker=function(e,t){return p.create(this,e,t)},t.prototype.getStartBlockRange=function(){return this.startRange},t.prototype.getEndBlockRange=function(){return this.endRange},t.prototype.getDataAsHtml=function(e){var t=this.startRange;return this._isSingleNotFullSelectedLI()?t.block.toHtml(t.start,t.end):e.toHtml(this)},t.prototype.getDataAsJSON=function(e,n){var o=this._getDataWithType(e,t.DATA_TYPES.JSON,n);return o=o||[],JSON.stringify(o)},t.prototype.getDataAsPlain=function(e,n){var o=this._getDataWithType(e,t.DATA_TYPES.PLAIN,n),i="";return o&&o.length&&(i=o.join(u.LINE_BREAK)),i},t.prototype.getDataWithType=function(e,t,n){return this._getDataWithType(e,t,n)},t.prototype.getType=function(){return this.type},t.prototype.isCollapsed=function(){return!(!this.startRange||!this.isInSingleBlock())&&this.startRange.isCollapsed()},t.prototype.isInSingleBlock=function(){return this.startRange===this.endRange},t.prototype.isInMultiBlock=function(){return!this.isInSingleBlock()},t.prototype.isMatchBlockTypes=function(e,t){if(!e)return c.warn("The param note does not exist!"),!1;var n,o,i,r=this.startRange.block,a=this.endRange.block,l=e.getBlockIndex(r),s=e.getBlockIndex(a);if(-1===l||-1===s)return c.warn("startIndex or endIndex is -1!"),!1;for(n=e.getAllBlocks(),o=l;o<=s;o++)if(i=d.getType(n[o]),-1===t.indexOf(i))return!1;return!0},t.prototype.isSingleTableSelected=function(){var e=this.startRange;return!(!this.isInSingleBlock()||!d.isTable(e.block))},t.prototype.setBlockRanges=function(e){this.startRange=n.first(e),this.endRange=n.last(e),this._checkValid()},t.prototype.toCollabJSON=function(e){var t={};return t.startBlockRange=this.startRange.toCollabJSON(e),this.isInSingleBlock()?t.isInSingleBlock=!0:(t.isInSingleBlock=!1,t.endBlockRange=this.endRange.toCollabJSON(e)),t},t.prototype.toNativeRange=function(e){var t,n,o,i,r;if(this.canDrawedByNative())return c.log("to native range",this),t=this.getStartBlockRange(),(o=t.toNativeRange(e))?this.isInSingleBlock()?o:(n=this.getEndBlockRange(),(i=n.toNativeRange(e))?(r=document.createRange(),r.setStart(o.startContainer,o.startOffset),r.setEnd(i.endContainer,i.endOffset),r):void c.warn("no native range for end block!")):void c.warn("no native range for start block!")},t.prototype.initialize=function(e){e=e||{},delete this.options,this.type="note",e.startRange||e.endRange||!e.blockRanges?this.setBlockRanges([e.startRange,e.endRange]):this.setBlockRanges(e.blockRanges)},t.prototype._checkValid=function(){var e=this.startRange,t=this.endRange;if(!e||!t)throw new Error("starRange or endRange is not valid!");if(!e.block||!t.block)throw new Error("starRange.block or endRange.block is not valid!");if(e.block===t.block&&e!==t)throw new Error("startRange and endRange should be the same object when startRange.block === endRange.block")},t.prototype._getDataWithType=function(e,n,o){if(!e||!e.getBlockAt)return void c.warn("note is unvalid!");if(!t.isValidType(n))return void c.warn("type is unvalid!");o=o||function(){return!0};var i,r,a,s,u=[],p=this.startRange,h=t.getBlockRangeMethodName(n);if(t.DATA_TYPES.PLAIN===n&&this._isSingleNotFullSelectedLI())return i=p.block.toPlain(p.start,p.end),u.push(i),u;if(!(s=this.createWalker(e,function(e){return o(e.block)})))return[];for(a=s.next();a;)i=a[h](),null!=i?Array.isArray(i)?u=u.concat(i):(r=a.block,(l.IS_WEB_NOTE||l.IS_WEB_GROUP)&&d.isAttachment(r)&&i.resource&&!/^http/i.test(i.resource)&&(i.resource=location.protocol+"//"+location.hostname+i.resource),u.push(i)):c.warn("data is null!"),a=s.next();return u},t.prototype._isSingleNotFullSelectedLI=function(){var e=this.startRange,t=!1;return this.isInSingleBlock()&&d.isListItem(e.block)&&(0!==e.start||e.end!==e.block.getLength())&&(t=!0),t},t.TYPE="note",t.DATA_TYPES={JSON:1,HTML:2,PLAIN:3},t}(s)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(16)],void 0!==(i=function(e,t,n,o){"use strict";return function(){function e(e){e=e||{},e.enableEvent&&(this.eventInst={},n.extend(this.eventInst,o.Events)),this.options=n.extend({},e),this.initialize.apply(this,[e])}return e.extend=function(e,t){var o,i,r=this;return o=e&&n.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},n.extend(o,r,t),i=function(){this.constructor=o},i.prototype=r.prototype,o.prototype=new i,e&&n.extend(o.prototype,e),o.__super__=r.prototype,o},e}()}.apply(t,o))&&(e.exports=i)},,function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(15)],void 0!==(i=function(e,t,n){"use strict";return function(e){function t(t){return t=t||{},t.enableEvent=!0,e.call(this,t)||this}return r(t,e),t.prototype.on=function(e,t,n){return this.eventInst.on(e,t,n)},t.prototype.off=function(e,t,n){return this.eventInst.off(e,t,n)},t.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return(o=this.eventInst).trigger.apply(o,[e].concat(t));var o},t.prototype.bind=function(e,t,n){return this.eventInst.bind(e,t,n)},t.prototype.unbind=function(e,t,n){return this.eventInst.unbind(e,t,n)},t.prototype.once=function(e,t,n){return this.eventInst.once(e,t,n)},t.prototype.listenTo=function(e,t,n){return this.eventInst.listenTo(e,t,n)},t.prototype.listenToOnce=function(e,t,n){return this.eventInst.listenToOnce(e,t,n)},t.prototype.stopListening=function(e,t,n){return this.eventInst.stopListening(e,t,n)},t}(n)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(156),i=n(1);return t=o.extend({name:"UnknownSimpleCommand",isSimple:!0,initialize:function(){t.__super__.initialize.apply(this)},apply:function(){throw"Method not implemented."},doReapply:function(e){var t=this;return i.log("doReapply(): `"+t.name+"`"),t.apply(e)},doUnapply:function(){var e=this;throw i.log("doReapply(): `"+e.name+"`"),"Method not implemented."},isCollabCommand:function(){var e=this,t=e.options.args;return null!=t&&null!=t.collabProperties&&!0===t.collabProperties.isCollabCmd}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(40),n(29),n(142),n(1),n(6),n(113),n(25),n(2),n(30),n(10),n(71),n(20)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h,g,f){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.createBlank=function(e){var n=new t({});return!0===e&&s.PLATFORM_LINE_HEIGHT&&s.PLATFORM_LINE_HEIGHT!==g.getDefault("line-height",d.PARAGRAPH)&&n.setBlockStyle("line-height",s.PLATFORM_LINE_HEIGHT),n},t.fromJSON=function(e){return this.generalFromJSON(e,!1)},t.fromCollabJSON=function(e){return this.generalFromJSON(e,!0)},t.fromXml=function(e){var t=this.createBlank();return t.parseIdFromXml(e),t.setText(h.fromXml(e)),$(e).children().each(function(e,n){switch(n.nodeName){case u.TAG_ID_NAME:case u.LEGACY_TAG_ID_NAME:case"text":case"inline-styles":break;case"styles":o.fromXml(t,n);break;default:i.appendToTree(t.unknownTree,n)}}),t},t.generalFromJSON=function(e,t){if(!e)return void l.warn("jsonObj should not be null!");if(e.type=e.type||e.blockType,!d.isParagraphClusterType(e.type)||!e.text&&!e.richText)return void l.warn("invalid type or text.");var o,i=this.createBlank();return o=t?h.fromCollabJSON(e.richText):h.fromJSON(e.richText||e.text),i.setText(o),n.each(e.styles,function(e,t){i.setBlockStyle(t,e)}),e.blockId&&i.setId(e.blockId),i},t.prototype.append=function(e){this.richText.append(e)},t.prototype.countWords=function(e){var t,n=0,o=this.richText;return s.IS_MOBILE||!e?n=a(o):(t=this.getRangeText(e))&&(n=a(t)),n},t.prototype.deleteText=function(e,t,o){n.isObject(e)&&!n.isUndefined(e.start)&&(t=e.end,e=e.start);var i,r=this.richText,a=r.slice(0,e),l=h.createBlank();t>=0&&(i=r.slice(t)),l.append(a),l.append(i),this.setText(l,o)},t.prototype.getBlockBackColor=function(){var e=this.richText.getStyle(0,this.richText.getLength(),"back-color");return d.isParagraph(this)&&e.length&&n.all(e,function(t){return t===e[0]})?e[0]:""},t.prototype.getCommonInlineStyle=function(e,t){var n,o;return t?(n=t.start,o=t.end):(n=this.getStartOffset(),o=this.getEndOffset()),this.richText.getCommonStyle(n,o,e)},t.prototype.getCommonInlineStyles=function(e){var t,n,o=this.richText;return e?(t=e.start,n=e.end):(t=this.getStartOffset(),n=this.getEndOffset()),o.getCommonStyles(t,n)},t.prototype.getDefaultInlineStyles=function(){return f.getAllDefault()},t.prototype.getStartOffset=function(){return 0},t.prototype.getEndOffset=function(){return this.getLength()},t.prototype.getHighlight=function(e,t){if(e&&e.length){var o=this.richText,i=[];return n.each(e,function(e){for(var n=e.getLength(),r=o.indexOf(e,0,t.ignoreCase);-1!==r;)i[r]={end:r+n,start:r},r=o.indexOf(e,r+n,t.ignoreCase)}),i=n.compact(i),i.length?i:null}},t.prototype.getInlineStyleForEmpty=function(e,t){return(this.getInlineStylesForEmpty(t)||{})[e]},t.prototype.getInlineStylesForEmpty=function(e){var t=this.inlineStylesForEmpty;return e&&(t=t||f.getAllDefault()),t=n.clone(t),t||(t=this.getDefaultSetFont()),t},t.prototype.getLength=function(e){return this.richText.getLength(e)},t.prototype.getReadOnlyText=function(){return this.richText},t.prototype.getRangeText=function(e){if(e&&null!=e.start)return this.sliceText(e.start,e.end)},t.prototype.getStyleRanges=function(e,t){return this.richText.getStyleRanges(e,t)},t.prototype.getText=function(){return this.richText.slice(0)},t.prototype.getTextStyle=function(e,t,o){var i=this.richText;return n.isObject(t)&&null!=t.start&&(o=t.end,t=t.start),i.getStyle(t,o,e)},t.prototype.getTextStylesAtIndex=function(e){return this.richText.getStylesAtIndex(e)},t.prototype.insertText=function(e,t){return l.log("insert Text",e,t),this.richText.insert(t,e),l.log(this.richText),this.trigger("content-change"),!0},t.prototype.isEmpty=function(){return this.richText.isEmpty()},t.prototype.isEmptyContent=function(){return 0===this.getLength(!1)},t.prototype.removeAllStyles=function(){e.prototype.removeAllStyles.call(this),this.richText.removeStyles(),this.trigger("content-change",this)},t.prototype.setInlineStylesForEmpty=function(e){this.inlineStylesForEmpty=e},t.prototype.setText=function(e,t){e instanceof h||(n.isString(e)||(e=String(e)),e=new h({text:e})),this.richText=e,this.trigger("content-change",t)},t.prototype.setTextStyle=function(e,t,o,i){var r=this.richText;n.isObject(o)&&null!=o.start&&(i=o.end,o=o.start),r.setStyle(o,i,e,t),this.trigger("content-change")},t.prototype.sliceText=function(e,t,n){return this.richText.slice(e,t,n)},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.richText=this.richText.toCollabJSON(),t},t.prototype.toHtml=function(e,t,n){var o,i,r,a=document.createElement("div"),l=$(a);return n=!0===n,l.attr("yne-bulb-block","paragraph").css("white-space","pre-wrap"),this.applyBlockStylesOnElement(l),e=e||0,t=null==t?this.getEndOffset():t,o=this.sliceText(e,t,!1),i=p.rich2html(o,{withDefault:n}),l.html(i),r=a.outerHTML,a=l=null,r},t.prototype.toPlain=function(e,t){var n,o;return e=e||0,n=this.sliceText(e,t,!1),o=n.toString(),o=c(o)},t.prototype.toJSON=function(t,n){t=t||0;var o=this.sliceText(t,n,!1),i=e.prototype.toJSON.call(this);return i.richText=o.toJSON(),i},t.prototype.toXml=function(t){var n,r,a=e.prototype.toXml.apply(this,[t]),l=t.createElement("text"),s=this.richText.toString(),c=t.createTextNode(s);return l.appendChild(c),a.appendChild(l),r=this.richText.toXml(t),r&&a.appendChild(r),n=t.createElement("styles"),o.toXml(this,n,t),a.appendChild(n),i.appendToXml(this.unknownTree,a),a},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=d.PARAGRAPH,null!=t.text?this.setText(t.text):this.setText("")},t.prototype.applyBlockStylesOnElement=function(e,t){var o,i=this,r=i.getBlockStyles(),a={};n.each(r,function(e,n){switch(n){case"align":a["text-align"]=e;break;case"indent":case"text-indent":t?(e=i.getBlockStyle("indent")+i.getBlockStyle("text-indent"),o="text-indent"):(e=e>0?e:0,o="indent"===n?"margin-left":"text-indent"),a[o]=e*s.INDENT_WIDTH||"";break;case"line-height":e>0&&(a["line-height"]=String(e));break;case"back-color":a["background-color"]=String(e);break;case"padding":a.padding=String(e);break;default:l.warn("unknown block style: "+n)}}),a["line-height"]||(o=g.getDefault("line-height",d.PARAGRAPH),a["line-height"]=o),o=p.getDefaultForHtml("font-size"),a["font-size"]=o,e.css(a)},t}(u)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(145)],void 0!==(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.getAllConfig=function(t){var o=e.getStyleNames(t),i={};return n.each(o,function(t){i[t]=e.getConfig(t)}),i},e.getAllDefault=function(t){var o=e.getStyleNames(t),i={};return n.each(o,function(t){i[t]=e.getDefault(t)}),i},e.getConfig=function(t){var i=o[t],r=e.overrideDefaults[t];return i&&r&&(i=n.clone(i),i.default=r),i},e.getDefault=function(t){var n=e.overrideDefaults[t];return null!=n?n:(n=o[t],n?n.default:void 0)},e.getStyleNames=function(e){var t=n.keys(o);return e&&e.length?n.difference(t,e):t},e.isSupport=function(e){return null!=o[e]},e.reset=function(){e.overrideDefaults={}},e.setDefault=function(t,n){var o=e.getDefault(t);null!=n&&n!==o&&(e.overrideDefaults[t]=n)},e.overrideDefaults={},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(0),a=n(97),l=n(3);return t=o.extend({name:"atom.InsertBlocks",_note:null,_newBlks:null,_newBlkIds:null,_preBlkId:null,initialize:function(){var e=this,n=e.options.args;l.isCollabCommand(n)||(e._note=e.options.note,e._newBlks=e.options.newBlks,e.options.preBlk&&(e._preBlkId=e.options.preBlk.getId()),e._newBlkIds=[],r.each(e._newBlks,function(t){e._newBlkIds.push(t.getId())})),t.__super__.initialize.apply(e)},apply:function(){var e,t=this,n=0;if(t._preBlkId){if(-1===(e=t._note.getBlockIndexById(t._preBlkId)))return!1;n=e+1}return r.each(t._newBlks,function(e){t._note.insert(n,e),n++}),!0},doUnapply:function(){var e=this;r.each(e._newBlkIds,function(t){e._note.remove(e._note.getBlockIndexById(t))})},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties,i=o.cmdJSON;t.__super__.fromCollabJSON.apply(e),e._note=o.coreEditor.getNote(),i.preBlockId&&(e._preBlkId=i.preBlockId),o.isCollabUndo?e._newBlkIds=i.insertedBlocks:o.isCollabRedo&&(e._newBlks=[],r.each(i.insertedBlocks,function(t){e._newBlks.push(a.buildBlockFromJSON(t,o.coreEditor))}))},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e),o=[];return e.isCollabUndo?r.each(e._newBlks,function(e){o.push(e.getId())}):e.isCollabRedo&&r.each(e._newBlks,function(e){o.push(e.toCollabJSON())}),n.insertedBlocks=o,e._preBlkId&&(n.preBlockId=e._preBlkId),n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},,function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(1),a=n(0),l=n(97),s=n(3);return t=o.extend({name:"atom.DeleteBlocks",_note:null,_deletedBlocks:null,_deletedBlockIds:null,_preBlockId:null,initialize:function(){var e=this,n=e.options.args;s.isCollabCommand(n)||(e._note=e.options.note,e._deletedBlocks=a.sortBy(e.options.blocks,function(t){return e._note.getBlockIndex(t)}),e._deletedBlockIds=[],a.each(e._deletedBlocks,function(t){e._deletedBlockIds.push(t.getId())})),t.__super__.initialize.apply(e)},apply:function(){var e,t,n=this;return n._deletedBlockIds&&0!==n._deletedBlockIds.length?(t=n._note.getBlockById(n._deletedBlockIds[0]),e=n._note.getPreBlock(t),n._preBlockId=e?e.getId():0,a.each(n._deletedBlockIds,function(e,t){n._note.removeBlockById(e,n._deletedBlockIds.length===t+1)}),!0):(r.error("没有指定要删除的段落"),!1)},doUnapply:function(){var e=this,t=0;e._preBlockId&&(t=e._note.getBlockIndexById(e._preBlockId)+1),a.each(e._deletedBlocks,function(n){e._note.insert(t,n),t++})},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties,i=o.cmdJSON;t.__super__.fromCollabJSON.apply(e),e._note=o.coreEditor.getNote(),i&&i.preBlockId&&(e._preBlockId=i.preBlockId),o.isCollabUndo?(e._deletedBlocks=[],a.each(i.deletedBlocks,function(t){e._deletedBlocks.push(l.buildBlockFromJSON(t,o.coreEditor))})):o.isCollabRedo&&(e._deletedBlockIds=[],a.each(i.deletedBlocks,function(t){e._deletedBlockIds.push(t)}))},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e),o=[];return e.isCollabUndo?a.each(e._deletedBlocks,function(e){o.push(e.toCollabJSON())}):e.isCollabRedo&&a.each(e._deletedBlockIds,function(e){o.push(e)}),n.preBlockId=e._preBlockId,n.deletedBlocks=o,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(){var e=navigator.userAgent.toLowerCase();return{isSafari:function(){return e&&e.indexOf("applewebkit")>-1&&e.indexOf("chrome")<=-1},isEdge:function(){return e&&e.indexOf("applewebkit")>-1&&e.indexOf("edge")>-1}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(3),n(8),n(17),n(1),n(71)],void 0!==(i=function(e,t,n,o,i,a,l,s){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromXml=function(e){throw new Error("The fromXml should be implemented by subclass!")},t.parseResourceList=function(e){var t=[];return $(e).find(">resource-list>resource-mono>res-id").each(function(e,n){var o=$(n).text();(o=$.trim(o))&&t.push(o)}),t},t.prototype.isSupportedBlockStyle=function(e){return s.isSupport(e,this.type)},t.prototype.isEmptyContent=function(){return!1},t.prototype.isEmpty=function(){return!1},t.prototype.setBlockStyle=function(e,t){var o=this,i=s.getConfig(e,o.type);i&&("Enum"===i.type?i.possible[t]||(t=i.default):"Number"!==i.type||n.isNumber(t)?"Boolean"!==i.type||n.isBoolean(t)?n["is"+i.type]&&t&&!n["is"+i.type](t)&&(t=t.default):t="true"===t:(t=null===t||""===t?NaN:Number(t),!isNaN(t)&&t||(t=i.default)),t=t||i.default,o.styles[e]=t,l.log("style-change "+e+": "+t),o.trigger("style-change",e,t))},t.prototype.setBlockStyles=function(e){var t=this;e&&n.each(e,function(e,n){t.setBlockStyle(n,e)})},t.prototype.getBlockStyles=function(){return n.clone(this.styles)},t.prototype.getBlockStyle=function(e,t){var n=this,o=s.getConfig(e,n.type);return o?!0===t?n.styles[e]:n.styles[e]||o.default:null},t.prototype.getDefaultBlockStyles=function(){return s.getDefaultsOfBlock(this.type)},t.prototype.removeBlockStyles=function(){var e=this;e.styles={},e.trigger("styles-reset")},t.prototype.removeAllStyles=function(){this.removeBlockStyles()},t.prototype.toXml=function(e){var n,o,i,r=this,a=r.getId();return null==a?void l.debugAlert("The block has NO id",r):(n=e.createElement(r.xmlNodeName),o=e.createElement(t.TAG_ID_NAME),i=e.createTextNode(a),o.appendChild(i),n.appendChild(o),n)},t.prototype.getType=function(){return this.type},t.prototype.parseIdFromXml=function(e){var n,o,r=this;n=r._getChildByTagName(e,t.TAG_ID_NAME),n&&(o=n.textContent),o||i.IS_ANDROID||(n=r._getChildByTagName(e,t.LEGACY_TAG_ID_NAME))&&(o=n.textContent),null==o?r.validForCollab=!1:r.blockId=o},t.prototype.toJSON=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;return{blockId:n.getId(),blockType:n.type,styles:n.getBlockStyles(),type:n.type}},t.prototype.toHtml=function(e,t,n){throw new Error("toHtml() should be implemented by subclass!")},t.prototype.toPlain=function(e,t){throw new Error("toPlain() should be implemented by subclass!")},t.prototype.countWords=function(e){throw new Error("countWords() should be implemented by subclass!")},t.prototype.setResourceIds=function(e){var t=this;e&&e.length&&(t.resourceIds=e)},t.prototype.getResourceIds=function(){return this.resourceIds},t.prototype.getExtraInfo=function(e){var t,n=this;return n.trigger("get-extra-info",e,function(e){t=e}),t},t.prototype.getDefaultSetFont=function(){var e;return this.trigger("get-default-set-font",function(t){e=t}),e},t.prototype.highlight=function(e,t,n){this.trigger("high-light",e,t,n)},t.prototype.getId=function(){var e=this,t=e.blockId;return null==t&&l.debugAlert("The blockId should NOT be null"),t},t.prototype.setId=function(e){var t=this;if(null==e)return void l.debugAlert("The param blockId should NOT be null");t.blockId=e},t.prototype.setLocked=function(e,t){var n=this;n.locked===e&&t&&!t.lockUpdated||(n.locked=e,n.trigger("locked-change",t))},t.prototype.isLocked=function(){return this.locked},t.prototype.getUnknownTree=function(){return this.unknownTree},t.prototype.isValidForCollab=function(){return this.validForCollab},t.prototype.resetLockState=function(){this.locked=!1},t.prototype.toCollabJSON=function(){return this.toJSON()},t.prototype.setReadOnly=function(e){this.readOnly=!!e},t.prototype.isReadOnly=function(){return this.readOnly},t.prototype.initialize=function(e){var t=this;e=e||{},t.styles={},t.validForCollab=!0,null==t.blockId&&(null!=e.blockId||null!=e.id?t.blockId=e.blockId||e.id:t.blockId=o.newGUID()),t.unknownTree={}},t.prototype._getChildByTagName=function(e,t){if(e)for(var n=e.childNodes[0];n;){if(n.nodeName&&n.nodeName===t)return n;n=n.nextSibling}},t.TAG_ID_NAME="coId",t.LEGACY_TAG_ID_NAME="id",t}(a)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(2),n(94),n(1),n(95),n(120),n(121),n(96),n(35),n(42),n(123)],void 0!==(i=function(e,t,n,o,i,r,a,l,s,c,u,d,p){"use strict";return function(){function e(){}return e.createRangeByBlock=function(e){if(r.log(e),!e||!e.block)return void r.warn("arguments is not valid!");var t,n=e.block,h=n.getType(),g=0,f=0;switch(null!=e.start&&null!=e.end?(g=e.start,f=e.end):(null==e.allContent&&null==e.collapseToStart||!0===e.allContent)&&null!=n.getEndOffset?(g=0,f=n.getEndOffset()):e.collapseToStart||null==n.getEndOffset?(g=0,f=0):(g=n.getEndOffset(),f=g),h){case o.QUOTE:case o.TODO:case o.PARAGRAPH:case o.LIST_ITEM:case o.CATALOGUE:case o.HEADING:t=new u({block:n,end:f,start:g});break;case o.IMAGE:t=new c({block:n});break;case o.ATTACHMENT:t=new a({block:n});break;case o.TABLE:e.allContent&&(e.type=d.TYPES.ALL,delete e.allContent),e.type||e.rect||r.warn("Bad tableRange options will select first table cell",e),t=new d({block:n,rect:e.rect,type:e.type});break;case o.HR:t=new s({block:n});break;case o.UNKNOWN:t=new p({block:n});break;case o.HEADER_FOOTER:t=new i({block:n});break;case o.HANDWRITE:t=new l({block:n});break;default:r.error("block.type ["+h+"] is not valid!")}return t},e.isBlockRange=function(e){return null!=e&&null!=e.getType&&null!=e.getType()&&n.contains(o.getAllBlockTypes(),e.getType())},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(1),o=n(0);return{bubble:function(e,n,i,r){if(!e||!n||!i)return void t.log("arguments are not valid",arguments);var a=o.isArray(e);o.each(e,function(e,t){e&&(a?t=e:!0===e&&(e=t),!0===r&&n.off(t),n.on(t,i.trigger.bind(i,e)))})},addListeners:function(e,n,i,r){if(!e||!n||!i)return void t.log("arguments are not valid",arguments);o.each(e,function(e,t){!0===r&&n.off(t),n.on(t,i[e].bind(i))})}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(1),n(141)],void 0!==(i=function(e,t,n,o,i){"use strict";return function(){function e(){}return e.getAllValueByFont=function(t){var n=e.getFont(t);if(n)return e.FONT_MAP[n].join(",");o.warn("Font does not exit in Font Maps: "+t)},e.getFontMap=function(){return e.FONT_MAP},e.getFont=function(t){var o,i;if((t=(t||"").toLowerCase())&&(i=e.splitFontFamily(t)))return n.some(i,function(t){if(n.some(e.FONT_MAP,function(n,i){if(i.toLowerCase()===t||e.CONTAIN_IGNORE_CASE(n,t))return o=i,!0}),o)return!0}),o},e.getFontFirstValue=function(t){var n,o=e.getFont(t);if(n=e.FONT_MAP[o])return n[0]},e.getItems=function(){var t=[];return n.each(e.FONT_MAP,function(e,n){t.push({fullValue:e.join(","),name:n,singleValue:e[0]})}),t},e.getNames=function(){return n.keys(e.FONT_MAP)},e.splitFontFamily=function(e){var t,o=[];return(e=$.trim(e||""))?(t=e.split(","),n.each(t,function(e){e=e||"",(e=$.trim(e.replace(/["']/g,"")))&&o.push(e)}),o):[]},e.CONTAIN_IGNORE_CASE=function(e,t){return n.some(e,function(e){return(e+"").toLowerCase()===t})},e.DEFAULT_FONT=i.DEFAULT_FONT,e.FONT_MAP={"微软雅黑":[i.DEFAULT_FONT,"STXihei"],"宋体":["SimSun","STSong"],"新宋体":["NSimSun"],"仿宋":["FangSong_GB2312","FangSong","STFangsong"],"楷体":["KaiTi_GB2312","KaiTi","STKaiti"],"黑体":["SimHei","STHeiti"],Arial:["Arial"],"Arial Black":["Arial Black"],"Times New Roman":["Times New Roman"],"Courier New":["Courier New"],Tahoma:["Tahoma"],Verdana:["Verdana"]},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(6),n(112),n(1)],void 0!==(i=function(e,t,n,o,i,r){"use strict";return function(){function e(){}return e.appendToTree=function(e,t){if(!e||!t)return void r.error("arguments are not valid!");var n=$(t).attr(o.COMPAT);i.isCompatible(n)&&(e.unknown||(e.unknown=[]),e.unknown.push(t.cloneNode(!0)))},e.appendToXml=function(e,t){if(!e||!t)return void r.error("arguments are not valid!");e.unknown&&e.unknown.length&&n.each(e.unknown,function(e){var n,o;e&&e.cloneNode&&(o=e.nodeName,n=$(t).find(">"+o).length>0,n?r.error("unknown node <"+o+"> has already exist!"):t.appendChild(e.cloneNode(!0)))})},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(87),n(143),n(10),n(20)],void 0!==(i=function(e,t,n,o,i,r,a){"use strict";return function(){function e(){}return e.getCssRule=function(t){return e.globalInlineStyleRules[t]},e.getDefaultForHtml=function(t){var n,o,i,r=e.inlineStyleDefaultForHtml[t];return null==r&&(n=e.getCssRule(t),o=a.getDefault(t),n?(i={},i[t]=o,r=n(i)):r=o,e.inlineStyleDefaultForHtml[t]=r),r},e.html2rich=function(e){return new r({text:$(e).text()})},e.rich2html=function(t,o){var r,a,l,s,c,u,d=t.getReadOnlyData(),p=d.length,h=[],g="";if(o=n.defaults(o||{},{customDefaultStyles:null,styleRules:null,withDefault:!0}),0===p)return"<br>";for(r=t.getReadOnlyStylesList(o.withDefault,o.customDefaultStyles),o.styleRules?(u=n.clone(o.styleRules),n.defaults(u,e.globalInlineStyleRules)):u=e.globalInlineStyleRules,u=i.getRules(u),a=0;a<p;++a)l=d[a],c=r[a],e.isEqualStyles(s,c)||(e.handleEndStyles(h),g!==c.href&&(e.handleEndHref(h),e.handleStartHref(h,c.href)),e.handleStartStyles(h,c,u)),h.push(n.escape(l.toString())),s=c,g=c.href;return e.handleEndStyles(h),e.handleEndHref(h),h.join("")},e.resetCssRules=function(){e.globalInlineStyleRules={},e.resetInlineStyleDefaultForHtml()},e.resetInlineStyleDefaultForHtml=function(t){t?(t+="",delete e.inlineStyleDefaultForHtml[t]):e.inlineStyleDefaultForHtml={}},e.setCssRules=function(t){n.each(t,function(t,o){n.isFunction(t)&&(e.globalInlineStyleRules[o]=t,e.resetInlineStyleDefaultForHtml(o))})},e.anchorEndTag=function(){return"</a>"},e.anchorStartTag=function(e){return e+="",'<a href="'+o.safeHref(e)+'">'},e.handleEndHref=function(t){t.push(e.anchorEndTag())},e.handleEndStyles=function(t){t.push(e.spanEndTag())},e.handleStartHref=function(t,n){n&&t.push(e.anchorStartTag(n))},e.handleStartStyles=function(t,o,i){n.isEmpty(o)||t.push(e.spanStartTag(o,i))},e.isEqualStyles=function(t,n){if(!t||!n)return!1;var o,i=e.supportedInlineStyleNames.length;for(o=0;o<i;o++)if(t[e.supportedInlineStyleNames[o]]!==n[e.supportedInlineStyleNames[o]])return!1;return!0},e.spanEndTag=function(){return"</span>"},e.spanStartTag=function(e,t){var o,i=document.createElement("span");return n.each(t,function(t,n){var o=t(e);(o||0===o)&&(i.style[n]=o)}),o=i.outerHTML,o=o.replace(/<\/span>$/i,"")},e.globalInlineStyleRules={},e.inlineStyleDefaultForHtml={},e.supportedInlineStyleNames=a.getStyleNames(),e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.listeners=[],this.maxListeners=null}return e.prototype.addListener=function(e,t){return this.on(e,t)},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=this._filterMatchedEvent(this.listeners,e);return o.length>0&&(this._invokeListeners.apply(this,[o].concat(t)),this.listeners=this._filterNotMatchedEvent(this.listeners,e,!0)),o.length>0},e.prototype.getMaxListeners=function(){return null===this.maxListeners?e.defaultMaxListeners:this.maxListeners},e.prototype.listenerCount=function(e){return this._filterMatchedEvent(this.listeners,e).length},e.prototype.on=function(e,t){return this._register({event:e,listener:t,once:!1}),this},e.prototype.off=function(e,t){return this._unregister({event:e,listener:t}),this},e.prototype.once=function(e,t){return this._register({event:e,listener:t,once:!0}),this},e.prototype.removeAllListeners=function(e){return this.listeners=null!=e?this._filterNotMatchedEvent(this.listeners,e):[],this},e.prototype.removeListener=function(e,t){return this.listeners=this._filterNotMatchedEvent(this.listeners,e,null,t),this},e.prototype.setMaxListeners=function(e){return this.maxListeners=e,this},e.prototype._invokeListeners=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e.map(function(e){return e.listener.apply(e,t)})},e.prototype._register=function(e){if(!this._checkListenerLimitReached(e.event))return void this.listeners.unshift(e);throw new Error("Listner Limit Reached:"+this.maxListeners)},e.prototype._unregister=function(e){this.listeners=this._filterNotMatchedEvent(this.listeners,e.event,null,e.listener)},e.prototype._returnListenerLimit=function(){return null===this.maxListeners?e.defaultMaxListeners:this.maxListeners},e.prototype._checkListenerLimitReached=function(e){return this.listenerCount(e)===this._returnListenerLimit()},e.prototype._filterMatchedEvent=function(e,t,n){var o=function(e,o,i){return null==n?e.event===t:e.event===t&&e.once===n};return e.filter(o,this)},e.prototype._filterNotMatchedEvent=function(e,t,n,o){var i=function(e,i,r){var a=e.event!==t;return!1===a&&null!=n&&(a=e.once!==n),!1===a&&null!=o&&(a=e.listener!==o),a};return e.filter(i,this)},e.defaultMaxListeners=10,e}();t.YEvent=n}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(7),i=n(12),r=n(8),a=n(128),l=n(69),s=n(24);return l.extend({className:"toolbar-item toolbar-button",events:{click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp"},name:"unknown",label:"unknown",defaultState:!1,state:!1,templateName:"toolbar-button-template",editorEvents:{"yne-editing-state-change":"onEditingStateChange","yne-selection-change":"onSelectionChange"},shortcut:null,onEditingStateChange:function(){},onSelectionChange:a,initialize:function(e){var t=this;t.editor=e.editor,t.render(),t.setState(t.defaultState),t.bindEditorEvents(),t.bindEvents()},render:function(){var e,t=this,n=t.$el,o=t.label;n.addClass("button-"+t.name),e=i.render("web",t.templateName,{name:t.name,label:t.label,defaultState:t.defaultState}),n.html(e),null==t.shortcut||s.isSafari()&&!r.IS_MAC||(o="<div><span>"+t.label+'</span><span class="split"></span><span>'+t.shortcut+"</span><div>"),n.find(".button").tooltipster({animation:"",animationDuration:0,theme:["tooltipster-borderless","tooltipster-borderless-customized"],side:"bottom",delay:[800,300],content:o,contentAsHTML:!0}),t.isVisible||this.hide()},bindEvents:function(){},bindEditorEvents:function(){var e=this,n=e.editor,o=e.editorEvents;o&&t.each(o,function(t,o){n.on(o,e[t].bind(e))})},onMouseUp:function(){var e=o(window);e.is(":focus")||e.focus()},onMouseDown:function(e){e.preventDefault()},onClick:function(){},setState:function(e){var t=this,n=t.$el;e=!0===e,t.state=e,e?n.find(".button").addClass("active"):n.find(".button").removeClass("active")},reset:function(){var e=this;e.setState(e.defaultState)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(59),n(17),n(1)],void 0!==(i=function(e,t,n,o,i,a){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromCollabJSON=function(e){return new t({listId:e.id,type:e.type})},t.fromXml=function(e){var o=$(e),i=o.attr("id"),r=o.attr("type"),a=new t({listId:i,type:r});return n.each(e.attributes,function(e){switch(e.nodeName){case"id":case"type":break;default:a.unknownAttrs.push(e.cloneNode(!0))}}),a},t.prototype.addItem=function(e){e&&(this.listItems.push(e),this.updateIndexes())},t.prototype.getId=function(){return this.listProps.listId},t.prototype.getItems=function(){return this.listItems},t.prototype.getLength=function(){return this.listItems.length},t.prototype.getType=function(){return this.listProps.type},t.prototype.insertAfter=function(e,t){var n=this.listItems,o=t?n.indexOf(t):-1;this.insertItem(o+1,e)},t.prototype.insertItem=function(e,t){var n=this.listItems;return o(e>0||e<=n.length),o(!(t in n)),n.splice(e,0,t),this.updateIndexes(),e},t.prototype.isOrdered=function(){return this.listProps.type===t.ORDERED},t.prototype.isUnordered=function(){return this.listProps.type===t.UNORDERED},t.prototype.removeItem=function(e){var t=this.listItems,n=t.indexOf(e);return n>=0&&(t.splice(n,1),this.updateIndexes()),n},t.prototype.setType=function(e){o(e===t.ORDERED||e===t.UNORDERED),e!==this.listProps.type&&(this.listProps.type=e,this.updateIndexes(!0),this.trigger("type-change"))},t.prototype.toCollabJSON=function(){var e={};return e.id=this.listProps.listId,e.type=this.listProps.type,e},t.prototype.updateIndexes=function(e){var t,n,o,i=this.listItems,r=i.length,a=0,l={};for(t=0;t<r;++t)n=i[t],o=n.getLevel(),o>a?l[o]=1:l[o]?l[o]++:l[o]=1,a=o,n.setIndex(l[o]),e&&n.updateListType()},t.prototype.initialize=function(e){this.listProps=n.clone(e),this.listItems=[],this.unknownAttrs=[],this.listProps.type!==t.ORDERED&&this.listProps.type!==t.UNORDERED&&(a.error("type should be ORDERED or UNORDERED",this.listProps.type),this.listProps.type=t.UNORDERED)},t.ORDERED="ordered",t.UNORDERED="unordered",t}(i)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(3),n(40),n(33),n(29),n(59),n(1),n(6),n(113),n(25),n(2),n(116),n(19),n(30),n(10)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h,g,f,m,_){"use strict";return function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.createBlank=function(){return new t({})},t.fromCollabJSON=function(e){return this.generalFromJSON(e,!0)},t.fromJSON=function(e){return this.generalFromJSON(e,!1)},t.fromXml=function(e){var n,o=$(e),r=parseInt(o.attr("level"),10)||1;return n=new t({level:r}),n.setText(_.fromXml(e)),n.parseIdFromXml(e),$(e).children().each(function(e,t){switch(t.nodeName){case p.TAG_ID_NAME:case p.LEGACY_TAG_ID_NAME:case"text":case"inline-styles":break;case"styles":i.fromXml(n,t);break;default:l.appendToTree(n.unknownTree,t)}}),n},t.getOrCreateListById=function(e,t,n){var i,r,l=null,s=t;for(r=e.length-1;r>=0;--r)i=e[r],h.isListItem(i)&&i.getOwnerList()&&i.getOwnerList().getId()===t&&(i.getOwnerList().getType()===n?l=i.getOwnerList():s=o.newGUID());return l||(l=new a({listId:s,type:n})),l},t.generalFromJSON=function(t,n){var o=e.generalFromJSON.call(this,t,n);return o&&(t.listId&&o.setListId(t.listId),t.listType&&o.setListType(t.listType),t.level&&o.setLevel(t.level),t.index&&o.setIndex(t.index)),o},t.prototype.getIndex=function(){return this.index},t.prototype.getListId=function(){return this.ownerList?this.ownerList.getId():this.listItemProps.listId},t.prototype.getListType=function(){return this.ownerList?this.ownerList.getType():this.listItemProps.listType},t.prototype.getLevel=function(){return this.listItemProps.level},t.prototype.getOwnerList=function(){return this.ownerList},t.prototype.isOrdered=function(){return this.ownerList.isOrdered()},t.prototype.setIndex=function(e){n.isNumber(e)&&e>0&&(this.index=e,this.trigger("index-change",e))},t.prototype.setLevel=function(e){n.isNumber(e)&&(e=Math.max(e,1),e=Math.min(e,u.MAX_LIST_ITEM_LEVEL),this.listItemProps.level=e,this.ownerList&&this.ownerList.updateIndexes(),this.trigger("level-change",e))},t.prototype.setListId=function(e){this.listItemProps.listId?c.error("should not override existing listId"):this.listItemProps.listId=e},t.prototype.setListType=function(e){this.listItemProps.listType?c.error("should not override existing listType"):this.listItemProps.listType=e},t.prototype.setOwnerList=function(e){this.ownerList=e,this.ownerList&&(this.listItemProps.listId=this.ownerList.getId(),this.listItemProps.listType=this.ownerList.getType())},t.prototype.toCollabJSON=function(){return this._generalToJSON(null,null,!0)},t.prototype.toHtml=function(e,t,n){var o,i,r,a=document.createElement("li"),l=$(a);return n=!0===n,this.applyBlockStylesOnElement(l),l.css("list-style-position","inside").css("white-space","pre-wrap").css("word-break","break-word"),r=g.makeHtmlMarker(this),r&&r.listStyleType&&l.css("list-style-type",r.listStyleType),r&&r.markerStyles&&l.css(r.markerStyles),e=e||0,o=this.sliceText(e,t,!1),i=m.rich2html(o,{withDefault:n}),a.innerHTML=i,a.outerHTML},t.prototype.toJSON=function(e,t){return this._generalToJSON(e,t,!1)},t.prototype.toPlain=function(e,t){var n,o;return e=e||0,n=this.sliceText(e,t,!1),o=n.toString(),o=d(o)},t.prototype.toXml=function(t){var n,o=this.getOwnerList();return o?(n=e.prototype.toXml.apply(this,[t]),n.setAttribute("level",this.getLevel().toString()),n.setAttribute("list-id",this.listItemProps.listId),{listId:this.listItemProps.listId,listItem:n,listType:o.getType(),ownerList:o}):void c.error("The list item has no owner list!")},t.prototype.updateListType=function(){this.ownerList&&(this.listItemProps.listType=this.ownerList.getType())},t.prototype.initialize=function(t){var o=t.level||1;e.prototype.initialize.call(this,t),this.type=h.LIST_ITEM,this.listItemProps=n.clone(t),this.setLevel(o),this.setIndex(1),t.list&&(this.ownerList=t.list,this.listItemProps.listId=this.ownerList.getId(),this.listItemProps.listType=this.ownerList.getType()),!this.listItemProps.listId&&t.listId&&(this.listItemProps.listId=t.listId),!this.listItemProps.listType&&t.listType&&(this.listItemProps.listType=t.listType),t.id&&this.setId(t.id),t.text&&this.setText(t.text),this.on("attached",this._onAttached.bind(this)),this.on("detached",this._onDetached.bind(this))},t.prototype._onAttached=function(e){var n,o,i=this.getOwnerList(),r=e.getAllBlocks(),a=e.getBlockIndex(this),l=null;if(s(a>=0,"Block not attached yet.",a,this),!i&&this.getListId()&&(i=t.getOrCreateListById(r,this.getListId(),this.getListType()),this.setOwnerList(i)),0===i.getLength())i.insertAfter(this,null);else{for(n=a-1;n>=0;--n)if(o=r[n],h.isListItem(o)&&o.getOwnerList()===i){l=o;break}i.insertAfter(this,l)}},t.prototype._onDetached=function(){this.getOwnerList().removeItem(this)},t.prototype._generalToJSON=function(t,n,o){var i;return i=o?e.prototype.toCollabJSON.call(this):e.prototype.toJSON.call(this,t,n),i.level=this.getLevel(),i.index=this.getIndex(),this.listItemProps.listId&&(i.listId=this.listItemProps.listId),this.listItemProps.listType&&(i.listType=this.listItemProps.listType),i},t}(f)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(2),n(1),n(46)],void 0!==(i=function(e,t,n,o,i){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.create=function(e){return new t(e)},t.fromCollabJSON=function(e,r){var a=e.rangeType;if(a!==n.PARAGRAPH)return void o.error("wrong block range type:",a);var l=i.getBlockById(e.blockId,r);if(l){var s={block:l,end:e.endPosition,start:e.startPosition};return t.create(s)}},t.prototype.isCollapsed=function(){return this.start===this.end},t.prototype.clone=function(){return t.create({block:this.block,end:this.end,start:this.start})},t.prototype.collapse=function(e){void 0===e&&(e=!0),e?this.end=this.start:this.start=this.end},t.prototype.expandToStart=function(){this.start=this.block.getStartOffset()},t.prototype.expandToEnd=function(){this.end=this.block.getEndOffset()},t.prototype.getDataAsJSON=function(){return this.block.toJSON(this.start,this.end)},t.prototype.getDataAsHtml=function(e){return this.block.toHtml(this.start,this.end,e)},t.prototype.getDataAsPlain=function(){return this.block.toPlain(this.start,this.end)},t.prototype.getContent=function(){return this.block.sliceText(this.start,this.end)},t.prototype.canDrawedByNative=function(){return!0},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.startPosition=this.start,t.endPosition=this.end,t},t.prototype.initialize=function(e){this.type=n.PARAGRAPH,this.start=e.start||0,this.end=e.end||0,this.block=e.block},t}(i)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.setUnderscore=function(e){t.underscoreInst=e},e.setLogger=function(e){t.loggerInst=e},e}();t.ExternalLibs=n}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(1),n(41)],void 0!==(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.getRange=function(t){var o,i=e.getSelection(t);return i?i.rangeCount>0?o=i.getRangeAt(0):n.warn("The selection has no range!"):n.warn("The selection is null!"),o},e.getSelection=function(e){return e=e||window,e.getSelection()},e.isNodeInRange=function(t,o){if(!t)return n.warn("The param node is unvalid!"),!1;var i,r=t.ownerDocument||document,a=r.defaultView,l=a.Range;return o=o||e.getRange(a),i=r.createRange(),i.selectNode(t),o.compareBoundaryPoints(l.START_TO_START,i)<1&&o.compareBoundaryPoints(l.END_TO_END,i)>-1},e.isRangeInNode=function(t,o){if(!t)return n.warn("The param node is unvalid!"),!1;var i,r=t.ownerDocument||document,a=r.defaultView;if(!(o=o||e.getRange(a)))return n.warn("The native range is null!"),!1;for(i=o.commonAncestorContainer;i;){if(i===t)return!0;i=i.parentNode}return!1},e.isRangeInSelector=function(t,n){if(!t)return!1;var i;if(n=n||e.getRange(),i=n.commonAncestorContainer,!n||!i)return!1;for(o.isText(i)&&(i=i.parentElement||i.parentNode);i&&i.webkitMatchesSelector;){if(i.webkitMatchesSelector(t))return!0;i=i.parentNode}return!1},e.removeAllRanges=function(t){var n=e.getSelection(t);n&&n.removeAllRanges()},e.setRange=function(t,o){var i=e.getSelection(o);n.log("setRange",t,o),i&&t?(i.removeAllRanges(),i.addRange(t)):n.warn("The selection or range is null!")},e}()}.apply(t,o))&&(e.exports=i)},,,function(e,t,n){var o,i;o=[n,t,n(0),n(71),n(29)],void 0!==(i=function(e,t,n,o,i){"use strict";return function(){function e(){}return e.toXml=function(e,t,r){var a=e.getBlockStyles(),l=e.getType(),s=o.getStyleNamesOfBlock(l);n.each(s,function(e){var n=a[e],i=o.getConfig(e,l,!1);if(null!=n&&n!==i.default){var s=r.createElement(e),c=r.createTextNode(n);s.appendChild(c),t.appendChild(s)}});var c=e.getUnknownTree();c&&c.styles&&i.appendToXml(c.styles,t)},e.fromXml=function(e,t){var r=e.getUnknownTree(),a=e.getType(),l=o.getStyleNamesOfBlock(a),s=[];$(t).children().each(function(t,n){var o,a=n.nodeName;e.isSupportedBlockStyle(a)?(o=$(n).text(),e.setBlockStyle(a,o),s.push(a)):(r.styles||(r.styles={}),i.appendToTree(r.styles,n))}),n.each(l,function(t){var n;-1===s.indexOf(t)&&(n=o.getConfig(t,a,!1),e.setBlockStyle(t,n.default))})},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0);return{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,getType:function(e){if(e&&e.nodeType)return e.nodeType},isNode:function(e){var n=this,o=n.getType(e);return t.isNumber(o)&&o>=n.ELEMENT_NODE&&o<=n.NOTATION_NODE},isElement:function(e){return this.getType(e)===this.ELEMENT_NODE},isAttribute:function(e){return this.getType(e)===this.ATTRIBUTE_NODE},isText:function(e){return this.getType(e)===this.TEXT_NODE},isCDataSection:function(e){return this.getType(e)===this.CDATA_SECTION_NODE},isEntityReference:function(e){return this.getType(e)===this.ENTITY_REFERENCE_NODE},isEntity:function(e){return this.getType(e)===this.ENTITY_NODE},isProcessingInstruction:function(e){return this.getType(e)===this.PROCESSING_INSTRUCTION_NODE},isComment:function(e){return this.getType(e)===this.COMMENT_NODE},isDocument:function(e){return this.getType(e)===this.DOCUMENT_NODE},isDocumentType:function(e){return this.getType(e)===this.DOCUMENT_TYPE_NODE},isDocumentFragment:function(e){return this.getType(e)===this.DOCUMENT_TYPE_NODE},isNotation:function(e){return this.getType(e)===this.NOTATION_NODE}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(2),n(264),n(1),n(46)],void 0!==(i=function(e,t,n,o,i,a,l){"use strict";var s={NORMAL:"1",ALL:"2",FIRST_CELL:"3",LAST_CELL:"4",BLANK:"5"};return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.create=function(e){return e&&e.block&&e.type?e.type!==s.NORMAL||t._isValidRect(e.rect)?new t(e):void a.error("Failed to create TableRange, rect is NOT valid",e):void a.error("Failed to create TableRange",e)},t.fromCollabJSON=function(e,n){var i=e.rangeType;if(i!==o.TABLE)return void a.error("wrong block type:",i);var r=l.getBlockById(e.blockId,n);return r?t.create({block:r,type:e.simpleValue2,rect:e.simpleValue1}):void 0},t._isValidRect=function(e){return e&&e.left>=0&&e.top>=0&&e.width>=1&&e.height>=1},t.prototype.getType=function(){return this.type},t.prototype.getAsRectRange=function(){var e,t=this.type,n=this.block;switch(t){case s.FIRST_CELL:case s.LAST_CELL:e=i.create({table:n,width:1,height:1,top:t===s.FIRST_CELL?0:n.getRowCount()-1,left:t===s.FIRST_CELL?0:n.getColumnCount()-1});break;case s.ALL:e=i.create({table:n,top:0,left:0,width:n.getColumnCount(),height:n.getRowCount()});break;case s.NORMAL:if(!this.rect)return void a.warn("Bad range, please check code, range:",this);e=i.create({table:n,top:this.rect.top,left:this.rect.left,width:this.rect.width,height:this.rect.height});break;case s.BLANK:return null;default:a.error("Failed to create RectRange",t)}return e},t.prototype.isCollapsed=function(){return this.type===s.BLANK},t.prototype.isFullSelected=function(){return this.type===s.ALL},t.prototype.isOnCellEdit=function(){var e;return this.block.trigger("get-block-view",this.block,function(t){e=t}),e&&e.isOnCellEdit()},t.prototype.isInBlank=function(){return this.type===s.BLANK},t.prototype.clone=function(){return t.create({block:this.block,type:this.type,rect:this.rect})},t.prototype.collapse=function(){},t.prototype.getDataAsJSON=function(e){var t=this.getAsRectRange();return t?t.getDataAsJSON(e):null},t.prototype.getDataAsHtml=function(){var e=this.getAsRectRange();return e?e.getDataAsHtml():null},t.prototype.getDataAsPlain=function(){var e=this.getAsRectRange();return e?e.getDataAsPlain():null},t.prototype.canDrawedByNative=function(){return!1},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.simpleValue1=this.getAsRectRange()||null,t.simpleValue2=this.getType()||null,t},t.prototype.initialize=function(i){e.prototype.initialize.call(this,i),i=n.defaults(i||{},{type:s.FIRST_CELL,rect:null}),this.block=i.block,this.type=i.type||o.TABLE,this.type===s.NORMAL&&(t._isValidRect(i.rect)?this.rect=i.rect:this.type=s.FIRST_CELL)},t.TYPES={NORMAL:"1",ALL:"2",FIRST_CELL:"3",LAST_CELL:"4",BLANK:"5"},t}(l)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(){return{LEFT:1,RIGHT:2,UP:3,DOWN:4}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){function t(e){var t=this;t.name=e.name,t.value=e.value,t.isNative=!0===e.isNative,t.tryNativeIfNeeded=!1!==e.tryNativeIfNeeded,t.stopSelectionChange=!0===e.stopSelectionChange,t.callback=o.isFunction(e.callback)?e.callback:null}var o=n(0),i=n(1);return t.prototype.isCmdBall=!0,t.prototype.clone=function(){return new t(this)},t.create=function(e){return e&&e.isCmdBall?e:e&&e.name?new t(e):void i.warn("Failed to create cmdBall",e)},t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(40),n(29),n(113),n(25),n(2),n(19),n(30),n(10)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d){"use strict";return function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.createBlank=function(){return new t({})},t.fromCollabJSON=function(e){return t.generalFromJSON(e,!0)},t.fromJSON=function(e){return t.generalFromJSON(e,!1)},t.fromXml=function(e){var n=$(e),r="true"===n.find("> checked:first").text(),a=new t({checked:r});return a.setText(d.fromXml(e)),a.parseIdFromXml(e),n.children().each(function(e,t){switch(t.nodeName){case l.TAG_ID_NAME:case l.LEGACY_TAG_ID_NAME:case"checked":case"text":case"inline-styles":break;case"styles":o.fromXml(a,t);break;default:i.appendToTree(a.unknownTree,t)}}),a},t.getMarker=function(e){if(!e)return"";var n=e.getChecked()?t.CHECKED_MARKER:t.UNCHEKED_MARKER;return n+=" "},t.generalFromJSON=function(t,n){var o=e.generalFromJSON.call(this,t,n);return o&&o.setChecked(!!t.checked),o},t.prototype.countWords=function(){return this.richText.getLength()},t.prototype.getChecked=function(){return this.todoProps.checked},t.prototype.getLegacyResId=function(){return this.todoProps.legacyResId},t.prototype.isFromOldTodo=function(){return!!this.todoProps.legacyResId},t.prototype.setChecked=function(e){e!==this.todoProps.checked&&(this.todoProps.checked=e,this.trigger("checked-change",e))},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.checked=this.getChecked(),t},t.prototype.toHtml=function(e,t,n){var o,i=document.createElement("div"),r=$(document.createElement("div")),a=$(document.createElement("div")),l=this.getChecked(),s=$(i);return s.attr("yne-bulb-block","todo").attr("yne-bulb-checked",l.toString()).attr("id",this.getId()).css("display","table"),r.css({border:"1px solid #bbb",display:"inline-flex",height:"1em","line-height":"1",position:"relative",width:"1em"}),l&&(r.css({"background-repeat":"no-repeat","background-position":"center","background-size":"100%","background-image":"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgdmlld0JveD0iMCAwIDUwIDUwIiBzdHlsZT0iaGVpZ2h0OiAxMDAlO3dpZHRoOiAxMDAlO3N0cm9rZS13aWR0aDogMjtzdHJva2U6IGJsYWNrO3RvcDogMDtsZWZ0OiAwO3Bvc2l0aW9uOiBhYnNvbHV0ZTsiICB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbG5zOnNrZXRjaD0iaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoL25zIj4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0xNC4xIDI3LjJsNy4xIDcuMiAxNi43LTE2LjgiPjwvcGF0aD4KPC9zdmc+)"}),s.css("text-decoration","line-through")),this.applyBlockStylesOnElement(s),e=e||0,t=null==t?this.getEndOffset():t,o=this.sliceText(e,t,!1),a.html(u.rich2html(o,{withDefault:n})),a.attr("yne-bulb-todo-content","").css({display:"table-cell","word-break":"break-word","padding-left":"8px",width:"100%"}),s.append(r),s.append(a),i.outerHTML},t.prototype.toJSON=function(t,n){var o=e.prototype.toJSON.call(this,t,n);return o.checked=this.getChecked(),o},t.prototype.toPlain=function(e,t){e=e||0;var n=this.sliceText(e,t,!1);return a(n.toString())},t.prototype.toXml=function(t){var n,o;return o=e.prototype.toXml.call(this,t),n=t.createElement("checked"),n.appendChild(t.createTextNode(this.getChecked().toString())),o.appendChild(n),i.appendToXml(this.unknownTree,o),o.setAttribute("compat","true"),o},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.todoProps=n.clone(t),this.type=s.TODO},t.CHECKED_MARKER="✔",t.UNCHEKED_MARKER="☐",t}(c)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(15),n(1)],void 0!==(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.getBlockById=function(e,t){var n=t.getBlockById(e);return n||o.warn("Failed to find block",e),n},t.fromCollabJSON=function(e,n){var o=t.getBlockById(e.blockId,n);return o?new t({block:o}):null},t.prototype.isCollapsed=function(){throw new Error("isCollapsed () should be implemented by subclass")},t.prototype.getType=function(){return this.type},t.prototype.clone=function(e){throw new Error("Every subclass of BlockRange should implement the `clone` method")},t.prototype.collapse=function(e){throw new Error("Every subclass of BlockRange should implement the `collapse` method")},t.prototype.expandToStart=function(){},t.prototype.expandToEnd=function(){},t.prototype.getDataAsJSON=function(){throw new Error("toJSON() should be implemented by subclass!")},t.prototype.getDataAsHtml=function(e){throw new Error("toHtml() should be implemented by subclass!")},t.prototype.getDataAsPlain=function(){throw new Error("toPlain() should be implemented by subclass!")},t.prototype.canDrawedByNative=function(){throw new Error("canDrawedByNative() should be implemented by subclass!")},t.prototype.toNativeRange=function(e){if(!e||!e.getBlockViewByBlock)return void o.error("note view is unvalid!");var t=e.getBlockViewByBlock(this.block);return t?t.convertToNativeRange(this):void o.warn("No blockView")},t.prototype.extendToBlockEnd=function(){o.warn('Show sub block range do! "extendToBlockEnd"')},t.prototype.extendToBlockStart=function(){o.warn('Show sub block range do! "extendToBlockStart"')},t.prototype.getBlockId=function(){return this.block?this.block.getId():null},t.prototype.toCollabJSON=function(e){return{blockId:this.block.getId(),rangeType:this.type}},t.prototype.initialize=function(e){e=e||{block:null},this.type="block",this.block=e.block},t}(n)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(10),a=n(3);return t=o.extend({name:"atom.DeleteBlockText",_textBlock:null,_start:null,_end:null,_deletedText:null,initialize:function(){var e=this,n=e.options.args;a.isCollabCommand(n)||(e._textBlock=e.options.block,e._start=e.options.start,e._end=e.options.end,e._inlineStyles=e.options.inlineStyles),t.__super__.initialize.apply(e)},apply:function(){var e=this,t=e._textBlock,n=t.sliceText(e._start,e._end);return!!n&&(e._deletedText=n,t.deleteText(e._start,e._end,e._inlineStyles),!0)},doUnapply:function(){var e=this,t=e._deletedText;e._textBlock&&e._deletedText&&e._textBlock.insertText(e._start,t)},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),o&&(e._deletedText=r.fromCollabJSON(o.richText),e._textBlock=n.collabProperties.coreEditor.getBlockById(o.blockId),e._start=o.startPosition,e._end=o.endPosition)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._textBlock.getId(),n.richText=e._deletedText.toCollabJSON(),n.startPosition=e._start,n.endPosition=e._end,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(69),o=n(128);return t.extend({className:"toolbar-item toolbar-split",initialize:o,render:o,enable:o,disable:o,reset:o})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(16),o=n(7),i=n(0),r=n(6),a=n(2),l=n(1),s=n(439),c=o('<div class="collab-editing-view-wrapper"><div class="collab-session-view"></div></div>');return t.View.extend({className:"block-view unknown-block-view",_isReadOnly:!1,_pageInfo:null,_$pageBreakContainer:null,PAGE_HEIGHT:null,_viewHeightInlastPaging:null,block:null,_getSelector:function(){var e=this,t=e.tagName,n=e.className.split(/\s+/),o=e.id,r=e.cid,a=".note-view ";return a+=t,o&&(a+="#"+o),i.each(n,function(e){e&&(a+="."+e)}),a+='[data-yne-cid="'+r+'"]'},initialize:function(e){var t=this;t.block=e.block,t._isReadOnly=e.isReadOnly,i.bindAll(t,"_onLockedChange"),t.block.on("locked-change",t._onLockedChange),e.inlineStyleViewMapper&&(t._inlineStyleViewMapper=e.inlineStyleViewMapper),t._pageInfo={},t.PAGE_HEIGHT=e.pageSize.height,i.isNumber(t.PAGE_HEIGHT)||(l.debugAlert("invalid PAGE_HEIGHT:"+t.PAGE_HEIGHT),t.PAGE_HEIGHT=r.PAGE_TYPE_NONE_HEIGHT),t._$pageBreakContainer=e.pageBreakContainer,t.noteView=e.noteView},render:function(){var e=this;e.$el.attr("data-yne-cid",e.cid),e._updateLockState(e.isLocked()),a.isListItem(e.block)||e.trigger("view-height-changed",e.cid)},convertToNativeRange:function(){l.error("convertToNativeRange() should be implemented by subclass!")},parseNativeRange:function(){l.error("parseNativeRange() should be implemented by subclass!")},bindSelectionEvents:function(){var e=this;i.bindAll(e,"onDrawRange"),e.on("draw-range",e.onDrawRange)},onDrawRange:function(){throw"Method not implemented."},_onLockedChange:function(e){var t=this;t._updateLockState(t.isLocked()),t._updateLockIndicator(t.block.isLocked(),e),t.trigger("locked-change"),t.trigger("view-height-changed",t.cid)},isCollabLocked:function(){var e=this,t=e.block,n=!1;return t&&(n=t.isLocked()),n},isLocked:function(){var e=this,t=e.block,n=e._isReadOnly;return t&&(n=t.isLocked()||e._isReadOnly),n},_updateLockIndicator:function(e,t){var n,o,i=this,r=t&&t.lockColor,a=t&&t.nickname;n=i.$el.find(".collab-editing-view-wrapper"),null!=n&&0!==n.length||(n=c.clone(),i.$el.prepend(n)),o=n.find(".collab-session-view"),e?(i.$el.addClass("collab-editing-view"),null!=a&&o.text(a),null!=r&&o.css("background-color",r)):(i.$el.removeClass("collab-editing-view"),i.$el.find(".collab-editing-view-wrapper").remove())},_updateLockState:function(e){var t=this;e?t.$el.addClass("collab-locked"):t.$el.removeClass("collab-locked")},onDestroy:function(){l.log("onDestroy() should be implemented by subclass!")},clearHighlight:function(){},clearPageBreaks:function(){var e=this;i.each(e._pageInfo,function(t){t&&t.pageBreak&&e._removePageBreak(t.pageBreak)}),e._pageInfo={}},coincideAllPageBreaks:function(){var e=this;if(!e._pageInfo)return void l.debugAlert("pageInfo should not be null when coincideAllPageBreaks");i.each(e._pageInfo,function(t){t&&t.pageBreak&&e._coincidePageBreak(t.pageBreak)})},disablePageMode:function(){var e=this;e.clearPageBreaks(),e.PAGE_HEIGHT=r.PAGE_HEIGHT_NONE},enablePageMode:function(e){var t=this;t.clearPageBreaks(),e===r.PAGE_TYPE_A4?t.PAGE_HEIGHT=r.PAGE_HEIGHT_A4:e===r.PAGE_TYPE_B5?t.PAGE_HEIGHT=r.PAGE_HEIGHT_B5:e===r.PAGE_TYPE_TEST?t.PAGE_HEIGHT=r.PAGE_HEIGHT_TEST:t.PAGE_HEIGHT=r.PAGE_HEIGHT_NONE},getBottomPosInPage:function(e){var t,n=this;return n._pageInfo[e]?n._pageInfo[e].pageBreak?t=-1:(t=n._pageInfo[e].topPosInPage+n._getHeightInPage(e))>n.PAGE_HEIGHT&&l.warn("Unsplitted Block whose Height is more than PAGE_HEIGHT",n._pageInfo[e].topPosInPage,t,n.PAGE_HEIGHT):(l.debugAlert("should NOT invoke the getBottomPosInPage when the view is NOT on the page"),t=0),t},getFirstTransPageIndex:function(){var e=this,t={};return e._pageInfo?(i.each(e._pageInfo,function(e){e&&(null==t.pageIndex?t=e:e.pageIndex<t.pageIndex&&(t=e))}),t.pageIndex):(l.debugAlert("pageInfo should not be null when getFirstTransPageIndex"),null)},getLastTransPageIndex:function(){var e=this,t={};return e._pageInfo?(i.each(e._pageInfo,function(e){e&&(null==t.pageIndex?t=e:e.pageIndex>t.pageIndex&&(t=e))}),t.pageIndex):(l.debugAlert("pageInfo should not be null when getLastTransPageIndex"),null)},isOnFloat:function(){var e,t=this;return e=t.$el.css("float")||"none","none"!==e.toLowerCase()},resetPageInfo:function(e,t){var n,o,r=this,a=!1;return r._pageInfo?i.isNumber(t)?null==e?(l.debugAlert("pageIndex should NOT be null"),a):null==r._$pageBreakContainer?(l.debugAlert("pageBreakContainer should not be null"),a):(r._pageInfo[e]&&(n=r._pageInfo[e].topPosInPage),t=Math.ceil(t),r.clearPageBreaks(),r._updatePageInfo(e,t),r.$el.css("height","auto"),o=r.$el.outerHeight(!0),t!==n?a=!0:r._isViewHeightChanged(o)?a=!0:r._isPagingContinue()&&(a=!0),a?r._viewHeightInlastPaging=o:l.log("No Page Pos Changed",r),l.log("resetPageInfo(cid/pageInfo/topPos/height):"+r.cid+"/"+e+"/"+t+"/"+r._viewHeightInlastPaging),a):(l.debugAlert("topPosInPage should be a number:"+t),a):(l.debugAlert("pageInfo should not be null when resetPageInfo"),a)},_coincidePageBreak:function(e){var t=this;e.coincide(),t.trigger("pageBreak-positionChanged",e.getPageBreak().attr("data-page-id")),t._showPageBreakInfo(e)},_createPageBreak:function(e,t,n,o){var i=this;return new s({pageIndex:e,topBlankHeight:t,bottomBlankHeight:n,container:i._$pageBreakContainer,noteView:i.noteView,placeholder:o})},_getContentContainer:function(){return this.$el},_getContentContainerBottomInView:function(){var e=this;return e._getOffsetTopPos(e._getContentContainer())+e._getContentContainer().outerHeight()-e._getOffsetTopPos(e.$el)},_getOffsetTopPos:function(e){return e.offset().top},_getHeightInPage:function(e){var t,n,o=this,i=o._pageInfo[e-1],r=o._pageInfo[e];return r?i&&!i.pageBreak?(l.debugAlert("previous pageBreak should NOT be null"),0):i&&0===i.pageBreak.getPlaceholder().next().length?0:a.isTable(o.block)&&0===o._getContentContainer().find("tbody").children().length?0:"none"!==o.$el.css("float")?0:i&&i.pageBreak&&r&&r.pageBreak?(l.debugAlert("_getHeightInPage: should NOT there when crossing previous/current page"),o.PAGE_HEIGHT):(t=i?o._getPageBreakBottomPosInView(e-1):0,r&&r.pageBreak?(l.debugAlert("_getHeightInPage: shoud not be there when current pageBreak ready"),n=o._getPageBreakTopPosInView(e)):n=o._getContentContainerBottomInView(),Math.ceil(n-t)):(l.debugAlert("should NOT invoke the method when not on the page"),0)},_getPageBreakBottomPosInView:function(e){var t,n,o=this;return t=o._pageInfo[e],t&&t.pageBreak?(n=t.pageBreak.getPlaceholder(),o._getOffsetTopPos(n)+n.height()-o._getOffsetTopPos(o.$el)):0},_getPageBreakTopPosInView:function(e){var t,n,o=this;return t=o._pageInfo[e],n=t.pageBreak.getPlaceholder(),o._getOffsetTopPos(n)-o._getOffsetTopPos(o.$el)},_getTopPosInPage:function(e){var t=this,n=0;return t._pageInfo[e-1]&&t._pageInfo[e-1].pageBreak?n=0:t._pageInfo[e]?n=t._pageInfo[e].topPosInPage:l.debugAlert("should NOT invoke the _getTopPosInPage when the view is NOT on the page"),n},_handlePageOverflow:function(e,t){var n,o,i=this,r=i._getHeightInPage(e),a=i._pageInfo[e-1];return o=i.PAGE_HEIGHT-t,a&&a.pageBreak&&0!==t?(l.debugAlert("toPosInPage should be 0 when crossing the previous page"),!1):(o<0&&(o=0),0===t||i.isOnFloat()||o>r?(i._setViewMaxHeight(e),n=!1):(i._insertPageBreak(e,o),n=!0),n)},_insertPageBreak:function(e,t){var n,o=this;n=o._createPageBreak(e,t),n.getPlaceholder().prependTo(o.$el),o._pageInfo[e].pageBreak=n,o.trigger("pageBreak-inserted",n.getPageBreak().attr("data-page-id")),o._coincidePageBreak(n)},_isInPageMode:function(){return this.PAGE_HEIGHT!==r.PAGE_HEIGHT_NONE},_isPagingContinue:function(){return!1},_isViewHeightChanged:function(e){var t=this,n=!1;return(!t._viewHeightInlastPaging||Math.round(Math.abs(e-t._viewHeightInlastPaging))>r.TOLERABLE_HEIGHT_CHANGE)&&(n=!0),n},_removePageBreak:function(e){e.destroy()},_setViewMaxHeight:function(){},_showPageBreakInfo:function(e){var t,n,o,i,r,a,s=this,c=e.getPageBreak();l.DEBUG&&(t=c.find(".bottomSpan"),t.css("border-bottom","2px dashed #b6b9b6"),n=c.find(".topSpan"),n.css("border-top","2px dashed #b6b9b6"),r=c.attr("data-page-id"),o=s._getOffsetTopPos(c),i=s._getOffsetTopPos(e.getPlaceholder()),a="Page:"+r+" OffsetTop(mark/placeholder):("+Math.round(o)+"/"+Math.round(i)+") TopBlank:"+n.outerHeight(),n.text(a),r*=1,a="TopOnPage:"+s._pageInfo[r].pageIndex+" BottomBlank:"+t.outerHeight(),t.text(a))},_updatePageInfo:function(e,t){var n=this;n._pageInfo[e]={pageIndex:e,topPosInPage:t},n._handlePageOverflow(e,t)&&n._updatePageInfo(e+1,0)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(15),i=n(0),r=n(1),a=n(225),l=n(110);return t=o.extend({inheritStyleHandlers:null,uninheritStyleHandlers:null,tagHandler:null,el:null,parent:null,children:null,styles:null,parser:null,options:null,constructor:function(e,t,n,o,i){var r=this;r.el=e,r.children=[],r.parent=t,r.internalStylesParser=n,r.parent&&r.parent.children&&r.parent.children.push(r),r._computeStyles(),r.computeBulbStyles(),r.parser=o,r.options=i},computeBulbStyles:function(){},_findStyleHandler:function(e,n){var o,a=this,l=e?a.inheritStyleHandlers:a.uninheritStyleHandlers,s=l[n];if(i.isFunction(s))return{action:s};if(i.isObject(s)&&s.action)return s;if(!0===s&&(o=t.styleHandlers[n])&&o.action)return o.inheritable!==e?void r.error("The inheritable value of "+n+" is unvalid!"):o},_computeStyles:function(){var e=this,n=e.el,o={},i=e.tagHandler||t.tagHandlers[n.tagName.toLowerCase()];i&&i(o,n),e.styles={},e._computeInheritStyles(o),e._computeUninheritStyles(o)},_computeStyle:function(e,t){var n,o,r,a=this,l=null!=a.inheritStyleHandlers[t],s=a.parent,c=a.el;null==a.styles[t]&&(l&&!s||(n=a._findStyleHandler(l,t))&&n.action&&(n.requireValues&&n.requireValues.length&&i.each(n.requireValues,function(t){a._computeStyle(e,t)}),l?(o=(s.styles||{})[t],r=n.action(c,a.styles,o),r||!1===r||(r=e[t]),r||!1===r||(r=o)):(r=n.action(c,a.styles))||!1===r||(r=e[t]),(r||!1===r)&&(a.styles[t]=r)))},_computeInheritStyles:function(e){var t=this;t.inheritStyleHandlers&&i.each(t.inheritStyleHandlers,function(n,o){n&&t._computeStyle(e,o)})},_computeUninheritStyles:function(e){var t=this;t.uninheritStyleHandlers&&i.each(t.uninheritStyleHandlers,function(n,o){n&&t._computeStyle(e,o)})},setup:function(){},capture:function(){r.warn("Function capture should be implemented by SubClass")},finish:function(){},handleChildrenBySelf:function(){return!1},emit:function(e){var t=this;t.parent&&t.parent.capture(e)},getRoot:function(){var e=this;if(e.parent)return e.parent.getRoot()}},{tagHandlers:a,styleHandlers:l})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(3),n(40),n(29),n(1),n(2),n(19),n(30),n(10),n(60)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.createBlank=function(){return new t({})},t.fromCollabJSON=function(e){var n=t.generalFromJSON(e,!0);return e.ownerId&&(n.oldOwnerId=e.ownerId),n},t.fromJSON=function(e){return t.generalFromJSON(e,!1)},t.fromXml=function(e){var n,r=new t({});return r.parseIdFromXml(e),r.setText(u.fromXml(e)),$(e).children().each(function(e,t){switch(t.nodeName){case s.TAG_ID_NAME:case s.LEGACY_TAG_ID_NAME:case"text":case"inline-styles":break;case"styles":o.fromXml(r,t);break;case"href":n=$(t).find("value").text(),r.setHref(n);break;default:i.appendToTree(r.unknownTree,t)}}),r},t.generalFromJSON=function(t,n){var o=e.generalFromJSON.call(this,t,n);return o&&t.href&&o.setHref(t.href),o},t.prototype.blur=function(){this.trigger("blur")},t.prototype.findAndSetOwnerList=function(e){var t,n=e.getPreBlock(this),o=e.getNextBlock(this),i=this.oldOwnerId;return i?l.isCatalogue(o)&&i===o.getOwnerId()?(t=o.getOwnerList(),this.setOwnerList(t),t.insertBefore(this,o)):l.isCatalogue(n)&&i===n.getOwnerId()?(t=n.getOwnerList(),this.setOwnerList(t),t.insertAfter(this,n)):(t=new d({id:i}),this.setOwnerList(t),t.insertAfter(this,null)):a.error("No oldOwnerId!")},t.prototype.focus=function(){this.trigger("focus")},t.prototype.getHref=function(){return this.href},t.prototype.getHtmlHref=function(){return n.isGUID(this.href)?"#"+this.href:this.href||"#"},t.prototype.getOwnerId=function(){return this.getOwnerList().getId()},t.prototype.getOwnerList=function(){return this.ownerList||a.warn('No ownerList! check have "setOwnerList"'),this.ownerList},t.prototype.getViewHref=function(){return n.isGUID(this.href)?null:this.href},t.prototype.isFirst=function(){return this.isFirstProp},t.prototype.isLast=function(){return this.isLastProp},t.prototype.removeSorting=function(){var e=!1;this.isFirstProp&&(e=!0,this.isFirstProp=null),this.isLastProp&&(e=!0,this.isLastProp=null),e&&this.trigger("sorting-change")},t.prototype.setOwnerList=function(e){this.ownerList=e},t.prototype.setFirst=function(){this.isFirstProp||(this.isFirstProp=!0,this.trigger("sorting-change"))},t.prototype.setHref=function(e){this.href=e||null,this.trigger("style-change","href",e)},t.prototype.setIndent=function(e){e>0&&this.setBlockStyle("indent",e)},t.prototype.setLast=function(){this.isLastProp||(this.isLastProp=!0,this.trigger("sorting-change"))},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.href=this.getHref(),t.ownerId=this.getOwnerId(),t},t.prototype.toJSON=function(t,n){var o=this.sliceText(t,n,!1),i=e.prototype.toJSON.call(this);return i.text=o.toJSON(),i.href=this.getHref(),i.ownerId=this.getOwnerId(),i},t.prototype.toHtml=function(e,t,n){var o,i,r=document.createElement("div"),a=$("<a></a>"),l=$(r),s="";return n=!0===n,l.attr("yne-bulb-block","catalogue").css("white-space","pre-wrap"),this.isFirst()&&(s="first"),this.isLast()&&(s+="last"),l.attr("yne-bulb-order",s),this.applyBlockStylesOnElement(l,!0),e=e||0,t=null==t?this.getEndOffset():t,o=this.sliceText(e,t,!1),i=c.rich2html(o,{withDefault:n}),a.attr("href",this.getHtmlHref()).html(i),l.html(a[0].outerHTML),r.outerHTML},t.prototype.toXml=function(t){var n,o,i=e.prototype.toXml.apply(this,[t]);return this.getHref()&&(n=t.createElement("href"),o=t.createElement("value"),$(o).text(this.getHref()),n.appendChild(o),i.appendChild(n)),$(i).attr("catalogue-id",this.getOwnerId()),$(i).attr("compat","true"),i},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=l.CATALOGUE,this.setHref(t.href),this.setIndent(t.indent),this.options&&this.options.ownerList&&this.setOwnerList(this.options.ownerList),this.on("attached",this._onAttached.bind(this)),this.on("detached",this._onDetached.bind(this)),this.on("select",this._onSelect.bind(this)),this.on("remove-select",this._onRemoveSelect.bind(this))},t.prototype._onAttached=function(e){var t=this.getOwnerList(),n=e.getPreBlock(this),o=e.getNextBlock(this);if(!t)return this.findAndSetOwnerList(e);n&&l.isCatalogue(n)&&n.getOwnerId()===this.getOwnerId()?t.insertAfter(this,n):o&&l.isCatalogue(o)&&o.getOwnerId()===this.getOwnerId()?t.insertBefore(this,o):t.insertAfter(this,null)},t.prototype._onDetached=function(){this.getOwnerList().removeItem(this)},t.prototype._onRemoveSelect=function(){this.getOwnerList().removeSelect()},t.prototype._onSelect=function(){this.getOwnerList().select()},t}(s)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(){var e=function(e,t){var n,o,i;if(t.implementation&&t.implementation.createHTMLDocument)return n=t.implementation.createHTMLDocument("title"),n.body.innerHTML=e,n;if(i=t.defaultView||window,i.DOMParser){o=new i.DOMParser;try{n=o.parseFromString("","text/html")}catch(e){}if(n)return n.body.innerHTML=e,n}};return function(t,n,o,i){if(i=!0===i,t||i){n=n||document;var r,a,l,s,c=e(t,n);if(c){if(!1!==o)return c.body;for(l=c.body.childNodes,r=l.length,s=[],a=0;a<r;a++)s.push(l[a]);return s}}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";return{ATTACHMENT:"attachment",IMAGE:"image",TEXT:"text"}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.WS_OPENED="WS_OPENED",e.WS_MESSAGE="WS_MESSAGE",e.WS_CLOSED="WS_CLOSED",e.SESSION_CHNAGED="SESSION_CHNAGED",e.SESSION_JOINED="SESSION_JOINED",e.SESSION_QUIT="SESSION_QUIT",e.SESSION_PROP_UPDATE="SESSION_PROP_UPDATE",e.SESSION_LOCK_UPDATE="SESSION_LOCK_UPDATE",e.SESSION_INIT_DONE="SESSION_INIT_DONE",e.SESSION_INIT_BUILT="SESSION_INIT_BUILT",e.NONDATACMD_MODIFIERS_RESULT="NONDATACMD_MODIFIERS_RESULT",e.LOCK_RELEASED="LOCK_RELEASED",e.LOCK_LOCKED="LOCK_LOCKED",e.LOCK_PROP_UPDATE="LOCK_PROP_UPDATE",e.CONFLICT_LOCKED_BY_ME="CONFLICT_LOCKED_BY_ME",e.CONFLICT_LOCKED_BY_OTHERS="CONFLICT_LOCKED_BY_OTHERS",e.CONFLICT_BLOCK_CHANGED="CONFLICT_BLOCK_CHANGED",e.DATACMD_FAILURE="DATACMD_FAILURE",e.DATACMD_NO_PENDING="DATACMD_NO_PENDING",e.DATACMD_SUCCESS="DATACMD_SUCCESS",e.ENGINE_EXCEPTION="ENGINE_EXCEPTION",e}();t.default=n}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(2),n(14),n(42),n(26)],void 0!==(i=function(e,t,n,o,i,r){"use strict";return function(){function e(){}return e.buildNoteRangeFromJSON=function(e,t){return o.fromCollabJSON(e,t)},e.buildNoteRangeFromNonTextBlock=function(e){var t,a={};return a.block=e,n.isTable(e)&&(a.type=i.TYPES.ALL),t=r.createRangeByBlock(a),o.create({endRange:t,startRange:t})},e.buildNoteRangeFromParagraph=function(e,t,n){var i=r.createRangeByBlock({block:e,start:t,end:n});return o.create({endRange:i,startRange:i})},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(10),a=n(3);return t=o.extend({name:"atom.InsertBlockText",_textBlock:null,_start:null,_insertedText:null,initialize:function(){var e=this,n=e.options.args;a.isCollabCommand(n)||(e._textBlock=e.options.block,e._start=e.options.start,e._insertedText=e.options.text),t.__super__.initialize.apply(e)},apply:function(){var e=this;return!!e._insertedText&&(e._textBlock.insertText(e._start,e._insertedText),!0)},doUnapply:function(){var e=this;e._textBlock&&e._insertedText&&e._textBlock.deleteText(e._start,e._start+e._insertedText.getLength())},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),o&&(e._insertedText=r.fromCollabJSON(o.richText),e._textBlock=n.collabProperties.coreEditor.getBlockById(o.blockId),e._start=o.startPosition)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._textBlock.getId(),n.richText=e._insertedText.toCollabJSON(),n.startPosition=e._start,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},,function(e,t,n){var o,i;o=[n,t,n(0)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){var t=n.keys(e);return n.each(t,function(t){var n=e[t];"object"==typeof n&&null!==n&&o(n)}),Object.freeze(e)};return function(e,t){return e&&"object"==typeof e?(t=!1!==t,Object.freeze?t?o(e):Object.freeze(e):e):e}}.apply(t,o))&&(e.exports=i)},function(e,t,n){(function(o){var i,r;i=[n,t],void 0!==(r=function(e,t){"use strict";var n=this,o=n.DEBUG,i=n.console,r=function(){};return o&&i.assert&&(r=i.assert.bind(i)),r}.apply(t,i))&&(e.exports=r)}).call(t,n(83))},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(3),n(59),n(17)],void 0!==(i=function(e,t,n,o,i,a){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromXml=function(e){var o=$(e),i=o.attr("id"),r=new t({id:i});return n.each(e.attributes,function(e){switch(e.nodeName){case"id":case"type":break;default:r.unknownAttrs.push(e.cloneNode(!0))}}),r},t.prototype.getId=function(){return this.id},t.prototype.getItems=function(){return this.items},t.prototype.getLength=function(){return this.items.length},t.prototype.insertAfter=function(e,t){var n=this.items,o=t?n.indexOf(t):-1;this.insertItem(o+1,e)},t.prototype.insertBefore=function(e,t){var n=this.items,o=t?n.indexOf(t):0;this.insertItem(o,e)},t.prototype.insertItem=function(e,t){var n=this.items;return i(e>0||e<=n.length),n.splice(e,0,t),this.updateIndexes(),e},t.prototype.isLock=function(){return!!this.state},t.prototype.removeItem=function(e){var t=this.items,n=t.indexOf(e);return n>=0&&(t.splice(n,1),this.updateIndexes()),n},t.prototype.removeSelect=function(){var e=this.items;e[0]&&e[0].blur()},t.prototype.select=function(){var e=this.items;this.isLock()||e[0]&&e[0].focus()},t.prototype.updateIndexes=function(){var e=this.items;e.forEach(function(t,n){t.removeSorting(),0===n&&t.setFirst(),n===e.length-1&&t.setLast()})},t.prototype.updateLockState=function(e){this.state=e,this.state&&this.removeSelect()},t.prototype.initialize=function(e){this.id=e.id||o.newGUID(),this.items=[],this.unknownAttrs=[]},t}(a)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(40),n(10),n(29),n(62),n(8),n(1),n(52),n(115),n(25),n(2)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromJSON=function(e){if(!e||!e.type||e.type!==h.IMAGE||!e.source)return void c.warn("jsonObj or jsonObj.source does NOT exist!");var n=new t({source:e.source,title:e.title});return e.styles&&n.setStyles(e.styles),e.blockId&&n.setId(e.blockId),n},t.fromXml=function(e){var n=$(e),i=$.trim(n.find("> source:first").text()),r=$.trim(n.find("> text:first").text()),l=new t({source:i,title:r});return l.parseIdFromXml(e),n.children().each(function(e,t){switch(t.nodeName){case p.TAG_ID_NAME:case p.LEGACY_TAG_ID_NAME:case"source":case"text":break;case"styles":o.fromXml(l,t);break;default:a.appendToTree(l.unknownTree,t)}}),l},t.prototype.countWords=function(){return 0},t.prototype.getFakeLoading=function(){return this.imageProps.fakeLoading},t.prototype.getHighlight=function(e,t){var o=this,r=[];if(null!=t.images&&t.images.length>0&&n.some(t.images,function(e){return e.resID===o.getSource()&&(r.push({imageInfo:e}),!0)}),null!=e&&e.length>0){var a=i.create(this.imageProps.title);n.each(e,function(e){for(var t=e.getLength(),n=a.indexOf(e,0,!0);-1!==n;)r.push({end:n+t,start:n}),n=a.indexOf(e,n+t,!0)})}return r.length?r:null},t.prototype.getImageInfo=function(){return this.imageInfo},t.prototype.getResId=function(){return this.imageProps.resId},t.prototype.getSource=function(e){var t,n=this.imageProps.source;return!0===e&&(t=this.getExtraInfo("pcResMap"))&&t[n]&&(n=t[n]),n},t.prototype.getStyles=function(e){return e?this.getBlockStyle(e):this.getBlockStyles()},t.prototype.getTitle=function(){return this.imageProps.title},t.prototype.setFakeLoading=function(e){this.imageProps.fakeLoading=e},t.prototype.setImageInfo=function(e){e&&e.resId&&"number"==typeof e.rawWide?this.imageInfo=e:c.error("The imageInfo is not valid in image: "+this.imageProps.resId)},t.prototype.setSource=function(e){return!(!e||e===this.imageProps.source)&&(this.imageProps.source=e+"",this.trigger("content-change"),!0)},t.prototype.setStyles=function(e,t){return n.isString(e)?this.setBlockStyle(e,t):n.isObject(e)&&this.setBlockStyles(e),!0},t.prototype.setTitle=function(e){return e!==this.imageProps.title&&(this.imageProps.title=e+"",this.trigger("content-change"),!0)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.source=this.getSource(),t.title=this.getTitle(),t},t.prototype.toHtml=function(e,t,o){var i,r,a=u("",document,!0,!0),c=a.ownerDocument,d=this.getStyles(),p=c.createElement("div"),h=$(p),g=$(c.createElement("img"));return h.attr("yne-bulb-block","image"),n.each(d,function(e,t){switch(t){case"align":h.css("text-align",e);break;case"width":null==e?g.css("width",""):g.css("width",e);break;case"float":h.css("float",e);break;case"back-color":h.css("background-color",e);break;case"padding":h.css("padding",e)}}),i=this.getSource(!0===o),r=this.getTitle(),s.IS_PC&&(i=l(i)),g.attr({alt:r,"data-media-type":"image",src:i}),h.append(g),p.outerHTML},t.prototype.toPlain=function(){return""},t.prototype.toXml=function(t){var n,i,r,l,s,c,u=this.getSource(),d=this.getTitle()||"";if(u)return n=e.prototype.toXml.apply(this,[t]),i=t.createElement("source"),r=t.createTextNode(u),i.appendChild(r),n.appendChild(i),l=t.createElement("text"),s=t.createTextNode(d),l.appendChild(s),n.appendChild(l),c=t.createElement("styles"),o.toXml(this,c,t),n.appendChild(c),a.appendToXml(this.unknownTree,n),n},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=h.IMAGE,this.imageProps={source:t.source,title:t.title},this.imageProps.fakeLoading=t.fakeLoading||!1,this.imageProps.resId=d.parseImgSource(this.imageProps.source).resId},t}(p)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(){return function(e){if(!e||/^http/i.test(e))return e;var t,n=e.lastIndexOf("\\");return-1===n?e:(t=e.substring(n+1),e.substring(0,n+1)+encodeURIComponent(t))}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(6),n(40),n(10),n(75),n(53),n(239),n(76),n(29),n(142),n(241),n(1),n(41),n(25),n(2),n(78),n(242),n(91),n(77),n(243)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h,g,f,m,_,y,v,b,k,C){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.createBlankTable=function(e,n,o,i){var r,a,s,c=new t({}),u=[],d=[],p=[];for(o?c.setId(o):o=c.getId(),i&&(s=i/e),r=0;r<n;r++)for(p.push(y.DEFAULT_ROW_HEIGHT),u[r]=u[r]||[],a=0;a<e;a++)0===r&&d.push(s||y.DEFAULT_COL_WIDTH),u[r].push(k.create({cellId:k.makeCellId(o,r,a),content:l.createBlank()}));return c.setContentData(u,p,d),c},t.fromJSON=function(e,n){if(!e||!e.type||e.type!==_.TABLE)return void g.warn("jsonObj is not valid!");var o=e.data,i=new t({colWidths:o.widths,rowHeights:o.heights,tableCells:u.cellsFromJSON({cellsJson:o.cells,height:o.heights.length,isUpdateCellId:n,resourceList:e.resourceList,width:o.widths.length})});return e.styles&&i.setBlockStyles(e.styles),e.blockId&&i.setId(e.blockId),i},t.fromXml=function(e){var n,o,r,a,l,s=$(e),c=s.children("content:first").eq(0),u=$.trim(c.text()),p=t._resourceMapFromXml(s.children("resource-list:first").get(0)),h=new t({resourceMap:p});h.parseIdFromXml(e);try{n=JSON.parse(u)}catch(e){return void g.error(e,u)}return r=n.cells,a=t.validateRowHeights(n.heights),l=t.validateRowHeights(n.widths),o=t._tableCellsFromXml(r,a,l,{resourceMap:p,tableBlockId:h.getId()}),h.setContentData(o,a,l),s.children().each(function(e,t){switch(t.nodeName){case m.TAG_ID_NAME:case m.LEGACY_TAG_ID_NAME:case"content":case"resource-list":break;case"styles":i.fromXml(h,t);break;default:d.appendToTree(h.unknownTree,t)}}),h},t.validateRowHeights=function(e){return t._validateDimensionArray(e,y.DEFAULT_ROW_HEIGHT)},t.validColWidths=function(e){return t._validateDimensionArray(e,y.DEFAULT_COL_WIDTH)},t._resourceMapFromXml=function(e){var t={};return e?($(e).children("resource-mono").each(function(e,o){var i=$(o),r=i.find("res-id").text();if(!r)return void g.error("<resource-mono/> node has no res-id",o);n.some(v,function(e,n){var a,l=i.children(n+":first").get(0);if(l&&e&&e.fromXml&&(a=e.fromXml(r,l,o)),a)return t[r]=a,!0})}),t):t},t._tableCellsFromXml=function(e,t,n,o){var i,r,a,l=n.length,s=t.length,c=[];for(i=0;i<s;i++)for(c[i]=[],r=0;r<l;r++)a=i*l+r,c[i][r]=k.fromXml({cellRawData:e[a],colIndex:r,resourceMap:o.resourceMap,rowIndex:i,tableBlockId:o.tableBlockId});return c},t._validateDimensionArray=function(e,t){return e?n.map(e,function(e){return e>0?e:t}):[t]},t.prototype.clearCellAttr=function(e,t){if(!this.isLocked()){var n=this._getCellAt(e,t);n&&(n.clearMergePointAttr(),n.clearMergedCellAttr(),this.trigger("attribute-changed"))}},t.prototype.countWords=function(){var e=this.toPlain({filter:function(e){return e&&e.getType()===s.TEXT},returnString:!1,withLineBreak:!1}),t=0;return n.each(e,function(e){n.each(e,function(e){t+=p(e)})}),t},t.prototype.createCell=function(e){e=e||{};var t,n=e.content||l.createBlank(),o=e.styles;return t=k.create({content:n}),o&&t.setBlockStyles(o),t},t.prototype.creatRowData=function(){var e,t=this.getColumnCount(),n=[];for(e=0;e<t;e++)n.push(this.createCell());return n},t.prototype.deleteCols=function(e,t){if(!this.isLocked()){var n,o,i=[];if(!this.isLocked())return t=t||1,this.tableCells.forEach(function(n){for(o=0;o<t;o++)i[o]=i[o]||[],i[o].push(n.splice(e,1)[0])}),n=this.colWidths.splice(e,t),this.trigger("col-deleted",e,t),{colsData:i,widths:n}}},t.prototype.deleteRows=function(e,t){if(!this.isLocked()){var n,o,i=[];if(!this.isLocked()){for(t=t||1,o=0;o<t;o++)i[o]=this.tableCells.splice(e,1)[0];return n=this.rowHeights.splice(e,t),this.trigger("row-deleted",e,t),{heights:n,rowsData:i}}}},t.prototype.forEach=function(e,t){var n=this;n.forEachRow(function(o){return n.forEachColumn(function(t){return e(o,t)},t)},t)},t.prototype.forEachCell=function(e,t){var n=this,o={};n.forEach(function(t,i){var r,a=n.getCell(t,i,{findMergePointIfNeeded:!0,withPosition:!0});if(a&&(r=a.row+"-"+a.col,!0!==o[r]))return o[r]=!0,e(a.cell,a.row,a.col)},t)},t.prototype.forEachColumn=function(e,t){var n,o=this.getColumnCount();for(n=0;n<o;n++)if(!1===e(t?0+o-n:0+n))return!1},t.prototype.forEachRow=function(e,t){var n,o=this.getRowCount();for(n=0;n<o;n++)if(!1===e(t?0+o-n:0+n))return!1},t.prototype.getAllResourceInfo=function(){var e,t,n,o,i,r=this,a=[];return r.forEach(function(l,s){var c=r.getCell(l,s),u=r.getExtraInfo("pcResMap");c&&c.isImageCell()&&(e=c.getContent(),t=e.getSource(),n=e.getSource(u),t&&n&&a.push({extraSource:n,source:t})),c&&c.isAttachmentCell()&&(e=c.getContent(),t=e.getSource(),n=e.getSource(u),o=e.getResource(),i=e.getResource(u),t&&n&&o&&i&&a.push({extraResource:i,extraSource:n,resource:o,source:t}))}),a},t.prototype.getCell=function(e,t,o){o=n.defaults(o||{},{findMergePointIfNeeded:!1,withPosition:!1});var i,r;if(!o.findMergePointIfNeeded){if(!(r=this._getCellAt(e,t)))return;return!0===o.withPosition?{cell:r,col:t,row:e}:r}return i=this._findMergePoint(e,t),o.withPosition?i:i&&i.cell?i.cell:null},t.prototype.getCells=function(){return this.tableCells},t.prototype.getCellBlockStyles=function(e){var t,o=e.row,i=e.col,r=e.names,a=this._getCellAt(o,i);return!a.isMergedCell()&&(t=a.getBlockStyles(),r&&r.length>0?n.pick(t,r):t)},t.prototype.getCellById=function(e){if(f.isElement(e)&&(e=$(e).data("cellId")),e){var t,n,o,i=this.getRowCount(),r=this.getColumnCount();for(t=0;t<i;t++)for(n=0;n<r;n++)if((o=this.getCell(t,n))&&o.getCellId()===e)return{cell:o,col:n,row:t}}},t.prototype.getCellInlineStyles=function(e){var t=e.row,n=e.col,o=this._getCellAt(t,n);return o.isTextNoEmptyCell()?o.getInlineStyles(e.names):o.getStylesForEmpty(e.names)},t.prototype.getCellSize=function(e,t){var n=this.getCell(e,t,{findMergePointIfNeeded:!0,withPosition:!0});if(n&&n.cell)return this._getCellSize(n.cell,n.row,n.col)},t.prototype.getCellSizeById=function(e){var t=this.getCellById(e);if(t&&t.cell)return this._getCellSize(t.cell,t.row,t.col)},t.prototype.getColumnCount=function(){var e=this.colWidths||[],t=e.length;return Math.max(y.MIN_COL_COUNT,t)},t.prototype.getColumnWidth=function(e){return this.colWidths[e]||y.DEFAULT_COL_WIDTH},t.prototype.getCommonBlockStyle=function(e,t){var n;return t&&t.getAsRectRange&&(t=t.getAsRectRange()),t&&t.forEachCell?(t.forEachCell(function(t){var i=t.getBlockStylesAsBulb()||{};if(null==n)n=i[e];else if(n!==i[e])return n=o.INTERM,!1},!1),n===o.INTERM?null:n):(g.warn("Unvalid parameter",t),null)},t.prototype.getCommonInlineStyle=function(e,t){var n;return t&&t.getAsRectRange&&(t=t.getAsRectRange()),t&&t.forEachCell?(t.forEachCell(function(t){var i=t.getCommonInlineStyle(e);if(null==n)n=i;else if(n!==i)return n=o.INTERM,!1},!1),n===o.INTERM?null:n):(g.warn("Unvalid parameter",t),null)},t.prototype.getContentAt=function(e,t){var n=this.getCell(e,t);if(n)return{content:n.getContent(),type:n.getType()}},t.prototype.getMergedCellAttrAt=function(e,t){var n=this._getCellAt(e,t),o={};return n?n.getMergedCellAttr():o},t.prototype.getMergePointAttrAt=function(e,t){var n=this._getCellAt(e,t),o={};return n?n.getMergePointAttr():o},t.prototype.getPosition=function(e){if(e){var t,n,o=this.getRowCount(),i=this.getColumnCount();for(t=0;t<o;t++)for(n=0;n<i;n++)if(this.getCell(t,n)===e)return{col:n,row:t}}},t.prototype.getRowCount=function(){var e=this.rowHeights||[],t=e.length;return Math.max(y.MIN_ROW_COUNT,t)},t.prototype.highlight=function(e,t,n){this.trigger("high-light",e,t,n)},t.prototype.isEmptyContent=function(){var e=!0;return this.forEachCell(function(t){if(!t.isEmpty())return e=!1,!1}),e},t.prototype.getRowHeight=function(e){return this.rowHeights[e]||y.DEFAULT_ROW_HEIGHT},t.prototype.isMergedCell=function(e,t){var n=this.getCell(e,t);return n&&n.isMergedCell&&n.isMergedCell()},t.prototype.isMergePoint=function(e,t){var n=this.getCell(e,t);return n&&n.isMergePoint&&n.isMergePoint()},t.prototype.isMergeRect=function(e){var t;return!!this.isMergePoint(e.top,e.left)&&(t=this.getMergePointAttrAt(e.top,e.left),t.width>=e.width&&t.height>=e.height)},t.prototype.insertCols=function(e,t,n){if(!this.isLocked()){var o=this,i=o.tableCells,r=e;n=n||[],t.forEach(function(e,t){i.forEach(function(t,n){t&&t.splice(r,0,e[n])}),o.colWidths.splice(r,0,n[t]||y.DEFAULT_COL_WIDTH),r+=1}),o.trigger("col-inserted",e)}},t.prototype.insertRows=function(e,t,o){if(!this.isLocked()){var i=this,r=e;o=o||[],n.forEach(t,function(e,t){i.tableCells.splice(r,0,e),i.rowHeights.splice(r,0,o[t]||y.DEFAULT_ROW_HEIGHT),r+=1}),i.trigger("row-inserted",e)}},t.prototype.setCellBlockStyles=function(e){if(!this.isLocked()){var t,o=e.row,i=e.col,r=e.styles,a=this._getCellAt(o,i);return!a.isMergedCell()&&(r&&!n.isEmpty(r)||a.clearStyles(),b.bulbStyles2TableStyles(r),a.setBlockStyles(r),t=a.getBlockStyles(),this.trigger("cell-block-style-change",o,i,r,t),!0)}},t.prototype.setCellContent=function(e,t,o){var i,r;if(!this.isLocked())return null==o?void g.warn("content is not valid",o):(i=this.getCell(e,t))?(n.isString(o)&&(o=a.create(o)),o instanceof a&&(o=l.create({richText:o})),r=i.setContent(o),r&&this.trigger("cell-content-change",i.getCellId()),r):void g.warn("no cell at row/col",e,t)},t.prototype.setCellInlineStyles=function(e){if(e&&e.styles&&!this.isLocked()){var t=e.row,n=e.col,o=e.styles,i=this._getCellAt(t,n);return i&&i.isTextNoEmptyCell()?(i.setInlineStyles(o),this.trigger("cell-inline-style-change",t,n)):i.setStylesForEmpty(o),!0}},t.prototype.setContentData=function(e,t,n){var o=this;e&&e.length&&t&&t.length&&n&&n.length&&(this.tableCells=e,this.rowHeights=t,this.colWidths=n,setTimeout(function(){o._checkAndFixTableData()}))},t.prototype.setColumnWidth=function(e,t){this.isLocked()||(this.colWidths[e]=t,this.trigger("col-width-set",e,t))},t.prototype.setMergedCellAttrAt=function(e,t,n,o){if(!this.isLocked()){var i=this._getCellAt(e,t);i&&(i.setMergedCellAttr(n,o),this.trigger("attribute-changed"))}},t.prototype.setMergePointAttrAt=function(e,t,n,o){if(!this.isLocked()){var i=this._getCellAt(e,t);i&&(i.setMergePointAttr(n,o),this.trigger("attribute-changed"))}},t.prototype.setRowHeight=function(e,t){this.isLocked()||(this.rowHeights[e]=t,this.trigger("row-height-set",e,t))},t.prototype.toHtml=function(e,t,o){var i,r=o?this.getExtraInfo("pcResMap"):null,a=c.renderTable(this,null,r),l=document.createElement("div"),s=$(l),u=this.getBlockStyles();return n.each(u,function(e,t){switch(t){case"back-color":s.css("background-color",e);break;case"padding":s.css("padding",e)}}),s.attr("yne-bulb-block","table").css({overflow:"auto"}).append(a),i=l.outerHTML,i=i.replace(/style="(.*?)"/g,function(e){if(e)return e.replace(/\&quot;/g,"")})},t.prototype.toJSON=function(t){var n=this,o=[].concat(n.colWidths),i=[].concat(n.rowHeights),r=[],a={},l={},s=e.prototype.toJSON.call(this);return n.forEach(function(e,o){var i,s=n.getCell(e,o);s&&s.isAttachmentCell()&&!t&&(i=s.getContent(),a[i.getResId()]=i.getInfo()),s&&s.isImageCell()&&!t&&(i=s.getContent(),l[i.getResId()]=i.getInfo()),r.push(s?s.toJSON(t):null)}),t?{cells:r,heights:i,widths:o}:(s.data={cells:r,heights:i,widths:o},s.resourceList={attachMap:a,imageMap:l},s)},t.prototype.toPlain=function(e){var t,o=this,i=[];return e=n.defaults(e||{},{filter:function(){return!0},returnString:!0,withLineBreak:!1}),o.forEach(function(t,n){var r=i[t],a=o.getCell(t,n),l="";r||(r=i[t]=[]),e.filter(a,t,n)&&(l=a?a.toPlain(e.withLineBreak):""),r.push(l)}),e.returnString?(t=n.map(i,function(e){return e.join(" ")}),t=t.join("\n")):i},t.prototype.toXml=function(t){var o,r,a,l=this,s=e.prototype.toXml.call(this,t),c=t.createElement("resource-list"),u=t.createElement("content"),p={},h=[];return l.forEach(function(e,o){var i=l.getCell(e,o),r=i?i.toXml(t,c,p):{},a=n.keys(r);1===a.length&&"value"===a[0]&&""===r.value&&(r={}),h.push(r)}),s.appendChild(c),r={cells:h,heights:[].concat(l.rowHeights),widths:[].concat(l.colWidths)},a=JSON.stringify(r),u.appendChild(t.createTextNode(a)),s.appendChild(u),o=t.createElement("styles"),i.toXml(l,o,t),s.appendChild(o),d.appendToXml(l.unknownTree,s),s},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=_.TABLE,this.setContentData(t.tableCells,t.rowHeights,t.colWidths),this.resourceMap=t.resourceMap,delete this.options,n.bindAll(this,"_onDetached","_onAttached","_onLockedChange"),this.on("detached",this._onDetached),this.on("attached",this._onAttached),this.on("locked-change",this._onLockedChange)},t.prototype._checkAndFixTableData=function(){var e,t,n=this.toJSON();try{e=C(n.data),e.errors.length&&(window.console.warn("Table data fix errors:  \n"+e.errors.join("\n")),g.log(n),t=e.fixedData,this.tableCells=u.cellsFromJSON({cellsJson:t.cells,height:t.heights.length,resourceList:n.resourceList,width:t.widths.length}),this.rowHeights=t.heights,this.colWidths=t.widths,this.trigger("content-change"))}catch(e){g.error("Table data fix failed",e)}},t.prototype._getCellAt=function(e,t){var n,o=this.tableCells;return o[e]&&o[e][t]&&(n=o[e][t]),n||g.warn("Failed to get cell at row/col",e,t),n},t.prototype._findMergePoint=function(e,t){var n,o=this._getCellAt(e,t);return o&&o.isMergedCell()&&(n=o.getMergedCellAttr(),e-=n.dy,t-=n.dx,o=this._getCellAt(e,t)),o?{cell:o,col:t,row:e}:void g.warn("Failed to find merge point row/col",e,t)},t.prototype._getCellSize=function(e,t,o){if(e&&!e.isMergedCell()){var i,r,a=this,l=function(e,t){return e+t};if(e&&!e.isMergedCell())return e.isMergePoint()?(i=e.getMergePointAttr())&&i.width&&i.height&&(r={cols:[],heights:[],rows:[],widths:[]},h(function(e){var t=o+e,n=a.getColumnWidth(t);r.widths.push(n),r.cols.push(t)},!1,i.width),h(function(e){var n=t+e,o=a.getRowHeight(n);r.heights.push(o),r.rows.push(n)},!1,i.height)):r={cols:[o],heights:[a.getRowHeight(t)],rows:[t],widths:[a.getColumnWidth(o)]},r&&(r.width=n.reduce(r.widths,l,0),r.height=n.reduce(r.heights,l,0)),r}},t.prototype._onDetached=function(){},t.prototype._onAttached=function(){},t.prototype._onLockedChange=function(){},t}(m)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(62),n(115),n(8),n(152),n(1),n(52),n(90)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.create=function(e){return e&&e.source&&e.resource&&null!=e.fileLength&&e.fileName?(e.resId||s.warn("Will create resId by url!"),new t(e)):void s.warn("Failed to create AttachmentResource",e)},t.fromJSON=function(e,o){e.resId&&o&&o.attachMap||s.error("jsonObj or resourceList is wrong, ",e,o);var r=o.attachMap[e.resId];return r||s.error("resourceList is wrong"),r.resource&&(e.resId=i.parseImgSource(r.resource).resId),t.fromCollabJSON(n.extend(e,r))},t.fromCollabJSON=function(e){return e.fileLength&&e.fileName&&e.resId&&e.resource&&e.source||s.error("jsonObj is wrong, ",e),t.create({resId:e.resId,source:e.source,resource:e.resource,fileName:e.fileName,fileLength:e.fileLength})},t.fromXml=function(e,n){var o=$(n),i=o.children("source:first").text(),r=o.children("resource:first").text(),a=o.children("filename:first").text(),l=o.children("filelength:first").text();return l&&(l=parseInt(l,10)),t.create({resId:e,source:i,resource:r,fileName:a,fileLength:l,fakeLoading:!1,type:u.TYPE_ATTACHMENT})},t.prototype.getFileName=function(){return this.attachmentProps.fileName},t.prototype.getInfo=function(){return{fileLength:this.attachmentProps.fileLength,fileName:this.attachmentProps.fileName,resource:this.attachmentProps.resource,source:this.attachmentProps.source}},t.prototype.getResource=function(e){var t=this.attachmentProps.resource;return e&&e[t]&&(t=e[t]),t},t.prototype.getSource=function(e){var t=this.attachmentProps.source;return e&&e[t]&&(t=e[t]),t},t.prototype.toCollabJSON=function(){var e;return e=this.getInfo(),e.resId=this.attachmentProps.resId,e},t.prototype.toHtml=function(e){var t,i=c("",document,!0,!0),r=i.ownerDocument,l=$(r.createElement("img"));return e=n.defaults(e||{},{resourceMap:null}),t=this.getSource(e.resourceMap)||"",a.IS_PC&&(t=o(t)),l.attr({alt:this.attachmentProps.fileName,"data-media-type":"attachment",filelength:this.attachmentProps.fileLength,filename:this.attachmentProps.fileName,path:this.getResource(),src:t,title:this.attachmentProps.fileName}),l.get(0).outerHTML},t.prototype.toJSON=function(){return{resId:this.getResId()}},t.prototype.toPlain=function(){return""},t.prototype.toXml=function(e,t){var n=e.createElement("resource-mono"),o=e.createElement("attach"),i=this.getInfo();l.appendText(e,n,"res-id",this.getResId()),l.appendText(e,o,"source",i.source),l.appendText(e,o,"resource",i.resource),l.appendText(e,o,"filename",i.fileName),l.appendText(e,o,"filelength",i.fileLength),n.appendChild(o),t.appendChild(n)},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.attachmentProps=this.resProps,this.attachmentProps.resId=t.resId||i.parseImgSource(t.resource).resId,this.attachmentProps.type=u.TYPE_ATTACHMENT},t}(u)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(62),n(115),n(8),n(152),n(1),n(52),n(90)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.create=function(e){return e&&e.source?(e.resId&&s.warn("Will create resId by url!"),new t(e)):void s.warn("Failed to create ImageResource",e)},t.fromCollabJSON=function(e){return e.resId&&e.source||s.error("jsonObj is wrong , ",e),t.create({height:e.height,resId:e.resId,source:e.source,title:"",type:u.TYPE_IMAGE,width:e.width})},t.fromJSON=function(e,o){e.resId&&o&&o.imageMap||s.error("jsonObj is or resourceList wrong , ",e,o);var r=o.imageMap[e.resId];return r||s.error("resourceList wrong"),r.source&&(e.resId=i.parseImgSource(r.source).resId),t.fromCollabJSON(n.extend(e,r))},t.fromXml=function(e,n){var o=$(n),i=o.children("source:first").text(),r=o.children("width:first").text(),a=o.children("height:first").text();return r&&(r=parseInt(r,10)),a&&(a=parseInt(a,10)),t.create({height:a,resId:e,source:i,title:"",type:u.TYPE_IMAGE,width:r})},t.prototype.getInfo=function(){var e=this.getSize();return null===e.width&&null===e.height&&(e=null),n.extend({source:this.getSource()},e)},t.prototype.getSize=function(){return{height:this.imageProps.height||null,width:this.imageProps.width||null}},t.prototype.getSource=function(e){var t=this.imageProps.source;return e&&e[t]&&(t=e[t]),t},t.prototype.toCollabJSON=function(){var e={};return e.source=this.getSource(),e.width=this.imageProps.width||null,e.height=this.imageProps.height||null,e.resId=this.imageProps.resId,e},t.prototype.toHtml=function(e){var t,i=c("",document,!0,!0),r=i.ownerDocument,l=$(r.createElement("img"));return e=n.defaults(e||{},{resourceMap:null}),t=this.getSource(e.resourceMap)||"",a.IS_PC&&(t=o(t)),l.attr({"data-media-type":"image",height:"auto",src:t,width:"100%"}),l.get(0).outerHTML},t.prototype.toJSON=function(){return{resId:this.getResId()}},t.prototype.toPlain=function(){return""},t.prototype.toXml=function(e,t){var o=e.createElement("resource-mono"),i=e.createElement("image"),r=this.getSize();l.appendText(e,o,"res-id",this.getResId()),l.appendText(e,i,"source",this.getSource()),r&&n.each(["width","height"],function(e){var t=r[e];t&&l.appendText(i,e,t+"")}),o.appendChild(i),t.appendChild(o)},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.imageProps=this.resProps,this.imageProps.resId=t.resId||i.parseImgSource(t.source).resId,this.imageProps.type=u.TYPE_IMAGE},t}(u)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.NONDATACMD_BLOCKSELECTION="nb_BlkSelection",e.NONDATACMD_CLINTPONG="nb_clientPong",e.NONDATACMD_COLLABCLOSE="nb_CollabClose",e.NONDATACMD_COLLABINFO="nb_CollabInfo",e.NONDATACMD_DATACMDFAILED="nb_dataCmdFailed",e.NONDATACMD_GETMODIFIERS="nb_getModifiers",e.NONDATACMD_NOTESAVE="nb_noteSave",e.NONDATACMD_LOCKRELEASE="nb_lockRelease",e.NONDATACMD_SESSIONINITIALIZED="nb_sessionInitialized",e.NONDATACMD_SEVERPING="nb_serverPing",e}();t.CmdNames=n;!function(e){e[e.EXCEPTION=0]="EXCEPTION",e[e.NO_ERROR=1]="NO_ERROR",e[e.TIME_OUT=100]="TIME_OUT",e[e.STOP_CALL=101]="STOP_CALL"}(t.CustomResultCode||(t.CustomResultCode={}));!function(e){e[e.FAILED_RECEIVE_COLLAB_CMD=4001]="FAILED_RECEIVE_COLLAB_CMD",e[e.FAILED_SEND_LOCAL_CMD=4002]="FAILED_SEND_LOCAL_CMD",e[e.MESSAGE_TOO_BIG=4003]="MESSAGE_TOO_BIG",e[e.SESSION_NOT_OPENED=4004]="SESSION_NOT_OPENED",e[e.CLOSED_BY_HOST=4500]="CLOSED_BY_HOST",e[e.COLLAB_SERVER_UNREACHABLE=9e3]="COLLAB_SERVER_UNREACHABLE",e[e.COLLAB_SERVER_SHUTDOWN=9003]="COLLAB_SERVER_SHUTDOWN",e[e.COLLAB_SESSION_CLOSED=9004]="COLLAB_SESSION_CLOSED"}(t.WSCustomCode||(t.WSCustomCode={}));!function(e){e[e.LOCAL_INVALID_STARTRANGE=5001]="LOCAL_INVALID_STARTRANGE",e[e.LOCAL_INVALID_CMDJSON=5002]="LOCAL_INVALID_CMDJSON",e[e.LOCAL_TARGET_BLOCK_LOCKED=5003]="LOCAL_TARGET_BLOCK_LOCKED",e[e.LOCAL_EMPTY_CMD=5004]="LOCAL_EMPTY_CMD",e[e.LOCAL_CMD_TOO_FAST=5005]="LOCAL_CMD_TOO_FAST",e[e.LOCAL_INVALID_FOR_COLLAB=5006]="LOCAL_INVALID_FOR_COLLAB",e[e.LOCAL_BLOCKS_MISSING=5008]="LOCAL_BLOCKS_MISSING",e[e.LOCAL_NOT_READY_APPLY=5009]="LOCAL_NOT_READY_APPLY",e[e.LOCAL_DIRTY_BLOCKS=5010]="LOCAL_DIRTY_BLOCKS",e[e.COLLAB_TARGET_BLOCK_LOCKED=5500]="COLLAB_TARGET_BLOCK_LOCKED",e[e.COLLAB_NOTEVERSION_MISMATCH=5507]="COLLAB_NOTEVERSION_MISMATCH",e[e.COLLAB_BLOCKS_MISSING=5508]="COLLAB_BLOCKS_MISSING",e[e.COLLAB_DIRTY_BLOCKS=5510]="COLLAB_DIRTY_BLOCKS"}(t.DataCmdFailureCode||(t.DataCmdFailureCode={}))}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(1),a=n(78),l=n(64),s=n(3),c=n(89);return t=o.extend({name:"atom.SetTableCellContent",_table:null,_cellRect:null,_oldContent:null,effected:!1,initialize:function(){var e=this,n=e.options.args;s.isCollabCommand(n)||(e._table=e.options.table,e._cellRect=e.options.cellRect,e._content=e.options.content),t.__super__.initialize.apply(e)},_computeSizeChange:function(e){if(e){var t=this,n=t._table,o=n.getCellSize(e.row,e.col),i={rowHeight:0,rowIndex:-1,colWidth:0,colIndex:-1};if(o)return o.height<a.ATTACHMENT_MIN_HEIGHT&&(i.rowHeight=o.heights[0]+a.ATTACHMENT_MIN_HEIGHT-o.height,i.rowIndex=o.rows[0]),o.width<a.ATTACHMENT_MIN_WIDTH&&(i.colWidth=o.widths[0]+a.ATTACHMENT_MIN_WIDTH-o.width,i.colIndex=o.cols[0]),i.rowHeight||i.colWidth?i:null}},apply:function(){var e,t=this,n=t._table,o=t._getCellInfo(t._cellRect)||{},i=t._contentInfo||n.getContentAt(o.row,o.col);return!!i&&(!!n.setCellContent(o.row,o.col,t._content)&&(t._content instanceof l&&(e=t._sizeChanged||t._computeSizeChange(o)),e&&e.rowHeight&&(t._oldSize={rowIndex:e.rowIndex,rowHeight:n.getRowHeight(e.rowIndex)},n.setRowHeight(e.rowIndex,e.rowHeight)),e&&e.colWidth&&(t._oldSize=t._oldSize||{},t._oldSize.colIndex=e.colIndex,t._oldSize.colWidth=n.getColumnWidth(e.colIndex),n.setColumnWidth(e.colIndex,e.colWidth)),t._sizeChanged=e,t._oldContent=i.content,t.effected=!0,t.effected))},doUnapply:function(){var e,t=this,n=t._table,o=t._getCellInfo(t._cellRect),i=t._oldSize;if(o)return e=n.setCellContent(o.row,o.col,t._oldContent),i&&i.rowHeight&&n.setRowHeight(i.rowIndex,i.rowHeight),i&&i.colWidth&&n.setColumnWidth(i.colIndex,i.colWidth),e},_getCellInfo:function(e){var t=this,n=t._table;if(null!=e.row&&null!=e.col)return{row:e.row,col:e.col,cell:n.getCell(e.row,e.col)};r.error("No cellRect!")},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._content=c.contentFromCollabJSON(r.simpleValue1),n._oldContent=c.contentFromCollabJSON(r.simpleValue2),n._sizeChanged=r.sizeChanged,n._oldSize=r.oldSize,n._cellRect=r.newBlkId)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.simpleValue1=c.contentToCollabJSON(e._content),n.simpleValue2=c.contentToCollabJSON(e._oldContent),n.sizeChanged=e._sizeChanged,n.oldSize=e._oldSize,n.newBlkId=e._cellRect,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(7);return{isNoteLinkUrl:function(e){return/^note:\/\/[a-z0-9\-]+$/i.test(e)},getNoteId:function(e){if(e=t.trim(e||"")){var n=/^note:\/\/([a-z0-9\-]+)$/i,o=n.exec(e);if(o&&o[1])return o[1]}},fillAsUrl:function(e){if(e=t.trim(e||"")){var n=this;if(n.isNoteLinkUrl(e)&&(e=n.getNoteId(e)),e)return"note://"+e}}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(16).View.extend({editorEvents:{"yne-editing-state-change":"onEditingStateChange","yne-selection-change":"onSelectionChange"},isVisible:!0,show:function(){this.$el.show(),this.isVisible=!0},hide:function(){this.$el.hide(),this.isVisible=!1},enable:function(){this.$el.removeClass("disabled")},disable:function(){this.$el.addClass("disabled")},onEditingStateChange:function(){},onSelectionChange:function(){}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(7),i=n(22),r=n(49),a=n(35),l=n(10),s=n(41),c=n(2),u=n(6),d=n(1),p=n(12),h=n(30),g=n(146),f=n(68),m=n(20),_=n(28);return r.extend({className:"block-view paragraph-view",_template:p.getTemplate("common","paragraph_view"),_tempPlaceholder:null,_selectToStartTimer:null,initialize:function(){r.prototype.initialize.apply(this,arguments);var e=this,n=e.block;t.bindAll(e,"_onContentChange","_onStyleChange","_onHighlight"),n.on("content-change",e._onContentChange),n.on("style-change",e._onStyleChange),n.on("high-light",e._onHighlight),e._tempPlaceholder=o("<div></div>"),e._tempPlaceholder.height(0),e._tempPlaceholder.width(e.$el.width()),e._tempPlaceholder.css("display","inline-block")},render:function(){var e=this;e._renderTemplate(),e._renderText(),e._renderStyles(),r.prototype.render.apply(e,arguments)},_renderTemplate:function(){var e=this;e.$el.html(e._template())},convertToNativeRange:function(e){if(!e)return void d.warn("block range is unvalid!");var t,n,o=this;return(n=o._getCharacterInfo(e.start))?(t=document.createRange(),t.setStart(n.node,n.offset),(n=o._getCharacterInfo(e.end))?(t.setEnd(n.node,n.offset),t):void d.error("_getCharacterInfo blockRange.end error!")):void d.error("_getCharacterInfo blockRange.start error!")},parseNativeRange:function(e,t,n){var o,i,r,l=this;return clearTimeout(l._selectToStartTimer),n?new a({start:0,end:t.getEndOffset(),block:t}):(r=l.el.querySelector(".place-holder"),r&&" "===r.innerText?(o=i=0,e.collapsed&&(l._selectToStartTimer=setTimeout(function(){e.setStart(e.startContainer,o),e.setEnd(e.endContainer,i)},150))):(o=l._getCharacterIndex(e.startContainer,e.startOffset,!0),-1===(i=l._getCharacterIndex(e.endContainer,e.endOffset,!1))&&(i=t.getEndOffset())),new a({start:o,end:i,block:t}))},_getCharacterInfo:function(e){var t,n=this,i=n.$el.find(".para-text").get(0),r=document.createNodeIterator(i,NodeFilter.SHOW_TEXT),a=r.nextNode(),l=0,s=0;if(0===e||!a)return o(i).children().first().hasClass("page-break-placeholder")&&(s=1),{node:a||i,offset:s};for(;a;){if(t=g(a.nodeValue),t.length>0&&l<e&&l+t.length>=e)return{node:a,offset:t.slice(0,e-l).reduce(function(e,t){return e+t.length},0)};l+=t.length,a=r.nextNode()}},_getTextOfNode:function(e){if(s.isText(e))return e.nodeValue;var t,n=document.createNodeIterator(e,NodeFilter.SHOW_TEXT),o="";if(!n)return"";for(t=n.nextNode();t;)o+=t.nodeValue,t=n.nextNode();return o},_charArrayLengthOfNode:function(e){var t=this,n=t._getTextOfNode(e);return g(n).length},_charArrayOffset:function(e,t){var n,o=g(e);for(n=0;n<o.length&&t>0;n++)t-=o[n].length;return n},_getCharacterIndex:function(e,t,n){var i,r,a=this,l=a.$el.find(".para-text").get(0),c=0;if(!o.contains(l,e)&&e!==l)return n?0:-1;for(s.isText(e)?c+=a._charArrayOffset(e.nodeValue,t):s.isElement(e)&&t>0&&(c+=a._charArrayLengthOfNode(e)),i=e;i!==l;){for(r=i.previousSibling;r;)"page-break"!==r.className&&"page-break-placeholder"!==r.className&&(c+=a._charArrayLengthOfNode(r)),r=r.previousSibling;i=i.parentNode}return c},_createHtmlForBlankLine:function(e){var n,o,i,r=this,a=new l({text:" "}),s=document.createElement("span"),c={},u=function(e,t){["bold","italic","font-family","font-size"].indexOf(t)>-1&&(c[t]=e)};return e?t.each(e,u):t.each(r.block.getInlineStylesForEmpty(),u),a.setStyles(0," ".length,c),n=h.rich2html(a),s.innerHTML=n,o=s.getElementsByTagName("span"),o&&o.length?1===o.length?(i=o[0],i.setAttribute("class","place-holder"),n=i.outerHTML):(d.error("_createHtmlForBlankLine error",s),n='<span class="place-holder">&nbsp;</span>'):(s.setAttribute("class","place-holder"),n=s.outerHTML),n},_renderText:function(e){var n,r,l=this,s=l.block,c=s.getReadOnlyText(),u=l._inlineStyleViewMapper,d=l.$el.find(".para-text");n=c.isEmpty()?this._createHtmlForBlankLine(e):h.rich2html(c,{styleRules:{color:function(e){var t=e.color;return e.href!==m.getDefault("href")&&i.equals(e.color,"blue")?"#003884":null!=t&&u?u.valueToView("color",t):void 0},"font-family":function(e){var t,n=e["font-family"];return null!=n&&u&&(t=u.valueToView("font-family",n)),n!==t?t:_.getAllValueByFont(n)||n}}}),d.html(n),r=s.getStyleRanges("href"),t.each(r,function(e){var t,n,i;t=new a({start:e.from,end:e.to,block:s}),n=l.convertToNativeRange(t),(i=l._findLinkNode(n.endContainer))&&(o(i).off("hover"),o(i).hover(function(){f.isNoteLinkUrl(i.href)||l.isCollabLocked()||l.trigger("link-menu-show",{linkNode:i,range:t,block:s})},function(){l.trigger("link-menu-hide")}))})},_findLinkNode:function(e){for(var t=e;t&&"A"!==t.tagName;)t=t.parentNode;return t},_renderStyles:function(){var e=this,n=e.block,o=n.getBlockStyles();t.each(o,function(t,n){e._setStyle(n,t)}),e._renderStylesFix()},_renderStylesFix:function(){this.$el.find(".para-text").css("fontSize",h.getDefaultForHtml("font-size"))},_setStyle:function(e,t){var n=this.$el,o=n.find(".para-text");switch(e){case"align":o.css("text-align",t);break;case"line-height":t>0?o.css("line-height",String(t)):o.css("line-height","normal");break;case"indent":t=t>0?t:0,n.css("margin-left",t*u.INDENT_WIDTH||"");break;case"text-indent":t=t>0?t:0,o.css("text-indent",t*u.INDENT_WIDTH||"");break;case"back-color":(c.isParagraph(this.block)||c.isHeading(this.block))&&o.css("background-color",t);break;case"padding":(c.isParagraph(this.block)||c.isHeading(this.block))&&o.css("padding",t);break;default:d.warn("unknown block style: "+e)}},_onContentChange:function(e){var n=this,o=!1;t.some(n._pageInfo,function(e){return e&&e.pageBreak&&(o=!0),o}),o&&n.$el.css("height",n.$el.height()),n._renderText(e),n.trigger("view-height-changed",n.cid),o&&n.$el.css("height","auto")},_onStyleChange:function(e,t){var n=this;n._setStyle(e,t),n.trigger("view-height-changed",n.cid)},_convertToData:function(e,n){var o,i=this,r=i.block;t.each(e,function(e){o=new a({block:r,start:e.start,end:e.end}),n(i.convertToNativeRange(o))})},_onHighlight:function(e,t,n){var o=this,i=o.block,r=i.getHighlight(e,t);r&&o._convertToData(r,n)},_findOverflowSpan:function(e,t){var n,o,i,r,a,l=this,s=l._pageInfo[e-1];for(s?(o=s.pageBreak.isAtViewBeginning()?l.$el.find(".para-text").children().first():s.pageBreak.getPlaceholder().next(),r=l._getOffsetTopPos(s.pageBreak.getPlaceholder())+s.pageBreak.getPlaceholder().height()):(o=l.$el.find(".para-text").children().first(),r=l._getOffsetTopPos(l.$el)),o.is("span")||(o=o.find("span").first()),n=o,i=o;n.length>0&&(n.after(l._tempPlaceholder),a=l._getOffsetTopPos(l._tempPlaceholder)-r-t,n.outerHeight(!0)>0&&(i=n),!(a>0));)n=l._tempPlaceholder.next();return l._tempPlaceholder.remove(),{textSpan:i,overflowHeight:a,isFirstSpan:o===i}},_getContentContainer:function(){return this.$el.find(".para-text")},_handlePageOverflow:function(e,t){var n,o=this,i=o._getHeightInPage(e);return!((n=o.PAGE_HEIGHT-t)>i)&&(o._insertPageBreak(e,n),!0)},_insertPageBreak:function(e,t){var n,o,i,r,a,l,s=this;s.block.isEmpty()||t<=0||s._forcePageBreakBegin?n=s._insertPageBreakAtViewBeginning(e,0):(o=s._findOverflowSpan(e,t),o.overflowHeight<=0?(n=s._createPageBreak(e,Math.abs(o.overflowHeight)),0===o.textSpan.height()?o.textSpan.before(n.getPlaceholder()):o.textSpan.after(n.getPlaceholder())):s._isSplitAvailable(o.textSpan,o.overflowHeight)?(r=o.textSpan.height()-o.overflowHeight,i=s._splitTextSpan(o.textSpan,r),n=s._createPageBreak(e,r-i[0].height()),i[0].after(n.getPlaceholder())):o.isFirstSpan?n=s._insertPageBreakAtViewBeginning(e,t):(a=s._pageInfo[e-1],l=a&&a.pageBreak?t-(s._getOffsetTopPos(o.textSpan)-s._getOffsetTopPos(a.pageBreak.getPlaceholder())-a.pageBreak.getPlaceholder().height()):t-(s._getOffsetTopPos(o.textSpan)-s._getOffsetTopPos(s.$el)),l<0&&(l=0),n=s._createPageBreak(e,l),o.textSpan.before(n.getPlaceholder()))),s._coincidePageBreak(n),s._pageInfo[e].pageBreak=n},_insertPageBreakAtViewBeginning:function(e,t){var n,o=this;return n=o._createPageBreak(e,t),n.setAtViewBeginning(!0),o.$el.prepend(n.getPlaceholder()),n},_isSplitAvailable:function(e,t){var n,o,i;if(0===e.length||""===e.text())return!1;for(o=e.height()-t,n=document.createRange(),i=e[0].firstChild;null!=i&&("#text"!==i.nodeName.toLowerCase()||0===i.textContent.length);)i=i.nextSibling;return null!=i&&(n.setStart(i,0),n.setEnd(i,1),!(n.getBoundingClientRect().height>o)&&(n.setEnd(i,i.textContent.length),!(n.getBoundingClientRect().height<o)))},_splitTextSpan:function(e,t){var n,o,i,r=e[0].firstChild,a=0,l=e.text().length,s=[];for(n=document.createRange(),n.setStart(r,0);l-a>1&&(i=Math.ceil((l+a)/2),n.setEnd(r,i),(o=n.getBoundingClientRect().height)!==t);)o>t?l=i:a=i;if(o<=t){for(;i<e.text().length&&o<=t;)i++,n.setEnd(r,i),o=n.getBoundingClientRect().height;i-=1}else for(;i>0&&o>t;)i--,n.setEnd(r,i),o=n.getBoundingClientRect().height;return s[0]=e.clone(),s[1]=e.clone(),s[0].text(e.text().substr(0,i)),s[1].text(e.text().substr(i)),e.before(s[0]),e.before(s[1]),e.remove(),s}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(1),n(2),n(222)],void 0!==(i=function(e,t,n,o,i,r){"use strict";return function(){function e(){}return e.getAllStyleNames=function(){return e.ALL_KEYS||(e.ALL_KEYS=[],n.each(r,function(t){var o=n.keys(t);n.each(o,function(t){-1===e.ALL_KEYS.indexOf(t)&&e.ALL_KEYS.push(t)})})),[].concat(e.ALL_KEYS)},e.getConfig=function(e,t,n){return(this.getConfigsOfBlock(t,n)||{})[e]},e.getConfigsOfBlock=function(t,i){if(!t)return void o.error("parameter is not valid",t);var a=r[t],l={};return i=!1!==i,n.each(a,function(o,r){var a=n.clone(o);i&&e.overrideDefaults[t]&&null!=e.overrideDefaults[t][r]&&(a.default=e.overrideDefaults[t][r]),l[r]=a}),l},e.getDefault=function(e,t,n){if(!e||!t)return void o.error("parameter is not valid",e,t);var i=this.getConfigsOfBlock(t,n)||{},r=i[e];return r&&null!=r.default?r.default:void 0},e.getDefaultsOfBlock=function(e,t){var o=this.getConfigsOfBlock(e,t),i={};return n.each(o,function(e,t){i[t]=e.default}),i},e.getStyleNamesOfBlock=function(t){var o=e.getConfigsOfBlock(t);return o?n.keys(o):[]},e.isSupport=function(t,n){var o=e.getConfigsOfBlock(n)||{},i=o[t];return i&&null!=i.type},e.reset=function(){e.overrideDefaults={}},e.setDefault=function(t,r,a){t&&null!=r||o.error("parameter is not valid",t,r);var l=[];a?l.push(a):l=i.getAllBlockTypes(),n.each(l,function(n){e.overrideDefaults[n]||(e.overrideDefaults[n]={}),e.overrideDefaults[n][t]=r})},e.overrideDefaults={},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(40),n(29),n(111),n(2),n(19),n(30),n(10)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.createBlank=function(){return new t({})},t.fromCollabJSON=function(e){return this.generalFromJSON(e,!0)},t.fromJSON=function(e){return this.generalFromJSON(e,!1)},t.fromXml=function(e){var n=new t({});return n.parseIdFromXml(e),n.setText(u.fromXml(e)),t.fromXmlHelp(n,$(e)),$(e).children().each(function(e,t){switch(t.nodeName){case s.TAG_ID_NAME:case s.LEGACY_TAG_ID_NAME:case"text":case"inline-styles":break;case"styles":o.fromXml(n,t);break;default:i.appendToTree(n.unknownTree,t)}}),n},t.generalFromJSON=function(t,n){var o=e.generalFromJSON.call(this,t,n);return o&&t.level&&o.setLevel(t.level),o},t.toXmlHelp=function(e,t){var n=e.getLevel();n&&$(t).attr("level",n),$(t).attr("compat","true")},t.fromXmlHelp=function(e,t){var n=parseInt($(t).attr("level"),10);e.setLevel(n)},t.prototype.getBlockStyle=function(t,n){return"heading"===t?this.level:e.prototype.getBlockStyle.call(this,t,n)},t.prototype.getDefaultBlockStyles=function(){return n.extend({},e.prototype.getDefaultBlockStyles.apply(this,[]),a.headingBlockStyles[this.level])},t.prototype.getDefaultInlineStyles=function(){return n.extend({},e.prototype.getDefaultInlineStyles.call(this),a.headingInlineStyles[this.level])},t.prototype.getInlineStylesForEmpty=function(){return n.extend({heading:this.level},this.getDefaultInlineStyles())},t.prototype.getLevel=function(){return this.level},t.prototype.setLevel=function(e){e&&(this.level=e,this.trigger("content-change",this))},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.richText=this.richText.toCollabJSON(),t.level=this.getLevel(),t},t.prototype.toHtml=function(e,t,n){var o,i,r,a=document.createElement("div"),l=$(a);return n=!0===n,l.attr("yne-bulb-block","heading").attr("yne-bulb-level",this.getLevel()).attr("id",this.getId()).css("white-space","pre-wrap"),this.applyBlockStylesOnElement(l),e=e||0,t=null==t?this.getEndOffset():t,o=this.sliceText(e,t,!1),i=c.rich2html(o,{withDefault:n}),l.html(i),r=a.outerHTML,a=l=null,r},t.prototype.toJSON=function(t,n){var o=this.sliceText(t,n,!1),i=e.prototype.toJSON.call(this,t,n);return i.richText=o.toJSON(),i.level=this.getLevel(),i},t.prototype.toXml=function(n){var o=e.prototype.toXml.apply(this,[n]);return t.toXmlHelp(this,o),o},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=l.HEADING,this.setLevel(t.level)},t}(s)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(40),n(29),n(1),n(25),n(2)],void 0!==(i=function(e,t,n,o,i,a,l,s){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromCollabJSON=function(e){var t=this.fromJSON(e);return e.blockId&&t.setId(e.blockId),t},t.fromJSON=function(e){if(!e||e.type!==s.HR)return void a.error("invalid jsonObj");var o=new t({});return n.each(e.styles,function(e,t){o.setBlockStyle(t,e)}),o},t.fromXml=function(e){var n=new t({}),r=$(e);return n.parseIdFromXml(e),r.children().each(function(e,t){switch(t.nodeName){case l.TAG_ID_NAME:case l.LEGACY_TAG_ID_NAME:break;case"styles":o.fromXml(n,t);break;default:i.appendToTree(n.unknownTree,t)}}),n},t.prototype.countWords=function(){return 0},t.prototype.toCollabJSON=function(){return this.toJSON()},t.prototype.toHtml=function(){var e=document.createElement("div"),t=document.createElement("div"),o=$(e),i=this.getBlockStyles();return o.attr("yne-bulb-block","hr"),n.each(i,function(e,t){switch(t){case"back-color":o.css("background-color",e);break;case"padding":o.css("padding",e);break;default:o.attr("yne-style-"+t,e)}}),n.each(i,function(e,t){o.attr("yne-style-"+t,e)}),$(t).css({width:"100%",height:"1px","background-color":"rgb(200, 200, 200)"}),o.append(t),o.css("clear","both"),e.outerHTML},t.prototype.toJSON=function(){return e.prototype.toJSON.call(this)},t.prototype.toPlain=function(){return new Array(81).join("-")},t.prototype.toXml=function(t){var n=e.prototype.toXml.apply(this,[t]),r=t.createElement("styles");return o.toXml(this,r,t),n.appendChild(r),i.appendToXml(this.unknownTree,n),n},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=s.HR},t}(l)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(62),n(8),n(1),n(52),n(25),n(40),n(2),n(29)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromJSON=function(e){if(!(e&&e.type&&e.type===u.ATTACHMENT&&e.source&&e.resource))return void a.warn("jsonObj or jsonObj.source/resource does NOT exist!");var n=new t({fakeLoading:!!e.fakeLoading,fileLength:e.fileLength,fileName:e.fileName,resource:e.resource,source:e.source});return e.styles&&n.setStyles(e.styles),e.blockId&&n.setId(e.blockId),n},t.fromXml=function(e){var n,o,i=$(e),r=$.trim(i.find("source").text()),a=$.trim(i.find("resource").text()),l=$.trim(i.find("filename").text())||"无文件名",u=$.trim(i.find("filelength").text());return o=parseInt(u,10),isNaN(o)&&(o=0),n=new t({fakeLoading:!1,fileLength:o,fileName:l,resource:a,source:r}),n.parseIdFromXml(e),i.children().each(function(e,t){switch(t.nodeName){case s.TAG_ID_NAME:case s.LEGACY_TAG_ID_NAME:case"source":case"resource":case"filename":case"filelength":break;case"styles":c.fromXml(n,t);break;default:d.appendToTree(n.unknownTree,t)}}),n},t.prototype.countWords=function(){return 0},t.prototype.getFakeLoading=function(){return this.attachmentProps.fakeLoading},t.prototype.getFileLength=function(){return this.attachmentProps.fileLength},t.prototype.getFileName=function(){return this.attachmentProps.fileName},t.prototype.getResource=function(e){var t,n=this.attachmentProps.resource;return!0===e&&(t=this.getExtraInfo("pcResMap"))&&t[n]&&(n=t[n]),n},t.prototype.getSource=function(e){var t,n=this.attachmentProps.source;return!0===e&&(t=this.getExtraInfo("pcResMap"))&&t[n]&&(n=t[n]),n},t.prototype.getStyles=function(e){return e?this.getBlockStyle(e,!1):this.getBlockStyles()},t.prototype.setFakeLoading=function(e){this.attachmentProps.fakeLoading=e},t.prototype.setFileLength=function(e){var t=parseInt(e,10);return!isNaN(t)&&t!==this.attachmentProps.fileLength&&(this.attachmentProps.fileLength=t,this.trigger("content-change"),!0)},t.prototype.setFileName=function(e){return!(!(e=String(e||""))||e===this.attachmentProps.fileName)&&(this.attachmentProps.fileName=e,this.trigger("content-change"),!0)},t.prototype.setResource=function(e){return!(!(e=(e||"")+"")||e===this.attachmentProps.resource)&&(this.attachmentProps.resource=e,this.trigger("content-change"),!0)},t.prototype.setSource=function(e){return!(!(e=(e||"")+"")||e===this.attachmentProps.source)&&(this.attachmentProps.source=e,this.trigger("content-change"),!0)},t.prototype.setStyles=function(e,t){var o=this;return n.isString(e)?this.setBlockStyle(e,t):n.isObject(e)&&n.each(e,function(e,t){o.setBlockStyle(t,e)}),!0},t.prototype.toHtml=function(e,t,r){var a,s,c=this,u=c.getStyles(null),d=l("",document,!0,!0),p=d.ownerDocument,h=p.createElement("div"),g=$(h),f=$(p.createElement("img"));return g.attr("yne-bulb-block","attachment"),n.each(u,function(e,t){switch(t){case"align":g.css("text-align",e);break;case"float":g.css("float",e);break;case"back-color":g.css("background-color",e);break;case"padding":g.css("padding",e)}}),s=c.getSource(!0===r),i.IS_PC&&(s=o(s)),f.attr({alt:this.attachmentProps.fileName,"data-media-type":"attachment",filelength:this.attachmentProps.fileLength,filename:this.attachmentProps.fileName,path:this.getResource(!1),src:s,title:this.attachmentProps.fileName}),g.append(f),a=h.outerHTML,h=g=f=null,a},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.source=this.getSource(!1),t.resource=this.getResource(!1),t.fileName=this.getFileName(),t.fileLength=this.getFileLength(),t},t.prototype.toPlain=function(){return""},t.prototype.toXml=function(t){var o,i,r=this,a=r.getSource(!1),l=["Source","Resource","FileName","FileLength"];if(a)return o=e.prototype.toXml.apply(r,[t]),n.each(l,function(e){var n=t.createElement(e.toLowerCase()),i=r["get"+e](),a=t.createTextNode(i);n.appendChild(a),o.appendChild(n)}),i=t.createElement("styles"),c.toXml(r,i,t),o.appendChild(i),d.appendToXml(r.unknownTree,o),o},t.prototype.initialize=function(t){var o=this;if(null==t||null==t.source||null==t.resource||null==t.fileLength||null==t.fileName)throw new Error("props or prop(source, resource, fileName, fileLength) in props cannot be null");e.prototype.initialize.call(this,t),o.attachmentProps=n.clone(t),o.attachmentProps.fakeLoading=!!t.fakeLoading,o.type=u.ATTACHMENT},t}(s)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(6),n(30),n(10),n(17),n(1)],void 0!==(i=function(e,t,n,o,i,a,l,s){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.create=function(e){return e&&e.richText?new t(e):void s.warn("Failed to create Lines",e)},t.createBlank=function(e){return e?t.create({richText:a.createBlank(!1)}):new t({})},t.fromCollabJSON=function(e){var o=t.createBlank();return n.map(e,function(e){o.appendRichText(a.fromCollabJSON(e))}),o},t.fromJSON=function(e){var o=t.createBlank();return n.map(e,function(e){o.appendRichText(a.fromJSON(e))}),o},t.splitRichText=function(e){if(e){if(0===e.getLength()||!e.isKeepLineBreak())return[e];var t,o=e.getReadOnlyData(),i=[],r=[],l=0;for(l=0;l<o.length;l++)t=o[l],t.isLineBreak()?(i.push(r),r=[]):r.push(t);return r.length&&i.push(r),i=n.map(i,function(e){var t=a.create("",!1);return t.appendRichChars(e),t})}},t.prototype.appendLines=function(e){e&&(this.richTextList=this.richTextList.concat(e.getAsRichTextList()))},t.prototype.appendRichText=function(e){var n=t.splitRichText(e);n&&n.length&&(this.richTextList=this.richTextList.concat(n))},t.prototype.getAsRichTextList=function(){return[].concat(this.richTextList)},t.prototype.getCommonStyles=function(e,t,n){var o=this.toRichText();return e=e||0,t=t||o.getLength(),o.getCommonStyles(e,t,n)},t.prototype.getCommonStyle=function(e){var t;return n.some(this.richTextList,function(n){if(n&&!n.isEmpty()){var i=n.getCommonStyle(0,n.getLength(),e,!0);if(null==t)null!=i&&(t=i);else if(t!==i)return t=o.INTERM,!0}}),t===o.INTERM&&(t=null),t},t.prototype.getCount=function(){return this.richTextList.length},t.prototype.getStyle=function(e){var t=[];return n.each(this.richTextList,function(n){var o=n.getStyle(0,n.getLength(),e);t.push(o)}),t},t.prototype.isEmpty=function(){var e=this.richTextList;return!e||!e.length||n.every(e,function(e){return e&&e.isEmpty()})},t.prototype.setStyle=function(e,t){var o;n.isArray(t)?(o=t,n.each(this.richTextList,function(t,n){var i=o[n];t.setStyle(0,t.getLength(),e,i)})):n.each(this.richTextList,function(n){n.setStyle(0,n.getLength(),e,t)})},t.prototype.toCollabJSON=function(){return n.map(this.richTextList,function(e){return e.toCollabJSON()})},t.prototype.toJSON=function(){return n.map(this.richTextList,function(e){return e.toJSON()})},t.prototype.toHtml=function(e){e=n.defaults(e||{},{handleLineWrapper:function(e){e.className="table-cell-line"}});var t=e.styleRules,o=n.map(this.richTextList,function(n,o){var r=i.rich2html(n,{styleRules:t}),a=document.createElement("div");return e.handleLineWrapper(a,n,o),a.innerHTML=r,a.outerHTML});return o=o.join("")},t.prototype.toPlain=function(){return n.map(this.richTextList,function(e){return e?e.toString():""})},t.prototype.toRichText=function(){var e,t=this.getCount(),n=this.richTextList,o=a.create("",!0);for(e=0;e<t;e++)o.append(n[e]),e<t-1&&o.append(a.create("\n",!0));return o},t.prototype.toString=function(){return this.toRichText().toString()},t.prototype.initialize=function(e){e=n.defaults(e||{},{richText:null}),this.richTextList=[],this.appendRichText(e.richText)},t}(l)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(1),n(77)],void 0!==(i=function(e,t,n,o,i){"use strict";return function(){function e(){}return e.cellsFromCollabJSON=function(e){return e?n.map(e,function(e){return n.map(e,function(e){return i.fromCollabJSON(e)})}):null},e.cellsFromJSON=function(e){var t,n,r,a=e.cellsJson,l=e.height,s=e.width,c=e.isUpdateCellId,u=e.resourceList,d=[];if(!a)return null;for(t=0;t<l;t++)for(d[t]=[],n=0;n<s;n++)r=t*s+n,a[r]||o.error("Bag json data, no cellData json, row, col: ",a,t,n),d[t][n]=i.fromJSON(a[r],c,u);return d},e.cellsToCollabJSON=function(e){return e?n.map(e,function(e){return n.map(e,function(e){return e.toCollabJSON?e.toCollabJSON():e})}):null},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(38),n(3),n(2),n(116),n(10),n(75),n(45),n(17),n(1),n(64),n(65),n(90),n(91),n(53),n(89)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h,g,f,m,_,y){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.blockToCell=function(e){var n,o=t.blockToCellContent(e);return o&&(n=t.create({content:o})),n},t.blockToCellContent=function(e){if(e){var t,i,r,d,f,m,_=a.getType(e);switch(_){case a.PARAGRAPH:case a.CATALOGUE:case a.HEADING:i=c.create({richText:e.getText()});break;case a.IMAGE:case a.HANDWRITE:i=g.create({source:e.getSource()});break;case a.ATTACHMENT:i=h.create({fileLength:e.getFileLength(),fileName:e.getFileName(),resource:e.getResource(),source:e.getSource()});break;case a.LIST_ITEM:t=e.getText(),t.getLength()&&(m={},n.each(t.getStylesAtIndex(0),function(e,t){l.isSupportedStyle(t)&&(m[t]=e)})),d=l.makePlainMarker(e,!1),d=s.create(d,!1),m&&d.setStyles(0,d.getLength(),m),d.append(s.create(" ",!1)),r=e.getLevel()||1,f=o.repeat(" ",4*(r-1)),f=s.create(f,!1),f.append(d),f.append(t),i=c.create({richText:f});break;case a.TODO:f=u.getMarker(e),f=s.create(f,!1),t=e.getText(),e.getChecked()&&t.setStyles(0,t.getLength(),{strike:!0}),f.append(t),i=c.create({richText:f});break;default:p.warn("Failed to handle block to cell",_,e)}return i}},t.create=function(e){if(!e||!e.content)return void p.warn("Failed to create TableCell",e);var n=e.content;return n instanceof c||n instanceof f?new t(e):void p.warn("Failed to create TableCell",e)},t.createByTable=function(e,n,o,i){var r=e.getId(),a=t.makeCellId(r,n,o);return t.create({cellId:a,content:i})},t.fromCollabJSON=function(e){var n={cellId:e.cellId,content:y.contentFromCollabJSON(e.content),styles:e.styles};return e.attr&&(n.mergeWidth=e.attr.width,n.mergeHeight=e.attr.height,n.mergePointDX=e.attr.dx,n.mergePointDY=e.attr.dy),t.create(n)},t.fromJSON=function(e,o,i){e||p.error("Bad json data!");var r={};return r.styles=n.pick(e,m.getAllStyleNames()),n.extend(r,n.pick(e,t.ATTRIBUTE_NAMES),{cellId:e.cellId,content:y.contentFromJSON(e.content,!1,i)||c.createBlank()}),o&&delete r.cellId,t.create(r)},t.fromXml=function(e){if(!e||!e.tableBlockId||null==e.rowIndex||null==e.colIndex)return void p.warn("Failed to create TableCell from JSON",e);var o,i=t.makeCellId(e.tableBlockId,e.rowIndex,e.colIndex),r={cellId:i},a=e.cellRawData,l=e.resourceMap,s=t._resourceFromJSON(a,l),u=t.ATTRIBUTE_NAMES,d=m.getAllStyleNames(),h=["value","resource","inlineStyles"].concat(u,d);return s?r.content=s:(o=t._linesFromJSON(a),r.content=o||c.createBlank()),a=a||{},r.unknown=n.omit(a,h.concat(n.keys(y.oldStyleNameMap))),r.styles=n.pick(a,d),n.extend(r,n.pick(a,u)),t.create(r)},t.makeCellId=function(e,t,n){return[e,"cell",t,n].join("-")},t._linesFromJSON=function(e){var n=t._richTextFromJSON(e);return n?c.create({richText:n}):c.createBlank()},t._resourceFromJSON=function(e,t){if(e&&e.resource){var n=e.resource,o=t[n];return o&&o.getResId&&o.getResId()===n?o:void 0}},t._richTextFromJSON=function(e){if(e&&e.value){var t=e.value,o=new s({text:t}),i=y.oldStyleNameMap,r=o.getLength();return n.each(i,function(t,i){var a=t,l=e[i];null!=l&&("font-size"===a&&n.isString(l)&&(l=l.replace("px","")),o.setStyle(0,r,a,l))}),e.inlineStyles&&n.each(e.inlineStyles,function(e,t){n.each(e,function(e){o.setStyle(e.from,e.to,t,e.value)})}),o}},t.prototype.clearMergedCellAttr=function(){delete this.mergePointDX,delete this.mergePointDY},t.prototype.clearMergePointAttr=function(){delete this.mergeWidth,delete this.mergeHeight},t.prototype.clearStyles=function(){this.styles={}},t.prototype.clearStylesForEmpty=function(){this.stylesForEmpty={}},t.prototype.getBlockStyles=function(){return this.styles},t.prototype.getBlockStylesAsBulb=function(){var e=n.clone(this.styles);return m.tableStyles2BulbStyles(e)},t.prototype.getCellId=function(){return this.cellId},t.prototype.getCommonInlineStyle=function(e){var t=this.getContent();return this.isTextNoEmptyCell()&&t.getCommonStyle?t.getCommonStyle(e):this.stylesForEmpty[e]},t.prototype.getCommonInlineStyles=function(){var e=this.getContent();return this.isTextNoEmptyCell()&&e.getCommonStyles?e.getCommonStyles():this.stylesForEmpty},t.prototype.getContent=function(){return this.content},t.prototype.getInlineStyles=function(e){if(this.isTextNoEmptyCell()){var t=this.getContent(),n={};return e.forEach(function(e){n[e]=t.getStyle(e)}),n}},t.prototype.getMergedCellAttr=function(){return{dx:this.mergePointDX||0,dy:this.mergePointDY||0}},t.prototype.getMergePointAttr=function(){var e=this.mergeWidth||0;return{height:this.mergeHeight||0,width:e}},t.prototype.getStylesForEmpty=function(e){var t,o=this;return e?(t={},n.each(e,function(e){t[e]=o.stylesForEmpty[e]}),t):o.stylesForEmpty},t.prototype.getType=function(){var e=_.TEXT,t=this.getContent();if(t&&t.getType)switch(t.getType()){case f.TYPE_IMAGE:e=_.IMAGE;break;case f.TYPE_ATTACHMENT:e=_.ATTACHMENT}return e},t.prototype.isAttachmentCell=function(){return this.getType()===_.ATTACHMENT},t.prototype.isEmpty=function(){var e=this.getType(),t=this.content;return e===_.TEXT&&(!t||t.isEmpty())},t.prototype.isImageCell=function(){return this.getType()===_.IMAGE},t.prototype.isLocked=function(){return this.locked},t.prototype.isMergedCell=function(){var e=this.getMergedCellAttr();return e.dx>=1||e.dy>=1},t.prototype.isMergePoint=function(){var e=this.getMergePointAttr();return e.width>1||e.height>1},t.prototype.isTextNoEmptyCell=function(){var e=this.getContent();return!!e&&(this.getType()===t.TYPE_TEXT&&!e.isEmpty())},t.prototype.setBlockStyle=function(e,t){var o=m.getConfig(e);o&&(this.isLocked()||("Enum"===o.type?o.possible[t]||(t=o.default):"Number"!==o.type||n.isNumber(t)?"Boolean"!==o.type||n.isBoolean(t)?n["is"+o.type]&&(n["is"+o.type](t)||(t=t.default)):t="true"===t:(t=null===t||""===t?NaN:Number(t),!isNaN(t)&&t||(t=o.default)),t=t||o.default,this.styles[e]=t,p.log("style-change "+e+": "+t)))},t.prototype.setBlockStyles=function(e){var t=this;if(!t.isLocked())return e?(n.each(e,function(e,n){t.setBlockStyle(n,e)}),!0):void 0},t.prototype.setInlineStyles=function(e){if(e&&this.isTextNoEmptyCell()){var t=this.getContent();n.each(e,function(e,n){t.setStyle(n,e)})}},t.prototype.setContent=function(e){var t=!1;if(!this.isLocked())return e instanceof c?(this.content=e,t=!0,this.isTextNoEmptyCell()&&this.clearStylesForEmpty()):e instanceof f&&(this.content=e,t=!0),t},t.prototype.setLocked=function(e){this.locked=!0===e},t.prototype.setMergedCellAttr=function(e,t){if(null!=e&&null!=t&&e>=0&&t>=0&&(e>0||t>0))return this.mergePointDX=e,this.mergePointDY=t,this.clearMergePointAttr(),!0},t.prototype.setMergePointAttr=function(e,t){return!(!e&&!t)&&(e>=1&&!t&&(p.warn("No valid mergeHeight, will set 1"),t=1),t>=1&&!e&&(p.warn("No valid mergeWidth, will set 1"),e=1),this.mergeWidth=e,this.mergeHeight=t,this.clearMergedCellAttr(),!0)},t.prototype.setStylesForEmpty=function(e){p.log("setStylesForEmpty",e),n.extend(this.stylesForEmpty,e)},t.prototype.setUnknown=function(e){e&&(this.unknown=e)},t.prototype.toCollabJSON=function(){var e,t=this,o={};return t.isMergedCell()&&(o=n.extend(o,t.getMergedCellAttr())),t.isMergePoint()&&(o=n.extend(o,t.getMergePointAttr())),e={cellId:t.getCellId(),content:y.contentToCollabJSON(t.content),styles:n.extend({},t.styles)},n.isEmpty(o)||(e.attr=o),e},t.prototype.toHtml=function(){p.error("Should not call TabelCell.toHtml()")},t.prototype.toJSON=function(e){var t,o=this,i={},r={};return o.isMergedCell()&&(i=n.extend(i,o.getMergedCellAttr()),n.extend(r,{mergePointDX:i.dx,mergePointDY:i.dy})),o.isMergePoint()&&(i=n.extend(i,o.getMergePointAttr()),n.extend(r,{mergeHeight:i.height,mergeWidth:i.width})),o.isTextNoEmptyCell()&&(r.value=o.content.toString(),e&&(t=o.content.getCommonStyles(null,null,!0),n.extend(r,y.inlineStyle2oldCell(t)))),e?n.extend(r,y.blockStyle2oldCell(o.styles)):n.extend(r,{cellId:o.getCellId(),content:y.contentToJSON(o.content)},y.blockStyle2oldCell(o.styles)),r},t.prototype.toPlain=function(e){return this.isMergedCell()?"":y.contentToPlain(this.content,e)},t.prototype.toXml=function(e,t,o){var i,r,a,l,s,c,u=this,d={};if(u.isMergedCell())return i=u.getMergedCellAttr(),{mergePointDX:i.dx,mergePointDY:i.dy,value:""};switch(u.isMergePoint()&&(i=u.getMergePointAttr(),d={mergeHeight:i.height,mergeWidth:i.width}),r=u.getType(),a=u.getContent(),n.isEmpty(u.styles)||n.extend(d,u.styles),n.isEmpty(u.unknown)||n.extend(d,u.unknown),r){case _.TEXT:l=a.toRichText(),s=l.toJSON(!0),d.value=s.text,s.inlineStyles&&(d.inlineStyles=s.inlineStyles);break;case _.IMAGE:case _.ATTACHMENT:c=a.getResId(),d.value="",d.resource=c,c&&!0===o[c]?p.warn("resource has already in <resource-list>",c,a):(a.toXml(e,t),o[c]=!0);break;default:p.error("unvalid type",r)}return d},t.prototype.initialize=function(e){e=e||{},this.styles={},this.cellId=e.cellId||i.newGUID(),this.setContent(e.content),this.setBlockStyles(e.styles),this.setMergePointAttr(e.mergeWidth,e.mergeHeight),this.setMergedCellAttr(e.mergePointDX,e.mergePointDY),this.setUnknown(e.unknown),this.stylesForEmpty={}},t.TYPE_TEXT="text",t.ATTRIBUTE_NAMES=["mergeWidth","mergeHeight","mergePointDX","mergePointDY"],t}(d)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(58)],void 0!==(i=function(e,t,n){"use strict";return n({DEFAULT_ROW_HEIGHT:40,DEFAULT_COL_WIDTH:70,MIN_ROW_COUNT:1,MIN_COL_COUNT:1,MAX_ROW_COUNT:500,MAX_COL_COUNT:35,ATTACHMENT_MIN_WIDTH:285,ATTACHMENT_MIN_HEIGHT:64,DEFAULT_TABLE_WIDTH:620},!0)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(1);return{_getHref:function(e,t){var n;if(!(t<0||t>=e.getLength()))return n=e.getTextStylesAtIndex(t)||{},n.href},_hasHref:function(e,t,n){var o=this,i=o._getHref(e,t);return n?i===n:i&&i.length>0},isAtHrefBorder:function(e,t,n){var o=this,i=n?t-1:t,r=o._getHref(e,i),a=o._getHref(e,n?i+1:i-1);return r&&r.length>0&&r!==a},findHrefBorder:function(e,n,o){if(!e||!e.getText)return t.error("param is not valid!"),-1;var i,r,a,l=this,s=-1,c=e.getText(),u=c.getLength();if(n>u)return-1;if(o){if(i=n-1,!(a=l._getHref(e,i)))return-1;for(r=i-1;r>=-1;r--)if(!l._hasHref(e,r,a)){s=r+1;break}}else{if(i=n,!(a=l._getHref(e,i)))return-1;for(r=i+1;r<=u;r++)if(!l._hasHref(e,r,a)){s=r-1;break}}return s},completeUrl:function(e){var t=/\:\/\//;return!e||t.exec(e)?e:"http://"+e}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(2),a=n(11),l=n(1),s=n(23),c=n(47),u=n(3);return t=o.extend({name:"abstract.comp.InsertResource",_cmdArgs:null,_note:null,_newStartBlkId:null,_newEndBlkId:null,_resourceBlock:null,_retainStartBlock:null,insertResource:function(e,t,n){throw l.error("Method not implemented with:",e,t,n),"Method not implemented"},initialize:function(){var e,n=this;n._note=n.options.note,e=n._cmdArgs=n.options.args||{},t.__super__.initialize.apply(n,arguments),u.isCollabCommand(e)||(n._newStartBlkId=u.newGUID(),n._newEndBlkId=u.newGUID(),1===e.retainStartBlock||"1"===e.retainStartBlock||!0===e.retainStartBlock?n._retainStartBlock=!0:n._retainStartBlock=!1)},apply:function(){var e=this,t=e._cmdArgs.range,n=t.getStartBlockRange(),o=n.block;return t?(t.isCollapsed()||t.isSingleTableSelected()||a.deleteSelectedContent(e,e._note,t),t.isInMultiBlock()?e._handleMultiBlockSelection(t):r.isTable(o)?e._handleSingleTableSelection(t,o):e._handleSingleBlockSelection(t)):(l.error(this.name+":note range should NOT be null"),!1)},_deleteBlocks:function(e){var t=this;t.executeAtomicCommand(new s({note:t._note,blocks:e}))},_deleteBlockText:function(e,t,n){var o=this,i="";return t<n&&(i=e.sliceText(t,n),o.executeAtomicCommand(new c({block:e,start:t,end:n}))),i},_handleMultiBlockSelection:function(e){var t,n,o,i,l,s,c,u,d,p=this,h=[],g=[];return t=e.getStartBlockRange(),n=t.block,l=e.getEndBlockRange(),s=l.block,r.isListItem(n)?(d=p._note.getNextBlock(s),l.start!==s.getLength()?(u=s.getText?s.getText():"",c=a.createNewListItem(n,s.getId(),u),g.push(c.getId())):r.isTextBlock(d)||(c=a.createNewParagraph(s,s.getId(),"")),p._deleteBlocks([s]),p._resourceBlock=p.insertResource(n,null,c),g.push(s.getId(),p._resourceBlock.getId()),c||(c=d)):r.isTextBlock(n)?r.isListItem(s)||!r.isTextBlock(s)?(u=s.getText?s.getText():"",c=a.createNewParagraph(s,s.getId(),u),p._deleteBlocks([s]),p._resourceBlock=p.insertResource(n,null,c),g.push(s.getId(),p._resourceBlock.getId())):(c=s,p._resourceBlock=p.insertResource(n),g.push(p._resourceBlock.getId())):(i=p._note.getPreBlock(n),r.isTextBlock(i)||(o=a.createNewParagraph(i,p._newStartBlkId,""),g.push(p._newStartBlkId)),h.push(n),g.push(n.getId()),r.isTextBlock(s)||(h.push(s),c=a.createNewParagraph(s,s.getId(),""),g.push(s.getId())),p._deleteBlocks(h),p._resourceBlock=p.insertResource(i,o,c),g.push(p._resourceBlock.getId()),c||(c=s)),a.setTextBlockAsEndingRange(p,c,0,0),p.pushAffectedBlockIds(g),!0},_handleSingleBlockSelection:function(e){var t,n,o,i,l,s,c,u=this,d=[];return t=e.getStartBlockRange(),n=t.block,l=e.getEndBlockRange(),l.block,!r.isTextBlock(n)||n.isEmpty()?(i=u._note.getPreBlock(n),s=u._note.getNextBlock(n),s&&r.isTextBlock(s)||(c=a.createNewParagraph(n,u._newEndBlkId,""),d.push(u._newEndBlkId)),u._retainStartBlock&&(r.isTable(n)||r.isAttachment(n)||r.isImage(n))||r.isCatalogue(n)?(i=n,o=a.createNewParagraph(n,u._newStartBlkId,""),d.push(u._newStartBlkId)):(i&&r.isTextBlock(i)||(o=a.createNewParagraph(n,u._newStartBlkId,""),d.push(u._newStartBlkId)),u._deleteBlocks([n]),d.push(n.getId())),u._resourceBlock=u.insertResource(i,o,c)):(s=u._note.getNextBlock(n),t.start!==n.getLength()?c=u._handleSingleParaBlock(t,n):r.isTextBlock(s)||(c=a.createNewParagraph(n,u._newEndBlkId,"")),d.push(u._newEndBlkId),u._resourceBlock=u.insertResource(n,null,c)),d.push(u._resourceBlock.getId()),c||(c=s),a.setTextBlockAsEndingRange(u,c,0,0),u.pushAffectedBlockIds(d),!0},_handleSingleParaBlock:function(e,t){var n,o=this;return n=o._deleteBlockText(t,e.start,t.getLength()),r.isHeading(t)?a.createNewHeading(t,o._newEndBlkId,n,t.getLevel()):r.isCatalogue(t)?a.createNewCatalogue(t,{paraId:o._newEndBlkId,text:n,href:t.getHref()}):r.isListItem(t)?a.createNewListItem(t,o._newEndBlkId,n):r.isTodo(t)?a.createNewTodo(t,{id:o._newEndBlkId,text:n,checked:!1}):a.createNewParagraph(t,o._newEndBlkId,n)},_handleSingleTableSelection:function(e,t){var n=this;return n._resourceBlock=n.insertResource(t),n.setEndingRange(e),!0},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),n&&(e._newStartBlkId=n.newStartBlkId,e._newEndBlkId=n.newEndBlkId,e._retainStartBlock=n.abstractSimpleValue1)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e&&(e.newStartBlkId=n._newStartBlkId,e.newEndBlkId=n._newEndBlkId,e.abstractSimpleValue1=n._retainStartBlock),e}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(6),i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"ins",46:"del",106:"*",107:"+",109:"-",110:".",111:"/",144:"numlock",186:";",189:"-",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},r=o.IS_MAC?{3:"enter",91:"meta",93:"meta",224:"meta"}:{91:"win",92:"win",93:"menu",224:"win",229:"ime"},a=function(e,n,o){return t.some(e,function(e,t){return e===n&&parseInt(t,10)===o})},l={},s="A".charCodeAt(0),c="Z".charCodeAt(0);for(s;s<=c;s++)i[s]=String.fromCharCode(s).toLowerCase();for(s=1;s<20;++s)i[111+s]="f"+s;for(s=0;s<=9;s++)i[48+s]=s+"";for(s=0;s<=9;++s)i[s+96]=s+"";return{isMatch:function(e,t){var n=e+"-"+t,o=l[n];return null==o&&(o=a(r,e,t)||a(i,e,t),l[n]=o),o},getKey:function(e){if(t.isNumber(e))return e+="",i[e]||r[e]}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(32),o=n(128);return t.extend({editorEvents:{"yne-editing-state-change":"onEditingStateChange","yne-selection-change":"onSelectionChange"},onEditingStateChange:function(){},onSelectionChange:o})}.call(t,n,t,e))&&(e.exports=o)},,,,function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(50),i=n(2),r=n(72),a=n(19),l=n(45),s=n(10),c=n(228),u=n(6),d=n(0),p=n(51),h=n(60),g=n(7),f=n(3);return t=null,o.extend({inheritStyleHandlers:{bold:!0,italic:!0,underline:!0,strike:!0,"font-family":!0,"font-size":!0,color:!0,"back-color":!0,"white-space":!0,align:!0,"line-height":!0,indent:!0,"text-indent":!0},computeBulbStyles:function(){var e,n=this,o=n.el,r=o.getAttribute("yne-bulb-block");n.bulbBlock=r,r===i.PARAGRAPH?(e=o.style.marginLeft,e=parseInt(e,10),isNaN(e)||(e=Math.ceil(e/u.INDENT_WIDTH),n.styles.indent=(n.styles.indent||0)+e)):r===i.TODO&&(e=o.querySelector("[yne-bulb-todo-content]"))?o.innerHTML=e.innerHTML:("catalogue-wrap"===o.getAttribute("yne-bulb-type")||!t&&r===i.CATALOGUE)&&(t=new h({}))},setup:function(){this.block=null},capture:function(e){var t=this;e&&!0===e.isBr?t.emitBlock(!0):e&&!0===e.isText?t._appendText(e):e&&!0===e.isEmptyPara?t.emitBlock():t.captureBlock(e),t._hasChild=!0},captureBlock:function(e){this.emitBlock(),this.emit(e)},finish:function(){this.emitBlock(),this._hasChild||this.emit({isEmptyPara:!0})},_getBlock:function(){var e=this;return e.block||(e.block=e.createBlock()),e.block},createBlock:function(){var e,n=this,o=n.el;switch(this.bulbBlock){case i.HEADING:return new r({level:o.getAttribute("yne-bulb-level"),id:o.id});case i.CATALOGUE:return e=g(o).find("a").attr("href"),/#\w+$/.test(e)&&(e=e.match(/\w+$/)[0]),new p({id:f.newGUID(),href:e,ownerList:t});case i.TODO:return new l({id:f.newGUID(),checked:"true"===o.getAttribute("yne-bulb-checked")});default:return new a}},_appendText:function(e){var t=this;t.txtList=t.txtList||[],t.txtList.push(e)},emitBlock:function(e){var t,n,o,r=this,a=r.txtList;n=r._getBlock(),a&&(r.options&&r.options.holdSpaces||(a=c(a)),d.each(a,function(e){r.bulbBlock===i.CATALOGUE&&(e.styles.href=""),e.text&&(o=new s({text:e.text}),t=o.getLength(),d.each(e.styles,function(e,n){o.setStyle(0,t,n,e)}),n.append(o))})),(e||n.getLength()>0)&&(n.setBlockStyles(r.styles),r.emit(n)),r.block=null,r.txtList=null}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(){function e(e){return e.replace(g,"&lt;").replace(f,"&gt;")}function t(e){return e.replace(m,"&quot;")}function n(e){return e.replace(_,'"')}function o(e){return e.replace(y,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})}function i(e){return e.replace(v,":").replace(b," ")}function r(e){for(var t="",n=0,o=e.length;n<o;n++)t+=e.charCodeAt(n)<32?" ":e.charAt(n);return t.trim()}function a(e){return e=n(e),e=o(e),e=i(e),e=r(e)}function l(n){return n=t(n),n=e(n)}function s(){return""}function c(e,t){function n(t){return!!o||-1!==e.indexOf(t)}"function"!=typeof t&&(t=function(){});var o=!Array.isArray(e),i=[],r=!1;return{onIgnoreTag:function(e,o,a){if(n(e)){if(a.isClosing){var l="[/removed]",s=a.position+l.length;return i.push([!1!==r?r:a.position,s]),r=!1,l}return r||(r=a.position),"[removed]"}return t(e,o,a)},remove:function(e){var t="",n=0;return i.forEach(function(o){t+=e.slice(n,o[0]),n=o[1]}),t+=e.slice(n)}}}function u(e){return e.replace(I,"")}function d(e){var t=e.split("");return t=t.filter(function(e){var t=e.charCodeAt(0);return 127!==t&&(!(t<=31)||(10===t||13===t))}),t.join("")}function p(e){return e=a(e),k.lastIndex=0,k.test(e)?"":e=l(e)}function h(e,t){if(t=a(t),"href"===e||"src"===e){if("#"===(t=t.trim(t)))return"#";if("http://"!==t.substr(0,7)&&"https://"!==t.substr(0,8)&&"mailto:"!==t.substr(0,7)&&"#"!==t[0]&&"/"!==t[0])return""}else if("background"===e){if(k.lastIndex=0,k.test(t))return""}else if("style"===e){if(C.lastIndex=0,C.test(t))return"";if(S.lastIndex=0,S.test(t)&&(k.lastIndex=0,k.test(t)))return""}return t=l(t)}var g=/</g,f=/>/g,m=/"/g,_=/&quot;/g,y=/&#([a-zA-Z0-9]*);?/gim,v=/&colon;?/gim,b=/&newline;?/gim,k=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,C=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,S=/u\s*r\s*l\s*\(.*/gi,I=/<!--[\s\S]*?-->/g,w={};return w.safeAttrValue=h,w.safeHref=p,w.escapeHtml=e,w.escapeQuote=t,w.unescapeQuote=n,w.escapeHtmlEntities=o,w.escapeDangerHtml5Entities=i,w.clearNonPrintableCharacter=r,w.friendlyAttrValue=a,w.escapeAttrValue=l,w.onIgnoreTagStripAll=s,w.StripTagBody=c,w.stripCommentTag=u,w.stripBlankChar=d,w}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(50);return o.extend({inheritStyleHandlers:{bold:!0,italic:!0,underline:!0,strike:!0,"font-family":!0,"font-size":!0,color:!0,"back-color":!0,"white-space":!0},inheritBlockStyles:{align:!0,"line-height":!0,indent:!0,"text-indent":!0},_computeInheritStyles:function(){var e=this;o.prototype._computeInheritStyles.apply(e,arguments),e._computeInheritBlockStyles()},_computeInheritBlockStyles:function(){var e,n=this,o=n.parent,i=n.inheritBlockStyles;o&&o.styles&&(e=o.styles,t.each(i,function(t,o){if(!0===t){var i=e[o];i&&(n.styles[o]=i)}}))},capture:function(e){this.emit(e)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(75),n(1),n(64),n(65),n(90),n(53)],void 0!==(i=function(e,t,n,o,i,r,a,l,s){"use strict";return function(){function e(){}return e.boolean2string=function(e){return n.isBoolean(e)?String(e):e},e.blockStyle2oldCell=function(t){var o={};return n.map(t,function(t,n){o[n]=e.boolean2string(t)}),o},e.contentFromCollabJSON=function(t){return e.contentFromJSON(t,!0)},e.contentFromJSON=function(e,t,n){if(e){var l,c=e.type,u=e.data;switch(c){case s.IMAGE:l=t?a.fromCollabJSON(u):a.fromJSON(u,n);break;case s.ATTACHMENT:l=t?r.fromCollabJSON(u):r.fromJSON(u,n);break;case s.TEXT:l=t?o.fromCollabJSON(u):o.fromJSON(u);break;default:i.error("do not support type",c)}return l}},e.contentToCollabJSON=function(t){return e.contentToJSON(t,!0)},e.contentToHtml=function(e,t){if(!e)return"";var n={resourceMap:t};return e instanceof o||e instanceof a||e instanceof r?e.toHtml(n):(i.warn("unvalid content",e),"")},e.contentToJSON=function(e,t){t=!0===t;var n,o=s.TEXT;if(e){if(e.getType)switch(e.getType()){case l.TYPE_IMAGE:o=s.IMAGE;break;case l.TYPE_ATTACHMENT:o=s.ATTACHMENT}return n=t?e.toCollabJSON():e.toJSON(),{data:n,type:o}}},e.contentToPlain=function(e,t){if(!e)return"";var n;return e instanceof o?(n=e.toPlain(),n.join(t?"\n":"")):e instanceof a?e.toPlain():e instanceof r?e.toPlain():(i.warn("unvalid content",e),"")},e.inlineStyle2oldCell=function(t){var o=this.oldStyleNameMap,i={};return n.map(o,function(n,o){if(null!=t[n])return void(i[o]=e.boolean2string(t[n]))}),i},e.oldStyleNameMap={bold:"bold",italic:"italic",underline:"underline",lineThrough:"strike",fontName:"font-family",fontSize:"font-size",textColor:"color",link:"href"},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(17),n(1)],void 0!==(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromXml=function(e,t){o.error("fromXml() should be implemented by sub-class")},t.fromCollabJSON=function(e){return o.error("fromCollabJSON() should be implemented by sub-class"),null},t.prototype.getResId=function(){return this.resProps.resId||o.error("No resId"),this.resProps.resId},t.prototype.getType=function(){return this.resProps.type},t.prototype.isType=function(e){return this.resProps.type===e},t.prototype.toHtml=function(e){return o.error("toHtml() should be implemented by sub-class"),""},t.prototype.toJSON=function(){o.error("toJSON() should be implemented by sub-class")},t.prototype.toCollabJSON=function(){o.error("toCollabJSON() should be implemented by sub-class")},t.prototype.toPlain=function(){o.error("toPlain() should be implemented by sub-class")},t.prototype.toXml=function(e,t){o.error("toXml() should be implemented by sub-class")},t.prototype.initialize=function(e){this.resProps=e||{resId:"",type:t.TYPE_IMAGE}},t.TYPE_IMAGE="image",t.TYPE_ATTACHMENT="attachment",t}(n)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(240)],void 0!==(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.bulbStyles2TableStyles=function(e){return e.align&&(e.textAlign=e.align,delete e.align),e},e.getAllDefaults=function(){var t={};return n.each(e.STYLE_NAMES,function(n){t[n]=e.getDefault(n)}),t},e.getAllStyleNames=function(){return[].concat(e.STYLE_NAMES)},e.getConfig=function(t){var n;return e.isSupport(t)&&(n=o[t]),n},e.getDefault=function(t){return(e.getConfig(t)||{}).default},e.isSupport=function(t){return e.STYLE_NAMES.indexOf(t)>-1},e.tableStyles2BulbStyles=function(e){return e.textAlign&&(e.align=e.textAlign,delete e.textAlign),e},e.STYLE_NAMES=n.keys(o)||[],e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(){return{test:function(e){var t=/(https?:\/\/|www\.|ssh:\/\/|ftp:\/\/)[a-z0-9&_+\-\?\/\.=\#,:,@]+$/i,n=/[a-z0-9_+\-\.]+@[a-z0-9_+\-\.]+$/i;return e=String(e),t.test(e)||n.test(e)||!1},matchEnd:function(e){var t,n,o=/(https?:\/\/|www\.|ssh:\/\/|ftp:\/\/)[a-z0-9&_+\-\?\/\.=\#,:@%\(\)~]+$/i,i=/[a-z0-9_+\-\.]+@[a-z0-9_+\-\.]+$/i;return e=String(e),(t=o.exec(e))?(n=t[0],{mail:!1,fullURI:0===n.toLowerCase().indexOf("www.")?"http://"+n:n,result:t}):(t=i.exec(e),t?(n=t[0],{mail:!0,fullURI:"mailto:"+n,result:t}):void 0)}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(6),n(0),n(2),n(19),n(30)],void 0!==(i=function(e,t,n,o,i,a,l){"use strict";var s;return s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.createBlank=function(){return new t({})},t.prototype.toHtml=function(e,i,r){e=e||0,i=null==i?this.getEndOffset():i,r=!0===r;var a=document.createElement("div"),s=$(a);return s.attr("yne-bulb-block","quote").css("white-space","pre-wrap").css("padding",n.QUOTE_PADDING).css("border-left",n.QUOTE_BORDER_LEFT).css("margin",n.QUOTE_MARGIN),o.each(t.DEFAULT_STYLES,function(e,t){return s.css(t,e)}),this.applyBlockStylesOnElement(s),s.html(l.rich2html(this.sliceText(e,i,!1),{withDefault:r})),a.outerHTML},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=i.QUOTE},t}(a),s.DEFAULT_STYLES={color:"#919191","font-weight":300},s}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(2),n(46)],void 0!==(i=function(e,t,n,o){"use strict";return function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.isHeaderFooterRange=function(e){return n.isHeaderFooter(e.block)},t.prototype.collapse=function(e){void 0===e&&(e=!0),e?this.end=this.start:this.start=this.end},t.prototype.isCollapsed=function(){return this.start===this.end},t.prototype.clone=function(){return new t({block:this.block,end:this.end,start:this.start})},t.prototype.getDataAsPlain=function(){return""},t.prototype.canDrawedByNative=function(){return!0},t.prototype.toNativeRange=function(e){return null},t.prototype.toCollabJSON=function(){var e=this.block.toCollabJSON();return e.rangeType=this.type,e.blockId=this.block.getId(),e},t.prototype.countWords=function(){return this.end-this.start},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.HEADER_FOOTER,this.start=t.start||0,this.end=t.end||0,this.block=t.block},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(2),n(8),n(1),n(46)],void 0!==(i=function(e,t,n,o,i,a){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromCollabJSON=function(e,o){var r,l=e.rangeType;return l!==n.ATTACHMENT?void i.error("wrong block range type:",l):(r=a.getBlockById(e.blockId,o),r?new t({block:r}):void 0)},t.prototype.canDrawedByNative=function(){return!1},t.prototype.clone=function(){return new t({block:this.block})},t.prototype.collapse=function(e){},t.prototype.getDataAsHtml=function(e){return this.block.toHtml(null,null,e)},t.prototype.getDataAsJSON=function(){var e=this.block.toJSON();return(o.IS_WEB_NOTE||o.IS_WEB_GROUP)&&e.resource&&!/^http/i.test(e.resource)&&(e.resource=location.protocol+"//"+location.hostname+e.resource),e},t.prototype.getDataAsPlain=function(){return this.block.toPlain()},t.prototype.isCollapsed=function(){return!1},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.ATTACHMENT},t}(a)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(1),n(2),n(46)],void 0!==(i=function(e,t,n,o,i){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromCollabJSON=function(e,r){var a=e.rangeType;if(a!==o.IMAGE)return void n.error("wrong block range type:",a);var l=i.getBlockById(e.blockId,r);return l?new t({block:l}):void 0},t.prototype.isCollapsed=function(){return!1},t.prototype.clone=function(){return new t({block:this.block})},t.prototype.collapse=function(){},t.prototype.getDataAsJSON=function(){return this.block.toJSON()},t.prototype.getDataAsHtml=function(e){return this.block.toHtml(null,null,e)},t.prototype.getDataAsPlain=function(){return this.block.toPlain()},t.prototype.canDrawedByNative=function(){return!1},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=o.IMAGE},t}(i)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(74),n(2),n(51),n(72),n(73),n(61),n(34),n(19),n(63),n(45)],void 0!==(i=function(e,t,n,o,i,r,a,l,s,c,u,d){"use strict";return function(){function e(){}return e.buildBlockFromJSON=function(e,t){var p=null,h=e.type;switch(h){case o.PARAGRAPH:p=c.fromCollabJSON(e);break;case o.IMAGE:p=l.fromJSON(e);break;case o.ATTACHMENT:p=n.fromJSON(e);break;case o.LIST_ITEM:p=s.fromCollabJSON(e);break;case o.TABLE:p=u.fromJSON(e);break;case o.HR:p=a.fromCollabJSON(e);break;case o.HEADING:p=r.fromCollabJSON(e);break;case o.CATALOGUE:p=i.fromCollabJSON(e);break;case o.TODO:p=d.fromCollabJSON(e);break;default:throw new Error("unsupported type [ "+h+"] in buildBlockFromJSON")}return p},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(0),i=n(18),r=n(4),a=n(42),l=n(3);return t=i.extend({name:"atom.SetTableCellBlockStyle",_table:null,_rect:null,_type:null,effected:!1,_oldStyles:{},_styles:null,initialize:function(){var e=this,n=e.options.args;e._oldStyles={},l.isCollabCommand(n)||(e._table=e.options.table,e._styles=e.options.styles,e._toggle=e.options.toggle,e._rect=e.options.rect,e._type=e.options.type),e.type===a.TYPES.ALL&&(e._rect=e._rect||{top:0,left:0,width:e._table.getColumnCount(),height:e._table.getRowCount()}),t.__super__.initialize.apply(e)},apply:function(){var e,t,n,i,r,l,s,c,u=this,d=u._table,p=u._rect,h=u._styles||{},g=u._toggle,f=!1;if(!p)return u.effected;if(e=p.top+p.height,t=p.left+p.width,g){if(!(r=a.create({block:d,type:a.TYPES.NORMAL,rect:p})))return u.effected;if(!(l=r.getAsRectRange()))return u.effected;n=d.getCommonBlockStyle(g,l),h[g]=null==n||!n}for(i=o.keys(h),s=p.top;s<e;s++)for(c=p.left;c<t;c++)this._oldStyles[s+"-"+c]=d.getCellBlockStyles({row:s,col:c,names:i}),d.setCellBlockStyles({row:s,col:c,styles:h})&&(f=!0);return u.effected=f,u.effected},doUnapply:function(){var e,t,n=this._table,o=this._rect,i=o.top+o.height,r=o.left+o.width;for(e=o.top;e<i;e++)for(t=o.left;t<r;t++)n.setCellBlockStyles({row:e,col:t,styles:this._oldStyles[e+"-"+t]})},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._styles=r.styleNameValues,n._oldStyles=r.oldStyleNameValues,n._rect=r.simpleValue1,n._type=r.simpleValue2,n._toggle=r.newBlkId)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.styleNameValues=e._styles||null,n.oldStyleNameValues=e._oldStyles,n.simpleValue1=e._rect,n.simpleValue2=e._type,n.newBlkId=e._toggle||null,n}}),r.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(0),a=n(3);return t=o.extend({name:"atom.SetListItemLevel",_listItems:null,_newLevels:null,_oldLevels:null,initialize:function(){var e=this,n=e.options,o=n.args;a.isCollabCommand(o)||(e._listItems=n.listItems,e._newLevels={},n.newLevel?r.each(e._listItems,function(t,o){e._newLevels[o]=n.newLevel}):n.deltaLevel&&r.each(e._listItems,function(t,o){e._newLevels[o]=t.getLevel()+n.deltaLevel})),t.__super__.initialize.apply(e)},apply:function(){var e=this;return e._oldLevels={},r.each(e._newLevels,function(t,n){e._oldLevels[n]=e._listItems[n].getLevel(),e._listItems[n].setLevel(t)}),!0},doUnapply:function(){var e=this;return r.each(e._oldLevels,function(t,n){e._listItems[n].setLevel(t)}),!0},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties.cmdJSON;i&&(e=o.collabProperties.coreEditor.getNote(),i.oldLevels&&(n._oldLevels=i.oldLevels),n._newLevels=i.newLevels,n._listItems=[],r.each(i.listItemIds,function(t){n._listItems.push(e.getBlockById(t))})),t.__super__.fromCollabJSON.apply(n)},toCollabJSON:function(){var e=this,n=[],o=t.__super__.toCollabJSON.apply(e);return e._oldLevels&&(o.oldLevels=e._oldLevels),o.newLevels=e._newLevels,r.each(e._listItems,function(e){n.push(e.getId())}),o.listItemIds=n,o}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(7),i=n(12),r=n(69),a=n(8),l=n(24),s=n(6);return r.extend({className:"toolbar-item toolbar-combo-box",events:{"click .combo-value-wrapper":"onValueWrapperElClick","click .combo-expand-wrapper":"onExpandWrapperElClick","click .combo-menu-wrapper":"onMenuWrapperClick",mousedown:"onMouseDown"},name:"unknown",label:"unknown",defaultValue:"",items:{},value:"",templateName:"toolbar-combo-box-template",_isForceSelectWhenClick:!1,initialize:function(e){var t=this;t.editor=e.editor,t.render(),t.defaultSetValue?t.select(t.defaultSetValue):t.select(t.defaultValue),t.bindEvents(),t.bindDocumentEvents(),t.bindEditorEvents()},render:function(){var e,t=this,n=t.$el;if(n.addClass("combo-box-"+t.name),e=i.render("web",t.templateName,{name:t.name,label:t.label,defaultValue:t.defaultValue,items:t.items}),n.html(e),t.valueWrapperEl=n.find(".combo-value-wrapper")[0],t.expandWrapperEl=n.find(".combo-expand-wrapper")[0],t.menuWrapperEl=n.find(".combo-menu-wrapper")[0],t.displayWrapperEl=n.find(".combo-display-wrapper")[0],o(t.displayWrapperEl).tooltipster({animation:"",animationDuration:0,theme:["tooltipster-borderless","tooltipster-borderless-customized"],side:"bottom",delay:[800,300]}),t.isVisible||t.hide(),"heading"===t.name&&(!l.isSafari()||a.IS_MAC))for(var r=s.IS_MAC?"Command+":"Ctrl+",c=3;c<=6;c++)o(o(t.menuWrapperEl).find("li[data-value="+c+"]")[0]).tooltipster({animation:"",animationDuration:0,theme:["tooltipster-heading","tooltipster-heading-customized"],side:"right",delay:[800,300],content:r+(c-2)})},bindEvents:function(){},bindDocumentEvents:function(){var e=this;t.bindAll(e,"onDocumentMouseDown"),o(document).on("mousedown",e.onDocumentMouseDown)},bindEditorEvents:function(){var e=this,n=e.editor,o=e.editorEvents;o&&t.each(o,function(t,o){n.on(o,e[t].bind(e))})},onValueWrapperElClick:function(){this.toggleMenu()},onExpandWrapperElClick:function(){this.toggleMenu()},onMenuWrapperClick:function(e){var t=this,n=e.target,i=o(n).closest(".combo-item")[0];i&&(t.hideMenu(),t.onItemClick(i))},onItemClick:function(e){var t,n,i=this,r=o(e).data("value"),a=i.editor,l=a.getNoteRange();r&&(r!==i.value||!0===i._isForceSelectWhenClick||l.isInMultiBlock())&&(i._isForceSelectWhenClick=!1,i.select(r),i.onChange(r)),l.isSingleTableSelected()&&(t=l.startRange,n=t.getAsRectRange(),n.onlyOneCell()||(i.select(r),i.onChange(r)))},select:function(e){var t=this;t.value=e,t.updateValueUI(e)},updateValueUI:function(){},onChange:function(){},showMenu:function(){var e,t=this,n=t.menuWrapperEl;o(n).removeClass("menu-position-fix"),o(n).addClass("show"),e=n.getBoundingClientRect(),e.right>document.documentElement.offsetWidth&&o(n).addClass("menu-position-fix")},hideMenu:function(){o(this.menuWrapperEl).removeClass("show")},toggleMenu:function(){var e=this;o(e.menuWrapperEl).hasClass("show")?e.hideMenu():e.showMenu()},onDocumentMouseDown:function(e){var t=this,n=e.target;o.contains(t.el,n)||t.hideMenu()},onMouseDown:function(e){e.preventDefault()},reset:function(){var e=this;e.defaultSetValue?e.select(e.defaultSetValue):e.select(e.defaultValue)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(32),o=n(0);return t.extend({editorEvents:{"yne-editing-state-change":"onEditingStateChange"},onEditingStateChange:function(e){var t=this;o.has(e,t.name)&&t.setState(e[t.name])},onClick:function(){var e=this,t={},n=e.editor.controller.editingInlineStates;t[e.name]=!e.state,e.editor.execCommandByToolbar("comp.ApplyStyles",{inlineStyles:t,editingInlineStates:n})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(100).extend({editorEvents:{"yne-selection-change":"onSelectionChange"},onChange:function(e){var t=this,n={};n[t.name]=e,t.editor.execCommandByToolbar("comp.ApplyStyles",{blockStyles:n})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(15),o=n(7),i=n(0),r=n(6),a=n(81),l=["shift","alt","ctrl","meta"],s={return:"enter",escape:"esc",plus:"+"},c={mod:r.IS_MAC?"meta":"ctrl",option:"alt",command:"meta"};return t.extend({initialize:function(e){var t=this;e=e||{},e.el&&(i.bindAll(t,"_onKeyDown"),t.el=e.el,t._beforeMatch=e.beforeMatch,t._afterMatch=e.afterMatch,t._hasBindEvents=!1)},_bindEvents:function(){var e=this;e._hasBindEvents||(o(e.el).on("keydown",e._onKeyDown),e._hasBindEvents=!0)},_unbindEvents:function(){var e=this;e._hasBindEvents&&(o(e.el).off("keydown",e._onKeyDown),e._hasBindEvents=!1)},_prepareForBindKey:function(){var e=this;e._hasBindEvents||e._bindEvents(),e._keyMap||(e._keyMap={}),e._matchCache||(e._matchCache={})},_formatKey:function(e){e=o.trim(e),e=e.toLowerCase(),e=e.replace(/\s+/g,""),i.each(c,function(t,n){e=e.replace(n+"+",t+"+")});var t={},n=e.split(/\+/),r=i.last(n),a=[];return r=s[r]||r,t.key=r,i.each(l,function(n){e.indexOf(n)>-1&&(t[n]=!0,a.push(n))}),a.push(r),t.mark=a.join("-"),t},isEventMatchKey:function(e,t){var n=this._extractEventInfo(e),o=this._formatKey(t);return this._isMatch(n,o)},_extractEventInfo:function(e){var t={},n=[];return i.each(l,function(o){e[o+"Key"]&&(t[o]=!0,n.push(o))}),n.push(e.keyCode),t.keyCode=e.keyCode,t.mark=n.join("-"),t},_isMatch:function(e,t){return!(!t||!event)&&(i.every(l,function(n){return t[n]===e[n]})&&a.isMatch(t.key,e.keyCode))},_onKeyDown:function(e){var t,n,o=this,r=o._keyMap,a=o._extractEventInfo(e),l=a.mark,s=o._matchCache,c=s[l];o._beforeMatch&&o._beforeMatch(e),c||(c=s[l]={eventInfo:a},t={},n=!1,i.each(r,function(e,i){o._isMatch(a,e.keyInfo)&&(t[i]=e,n=!0)}),n&&(c.handlers=t)),i.each(c.handlers,function(t){t.callback.apply(null,[e])}),o._afterMatch&&o._afterMatch(e,n)},bind:function(e,t){var n,o,r=this,a=r._formatKey(e);a&&(r._prepareForBindKey(),o=r._keyMap["key-"+e]={keyInfo:a,callback:t},n=r._matchCache,i.each(n,function(e){if(e&&e.eventInfo){var t,n=e.handlers;n?t=!0:(n={},t=!1),r._isMatch(e.eventInfo,a)&&(n[a.mark]=o,t=!0),t&&(e.handlers=n)}}))},unbind:function(e){var t=this,n=t._keyMap,o=t._matchCache,r="key-"+e;n&&n[r]&&delete n[r],i.each(o,function(e){var t=e.handlers;t&&t[r]&&delete t[r]})},unbindAll:function(){var e=this;e._unbindEvents(),e._keyMap={},e._matchCache={}},clearCache:function(){this._matchCache={}}})}.call(t,n,t,e))&&(e.exports=o)},,,,,function(e,t,n){var o;void 0!==(o=function(){return{getNamespace:function(){return"note.youdao.com"}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(140),o=n(252),i=n(255),r=n(257),a=n(1);return{parseHtml:function(e){var n=t(e);return a.log("parseHtml OK",n),n},parsePlain:function(e,t,n,i){return o(e,t,n,i)},parseJSON:function(e){return i(e)},parseOCR:function(e,t){return r(e,t)}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(38),o=n(6),i=n(0),r=n(226),a=["bold","bolder","700","800","900"],l=n(28),s={"xx-small":12,"x-small":12,small:13,medium:16,large:18,"x-large":24,"xx-large":32};return{bold:{inheritable:!0,action:function(e){var n=e.style.fontWeight;return n=n&&t.trim(n).toLowerCase(),n&&"inherit"!==n?-1!==i.indexOf(a,n):null}},italic:{inheritable:!0,action:function(e){var t=e.style.fontStyle;return t?"italic"===t:null}},underline:{inheritable:!0,action:function(e,t,n){var o=e.style.textDecoration;return!!/(^|\s)underline($|\s)/i.test(o)||!(o&&!n)&&n}},strike:{inheritable:!0,action:function(e,t,n){var o=e.style.textDecoration;return!!/(^|\s)line-through($|\s)/i.test(o)||!(o&&!n)&&n}},"font-family":{inheritable:!0,action:function(e){var t=e.style.fontFamily;return 0===t.trim().indexOf("-apple-system")?l.DEFAULT_FONT:l.getFontFirstValue(t)}},"font-size":{inheritable:!0,action:function(e,n,o){var i=e.style.fontSize;if(i=t.trim(i+""),/^[\d.]+px$/.test(i)?i=parseInt(i,10):/^[\d.]+pt$/.test(i)?i=Math.floor(4*parseFloat(i,10)/3):/^[\d.]+em$/.test(i)?(i=parseFloat(i,10),i*=o||14,i=Math.floor(i)):/^[\d.]+rem$/.test(i)?(i=parseFloat(i,10),i*=10,i=Math.floor(i)):i=s[i],i&&!isNaN(i))return i}},color:{inheritable:!0,action:function(e){var t=e.style.color;return r(t,!1)}},"back-color":{inheritable:!0,action:function(e){var t=e.style.backgroundColor;return r(t,!0)}},align:{inheritable:!0,action:function(e){var n=e.style.textAlign||e.align;if((n=n&&t.trim(n).toLowerCase())&&"inherit"!==n)return n}},"line-height":{inheritable:!0,requireValues:["font-size"],action:function(e,n){var o=t.trim(e.style.lineHeight+""),i=n["font-size"]||14;if(/^[\d.]+$/.test(o)?o=parseFloat(o,10):/^[\d.]+px$/.test(o)?(o=parseFloat(o,10),o/=i):o=0,o&&!isNaN(o)&&o>1)return o}},indent:{inheritable:!0,action:function(e,t,n){var o=0;return"BLOCKQUOTE"===e.tagName&&(o=1),o+=n||0}},"text-indent":{inheritable:!0,action:function(e){var n=e.style.textIndent;if(n=t.trim(n+""),n=/^[\d.]+px$/.test(n)?parseFloat(n,10):/^[\d.]+pt$/.test(n)?4*parseFloat(n,10)/3:null)return(n=Math.floor(n/o.INDENT_WIDTH))||1}},width:{inheritable:!1,action:function(e){var n=e.style.width||e.width;if(n=t.trim(n+""),/^[\d.]+(px)?$/.test(n)&&(n=parseInt(n,10)),n&&!isNaN(n))return n}},float:{inheritable:!1,action:function(e){return e.style.float}},"white-space":{inheritable:!0,action:function(e){var t=e.style.whiteSpace;if(t&&"inherit"!==t)return t}}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o,i,r,a=n(0),l={};t={default:{name:"普通文本","font-size":14},a:{name:"标题","font-size":32,bold:!0},b:{name:"副标题","font-size":18,color:"#595959",bold:!0},1:{name:"标题1","font-size":28,bold:!0},2:{name:"标题2","font-size":20,bold:!0},3:{name:"标题3","font-size":16,bold:!0},4:{name:"标题4","font-size":14,bold:!0}},o=[t.default,t.a,t.b,t[1],t[2],t[3],t[4]],i={};for(r in t)"default"!==r&&(l[r]=a.clone(t[r]),delete l[r].name,delete l[r].align);return{headingMap:t,headingArray:o,headingBlockStyles:i,headingInlineStyles:l}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0)],void 0!==(i=function(e,t,n){"use strict";var o;!function(e){e[e.major=1]="major",e[e.minor=0]="minor",e[e.revision=3]="revision"}(o||(o={}));var i;return function(e){e[e.GRETER=1]="GRETER",e[e.EQUAL=0]="EQUAL",e[e.LESS=-1]="LESS"}(i||(i={})),function(){function e(){}return e.getDefaultAsString=function(){return o.major+"."+o.minor+"."+o.revision},e.parse=function(t){if(t){var n=(t+"").split(".");return{major:e.getAsInt(n[0]),minor:e.getAsInt(n[1]),revision:e.getAsInt(n[2])}}},e.isLessThanDefault=function(t){if(!t)return!0;var n=e.parse(t);return e.compare(n,o)===i.LESS},e.isCompatible=function(t){if(!(t=t||"")||"true"===t)return!0;var n=e.parse(t);return e.compare(o,n)!==i.LESS},e.getAsInt=function(e){e=e||"";var t=parseInt(e+"",10);return isNaN(t)?0:t},e.compareInt=function(e,t){return e===t?i.EQUAL:e>t?i.GRETER:i.LESS},e.compare=function(t,o){var r=i.EQUAL;return n.some(["major","minor","revision"],function(n){var a=e.compareInt(t[n]||0,o[n]||0);if(a!==i.EQUAL)return r=a,!0}),r},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";return function(e){var t=/\xA0/g;return e.replace(t," ")}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(144)],void 0!==(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.checkValid=function(e){var t,i,r=e.length;if(!n.isString(e))return!1;for(t=0;t<r;t++)if(!(9===(i=o(e,t))||10===i||13===i||i>=32&&i<=55295||i>=57344&&i<=65533)){if(!(i>=65536&&i<=1114111))return!1;t++}return!0},e.clear=function(e){var t,i,r="",a=e.length;if(!n.isString(e))return e;for(t=0;t<a;t++)i=o(e,t),9===i||10===i||13===i||i>=32&&i<=55295||i>=57344&&i<=65533?r+=e[t]:i>=65536&&i<=1114111&&(r+=e[t],t++,r+=e[t]);return r},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(){return{parseImgSource:function(e){var t=e.split("?")[0].replace(/^\//,"").split("/");return{resId:t[t.length-1]}}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(1),n(0),n(143),n(20)],void 0!==(i=function(e,t,n,o,i,r){"use strict";return function(){function e(){}return e.convertToCssStyle=function(e,t){if(e){var n=o.pick(e,this.SUPPORTED_STYLES);return n=o.defaults(n,r.getAllDefault()),t&&o.each(n,function(e,o){null!=e&&(n[o]=t.valueToView(o,e))}),i.convertToCssStyle(n)}},e.isSupportedStyle=function(t){return e.SUPPORTED_STYLES.indexOf(t)>-1},e.makeHtmlMarker=function(t){if(!t)return void n.warn("Failed to create marker",t);var o,i,r=t.getLevel(),a=t.getText();return o=t.isOrdered()?e.ORDERED_STYLE_TYPES[r%3]:e.UNORDERED_STYLE_TYPES[r%3],a.getLength()&&(i=this.convertToCssStyle(a.getStylesAtIndex(0))),{listStyleType:o,markerStyles:i}},e.makePlainMarker=function(t,o){if(!t)return n.warn("Failed to create marker",t),"";o=!1!==o;var i,r="",a=t.getLevel();if(t.isOrdered()){switch(i=t.getIndex(),a%3){case 0:r=e.toRoman(i);break;case 2:r=e.toAlphabet(i);break;default:case 1:r=i}r+="."}else switch(a%3){case 0:r="■";break;case 2:r="○";break;default:case 1:r="●"}return o&&(r+=" "),r},e.toAlphabet=function(e){if(isNaN(e))return"";var t="a".charCodeAt(0),n="z".charCodeAt(0),o=n-t+1,i="";for(e--;e>=0;)i=String.fromCharCode(e%o+t)+i,e=Math.floor(e/o)-1;return i},e.toRoman=function(e){if(isNaN(e))return"";for(var t=[["","i","ii","iii","iv","v","vi","vii","viii","ix"],["","x","xx","xxx","xl","l","lx","lxx","lxxx","xcc"],["","c","cc","ccc","cd","d","dc","dcc","dcc","cm"]],n="",o=0,i=0,r=1e3;i<3;i++,r/=10)o=Math.floor(e%r/(r/10)),n+=t[2-i][o];return n},e.SUPPORTED_STYLES=["font-size","font-family","color","bold","italic"],e.ORDERED_STYLE_TYPES=["lower-roman","decimal","lower-alpha"],e.UNORDERED_STYLE_TYPES=["square","disc","circle"],e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";return function(){return{value:""}}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(6);return{parseToBoolean:function(e,n){var o=null;return t.isBoolean(e)?o=e:t.isNumber(e)?0===e?o=!1:1===e&&(o=!0):t.isString(e)&&("0"===e.toLowerCase()||"false"===e.toLowerCase()?o=!1:"1"!==e.toLowerCase()&&"true"!==e.toLowerCase()||(o=!0)),null===o&&t.isBoolean(n)&&(o=n),o},parseToNumber:function(e,n){var o=null;return t.isNumber(e)?o=e:t.isString(e)&&(o=window.parseInt(e)),(isNaN(o)||null===o)&&t.isNumber(n)&&(o=n),o},parseToPageType:function(e){var t=o.PAGE_TYPE_NONE;return e&&(e.trim().toUpperCase()===o.PAGE_TYPE_B5?t=o.PAGE_TYPE_B5:e.trim().toUpperCase()===o.PAGE_TYPE_A4?t=o.PAGE_TYPE_A4:e.trim().toUpperCase()===o.PAGE_TYPE_TEST&&(t=o.PAGE_TYPE_TEST)),t}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(108),o=new RegExp("^http[s]{0,1}://"+t.getNamespace()),i="//"+t.getNamespace(),r=!1;return{setUseConvert:function(e){r=!!e},isInnerResoures:function(e){return o.test(e)},getURL:function(e){return r&&this.isInnerResoures(e)?e.replace(o,i):e}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(46),n(2),n(8)],void 0!==(i=function(e,t,n,o,i){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromXml=function(e){throw new Error("HandWrite do NOT support fromXml till now")},t.prototype.canDrawedByNative=function(){return!1},t.prototype.clone=function(){return new t({block:this._rangeProps.block})},t.prototype.collapse=function(){},t.prototype.getDataAsJSON=function(){var e=this,t=e._rangeProps.block.toJSON();return(i.IS_WEB_NOTE||i.IS_WEB_GROUP)&&t.resource&&!/^http/i.test(t.resource)&&(t.resource=location.protocol+"//"+location.hostname+t.resource),t},t.prototype.getDataAsHtml=function(e){return this._rangeProps.block.toHtml(null,null,e)},t.prototype.getDataAsPlain=function(){return this._rangeProps.block.toPlain()},t.prototype.isCollapsed=function(){return!1},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=o.HANDWRITE,this._rangeProps={block:t.block}},t}(n)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(2),n(46)],void 0!==(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.clone=function(){return new t({block:this.block})},t.prototype.collapse=function(){},t.prototype.isCollapsed=function(){return!1},t.prototype.getDataAsHtml=function(){return this.block.toHtml()},t.prototype.getDataAsJSON=function(){return this.block.toJSON()},t.prototype.getDataAsPlain=function(){return this.block.toPlain()},t.prototype.canDrawedByNative=function(){return!0},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.HR},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(){return{contains:function(e,t){if(!e||!t)return!1;var n=e.left+e.width,o=e.top+e.height,i=t.left+t.width,r=t.top+t.height;return e.left<=t.left&&e.top<=t.top&&n>=i&&o>=r},union:function(e,t){if(e&&t){var n=Math.min(e.left,t.left),o=Math.min(e.top,t.top);return e={left:n,top:o,width:Math.max(e.left+e.width,t.left+t.width)-n,height:Math.max(e.top+e.height,t.top+t.height)-o}}}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(2),n(46)],void 0!==(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.canDrawedByNative=function(){return!1},t.prototype.clone=function(){return new t({block:this.block})},t.prototype.collapse=function(){},t.prototype.getDataAsHtml=function(){return this.block.toHtml()},t.prototype.getDataAsJSON=function(){return this.block.toJSON()},t.prototype.getDataAsPlain=function(){return this.block.toPlain()},t.prototype.isCollapsed=function(){return!1},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.UNKNOWN},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.isCmdVersionMatchNoteVersion=function(e,t){return e-t==1},e.isMessageTooLarge=function(e){return e>5e3},e.newGUID=function(){var e="";return e+=Math.floor(10*Math.random()).toString().substr(0,1),e+=Math.floor(10*Math.random()).toString().substr(0,1),e+="-",e+=Date.now().toString()},e}();t.Utils=n}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(0),a=n(3);return t=o.extend({name:"atom.SetInlineStyle",_selectedBlocks:null,_start:null,_end:null,_isFullText:!1,_oldStyleNameValues:{},_styleNameValues:null,initialize:function(){var e=this,n=e.options.args;e._oldStyleNameValues={},a.isCollabCommand(n)||(e._selectedBlocks=e.options.blocks,e._styleNameValues=e.options.styleNameValues,e._start=e.options.start,e._end=e.options.end,e._isFullText=e.options.fullText),t.__super__.initialize.apply(e)},apply:function(){var e=this;r.each(e._styleNameValues,function(t,n){e._setStyleToSelectedBlocks(n,t)})},doUnapply:function(){var e,t=this;r.each(t._selectedBlocks,function(n){e=t._oldStyleNameValues[n.getId()],t._isFullText&&(t._start=n.getStartOffset(),t._end=n.getEndOffset()),r.each(e,function(e,o){n.setTextStyle(o,e,t._start,t._end)})})},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,a=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),a&&(n._selectedBlocks=[],r.each(a.blockIds,function(t){n._selectedBlocks.push(e.getBlockById(t))}),n._styleNameValues=a.styleNameValues,n._oldStyleNameValues=a.oldStyleNameValues,n._start=a.startPosition,n._end=a.endPosition,n._isFullText=a.simpleValue1)},toCollabJSON:function(){var e=this,n=[],o=t.__super__.toCollabJSON.apply(e);return e._selectedBlockIds=[],r.each(e._selectedBlocks,function(e){n.push(e.getId())}),o.blockIds=n,o.styleNameValues=e._styleNameValues,o.oldStyleNameValues=e._oldStyleNameValues,o.startPosition=e._start,o.endPosition=e._end,e._isFullText&&(o.simpleValue1=!0),o},_setStyleToSelectedBlocks:function(e,t){var n,o,i,a=this;r.each(a._selectedBlocks,function(r){o=r.getId(),a._isFullText&&(a._start=r.getStartOffset(),a._end=r.getEndOffset()),n=r.getTextStyle(e,a._start,a._end),a._oldStyleNameValues[o]||(a._oldStyleNameValues[o]={}),a._oldStyleNameValues[o][e]=n,i=r.getInlineStylesForEmpty(),r.isEmpty()&&r.setInlineStylesForEmpty(a.getInlineStates(i,e,t)),r.setTextStyle(e,t,a._start,a._end)})},getInlineStates:function(e,t,n){if(e)return e[t]=n,e}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(0),a=n(3);return t=o.extend({name:"atom.SetBlockStyle",_selectedBlocks:null,_oldStyleNameValues:{},_styleNameValues:null,initialize:function(e){var n=this,o=n.options.args;n._oldStyleNameValues={},a.isCollabCommand(o)||(n._selectedBlocks=e.blocks,n._styleNameValues=n.options.styleNameValues),t.__super__.initialize.apply(n,arguments)},apply:function(){var e=this;r.each(e._styleNameValues,function(t,n){e._setStyleToSelectedBlocks(n,t)})},doUnapply:function(){var e,t=this;r.each(t._selectedBlocks,function(n){e=t._oldStyleNameValues[n.getId()],r.each(e,function(e,t){n.setBlockStyle(t,e)})})},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties,i=o.cmdJSON;t.__super__.fromCollabJSON.apply(e),e._note=o.coreEditor.getNote(),i&&(e._selectedBlocks=[],r.each(i.blockIds,function(t){e._selectedBlocks.push(e._note.getBlockById(t))}),e._styleNameValues=i.styleNameValues,e._oldStyleNameValues=i.oldStyleNameValues)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e),o=[];return r.each(e._selectedBlocks,function(e){o.push(e.getId())}),n.blockIds=o,n.styleNameValues=e._styleNameValues,n.oldStyleNameValues=e._oldStyleNameValues,n},_setStyleToSelectedBlocks:function(e,t){var n,o,i=this;r.each(i._selectedBlocks,function(r){o=r.getId(),n=r.getBlockStyle(e),i._oldStyleNameValues[o]||(i._oldStyleNameValues[o]={}),i._oldStyleNameValues[o][e]=n,r.setBlockStyle(e,t)})}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(3),a={POINT:"point",CELL:"cell"};return t=o.extend({name:"atom.SetTableCellAttr",_table:null,_rect:null,_type:null,_value:null,_oldValue:null,effected:!1,initialize:function(){var e=this,n=e.options.args;r.isCollabCommand(n)||(e._table=e.options.table,e._rect=e.options.rect,e._type=e.options.type,e._value=e.options.value),t.__super__.initialize.apply(e)},apply:function(){var e=this,t=e._type,n=e._table,o=e._rect,i=e._value;return i?t===a.POINT?(e._oldValue=e._getOldAttr(o.row,o.col),n.setMergePointAttrAt(o.row,o.col,i.width,i.height),void(e.effected=!0)):t===a.CELL?(e._oldValue=e._getOldAttr(o.row,o.col),n.setMergedCellAttrAt(o.row,o.col,i.dx,i.dy),void(e.effected=!0)):void 0:void((n.isMergePoint(o.row,o.col)||n.isMergedCell(o.row,o.col))&&(e._oldValue=e._getOldAttr(o.row,o.col),n.clearCellAttr(o.row,o.col),e.effected=!0))},_getOldAttr:function(e,t){var n=this,o=n._table;return o.isMergedCell(e,t)?o.getMergedCellAttrAt(e,t):o.isMergePoint(e,t)?o.getMergePointAttrAt(e,t):null},doUnapply:function(){var e=this,t=e._table,n=e._rect,o=e._oldValue;if(!o)return void t.clearCellAttr(n.row,n.col);(o.width||o.height)&&t.setMergePointAttrAt(n.row,n.col,o.width,o.height),(o.dx||o.dy)&&t.setMergedCellAttrAt(n.row,n.col,o.dx,o.dy)},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._value=r.styleNameValues,n._oldValue=r.oldStyleNameValues,n._rect=r.simpleValue1,n._type=r.simpleValue2)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.styleNameValues=e._value,n.oldStyleNameValues=e._oldValue,n.simpleValue1=e._rect,n.simpleValue2=e._type,n}},{TYPES:a}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(){return function(){}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(100),o=n(7),i=n(0);return t.extend({editorEvents:{"yne-editing-state-change":"onEditingStateChange"},onChange:function(e){var t=this,n={},o=t.editor.controller.editingInlineStates;n[t.name]=e,t.editor.execCommandByToolbar("comp.ApplyStyles",{inlineStyles:n,editingInlineStates:o})},updateValueUI:function(e){var t=this,n=o(t.valueWrapperEl).find(".combo-value")[0];t.items[e]?o(n).text(t.items[e]):o(n).text(t.getUnlistedText(e)||"")},getUnlistedText:function(){return""},onEditingStateChange:function(e,t){var n=this;n._isForceSelectWhenClick=!1,i.has(e,n.name)&&(t&&i.has(t,n.name)&&e[n.name]!==t[n.name]&&(n._isForceSelectWhenClick=!0),n.select(e[n.name]))}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(32).extend({editorEvents:{"yne-selection-change":"onSelectionChange"},onSelectionChange:function(){var e=this;e.setState(e.querySelectionState())},querySelectionState:function(){var e=this;return e.editor.querySelectionInlineStyle(e.name)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(7),o=n(92),i=n(37),r=n(41);return{_container:null,getUrlInfoBeforeRange:function(e,t){var n,o,a=this,l=e.commonAncestorContainer,s={textNodeArray:[],endIndex:-1};if(i.isRangeInNode(t,e))return a._container=t,a._isInLinkElement(l)?o={alreadyUrl:!0}:(r.isElement(l)?(n=a._findLastTextNode(l))&&(s.endIndex=n.length):s.endIndex=e.endOffset,o=a._iteratorOfTextNodeBefore(s,l),a._container=null,o)},_iteratorOfTextNodeBefore:function(e,t){var n,o=this;if(r.isText(t))n=t;else{if(!r.isElement(t))return;n=o._findLastTextNode(t)}if(n)return e.textNodeArray.unshift(n),o._parseTextNodeObject(e)||o._iteratorOfTextNodeBefore(e,o._findPreviousNode(n))},_findPreviousNode:function(e){var t=this,n=e.previousSibling;return n?t._isUnvalidElement(n)?null:n:(e=e.parentNode,e?t._findPreviousNode(e):null)},_findLastTextNode:function(e){var t,n,o,i=this;if(e){if(r.isText(e))return e;if(0===(o=e.childNodes.length))return e=i._findPreviousNode(e),i._findLastTextNode(e);for(n=o-1;n>=0;n--)return t=e.childNodes[n],i._findLastTextNode(t)}return null},_parseTextNodeObject:function(e){var t,n,i,r,a,l="",s=e.textNodeArray[0].nodeValue,c=0,u="",d=e.endIndex,p=e.textNodeArray,h=e.textNodeArray.length;for(r=0;r<h-1;r++)u+=p[r].nodeValue;if(u+=p[h-1].nodeValue.slice(0,d),(t=o.matchEnd(u))&&t.result){for(i=t.result.index,a=0;a<h-1;a++){if(i-=l.length,l.length<=i&&s.length>i){c=a;break}l+=p[a].nodeValue,s+=p[a+1].nodeValue}n={uri:t.fullURI,startNode:p[c],startOffset:i,endNode:p[h-1],endOffset:d}}return n},_isUnvalidElement:function(e){var n,o,i=this;return!r.isText(e)&&(!r.isElement(e)||!t.contains(i._container,e)||(n=e.currentStyle||window.getComputedStyle(e,""),o="A"===e.nodeName,"block"===n.display||o))},_isInLinkElement:function(e){var n=this;if(t.contains(n._container,e)){for(;e&&e!==n._container;){if("A"===e.nodeName)return!0;e=e.parentNode}return!1}}}}.call(t,n,t,e))&&(e.exports=o)},,,,,,,function(e,t,n){var o;void 0!==(o=function(e){var t=n(0);return{getAsArray:function(){return[9,12,14,16,18,22,26,30,36,42]},getAsList:function(){var e=this,n=e.getAsArray(),o={};return t.each(n,function(e){o[e]=e}),o},getMin:function(){return this.getAsArray()[0]},getMax:function(){var e=this.getAsArray();return e[e.length-1]}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(38),n(3),n(27),n(17),n(1),n(109),n(6),n(114),n(258),n(112),n(25),n(259),n(2),n(60),n(154),n(33),n(34),n(19),n(10),n(20),n(153),n(108)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h,g,f,m,_,y,v,b,k,C,S,I,w){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.createBlank=function(e,n){var o=k.createBlank(e);return n||(n=new t({})),n.append(o),n},t.fromHtml=function(e,o,i,r){var a,l=c.parseHtml(e);return o||(o=new t({})),r=n.defaults(r||{},{isAsync:!1,progressCallBack:function(){}}),a=r.progressCallBack,t._parseHTMLInBatch(l,0,o,i,a,r.isAsync)?o:null},t.fromOCR=function(e,o,i){var r=c.parseOCR(e,i),a=0;return o=o||new t({}),n.each(r,function(e){e&&(o.append(e),a++)}),a?o:null},t.fromXml=function(e,o,i,r){var a,l,c,p,g,f,m={},b={};return o||(o=new t({})),r=n.defaults(r||{},{isAsync:!1,progressCallBack:function(){}}),f=r.progressCallBack,n.isString(e)?(e=d.clear(e),a=$.parseXML(e)):a=e,f({percent:.1}),o.setContentStatus(!0),s.log(a),l=$(a).find("note:first"),c=l.attr("schema-version"),c&&o.setSchemaVersion(c),p=parseInt(l.attr("file-version"),10),isNaN(p)&&(p=0),o.setFileVersion(p),l&&l.get(0)?(l.find("head").children().each(function(e,t){var n,i=t.nodeName;switch(i){case"list":n=v.fromXml(t),m[$(t).attr("id")]=n;break;case"catalogue-wrap":n=_.fromXml(t),b[$(t).attr("id")]=n;break;case"header":n=y.fromXml(t),o.setHeaderFooter(n,!1,!0);break;case"footer":n=y.fromXml(t),o.setHeaderFooter(n,!0,!0);break;default:n=$(t).attr(u.COMPAT),h.isCompatible(n)&&(n=t.cloneNode(!0),o.headUnknownNodeList.push(n))}}),f({percent:.15}),g=l.find("body").children(),t._parseXMLBodyInBatch(g,0,o,m,b,i,f,r.isAsync),o):(o.isBlank()&&o.append(k.createBlank()),f({percent:1}),o.setContentStatus(!1),o.updateContentParseTimer(null),o)},t.unescape=function(e){var t=document.createElement("span");return t.innerHTML=e,t.textContent},t._parseHTMLInBatch=function(e,o,i,r,a,l){var s,c,u,d=Date.now(),p=!1,h=i.getExtraInfo("pcTodoMap");if(null==e&&0===e.length)return a({percent:1}),i.updateContentParseTimer(null),!1;for(;o<e.length;)if(s=e[o],m.isImage(s)&&r&&r.length>0&&n.each(r,function(e){if(e.resId===s.getResId())return void s.setImageInfo(e)}),m.isTodo(s)&&s.isFromOldTodo()&&(u=s.getLegacyResId(),u&&h&&h[u]?(s.setText(t.unescape(JSON.parse(h[u]).content)),s.setChecked(JSON.parse(JSON.parse(h[u]).checked))):s=null),s&&(i.append(s),p=!0),o++,o>=e.length?(a({percent:1}),i.updateContentParseTimer(null)):a({percent:.15+o/e.length*.85}),l&&Date.now()-d>100){c=setTimeout(t._parseHTMLInBatch.bind(null,e,o,i,r,a,l),10),i.updateContentParseTimer(c);break}return p},t._parseXMLBodyInBatch=function(e,o,r,a,l,s,c,d){var p,_,y,v,b,k,C,S,w=Date.now();if(null==e||0===e.length)return c({percent:1}),r.updateContentParseTimer(null),void r.setContentStatus(!1);for(;o<e.length;){if(p=e[o],_=p.nodeName,y=f[_],v=$(p).attr(u.COMPAT),(!y&&h.isCompatible(v)||y&&v&&!h.isCompatible(v))&&(y=I),y&&y.fromXml){if(!(b=y.fromXml(p)))throw r.updateContentParseTimer(null),new Error("Failed to parse block from xml node!");for(k=g.parseResourceList(p),b.setResourceIds(k),m.isListItem(b)&&b.setOwnerList(a[$(p).attr("list-id")]),m.isImage(b)&&s&&s.length>0&&n.each(s,function(e){if(e.resId===b.getResId())return void b.setImageInfo(e)}),m.isCatalogue(b)&&b.setOwnerList(l[$(p).attr("catalogue-id")]),r.append(b),b.isValidForCollab()||r.setValidForCollab(!1),S=b.getId();r.originalBlockIds.indexOf(S)>-1;)S=i.newGUID();S!==b.getId()&&(r.setValidForCollab(!1),b.setId(S)),r.originalBlockIds.push(S)}if(++o>=e.length)c({percent:1}),r.setContentStatus(!1),r.updateContentParseTimer(null);else if(c({percent:.15+o/e.length*.85}),d&&Date.now()-w>100){C=setTimeout(t._parseXMLBodyInBatch.bind(null,e,o,r,a,l,s,c,d),10),r.updateContentParseTimer(C);break}}},t.prototype.append=function(e){this.insert(this.blocks.length,e)},t.prototype.clearHighlight=function(){this.trigger("clear-high-light")},t.prototype.countWords=function(e,t){var n,o,i=function(e){return!m.isHr(e)};return e&&(n=!0,o=this._parseWordCountInfo(e.getDataAsPlain(this,i))),(!e||!o.all&&t)&&(n=!1,o=this._parseWordCountInfo(this.toPlain(i))),{count:o.all,detail:o,isSelected:n}},t.prototype.findAttachmentByResource=function(e,t){return n.filter(this.blocks,function(n){return m.isAttachment(n)&&n.getResource(t)===e})},t.prototype.getAllBlocks=function(){return this.blocks},t.prototype.getAllResouceIds=function(){var e=[];return n.each(this.blocks,function(t){var n=t.getResourceIds();n&&n.length&&(e=e.concat(n))}),e=n.uniq(e)},t.prototype.getAllResourceInfo=function(e,t){var o,i,r,a,l=[];return e=e||this.blocks,t=t||[m.IMAGE,m.ATTACHMENT,m.HANDWRITE,m.TABLE],n.each(this.blocks,function(e){m.isAttachment(e)&&t.indexOf(m.ATTACHMENT)>-1||m.isHandWrite(e)&&t.indexOf(m.HANDWRITE)>-1?(o=e.getSource(!1),i=e.getSource(!0),r=e.getResource(!1),a=e.getResource(!0),o&&i&&r&&a&&l.push({extraResource:a,extraSource:i,resource:r,source:o})):m.isImage(e)&&t.indexOf(m.IMAGE)>-1?(o=e.getSource(!1),i=e.getSource(!0),o&&i&&l.push({blockId:e.getId(),extraSource:i,source:o})):m.isTable(e)&&t.indexOf(m.TABLE)>-1&&(l=l.concat(e.getAllResourceInfo()))}),l},t.prototype.getAttachmentByResource=function(e,t){return n.filter(this.blocks,function(n){return m.isAttachment(n)&&n.getResource(t)===e})},t.prototype.getBlockAt=function(e){return this.blocks[e]},t.prototype.getBlockById=function(e){return this.header&&e===this.header.getId()?this.header:this.footer&&e===this.footer.getId()?this.footer:n.find(this.blocks,function(t){return e===t.getId()})},t.prototype.getBlockIndex=function(e){return n.indexOf(this.blocks,e)},t.prototype.getBlockIndexById=function(e){var t,n=-1;return t=this.getBlockById(e),t&&(n=this.getBlockIndex(t)),n},t.prototype.getCommonInlineStyle=function(e,t){var o=this;if(e&&t){var i,r=e.getStartBlockRange(),a=e.getEndBlockRange(),l=r.block,s=a.block,c=null,d=[],p=!0;return this.isNonEmptyParaTable(l)&&(d.push(l.getCommonInlineStyle(t,r)),p=!1),(l!==s&&(i=this.getInterBlocks(l,s),n.each(i,function(e){o.isNonEmptyParaTable(e)&&(d.push(e.getCommonInlineStyle(t)),p=!1)}),this.isNonEmptyParaTable(s)&&(d.push(s.getCommonInlineStyle(t,a)),p=!1)),p)?(m.isTextBlock(l)&&(c=l.getInlineStyleForEmpty(t,!0)),c||S.getDefault(t)):(n.some(d,function(e){if(null===c)c=e;else if(null!=e&&c!==e)return c=u.INTERM,!0}),c)}},t.prototype.getExtraInfo=function(e){return e?(this.extraInfo||{})[e]:this.extraInfo},t.prototype.getHeaderFooter=function(e){return e?this.footer:this.header},t.prototype.getFileVersion=function(){return this.fileVersion},t.prototype.getImageBySource=function(e,t){return n.filter(this.blocks,function(n){return m.isImage(n)&&n.getSource(t)===e})},t.prototype.getInterBlocks=function(e,t,n){var o=this.blocks,i=this.getBlockIndex(e),r=this.getBlockIndex(t);return n?o.slice(i,r+1):o.slice(i+1,r)},t.prototype.getLastBlock=function(){return n.last(this.blocks)},t.prototype.getNextBlock=function(e){var t=this.getBlockIndex(e);if(t>=0)return this.getBlockAt(t+1)},t.prototype.getNoteId=function(){return this.noteId},t.prototype.getPreBlock=function(e){var t=this.getBlockIndex(e);if(t>0)return this.getBlockAt(t-1)},t.prototype.getRangeBlockStyle=function(e,t){if(e&&t){var o=e.getStartBlockRange(),i=e.getEndBlockRange(),r=o.block,a=i.block,l=this.getInterBlocks(r,a,!0),c=null;return e.isSingleTableSelected()?l[0]?l[0].getCommonBlockStyle(t,o):void s.warn("No table block find, need update noteRange"):(n.each(l,function(e){var n=e.getBlockStyle(t);c=null===c?n:c===n?c:u.INTERM}),c)}},t.prototype.getSchemaVersion=function(){return this.schemaVersion||h.getDefaultAsString()},t.prototype.hasHandWriteBlock=function(){var e=!1;return n.some(this.blocks,function(t){return m.isHandWrite(t)&&(e=!0),e}),e},t.prototype.highlight=function(e,t){var o,i,r=[];t=n.defaults(t||{},{ignoreCase:!1}),e&&e.length&&(o=[],n.each(e,function(e){if(e&&!/\s/.test(e)){var t=new C({text:e});o.push(t)}}),o=o.length?o:null),i=this.blocks.slice(),this.header&&i.unshift(this.header),this.footer&&i.push(this.footer),n.each(i,function(e){(null!=o||null!=t.images&&t.images.length>0&&(m.isImage(e)||m.isTable(e)))&&e.highlight(o,t,function(e){r.push(e)})}),this.trigger("high-light",r),n.isFunction(t.callback)&&t.callback(r.length)},t.prototype.insert=function(e,t){if(!t)throw new Error("cannot insert null block");this.blocks.splice(e,0,t),this._bindEventsForBlock(t),t.trigger("attached",this),this.trigger("insert-block",e,t)},t.prototype.isBlank=function(){return!this.blocks||0===this.blocks.length},t.prototype.isEmptyContent=function(){var e,t=this.blocks;return!!(t&&1===t.length&&(e=t[0])&&e.isEmptyContent)&&e.isEmptyContent()},t.prototype.isParsingData=function(){return null!=this.contentParseTimer},t.prototype.isReadOnly=function(){return this.readOnly},t.prototype.isSameNote=function(e){return e===this.noteId},t.prototype.isSameList=function(e,t){var n,o,i,r,a,l,c,u,d,p;if(!e)return s.error("isSameList:noteRange should not be null"),!1;for(n=e.getStartBlockRange(),o=e.getEndBlockRange(),i=n.block,r=o.block,a=this.getInterBlocks(i,r,!0),p=a.length,l=0;l<p;l++)if((c=a[l])instanceof k){if(!(c instanceof b))return!1;if(u=c.getOwnerList(),u.getType()!==t)return!1;if(d){if(d!==c.getOwnerList())return!1}else d=u}return!!d},t.prototype.isValidForCollab=function(){return this.validForCollab},t.prototype.lastBlockIsEasyInput=function(){var e=this.getLastBlock();return m.isTextBlock(e)},t.prototype.lockBlock=function(e,t){this._setBlockLocked(e,!0,t)},t.prototype.nextHighlight=function(){this.trigger("next-high-light")},t.prototype.preHighlight=function(){this.trigger("pre-high-light")},t.prototype.remove=function(e,t){var n=this.blocks.splice(e,1)[0];n&&(n.trigger("detached",this),this._unbindEventsForBlock(n),this.trigger("remove-block",e,t))},t.prototype.removeBlock=function(e){this.remove(this.getBlockIndex(e))},t.prototype.removeBlockById=function(e,t){this.remove(this.getBlockIndexById(e),t)},t.prototype.replace=function(e,t){var n=this.blocks.splice(e,1,t)[0];return n?(n.trigger("detached",this),this._unbindEventsForBlock(n)):s.warn("oldBlock should not be null"),t&&(this._bindEventsForBlock(t),t.trigger("attached",this)),this.trigger("replace-block",e,t,n),n},t.prototype.reset=function(){this.destroy(),this.noteId=i.newGUID(),this.headUnknownNodeList=[],this.blocks=[],this.originalBlockIds=[],null!=this.contentParseTimer&&(clearTimeout(this.contentParseTimer),this.contentParseTimer=null),this.header=null,this.footer=null},t.prototype.setExtraInfo=function(e){this.extraInfo=e,this._triggerExtraInfoChange()},t.prototype.setExtraInfoWithKey=function(e,t,n,o){var i=this.extraInfo,r=i[e];i||(i={},o=!0),r||(i[e]=r={}),r[t]=n,!0===o?this.setExtraInfo(i):this.extraInfo=i},t.prototype.setFileVersion=function(e){this.fileVersion=e},t.prototype.setHeaderFooter=function(e,t,n){t?this.footer=e:this.header=e,n&&this.trigger("header-footer-changed",t)},t.prototype.setReadOnly=function(e){(e=!!e)!==this.readOnly&&(this.readOnly=e,this.trigger("read-only-change",e),n.each(this.blocks,function(t){t.setReadOnly(e)}))},t.prototype.setContentStatus=function(e){this.contentStart=e},t.prototype.getContentStatus=function(){return this.contentStart},t.prototype.setSchemaVersion=function(e){if(h.isLessThanDefault(e))return void s.warn("schema version is older than current, need upgrade!");this.schemaVersion=e||h.getDefaultAsString()},t.prototype.setValidForCollab=function(e){this.validForCollab=e},t.prototype.toHtml=function(e,t){var n,o,i,r,a,l,s,c,u,d,p,h,g,f,_,y=this.blocks,v=y.length,b=[],k=[];for(t=!0===t,e?(l=e.getStartBlockRange(),s=e.getEndBlockRange(),c=l.block,u=s.block,d=this.getBlockIndex(c),p=this.getBlockIndex(u),_=e.isInSingleBlock()):(d=0,p=v-1),o=d;o<=p;o++)f=null,h=o===d,g=o===p,n=y[o],h&&l?(f=l,_||(f=f.clone(),f.expandToEnd())):g&&s&&(f=s,_||(f=f.clone(),f.expandToStart())),m.isListItem(n)||m.isCatalogue(n)?(a=n.getOwnerList(),r&&r!==a&&k.length&&(i=this._toHtmlWithSameOwnerList(k,t),b.push(i),k=[]),k.push({block:n,range:f||null}),r=a):(r=null,k.length&&(i=this._toHtmlWithSameOwnerList(k,t),b.push(i),k=[]),i=f?f.getDataAsHtml(t):n.toHtml(null,null,t),b.push(i));return k.length&&(i=this._toHtmlWithSameOwnerList(k,t),b.push(i)),b.join("")},t.prototype.toPlain=function(e){var t=e?n.filter(this.blocks,e):this.blocks;return n.map(t,function(e){return e.toPlain()}).join("\n")},t.prototype.toXml=function(){var e,t,i,r,a,l,c,u="http://"+w.getNamespace(),d=this._createXMLDocument(u,"note"),p=d.createElement("head"),h=d.createElement("body"),g={},f=this.getSchemaVersion(),m=this.getFileVersion(),_=d.documentElement,y=[];return _.appendChild(p),_.appendChild(h),f&&_.setAttribute("schema-version",f),_.setAttribute("file-version",m.toString()),n.each(this.blocks,function(e){var t,o,i,r,a,l;e&&e.toXml&&(t=e.toXml(d)),t?t.listItem?(o=t,h.appendChild(o.listItem),r=o.listId,g[r]||(g[r]=!0,i=d.createElement("list"),a=o.ownerList.unknownAttrs,n.each(a,function(e){var t=e.cloneNode(!0);i.setAttributeNode(t)}),i.setAttribute("id",r),i.setAttribute("type",o.listType),p.appendChild(i))):("catalogue"===t.tagName&&(l=t.getAttribute("catalogue-id"),-1===y.indexOf(l)&&y.push(l)),h.appendChild(t)):s.warn("block.toXml() failed!")}),n.each(this.headUnknownNodeList,function(e){if(e&&e.cloneNode){var t=e.cloneNode(!0);p.appendChild(t)}}),c=p.querySelectorAll("catalogue-wrap"),n.each(c,function(e){p.removeChild(e)}),n.each(y,function(e){e&&(l=d.createElement("catalogue-wrap"),l.setAttribute("id",e),l.setAttribute("compat","true"),p.appendChild(l))}),t=this.getHeaderFooter(!1),i=this.getHeaderFooter(!0),t&&(e=t.toXml(d))&&p.appendChild(e),i&&(e=i.toXml(d))&&p.appendChild(e),r=new XMLSerializer,a=r.serializeToString(d),o.startsWith(a,"<?xml")||(a='<?xml version="1.0"?>\n'+a),a},t.prototype.unlockBlock=function(e){this._setBlockLocked(e,!1)},t.prototype.updateContentParseTimer=function(e){this.contentParseTimer!==e&&(clearTimeout(this.contentParseTimer),this.contentParseTimer=e),null==e&&this.trigger("content-parse-done")},t.prototype.initialize=function(){this.extraInfo={},this.noteId=i.newGUID(),this.blocks=[],this.originalBlockIds=[],this.headUnknownNodeList=[],this.schemaVersion=h.getDefaultAsString(),this.fileVersion=0},t.prototype.destroy=function(){var e=this;n.each(e.blocks,function(t){e._unbindEventsForBlock(t)}),e.blocks=null,e.readOnly=!1,e.validForCollab=!0},t.prototype.isNonEmptyParaTable=function(e){return e instanceof k&&!e.isEmpty()||m.isTable(e)&&!e.isEmptyContent()},t.prototype._bindEventsForBlock=function(e){var t;e&&(this._unbindEventsForBlock(e),t=this._listenerEventsForBlock(),a.addListeners(t,e,this),t=this._bubbleEventsForBlock(e),a.bubble(t,e,this))},t.prototype._bubbleEventsForBlock=function(e){var t={};return m.isTable(e)&&(t=n.extend(t,{"color-picker-show":!0,"get-block-view":!0,"yne-user-action-collection":!0})),t},t.prototype._listenerEventsForBlock=function(){return{"get-default-set-font":"_onGetDefaultSetFont","get-extra-info":"_onGetExtraInfo"}},t.prototype._onGetDefaultSetFont=function(e){this.trigger("get-default-set-font",function(t){e(t)})},t.prototype._onGetExtraInfo=function(e,t){t(this.getExtraInfo(e))},t.prototype._parseCataloguesToHtml=function(e){var t,n,o,i=document.createElement("div"),r=document.createElement("div"),a="";for(o=0;o<e.length;o++)t=e[o],n=t.block,a+=n.toHtml();return i.setAttribute("yne-bulb-type","catalogue-wrap"),i.innerHTML=a,r.setAttribute("yne-bulb-type","catalogue-wrap-container"),r.style.backgroundColor=n.getBlockStyle("back-color"),r.appendChild(i),r.outerHTML},t.prototype._parseWordCountInfo=function(e){var t=/[A-z0-9~!@#$%^&*()_+{}|:"<>?`\-=[\]\\;',.\/]+/g,n=/[\u4e00-\u9fa5\u3002\uff1b\uff0c\uff1a\u201c\u201d\uff08\uff09\u3001\uff1f\u300a\u300b]/g,o=/\s+/g,i=e.match(t),r=e.match(n),a=e.replace(t,"").replace(o,""),l=a.length,s=r?r.length:0,c=i?i.length:0,u=l-s;return{all:s+c+u,chinese:s,nonChinese:c+u}},t.prototype._parseListItemsToTree=function(e){var t,n,o,i,r,a,l,s,c,u=new p(0),d=e.length;for(r=u,t=0;t<d;t++){if(n=e[t],o=n.block,i=n.range||{},s=o.getLevel(),l=new p(s,o,i.start,i.end),(c=s-r.getLevel())>1)for(;s-r.getLevel()>1;)a=new p(r.getLevel()+1),r.addChildNodes([a]),r=a;else if(c<1)for(;s-r.getLevel()<1;)r=r.getParentNode();r.addChildNodes([l]),r=l}return u},t.prototype._setBlockLocked=function(e,t,o){var i,r=this;i=n.isArray(e)?e:[e],n.each(i,function(i){var a;if(!(a=n.isString(i)?r.getBlockById(i):i))return void s.log("BlockLock: skip non-existing block",e);a.setLocked(t,o)})},t.prototype._toHtmlWithSameOwnerList=function(e,t){var o,i,r=n.first(e).block;return m.isListItem(r)?(o=this._parseListItemsToTree(e))&&(i=o.toHtml(!0===t)):m.isCatalogue(r)&&(i=this._parseCataloguesToHtml(e)),i||""},t.prototype._triggerExtraInfoChange=function(){n.each(this.blocks,function(e){e.trigger("extra-info-change")})},t.prototype._unbindEventsForBlock=function(e){if(e){var t=function(t){t&&n.each(t,function(t,n){e.off(n)})};t(this._listenerEventsForBlock()),t(this._bubbleEventsForBlock(e))}},t.prototype._createXMLDocument=function(e,t){var n=document.implementation.createDocument(e,t,null);return n.createElement=function(e){return this.createElementNS(this.documentElement.namespaceURI,e)},n},t}(l)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(223),i=n(148),r=n(251);return function(e,n){return t||(t=new o(i),t.define(".MsoListParagraph",r,o.PRIORITY.HIGH)),t.parse(e,n)}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(58)],void 0!==(i=function(e,t,n){"use strict";return n({DEFAULT_FONT:"Microsoft YaHei"})}.apply(t,o))&&(e.exports=i)},function(e,t,n){"use strict";var o;void 0!==(o=function(){return function(e){var t,n=0;return e?(t="string"==typeof e?e:e.toString(),n=t.replace(/(\s)/g,"").length):n}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(28)],void 0!==(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.getRules=function(t){var o=t?n.clone(t):{};return n.defaults(o,e.DEFAULT_RULES),o},e.convertToCssStyle=function(t,o,i){var r={},a=e.getRules(i);return n.isArray(o)&&(a=n.pick(a,o)),n.isObject(t)&&n.each(a,function(e,n){r[n]=e(t)}),r},e.DEFAULT_RULES={"font-size":function(e){var t=e["font-size"];if(null!=t)return t+"px"},"font-family":function(e){var t=e["font-family"];return t=o.getAllValueByFont(t)||t},color:function(e){return e.color},"background-color":function(e){return e["back-color"]},"font-weight":function(e){return{true:"bold",false:"normal"}[e.bold+""]},"font-style":function(e){return{true:"italic",false:"normal"}[e.italic+""]},"text-decoration":function(e){if(!1===e.underline&&!1===e.strike)return"none";var t=[];return e.underline&&t.push("underline"),e.strike&&t.push("line-through"),t.join(" ")||""}},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";return function(e,t){if(null!=String.prototype.codePointAt)return String.prototype.codePointAt.call(e,t);if(null===e||void 0===e)throw new TypeError("codePointAt第一个参数必须为String");e=String(e);var n,o,i=e.length,r=isNaN(t)?0:Number(t);return r<0||r>=i?void 0:(n=e.charCodeAt(r),n>=55296&&n<=56319&&i>r+1&&(o=e.charCodeAt(r+1))>=56320&&o<=57343?1024*(n-55296)+o-56320+65536:n)}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(141),n(58),n(22)],void 0!==(i=function(e,t,n,o,i){"use strict";var r={BACK_COLOR:"transparent",COLOR:"#000000"};return o({bold:{key:"b",default:!1,type:"Boolean"},italic:{key:"i",default:!1,type:"Boolean"},underline:{key:"u",default:!1,type:"Boolean"},strike:{key:"s",default:!1,type:"Boolean"},"font-family":{key:"ff",default:n.DEFAULT_FONT,type:"String"},"font-size":{key:"fs",default:14,type:"Number"},color:{key:"cl",default:r.COLOR,type:"String",equalDefault:function(e){return e===r.COLOR||i.equals(e,r.COLOR)}},"back-color":{key:"bc",default:r.BACK_COLOR,type:"String",equalDefault:function(e){return e===r.BACK_COLOR||i.equals(e,r.BACK_COLOR)}},href:{key:"href",default:"",type:"String"}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(144)],void 0!==(i=function(e,t,n){"use strict";return function(e){var t,o=[];for(t=0;t<e.length;t++)n(e,t)>65535?(o.push(e.slice(t,t+2)),t++):o.push(e[t]);return o}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(20)],void 0!==(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.add=function(t){t&&!o.isSupport(t)&&(n.contains(e.unknownInlineStyleNames,t)||e.unknownInlineStyleNames.push(t))},e.get=function(){return e.unknownInlineStyleNames},e.reset=function(){e.unknownInlineStyleNames=[]},e.unknownInlineStyleNames=[],e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(231),i=n(232),r=n(233),a={a:r.AnchorHandler,abbr:r.InlineHandler,acronym:r.InlineHandler,address:r.ParagraphHandler,applet:!1,area:!1,article:r.ParagraphHandler,aside:r.ParagraphHandler,audio:!1,b:r.InlineHandler,base:!1,basefont:!1,bdi:r.InlineHandler,bdo:r.InlineHandler,bgsound:!1,big:r.InlineHandler,blink:r.InlineHandler,blockquote:r.ParagraphHandler,body:r.ParagraphHandler,br:r.BreakHandler,button:!1,canvas:!1,center:r.ParagraphHandler,cite:r.InlineHandler,code:r.InlineHandler,command:!1,content:!1,data:!1,datalist:!1,dd:r.ParagraphHandler,del:r.InlineHandler,details:r.ParagraphHandler,dfn:r.InlineHandler,dialog:!1,dir:r.InlineHandler,div:r.ParagraphHandler,dl:r.ParagraphHandler,dt:r.ParagraphHandler,element:!1,em:r.InlineHandler,embed:!1,fieldset:r.ParagraphHandler,figcaption:r.ParagraphHandler,figure:r.ParagraphHandler,font:r.InlineHandler,footer:r.ParagraphHandler,form:r.ParagraphHandler,frame:!1,frameset:!1,h1:r.ParagraphHandler,h2:r.ParagraphHandler,h3:r.ParagraphHandler,h4:r.ParagraphHandler,h5:r.ParagraphHandler,h6:r.ParagraphHandler,header:r.ParagraphHandler,hgroup:r.ParagraphHandler,hr:r.HrHandler,html:r.ParagraphHandler,i:r.InlineHandler,iframe:!1,image:!1,img:r.ImageHandler,input:r.TodoHandler,ins:r.InlineHandler,isindex:!1,kbd:r.InlineHandler,keygen:!1,label:r.InlineHandler,legend:r.ParagraphHandler,li:r.ListItemHandler,link:!1,listing:!1,main:r.ParagraphHandler,map:!1,mark:r.InlineHandler,marquee:r.ParagraphHandler,menu:!1,menuitem:!1,meta:!1,meter:r.InlineHandler,multicol:r.ParagraphHandler,nav:r.ParagraphHandler,nobr:r.InlineHandler,noembed:!1,noframes:!1,noscript:!1,object:!1,ol:r.ListHandler,optgroup:!1,option:!1,output:r.InlineHandler,p:r.ParagraphHandler,param:!1,picture:!1,plaintext:r.ParagraphHandler,pre:r.ParagraphHandler,progress:!1,q:r.InlineHandler,rp:r.InlineHandler,rt:r.InlineHandler,rtc:r.InlineHandler,ruby:r.ParagraphHandler,s:r.InlineHandler,samp:r.InlineHandler,script:!1,section:r.ParagraphHandler,select:!1,shadow:!1,small:r.InlineHandler,source:!1,spacer:!1,span:r.InlineHandler,strike:r.InlineHandler,strong:r.InlineHandler,style:!1,sub:r.InlineHandler,summary:r.ParagraphHandler,sup:r.InlineHandler,table:r.TableHandler,template:!1,textarea:r.ParagraphHandler,time:r.InlineHandler,title:!1,track:!1,tt:r.InlineHandler,u:r.InlineHandler,ul:r.ListHandler,var:r.InlineHandler,video:!1,wbr:!1,xmp:!1},l=function(e,n){e&&e.length&&t.each(e,function(e){null==n[e]&&(n[e]=!1)})};return l(o,a),l(i,a),a}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(88),i=n(61),r=n(74),a=n(150),l=n(45),s=n(0);return t=o.extend({inheritStyleHandlers:!1,uninheritStyleHandlers:{width:!0,float:!0},inheritBlockStyles:{align:!0},_handleNoteLink:function(){var e,t,n,o=this,i=o.el;e=i.getAttribute("data-attr-noteid"),t=i.getAttribute("alt"),e&&t&&(n=o.parent&&o.parent.styles?s.clone(o.parent.styles):{},n.href="note://"+e,n.color="#003884",n.underline=!0,o.emit({text:t,styles:n,isText:!0}))},_handleNoteTodo:function(){var e=this,t=e.el,n=t.getAttribute("data-res-todo"),o=new l({legacyResId:n});e.emit(o)},finish:function(){var e,n,o,l,c,u=this,d=u.el,p=d.getAttribute("src"),h=function(e,t){s.each(e,function(e,n){var o=t.style[e];o&&(u.styles[n]=o)})};return t.isNoteLink(d)?void u._handleNoteLink():t.isTodo(d)?void u._handleNoteTodo():void(p&&(o=d.parentNode,o&&(l=o.getAttribute("yne-bulb-block")),t.isAttachment(d)?(n=d.getAttribute("path"),e=new r({source:p,resource:n,fileName:t.getAttachmentFileName(d),fileLength:t.getAttachmentFileLength(d)}),"attachment"===l&&h({align:"textAlign",float:"float"},o)):t.isImage(d)?("image"===l&&h({align:"textAlign",width:"width",float:"float"},o),e=new i({source:p}),u.styles.width&&u.styles.width>620&&(u.styles.width=620)):t.isHandWrite(d)&&(c=d.getAttribute("data-res-handwrite"),e=c?new a({source:p,resource:c}):new i({source:p})),e&&(e.setStyles(u.styles),u.emit(e))))}},{isAttachment:function(e){var t=e.getAttribute("path"),n=e.dataset.mediaType;return t&&("attachment"===n||!n)},isImage:function(e){var t=e.dataset.mediaType,n=e.getAttribute("path"),o=["image"];return!n&&(!t||o.indexOf(t)>-1)},isHandWrite:function(e){return"handwrite"===e.dataset.mediaType},isNoteLink:function(e){return"notelink"===e.dataset.mediaType},isTodo:function(e){return"todo"===e.dataset.mediaType},getAttachmentFileName:function(e){return e.getAttribute("filename")||e.getAttribute("alt")||e.getAttribute("title")||""},getAttachmentFileLength:function(e){return e.getAttribute("filelength")||""}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(52),n(25),n(2)],void 0!==(i=function(e,t,n,o,i,a){"use strict";return function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.fromXml=function(e){throw new Error("HandWrite do NOT support fromXml till now")},t.fromJSON=function(e){if(!(e&&e.type&&e.type===a.HANDWRITE&&e.source&&e.resource))throw new Error("jsonObj or jsonObj.source/resource does NOT exist!");var n=new t({resource:e.resource,source:e.source});return e.blockId&&n.setId(e.blockId),n},t.prototype.getSource=function(e){var t,n=this,o=n.handWriteProps.source;return!0===e&&(t=n.getExtraInfo("pcResMap"))&&t[o]&&(o=t[o]),o},t.prototype.getResource=function(e){var t,n=this,o=n.handWriteProps.resource;return!0===e&&(t=n.getExtraInfo("pcResMap"))&&t[o]&&(o=t[o]),o},t.prototype.setStyles=function(){},t.prototype.toHtml=function(e,t,n){var i=this,r=o("",document,!0,!0),a=r.ownerDocument,l=a.createElement("div"),s=$(l),c=$(a.createElement("img"));return s.attr("yne-bulb-block","handwrite"),c.attr({"data-media-type":"handwrite","data-res-handwrite":i.handWriteProps.resource,src:i.getSource(n)}),s.append(c),l.outerHTML},t.prototype.toJSON=function(){var t=this,n=e.prototype.toJSON.call(this);return n.source=t.getSource(!1),n.resource=t.getResource(!1),n},t.prototype.toPlain=function(){return""},t.prototype.toXml=function(){throw new Error("HandWrite do NOT support toXml till now")},t.prototype.initialize=function(t){var o=this;if(null==t||null==t.source||null==t.resource)throw new Error("props and props.source and props.resource  cannot be null");e.prototype.initialize.apply(o,[t]),o.handWriteProps=n.clone(t),o.type=a.HANDWRITE},t}(i)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(50),i=n(33),r=n(34),a=n(0),l=n(3);return t=o.extend({list:null,level:null,type:null,_itemCounter:null,prevSimilar:null,inheritStyleHandlers:{bold:!0,italic:!0,underline:!0,strike:!0,"font-family":!0,"font-size":!0,color:!0,"back-color":!0,"white-space":!0,align:!0,"line-height":!0,indent:!0,"text-indent":!0},_parseTypeFromElement:function(){return"ul"===this.el.tagName.toLowerCase()?i.UNORDERED:i.ORDERED},_getStartIndexFromElement:function(){var e=this,t=e.type,n=e.el,o=-1;return t!==i.ORDERED?o:("list"===n.getAttribute("yne-block-type")&&(o=parseInt(n.getAttribute("start"),10),isNaN(o)&&(o=-1)),o)},increaseItemCounter:function(){var e,t=this,n=t.prevSimilar;n&&n.increaseItemCounter?n.increaseItemCounter():(e=t._itemCounter||0,e+=1,t._itemCounter=e)},getItemCounter:function(){var e=this,t=e.prevSimilar;return t?t.getItemCounter():e._itemCounter||0},setup:function(){var e,t,n,o=this,r=o._findParentListHandler();o.list=null,o.level=1,r&&(o.level=r.level+1),n=o._parseTypeFromElement(),o.type=n,t=o._getStartIndexFromElement(),t>1&&(e=o._getPreviousSimilar())&&e.getItemCounter()===t-1&&(o.prevSimilar=e,o.list=e.list),o.list||(o.list=new i({type:n,listId:l.newGUID()}))},capture:function(e){var t=this,n=t.level;e instanceof r&&e.getLevel()<n&&e.setLevel(n),t.emit(e)},_findParentListHandler:function(){for(var e=this.parent;e;){if(e instanceof t)return e;e=e.parent}},_getPreviousSimilar:function(){var e,n=this,o=n.level,i=n.type,r=n.parent,l=r.children;return a.some(l,function(n){if(n instanceof t&&n.level===o&&n.type===i)return e=n,!0}),e}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(1);return{appendText:function(e,n,o,i){if(!(e&&n&&o&&i))return void t.warn("unvalid parameters");var r=e.createElement(o),a=e.createTextNode(i);r.appendChild(a),n.appendChild(r)}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(3),n(25),n(2)],void 0!==(i=function(e,t,n,o,i,a){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.fromJSON=function(){},t.fromXml=function(e){var n=new t({xmlNode:e});return n.parseIdFromXml(e),n},t.prototype.countWords=function(){return 0},t.prototype.setBlockStyle=function(){},t.prototype.setBlockStyles=function(){},t.prototype.getBlockStyles=function(){return null},t.prototype.getBlockStyle=function(){return null},t.prototype.getDefaultBlockStyles=function(){return null},t.prototype.toJSON=function(){return null},t.prototype.toHtml=function(){return""},t.prototype.toPlain=function(){return""},t.prototype.toXml=function(e){var t,r,a=!1;return n.some(this.unknownProps.xmlNode.childNodes,function(e){return e.nodeName===i.TAG_ID_NAME&&(a=!0),a}),a||(t=e.createElement(i.TAG_ID_NAME),r=e.createTextNode(o.newGUID()),t.appendChild(r),this.unknownProps.xmlNode.appendChild(t)),this.unknownProps.xmlNode},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.unknownProps=n.clone(t),this.type=a.UNKNOWN},t}(i)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(29),n(25),n(2)],void 0!==(i=function(e,t,n,o,i){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.createBlank=function(e){return new t({content:"",isFooter:!0===e})},t.format=function(e,t){return e?(t=t||{},null!=t.pageIndex&&(e=e.replace(/:p/,t.pageIndex+1)),t.pageCount&&(e=e.replace(/:n/,t.pageCount)),e):e},t.fromXml=function(e){var o=$(e),i=o.find(">text").text(),r=o.find("styles>align").text(),a=new t({align:r,content:i,isFooter:"footer"===e.nodeName});return o.children().each(function(e,t){switch(t.nodeName){case"text":break;case"styles":$(t).children().each(function(e,o){"align"!==o.nodeName&&n.appendToTree(a.unknownStyles,t)});break;default:n.appendToTree(a.unknownTree,t)}}),a},t.parse=function(e,t){return e.replace(/\d+/,function(e){return parseInt(e,10)===t.pageIndex+1?":p":e}).replace(/\d+/,function(e){return parseInt(e,10)===t.pageCount?":n":e})},t.prototype.getAlign=function(){return this.align},t.prototype.getBlockStyle=function(e){if("align"===e)return this.getAlign()||"center"},t.prototype.getContent=function(e,n){return t.format(this.content,n)},t.prototype.getInfo=function(){return{align:this.getAlign(),content:this.getContent(),isFooter:this.isFooter}},t.prototype.setAlign=function(e){this.align=e},t.prototype.setContent=function(e){this.content=e},t.prototype.setContentAndStyle=function(e,t){null!=e&&(this.content=e),null!=t&&(this.align=t),this.trigger("change",e,t)},t.prototype.toCollabJSON=function(){return{headerFooterInfo:this.getInfo()}},t.prototype.toXml=function(e){var t,o=this.isFooter?"footer":"header",i=e.createElement(o),r=e.createElement("styles"),a=e.createElement("text"),l=e.createTextNode(this.getContent());return a.appendChild(l),i.appendChild(a),t=e.createElement("align"),t.appendChild(e.createTextNode(this.getAlign())),r.appendChild(t),n.appendToXml(this.unknownStyles,r),i.appendChild(r),n.appendToXml(this.unknownTree,i),i.setAttribute("compat","true"),i},t.prototype.initialize=function(t){t=t||{isFooter:!1,content:"",align:"center"},e.prototype.initialize.call(this,t),this.type=i.HEADER_FOOTER,this.blockId=t.isFooter?"footer-fixed-id":"header-fixed-id",this.content=t.content||"",this.align=t.align||"center",this.isFooter=!0===t.isFooter,this.unknownTree={},this.unknownStyles={}},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(9),o=n(4),i=n(6),r=n(1),a=n(14),l=n(42),s=n(3),c=t.extend({name:"ManagerAdapter",effected:!0,_block:null,_dataBefore:null,_dataAfter:null,_args:null,initialize:function(e){var t,n=this;e.args=e.args||{},n._args=e.args,c.__super__.initialize.apply(n,arguments),s.isCollabCommand(n._args)||(n._block=e.block,n._dataBefore=e.dataBefore,n._dataAfter=e.dataAfter,(t=n._args.range)&&t.clone&&(n.setStartingRange(t),n.setEndingRange(t.clone(!0))))},apply:function(){var e=this,t=e._args,n=t.collabProperties||{},o=n.coreEditor;o.isCollabEnabled()&&n.isCollabCmd&&(e._block?e._NeedToSetData(o)&&e._block.setInnerData(e._dataAfter):(n.dataCmdError="Table block has been deleted",n.isOwnCmd&&o.notifyErrorToHost(i.INVALIDACTION_BLOCKS_DIRTY,n.coreEditor),e.effected=!1))},doReapply:function(e){var t,n,o=this,r=o._block,a=e.collabProperties,l=a.coreEditor;if(r&&(t=r.getInnerCommandManager()),!l.isCollabEnabled())return void(t&&t.redo());a.redoUndoEffected=!0,a.isCollabCmd?r?(r.setInnerData(o._dataAfter),a.isOwnCmd&&t&&(n=t.redoStack.pop())&&t.undoStack.push(n)):(a.dataCmdError="Table block has been deleted",a.isOwnCmd&&a.coreEditor.notifyErrorToHost(i.INVALIDACTION_BLOCKS_DIRTY,l),a.redoUndoEffected=!1):t&&t.redo()},sendInfoToInner:function(e){var t=this,n=t._block;if(!n||!n.sendInfoToInner)return void r.error("The block or sendInfoToInner() method is not valid!");n.sendInfoToInner(e)},doUnapply:function(e){var t,n,o=this,r=o._block,a=e.collabProperties||{},l=a.coreEditor;if(r&&(t=r.getInnerCommandManager()),!l.isCollabEnabled())return void(t&&t.undo());a.isCollabCmd?r?(r.setInnerData(o._dataBefore),a.isOwnCmd&&t&&(n=t.undoStack.pop())&&t.redoStack.push(n)):(a.dataCmdError="Table block has been deleted",a.isOwnCmd&&l.notifyErrorToHost(i.INVALIDACTION_BLOCKS_DIRTY,l),a.redoUndoEffected=!1):t&&t.undo()},fromCollabJSON:function(){var e=this,t=e._args,n=t.collabProperties,o=n.cmdJSON,i=n.coreEditor,r=i.getBlockById(o.blockId);e._block=r,e._dataBefore=o.dataBefore,e._dataAfter=o.dataAfter,c.__super__.fromCollabJSON.apply(e)},getBlockId:function(){var e=this,t=null;return e._block&&(t=e._block.getId()),t},toCollabJSON:function(){var e,t=this,n=t._block.getId();return t.rangeIsRequired=!1,e=c.__super__.toCollabJSON.apply(t),e.blockId=n,e.dataBefore=t._dataBefore,e.dataAfter=t._dataAfter,e},_NeedToSetData:function(e){var t=this,n=t._args.collabProperties||{},o=e.getLastNotOwnExecCmd(),i=!0;return n.isOwnCmd&&(o?o.name!==t.name?(r.log(t.name+": lastNotOwnCmd.name is "+o.name),i=!1):t._block.getId()!==t.getBlockId()?(r.log(t.name+": lastNotOwnCmd do NOT operate same table"),i=!1):t.getCmdOriginalNoteVersion()!==o.getCmdOriginalNoteVersion()?(r.log(t.name+": lastNotOwnCmd originalNoteVersion NOT same"),i=!1):r.log(t.name+": Need to set data again to resolve conflict"):(r.log(t.name+": lastNotOwnCmd is null"),i=!1)),i}},{create:function(e,t,n){var o,i,s={};return e&&e.getInnerCommandManager&&e.setInnerData?(o=new l({block:e}),i=new a({startRange:o,endRange:o}),s.range=i,new c({args:s,block:e,dataBefore:t,dataAfter:n})):void r.error("The block is not valid: ",e)}});return o.add(c),c}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(15),o=n(6),i=n(3),r=n(1);return t.extend({name:"UnknownCommand",isSimple:!1,cmdError:null,cmdId:null,isCollabRedo:!1,isCollabUndo:!1,rangeIsRequired:null,initialize:function(){var e=this,t=e.options.args||{};i.isCollabCommand(t)?e.fromCollabJSON(t.collabProperties.cmdJSON):e.cmdId=i.newGUID()},apply:function(){throw"Method not implemented."},doReapply:function(){throw"Method not implemented."},doUnapply:function(){throw"Method not implemented."},fromCollabJSON:function(){var e,t=this,n=t.options.args,o=n.collabProperties.cmdJSON;e=o.cmdId,null!=e?t.cmdId=o.cmdId:r.debugAlert("cmdJSON.cmdId should NOT be null")},getCmdId:function(){var e=this.cmdId;return null==e&&r.debugAlert("cmdId should NOT be null"),e},setCollabRedo:function(e){this.isCollabRedo=e},setCollabUndo:function(e){this.isCollabUndo=e},toCollabJSON:function(){var e=this,t={};return t[o.CJSON_ACTION]=e.name,t.cmdId=e.getCmdId(),t}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(0),i=n(18),r=n(4),a=n(42),l=n(3);return t=i.extend({name:"atom.SetTableCellInlineStyle",_table:null,_rect:null,_type:null,effected:!1,_oldStyles:{},_styles:null,initialize:function(){var e=this,n=e.options.args;e._oldStyles={},l.isCollabCommand(n)||(e._table=e.options.table,e._styles=e.options.styles,e._rect=e.options.rect,e._type=e.options.type,e._toggle=e.options.toggle),e.type===a.TYPES.ALL&&(e._rect=e._rect||{top:0,left:0,width:e._table.getColumnCount(),height:e._table.getRowCount()}),t.__super__.initialize.apply(e)},apply:function(){var e,t,n,i,r,l=this._table,s=this._rect,c=this._styles||{},u=this._toggle,d=s.top+s.height,p=s.left+s.width;if(!s)return this.effected;if(u){if(i=a.create({block:l,type:a.TYPES.NORMAL,rect:s})){if(!(r=i.getAsRectRange()))return this.effected;e=l.getCommonInlineStyle(u,r)}c[u]=null==e||!e}for(t=s.top;t<d;t++)for(n=s.left;n<p;n++)this._oldStyles[t+"-"+n]=l.getCellInlineStyles({row:t,col:n,names:o.keys(c)}),l.setCellInlineStyles({row:t,col:n,styles:c})&&(this.effected=!0);return this.effected},doUnapply:function(){var e,t,n=this._table,o=this._rect,i=o.top+o.height,r=o.left+o.width;for(e=o.top;e<i;e++)for(t=o.left;t<r;t++)n.setCellInlineStyles({row:e,col:t,styles:this._oldStyles[e+"-"+t]})},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._styles=r.styleNameValues,n._oldStyles=r.oldStyleNameValues,n._rect=r.simpleValue1,n._type=r.simpleValue2,n._toggle=r.newBlkId)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.styleNameValues=e._styles||null,n.oldStyleNameValues=e._oldStyles,n.simpleValue1=e._rect,n.simpleValue2=e._type,n.newBlkId=e._toggle||null,n}}),r.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(11),a=n(2),l=n(1),s=n(23),c=n(47),u=n(56),d=n(125),p=n(79),h=n(55);return t=o.extend({name:"abstract.comp.DeleteNoteRange",_cmdArgs:null,_note:null,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args,t.__super__.initialize.apply(e)},apply:function(){var e,t,n,o,i,c=this,d=c._cmdArgs.range,p=[];if(!d)return l.error(this.name+":note range should NOT be null"),!1;if(e=d.getStartBlockRange(),t=e.block,n=d.getEndBlockRange(),o=n.block,i=c._note.getNextBlock(o),!d.isCollapsed()&&(r.deleteSelectedContent(c,c._note,d),d.isInSingleBlock()&&a.isTextBlock(t)))return r.setTextBlockAsEndingRange(c,t,e.start,e.start),!0;if(d.isInSingleBlock()){if(a.isTextBlock(t)){if(d.isCollapsed())return e.start===t.getLength()?c._deleteAtTextBlockEnd(i,t):c._deleteAtTextBlockMiddle(t,e.start);r.setTextBlockAsEndingRange(c,t,e.start,e.start)}else i&&!a.isTable(i)?(c.executeAtomicCommand(new s({note:c._note,blocks:[t]})),t=i):t=r.replaceBlockWithParagraph(c,c._note,t,""),a.isTextBlock(t)?r.setTextBlockAsEndingRange(c,t,0,0):r.setNonTextBlockAsEndingRange(c,t);return!0}return d.isInMultiBlock(o)?(a.isTextBlock(t)&&a.isTextBlock(o)?(c.executeAtomicCommand(new u({block:t,start:t.getLength(),text:o.getText()})),p.push(o),r.setTextBlockAsEndingRange(c,t,e.start,e.start)):a.isTextBlock(t)?(p.push(o),r.setTextBlockAsEndingRange(c,t,e.start,e.start)):a.isTextBlock(o)?(p.push(t),r.setTextBlockAsEndingRange(c,o,0,0)):(p.push(t),i?p.push(o):o=r.replaceBlockWithParagraph(c,c._note,o,""),r.setTextBlockAsEndingRange(c,o,0,0)),c.executeAtomicCommand(new s({note:c._note,blocks:p})),!0):void 0},_deleteAtTextBlockEnd:function(e,t){var n,o=this;return!(e&&!a.isTable(e))||(a.isAttachment(e)||a.isImage(e)?(o.setEndingRange(h.buildNoteRangeFromNonTextBlock(e)),!0):(n=t.getLength(),a.isTextBlock(e)&&o.executeAtomicCommand(new u({block:t,start:t.getLength(),text:e.getText()})),o.executeAtomicCommand(new s({note:o._note,blocks:[e]})),r.setTextBlockAsEndingRange(o,t,n,n),!0))},_deleteAtTextBlockMiddle:function(e,t){var n=this;if(p.isAtHrefBorder(e,t,!1))return n._deleteHref(e,t,!1),!0;n.executeAtomicCommand(new c({block:e,start:t,end:t+1})),r.setTextBlockAsEndingRange(n,e,t,t)},_deleteHref:function(e,t){var n,o=this,i={href:"",color:"#393939",underline:!1};-1!==(n=p.findHrefBorder(e,t,!1))&&o.executeAtomicCommand(new d({blocks:[e],styleNameValues:i,start:t,end:n+1}))},isSingleBlockAffected:function(){var e,n,o=this,i=o._args.range,r=t.__super__.isSingleBlockAffected.apply(o),a=0;return r&&i&&i.isCollapsed()&&(n=i.getStartBlockRange(),e=n.block,a=n.start,o._note.getNextBlock(e)&&a===e.getEndOffset()&&(r=!1)),r}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(2),n(35)],void 0!==(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.TODO},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(76),a=n(3);return t=o.extend({name:"atom.InsertTableRowCol",_table:null,_rect:null,_cellsData:null,_dataLength:null,effected:!1,initialize:function(){var e=this,n=e.options,o=n.args;a.isCollabCommand(o)||(this._cellsData=n.cellsData,this._sizes=n.sizes,this._rect=n.rect,this._table=n.table,this._dataLength=this._cellsData.length),t.__super__.initialize.apply(e)},apply:function(){var e=this,t=e._rect,n=e._table,o=e._cellsData,i=e._sizes;null!=t.row&&(n.insertRows(t.row,o,i),this.effected=!0),null!=t.col&&(n.insertCols(t.col,o,i),this.effected=!0)},doUnapply:function(){var e=this,t=e._rect,n=e._table,o=e._dataLength;null!=t.row&&n.deleteRows(t.row,o),null!=t.col&&n.deleteCols(t.col,o)},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,a=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),a&&(n._table=e.getBlockById(a.blockId),n._cellsData=r.cellsFromCollabJSON(a.dataBefore),n._rect=a.simpleValue1,n._dataLength=a.simpleValue2)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.dataBefore=r.cellsToCollabJSON(e._cellsData),n.simpleValue1=e._rect,n.simpleValue2=e._dataLength,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(15)],void 0!==(i=function(e,t,n){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.createCommandTypeEvent=function(e){return new t({data:e,type:t.EVENT_TYPES.COMMAND})},t.createUserTypeEvent=function(e){return new t({data:e,type:t.EVENT_TYPES.USER})},t.prototype.getType=function(){return this.type},t.prototype.getData=function(){return this.data},t.prototype.isCommandType=function(){return this.type===t.EVENT_TYPES.COMMAND},t.prototype.isUserType=function(){return this.type===t.EVENT_TYPES.USER},t.prototype.initialize=function(e){this.type=e.type,this.data=e.data,delete this.options},t.EVENT_TYPES={COMMAND:1,USER:2},t}(n)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){return n(163).extend({initialize:function(e){var t=this,n=e.event,o=n.originalEvent||n;t._dataTransfer=o.clipboardData}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(15),i=n(1),r=n(24),a=r.isEdge(),l=n(329),s={"text/html":!0,"text/plain":!0,"text/uri-list":!0,"text/yne-image-json":!1,"text/yne-json":!1,"text/yne-note-id":!1,"text/yne-table-json":!1};return o.extend({initialize:function(e){var t=this,n=e.event,o=n.originalEvent||n;t._dataTransfer=o.dataTransfer},_getCustomData:function(e){var t,n,o=this;if(!o._altData){t=o._dataTransfer.getData("application/json");try{n=JSON.parse(t),o._altData=n}catch(e){i.error(e),o._altData={}}}return o._altData[e]},getData:function(e){var t,n,o=this,r=o._dataTransfer;return a?(t=s[e],!0===t?(n=r.getData(e),i.log("get standard type",e,n)):!1===t?(n=o._getCustomData(e),i.log("get custom type",e,n)):i.error("type should be registered!",e),n):r.getData(e)},setDataMap:function(e){var n,o=this._dataTransfer,r=function(t,n){i.log("set data to data transfer",n,t);try{var r=t;"text/html"===n&&null!=e["text/yne-json"]&&null!=e["text/html"]&&(e["text/html"]=e["text/html"]+"\x3c!--5f39ae17-8c62-4a45-bc43-b32064c9388a:"+l.encode(e["text/yne-json"])+"--\x3e",r=e["text/html"]),o.setData(n,r)}catch(e){i.error(e)}},c={},u=0;if(a){if(t.each(e,function(e,t){var n=s[t];!0===n?r(e,t):!1===n?(i.log("set custom type",t),c[t]=e,u++):i.error("type should be registered!",t)}),u>0)try{n=JSON.stringify(c),r(n,"application/json")}catch(e){i.error(e)}}else t.each(e,r)},clearData:function(e){return this._dataTransfer.clearData(e)},setProperty:function(e,t){this._dataTransfer[e]=t}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(){"use strict";return function(e){var t,n;window.getSelection?(t=window.getSelection(),t.getRangeAt&&t.rangeCount&&(n=t.getRangeAt(0),n.deleteContents(),n.insertNode(document.createTextNode(e)))):document.selection&&document.selection.createRange&&(document.selection.createRange().text=e)}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(48),o=n(0);return t.extend({name:"no-table-split",isVisible:!1,initialize:function(e){this.editor=e.editor,this.bindEditorEvents(),this.isVisible||this.hide()},editorEvents:{"yne-selection-change":"onSelectionChange"},bindEditorEvents:function(){var e=this,t=e.editor,n=e.editorEvents;n&&o.each(n,function(n,o){t.on(o,e[n].bind(e))})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(406),o=n(0);return t.extend({editorEvents:{"yne-editing-state-change":"onEditingStateChange"},onEditingStateChange:function(e){var t=this;o.has(e,t.name)&&(t.selectedValue=e[t.name])}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(2),n(35)],void 0!==(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.QUOTE},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0);return{getFileType:function(e){if(t.isUndefined(e))return null;var n=e.toLowerCase().split(".");return{table:"table",pdf:"pdf",txt:"txt",text:"txt",mht:"html",doc:"word",docx:"word",excel:"excel",xls:"excel",xlsx:"excel",csv:"excel",ppt:"ppt",pps:"ppt",pptx:"ppt",ppsx:"ppt",flash:"flash",swf:"flash",flv:"flash",compress:"compress",zip:"compress",rar:"compress","7z":"compress",audio:"audio",mp3:"music",aac:"music",ogg:"music",wav:"music",flac:"music",m4a:"music",ape:"music",wma:"music",video:"video",rm:"video",rmvb:"video",avi:"video",mkv:"video",mpg:"video",mpeg:"video",wmv:"video",ts:"video",m4v:"video",mp4:"video",image:"image",jpg:"image",jpeg:"image",gif:"image",png:"image",bmp:"image",md:"md",scan:"scan",html:"html",htm:"html"}[n[n.length-1]]||"other"},getSizeString:function(e){var t=["B","KB","MB","GB","TB"],n=0,o=parseInt(e);if(o=o||0,isNaN(o))return"未知大小";if(o<=0)return"";for(;o>=1024&&n<3;)n++,o/=1024;return String(Math.floor(100*o)/100)+t[n]},splitFileFullName:function(e){if(t.isUndefined(e))return null;var n,o,i=e.lastIndexOf(".");return i<0?(n=e,o=""):0===i?(n="",o=e):(n=e.substring(0,i-1),o=e.substring(i-1)),{fileName:n,fileType:o}},getFileIconByName:function(e){var t="src--svg--type_other_large",n=this.getFileType(e);return n&&(t="src--svg--type_"+n+"_large"),t}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(7);return{isDataUrl:function(e){return/^data:/i.test(e)},isHttpUrl:function(e){return/^http/i.test(e)},has:function(e){return/\?\d+$/.test(String(e))},remove:function(e){return String(e).replace(/\?\d+$/,"")},addIfNeeded:function(e,n){var i=this;if(e=String(e),e=o.trim(e),i.isHttpUrl(e))return e;if(i.isDataUrl(e))return e;if(i.has(e)){if(!0!==n)return e;e=i.remove(e)}else if(/\?/.test(e))return e;return e+"?"+t.uniqueId()}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(49),i=n(12),r=n(7),a=n(22),l=n(1),s=n(27),c=n(171),u=n(449),d=n(450),p=n(42),h=n(14),g=n(53),f=n(451),m=n(472),_=n(473),y=n(5),v=n(474),b=n(122),k=n(20),C=n(28),S=n(2),I=n(61),w=n(109),E=n(77),T=n(43),N=n(8),A=n(37),O=n(68),x=n(10),B=n(162),R=n(65);return n(475),o.extend({className:"block-view table-view",_template:i.getTemplate("common","table_view"),_wrapperElClassName:"table-wrapper",_cellEditClassName:"cell-edit",_cellSelectedClassName:"cell-selected",_layoutElClassName:"table-layout",_layoutInnerElClassName:"table-layout-inner",_rectOnDragStart:null,_oldRangeType:null,_rending:null,_isPasteAsText:!1,_OCRHighlightInfos:null,_OCRHighlightItem:null,events:{"mouseenter td":"_onCellMouseEnter","mouseleave td":"_onCellMouseLeave",mousedown:"_onMouseDown",dblclick:"_onDblclick",click:"_onClick","mouseenter a":"_onEnterLink","mouseleave a":"_onLeaveLink"},initialize:function(){var e=this;o.prototype.initialize.apply(e,arguments),e._draggable=new c({el:this.el,disableDocSelection:!0}),e.bindSelectionEvents(),e._initEvents(),e._OCRHighlightInfos=[],e._OCRHighlightItem=[]},_initEvents:function(){var e=this,n=e.block,o=e._draggable,i={};t.bindAll(e,"_onAttributeChanged","_onDragging","_onStyleChange"),s.addListeners({"cell-inline-style-change":"_onCellInlineStyleChange","cell-block-style-change":"_onCellBlockStyleChange","row-height-set":"_onRowHeightSet","col-width-set":"_onColWidthSet","row-inserted":"_onRowInserted","col-inserted":"_onColInserted","row-deleted":"_onRowDeleted","col-deleted":"_onColDeleted","cell-content-change":"_onCellContentChange","content-change":"_reRenderCells","high-light":"onHighlight"},n,e),n.on("attribute-changed",t.throttle(e._onAttributeChanged),100),n.on("style-change",e._onStyleChange),i[c.DRAG_START]="_onDragStart",i[c.DRAG_END]="_onDragEnd",s.addListeners(i,o,e),o.on(c.DRAGGING,t.throttle(e._onDragging,100)),e._triggerResize=t.throttle(e._triggerResize,100)},_removeSubViews:function(){var e=this;t.each(["_cellEditView","_selectionView","_hiddenInputView"],function(t){var n=e[t];n&&(n.destroy?n.destroy():l.error("view has no destroy()",n),e[t]=null)})},_addSubViews:function(){var e,n=this,o=n._keyHandlerManager;n._removeSubViews(),n._cellEditView=f.create({table:n.block,tableView:n,styleRules:n._getStyleRules(),mapper:this._inlineStyleViewMapper}),s.addListeners({"set-cell-content":"_onSetCellContent",blur:"_onCellEditViewBlur","cell-edit-view-exit":"_onCellEditViewExit","cell-edit-view-enter":"_onCellEditViewEnter"},n._cellEditView,n),s.bubble({"cell-edit-view-selection-change":!0,"cell-edit-view-exit":!0,"cell-edit-view-history-change":!0,"cell-edit-view-command-executed":!0},n._cellEditView,n),n.addViewToInner(n._cellEditView),n._selectionView=new d({tableView:n}),n.addViewToInner(n._selectionView),n._cellResizeView=new _({tableView:n}),n.addViewToInner(n._cellResizeView),s.addListeners({"set-row-height":"_onSetRowHeight","set-col-width":"_onSetColWidth","set-cells-size":"_setCellsSize"},n._cellResizeView,n),n._hiddenInputView=m.create({}),o||(o=n._keyHandlerManager=new y({scope:"table-hidden-input"})),o.on("bind-key",function(e){var t=n._hiddenInputView;t&&t.bindKey(e)}),o.on("unbind-key",function(e){var t=n._hiddenInputView;t&&t.unbindKey(e)}),e=o.getAvailableHandlerNames(),t.each(e,function(e){o.bind(e)}),n.addView(n._hiddenInputView),s.addListeners({"key-monitor":"_onKey",copy:"_onCopy",cut:"_onCut",paste:"_onPaste","text-input":"_onTextInput"},n._hiddenInputView,n)},_onSetCellContent:function(e,t){var n=this,o=n.block,i=o.getCellById(e);if(!i)return void l.error("Not find cell! by id:",e);n.trigger("command","comp.SetTableCellContent",{table:n.block,cellRect:{row:i.row,col:i.col},content:t})},_onCellEditViewBlur:function(){},_onCellEditViewExit:function(){this._hiddenInputView.hideBehind()},_onKey:function(e,t){var n=this;n._keyHandlerManager.execWithKey(e,n,t)},_onCopy:function(e){var t=this;e.stopPropagation(),e.preventDefault(),t.trigger("copy",e)},_onCut:function(e){var t=this,n=t._getNoteRange();e.stopPropagation(),e.preventDefault(),t.trigger("cut",e),n.isSingleTableSelected()&&t._clearSelectCells()},_pasteBlobImg:function(e){var t,n,o,i=this;t=e.originalEvent.clipboardData.items,o=i._getRectOfNoteRange(),t&&1===t.length&&0===t[0].type.indexOf("image")&&o&&(n=t[0].getAsFile(),i.trigger("yne-blob-paste",{isImg:!0,data:n},function(e){e&&e.source&&i.trigger("command","comp.SetTableCellContent",{table:i.block,cellRect:{row:o.top,col:o.left},content:R.create({source:e.source})})}))},_onPaste:function(e){e.stopPropagation(),e.preventDefault();var t,n,o,i,r,a,l,s=this,c=s._isPasteAsText;return N.IS_PC?void s.trigger("yne-on-paste",c,e):(t=new B({event:e}),c?void((r=t.getData("text/plain"))&&s._pastePlain(r)):void((n=t.getData("text/yne-json"))&&s._pasteJSON(n)||(o=t.getData("text/yne-table-json"))&&s._pasteYTableJson(o)||(i=t.getData("text/html"))&&s._pasteHTML(i)||(a=s.noteView.options.editor,(l=a&&a.callMacNativeApi("macClipboardData",["image"]))&&this._pasteImages(l)||(r=t.getData("text/plain"))&&s._pastePlain(r)||s._pasteBlobImg(e))))},_pasteHTML:function(e){var t=this,n=w.parseHtml(e);return t.pasteBlockList(n)},_pasteJSON:function(e){var t=w.parseJSON(e);return this.pasteBlockList(t)},_pasteYTableJson:function(e){var n=this;if(t.isString(e))try{e=window.JSON.parse(e)}catch(e){return void l.error("parse ytable json  string error")}return n._pasteJSON([{blockType:S.TABLE,data:e}])},_pasteImages:function(e){var t,n=this,o=[];e=JSON.parse(e);for(var i=0;i<e.length;i++)(t=e[i])&&o.push(new I({source:t,title:""}));return n.pasteBlockList(o)},_pastePlain:function(e){var t=this,n=w.parsePlain(e);return t.pasteBlockList(n)},pasteBlockList:function(e){var t=this,n=t.block,o=[],i=[];return!(!e||!e.length)&&(1===e.length&&S.isTable(e[0])?(this.trigger("command","comp.InsertTableCells",{table:n,widths:e[0].colWidths,heights:e[0].rowHeights,cellsData:e[0].tableCells}),!0):(e.forEach(function(e){var t=E.blockToCell(e);t&&o.push(t)}),o.length>0?(o.forEach(function(e){i.push([e])}),t.trigger("command","comp.InsertTableCells",{table:n,cellsData:i}),!0):void 0))},_clearSelectCells:function(){var e=this,t=e.block;e.trigger("command","comp.InsertTableCells",{table:t})},_onTextInput:function(e){var t,n,o,i,r=this,a=r._getRectOfNoteRange();if(!a)return void l.warn("Failed to show cellEditView",a);r.isLocked()||(t=r.block.getCell(a.top,a.left,{findMergePointIfNeeded:!0,withPosition:!0}))&&(n=t.cell,n&&n.isEmpty()?(o=n.getStylesForEmpty(),i=x.create(e,!1),i.setStyles(0,i.getLength(),o)):i=x.create(e,!1),r._cellEditView.showAndEdit({row:t.row,col:t.col,content:i}))},moveWithDirection:function(e,t){var n,o=this,i=o.block,r=o._getRectOfNoteRange(),a=1,l=1;if(r){if(i.isMergePoint(r.top,r.left)&&(n=i.getMergePointAttrAt(r.top,r.left),l=n.height,a=n.width),e===T.UP){if(r.top-l<0)return o.trigger("move-caret",!1,t);o._setRange({top:r.top-l,left:r.left,width:1,height:1})}if(e===T.DOWN){if(r.top+l+r.height>i.getRowCount())return o.trigger("move-caret",!0,t);o._setRange({top:r.top+l,left:r.left,width:1,height:1})}if(e===T.LEFT)if(r.left-a<0){if(r.top-l<0)return o.trigger("move-caret",!1,t);o._setRange({top:r.top-l,left:i.getColumnCount()-1,width:1,height:1})}else o._setRange({top:r.top,left:r.left-a,width:1,height:1});if(e===T.RIGHT)if(r.left+a>i.getColumnCount()-1){if(r.top+l+r.height>i.getRowCount())return o.trigger("move-caret",!0,t);o._setRange({top:r.top+l,left:0,width:1,height:1})}else o._setRange({top:r.top,left:r.left+a,width:1,height:1})}},toggleInlineStyle:function(e){this.trigger("command","comp.SetTableCellInlineStyle",{toggle:e})},clearSelectedCells:function(){this._clearSelectCells()},enterEditMode:function(){},selectAll:function(e){e&&this.trigger("select-all")},render:function(){var e=this,t=e.el;e._rending=!0,e._removeSubViews(),e._renderTemplate(),e.colgroupEl=t.querySelector("colgroup"),e.wrapperEl=t.querySelector("."+e._wrapperElClassName),e.tableEl=t.querySelector("table"),e._tableLayoutEl=t.querySelector("."+e._layoutElClassName),e._tableLayoutInnerEl=t.querySelector("."+e._layoutInnerElClassName),e._setTableStyles(),e._setHeightByData(),e._renderCells(),e._addSubViews(),o.prototype.render.apply(e,arguments),e._rending=!1,e._triggerResize()},addView:function(e){this._tableLayoutEl.appendChild(e.el),e.render()},addViewToInner:function(e){this._tableLayoutInnerEl.appendChild(e.el),e.render()},_renderTemplate:function(){var e=this;e.$el.html(e._template())},_renderCells:function(){var e,t,n,o,i,a=this,s=a.block,c=a.tableEl,u=s.getRowCount(),d=s.getColumnCount(),p=c.querySelector("tbody"),h=[];for(r(p).hide(),o=0;o<u;o++){for(e=p.insertRow(o),i=0;i<d;i++)t=s.getCell(o,i),t||l.error("No find cell! row, col, block",o,i,s),t.isMergedCell()||(t.isAttachmentCell()&&h.push({row:o,col:i}),e.appendChild(a._renderCell(o,i)));n=s.getRowHeight(o),e.style.height=n?n+"px":""}r(p).show(),a._renderColumns(a.colgroupEl.querySelectorAll("col").length,d)},_loadCellImg:function(e,t){var n=this,o=e.querySelector("img");o&&r(o).load(function(){n._triggerResize(),t&&n._redrawRange()})},_createHighlightMark:function(){var e=this;e._clearHighlightMark(),t.each(e._OCRHighlightInfos,function(n){var o=r(e.getCellImageEl(n.cellId));if(null==o||0===o.length)return void l.error("Failed to get TableCell by ID:",o);var a=o.position(),s=o.width()/n.width;t.each(n.pos,function(t){var n=r(i.render("common","high_light_item",{top:a.top+t.top*s-1,left:a.left+t.left*s-2,height:(t.bottom-t.top)*s,width:(t.right-t.left)*s}));n.appendTo(e.wrapperEl),e._OCRHighlightItem.push(n)})})},clearHighlight:function(){this._OCRHighlightInfos=[],this._clearHighlightMark()},_clearHighlightMark:function(){t.each(this._OCRHighlightItem,function(e){e.remove()}),this._OCRHighlightItem=[]},_replaceBlankToSymbol:function(e){var n=e,o=function(e){!e||e.length<1||t.forEach(e,function(e){e.children&&e.children.length>0&&o(e.children),e.childNodes[0]&&3===e.childNodes[0].nodeType&&(e.innerHTML=e.innerHTML.replace(/ /g,"&nbsp;"))})};n&&o(n.children)},_renderCell:function(e,t,n){var o,i,r,a,l,s=this,c=s.block,u=c.getCell(e,t,{findMergePointIfNeeded:!0,withPosition:!0});if(u){switch(o=u.cell,i=n||document.createElement("td"),r=o.getContent(),a=o.getType(),i.setAttribute("data-cell-id",o.getCellId()),s._setMergeCell(i,o),s._setCellStyles(i,o.getBlockStyles()),s._setBorder(i,e,t,o.getBlockStyles()),a){case g.TEXT:l=r.toHtml({styleRules:s._getStyleRules()});break;case g.IMAGE:l=v.renderImage(r,c.getExtraInfo("pcResMap"));break;case g.ATTACHMENT:l=v.renderAttachment(r)}return i.innerHTML=l,s._loadCellImg(i,n),n&&s._triggerResize(),i}},_getStyleRules:function(){var e=this._inlineStyleViewMapper;return{color:function(t){var n=t.color;return t.href!==k.getDefault("href")&&a.equals(t.color,"blue")?"#003884":null!=n&&e?e.valueToView("color",n):void 0},"font-family":function(t){var n,o=t["font-family"];return null!=o&&e&&(n=e.valueToView("font-family",o)),o!==n?n:C.getAllValueByFont(o)||o}}},_setMergeCell:function(e,t){if(t.isMergePoint()){var n=t.getMergePointAttr();n.width>0&&e.setAttribute("colspan",n.width),n.height>0&&e.setAttribute("rowspan",n.height)}},_reRenderCells:function(){var e=this,t=e.tableEl,n=t.querySelector("tbody");e._rending=!0,n.innerHTML="",e.colgroupEl.innerHTML="",e._renderCells(),e._rending=!1,e._triggerResize(),e._redrawRange()},_redrawRange:function(){var e=this,t=e._getRectOfNoteRange();e._setRange(t)},_onDownloadClick:function(e){var t,n,o,i=this,a=i.getCellElementByTarget(e.target),l=i.block;a&&(t=r(a).data("cellId"),(o=l.getCellById(t).cell)&&(n=o.getContent(),i.trigger("yne-download-attachment",n.getResource(),n.getFileName())))},_onClick:function(e){-1!==e.target.className.indexOf("attachment-download")&&this._onDownloadClick(e)},_onEnterLink:function(e){var t,n,o=this,i=r(e.target).closest("a").get(0),a=o.getCellElementByTarget(e.target),l=i.parentNode;t=r(a).data("cellId"),n=o.block.getCellById(t),!o.isOnCellEdit()&&n&&(l.innerText||"").trim()===(i.innerText||"").trim()&&(O.isNoteLinkUrl(i.href)||o.isCollabLocked()||!i||o.trigger("link-menu-show",{linkNode:i,block:o.block,range:p.create({block:o.block,type:p.TYPES.NORMAL,rect:{width:1,height:1,left:n.col,top:n.row}})}))},_onLeaveLink:function(){this.trigger("link-menu-hide")},_onMouseDown:function(e){var t=this;t.getCellElementByTarget(e)?this._handleDrag(e,c.DRAG_START,!0):t._setRange(p.TYPES.BLANK)},_onDblclick:function(){var e,t=this,n=t._getRectOfNoteRange();n&&!t.isLocked()&&(e=t.block.getCell(n.top,n.left,{findMergePointIfNeeded:!0,withPosition:!0}),t._cellEditView.showAndEdit(e))},_getTableRange:function(){var e,t=this,n=t._getNoteRange();if(n&&n.isInSingleBlock&&n.isInSingleBlock()&&(e=n.getStartBlockRange())&&e instanceof p&&e.block===t.block)return e},_getRectRange:function(){var e=this,t=e._getTableRange();if(t)return t.getAsRectRange()},_getRectOfNoteRange:function(){var e=this,t=e._getRectRange();return t&&t.getRect?t.getRect():null},_getNoteRange:function(){var e;return this.trigger("get-note-range",function(t){e=t}),e},_onDragStart:function(e){this._rectOnDragStart=null,this._handleDrag(e,c.DRAG_START)},_handleDrag:function(e,t,n){var o,i,a,s,u,d=this,p=d.getCellElementByTarget(e.target),h=e.shiftKey&&!e.ctrlKey&&!e.metaKey;if(o=r(p).data("cellId"),i=d.block.getCellById(o)){switch(s={width:1,height:1,left:i.col,top:i.row},t){case c.DRAG_START:if(h)u=d._getRectOfNoteRange(),d._rectOnDragStart=u,a=b.union(d._rectOnDragStart,s);else{if(n&&(u=d._getRectOfNoteRange(),b.contains(u,s)))return;a=d._rectOnDragStart=s}break;case c.DRAGGING:case c.DRAG_END:a=b.union(d._rectOnDragStart,s);break;default:l.error("unvalid drag type",t)}a&&d._setRange(a)}},_setRange:function(e){var t,n,o,i=this,r=p.TYPES.NORMAL;if(e)return e.width?o=e:r=e,t=p.create({block:i.block,type:r||p.TYPES.FIRST_CELL,rect:o}),n=new h({startRange:t,endRange:t}),i.trigger("set-range",n,!0,!0,!0),t},_onDragging:function(e){this._handleDrag(e,c.DRAGGING)},_onDragEnd:function(){this._handleDrag(event,c.DRAG_END),this._rectOnDragStart=null},_cancelEditMode:function(){l.log("hide cellEditView"),this._cellEditView.hide()},_setCellStyles:function(e,t){var n;n=t.textAlign,e.style.textAlign="center"===n||"right"===n||"left"===n?n:"",n=t.verticalAlign,e.style.verticalAlign="top"===n||"middle"===n||"bottom"===n?n:"",n=e.style.whiteSpace,n!==e.style.whiteSpace&&this._triggerResize(),n=t.backColor,e.style.backgroundColor=n&&"inherit"!==n&&"transparent"!==n?n:""},_setBorder:function(e,t,n,o){var i,r=this,a=r.tableEl,l=a.querySelector("tbody"),s=o["border|vertical"],c=o["border|horizontal"];0===t?(i=e)&&(i.style.borderTop=c):(i=l.rows[t-1].cells[n])&&(i.style.borderBottom=c),0===n?(i=e)&&(i.style.borderLeft=s):(i=l.rows[t].cells[n-1])&&(i.style.borderRight=s)},_setRowHeight:function(e,t){var n=this,o=n._getRowElAt(e);o&&(o.style.height=t+"px",n._triggerResize())},_getRowElAt:function(e){var t=this,n=t.tableEl,o=n.tBodies[0];if(o)return o.rows[e]},getRowElHeight:function(e){var t=this._getRowElAt(e),n=0;return t?n=t.getBoundingClientRect().height:n},_renderColumns:function(e,n){if(!((e=e||0)>=n)){var o,i=this,r=i.block,a=r.getColumnCount(),l=i.colgroupEl,s=t.toArray(l.querySelectorAll("col"));for(n=n||a,o=e;o<n;++o)i._setColumnWidth(o,r.getColumnWidth(o));for(o=s.length-1;o>=a;--o)u(s[o])}},_setColumnWidth:function(e,t){var n=this,o=n._ensureColEl(e);o&&(o.style.width=t+"px",n._triggerResize())},_ensureColEl:function(e){var t,n=this,o=n._getColumnCount(),i=Math.max(e+1,o),r=n.colgroupEl,a=i-r.querySelectorAll("col").length,l=n._getColElAt(e);if(l)return l;for(t=0;t<a;++t)r.appendChild(document.createElement("col"));return n._getColElAt(e)},_getColumnCount:function(){var e=this.tableEl.rows[0];return e?e.cells.length:this.block.getColumnCount()},_getColElAt:function(e){if(!(e<0)){return this.colgroupEl.querySelectorAll("col")[e]}},getColElWidth:function(e){var t=this._getColElAt(e);return t?parseFloat(t.style.width):0},getCellElement:function(e){if(e&&e.getCellId&&(e=e.getCellId()),e)return this.$el.find('[data-cell-id="'+e+'"]:first').get(0)},getCellElementAt:function(e,t){var n=this,o=n.block.getCell(e,t,{findMergePointIfNeeded:!0});return n.getCellElement(o)},getCellTextElementAt:function(e,t){return this.getCellElementAt(e,t).querySelector(".table-cell-line > span")},getColumnIndex:function(e){var t=this,n=r(e).data("cellId"),o=t.block.getCellById(n);return o&&null!=o.col?o.col:null},getCellElementByTarget:function(e){if(e&&e.target&&(e=e.target),e)return r(e).closest("td").get(0)},getAbsoluteBoundingRectAt:function(e,t){var n=this,o=n.getBoundingRectAt(e,t),i=n._tableLayoutInnerEl.scrollLeft;if(o)return o.left-=i,o},getBoundingRectAt:function(e,t){var n=this.getCellElementAt(e,t);return this.getBoundingRect(n)},getBoundingRectByCell:function(e){var t=this,n=t.getCellElement(e);return t.getBoundingRect(n)},_triggerResize:function(){if(!this._rending){var e=this,t=e._tableLayoutEl,n=e._tableLayoutInnerEl,o=n.getBoundingClientRect().height;e._viewHeight!==o&&(e.trigger("resize",o),e._viewHeight=o,t.style.height=o+"px",e.trigger("view-height-changed",e.cid)),e._createHighlightMark()}},getBoundingRect:function(e){if(e){var t=this,n=t.wrapperEl.getBoundingClientRect(),o=e.getBoundingClientRect();return{left:o.left-n.left,top:o.top-n.top,right:o.right-n.left,bottom:o.bottom-n.top,width:o.width,height:o.height}}},getEventBoundingRect:function(e){if(e){var t=this,n=t.wrapperEl.getBoundingClientRect();return{left:e.clientX-n.left,top:e.clientY-n.top}}},_onSetRowHeight:function(e,t){this._setCellsSize([{row:e,height:t}])},_onSetColWidth:function(e,t){this._setCellsSize([{col:e,width:t}])},_setCellsSize:function(e){this.trigger("command","comp.SetTableCellsSize",{table:this.block,sizes:e})},_onAttributeChanged:function(){this._reRenderCells()},_onRowHeightSet:function(e,t){this._setRowHeight(e,t)},_onColWidthSet:function(e,t){this._setColumnWidth(e,t)},_ensureRow:function(e){l.log("ensure the row has rendered",e)},_onColInserted:function(){this._reRenderCells()},_onColDeleted:function(){this._reRenderCells()},_onRowInserted:function(){this._reRenderCells()},_onRowDeleted:function(){this._reRenderCells()},_onCellInlineStyleChange:function(e,t){var n=this.getCellElementAt(e,t);this._renderCell(e,t,n)},_onCellBlockStyleChange:function(e,t,n,o){var i=this.getCellElementAt(e,t);i&&this._setCellStyles(i,o)},_onCellMouseEnter:function(e){var t=this;t.trigger("cell-enter",e,t)},_onCellMouseLeave:function(e){var t=this;t.trigger("cell-leave",e,t)},_onCellContentChange:function(e){var t,n=this,o=n.block.getCellById(e);return o?(n._ensureRow(o.row),(t=n.getCellElement(e))?(n._renderCell(o.row,o.col,t),void n._triggerResize()):void n._reRenderCells()):void l.error("unvalid cell info",o)},getHiddenInputView:function(){return this._hiddenInputView},getCellEditView:function(){return this._cellEditView},focusOutTbody:function(){this._setRange(p.TYPES.BLANK)},_setHeightByData:function(){var e,t=this,n=t.block,o=n.getRowCount(),i=t._tableLayoutEl,r=0;for(e=0;e<o;e++)r+=n.getRowHeight(e);t._viewHeight=r,i.style.height=r+"px"},_setTableStyles:function(){var e=this,n=e.block.getBlockStyles();t.each(n,function(t,n){e._setTableStyle(n,t)})},_setTableStyle:function(e,t){var n=this,o=n.$el;switch(e){case"back-color":o.css("background-color",t);break;case"padding":t?o.css({padding:t,"padding-bottom":"5px","padding-top":"5px"}):o.css({padding:t,"padding-bottom":"","padding-top":""})}},_onStyleChange:function(e,t){this._setTableStyle(e,t)},getCellImageEl:function(e){var t=this,n=t.getCellElement(e);if(n)return n.querySelector("img")},getImageDomMapByTableRange:function(e){var t,n=e.tableRange,o=e.selectAll,i=this,r=i.block,a={};if(o&&(n=p.create({type:p.TYPES.ALL,block:r})),n&&(t=n.getAsRectRange()))return t.forEachCell(function(e){var t,n,o=e.getCellId();e.isImageCell()&&(t=i.getCellImageEl(o))&&(n=e.getContent(),a[r.getId()+"-"+n.getResId()]||(a[r.getId()+"-"+n.getResId()]={img:t,source:n.getSource()}))}),a},isLocked:function(){var e;return this._rending||this.trigger("get-read-only-status",function(t){e=t}),this.block.isLocked()||this.block.isReadOnly()||this._isReadOnly||e},selectTable:function(e){var t=this;if(!t._selectionView)return l.error("No selectionView find!");if(e){if(t._getRectOfNoteRange())return;t._selectionView.draw(p.create({block:this.block,type:p.TYPES.ALL}))}else t._selectionView.draw()},onDrawRange:function(e){var t,n,o=this;if(!o._selectionView)return l.error("No selectionView find!");if(e&&!e.isInBlank()){if(o._selectionView.draw(e),!(t=e.getAsRectRange()))return;n=t.getRect(),o._hiddenInputView.focus(o.getAbsoluteBoundingRectAt(n.top,n.left))}else o._selectionView.draw()},convertToNativeRange:function(){var e=this,t=document.createRange(),n=e.$el.get(0);return t.setStart(n,0),t.setEnd(n,n.childNodes.length),t},parseNativeRange:function(e,t,n){var o,i,a,l,s,c=this,u=c.block,d=e.startContainer,h=e.endContainer;return e.collapsed||(i=c.getCellElementByTarget(h))&&(l=u.getCellById(r(i).data("cellId"))),o=c.getCellElementByTarget(d),o&&(a=u.getCellById(r(o).data("cellId"))),a?c._setRange({top:a.row,left:a.col,height:l?l.row-a.row:1,width:l?l.col-a.col:1}):n||A.isNodeInRange(c.wrapperEl,e)||A.isRangeInNode(c.el,e)?(s=new p({block:u,type:p.TYPES.ALL}),c._selectionView.draw(s),s):void 0},onHighlight:function(e,n,o){function i(e){for(var t,i=e.getLength(),r=n.ignoreCase?e.toString().toLowerCase():e.toString(),a=c.indexOf(r,0);-1!==a;)t=document.createRange(),t.setStart(u,a),t.setEnd(u,a+i),o(t),a=c.indexOf(r,a+i)}function r(o){c=o.textContent,c=n.ignoreCase?c.toLowerCase():c,u=o,t.each(e,i)}var a,l,s,c,u,d=this,p=d.block,h=p.getRowCount(),g=p.getColumnCount();for(d._OCRHighlightInfos=[],l=0;l<h;l++)for(s=0;s<g;s++)if(!p.isMergedCell(l,s))if(a=p.getCell(l,s),a.isImageCell())null!=n.images&&t.each(n.images,function(e){e.resID===a.getContent().getResId()&&(e.cellId=a.getCellId(),d._OCRHighlightInfos.push(e))});else{if(u=d.getCellTextElementAt(l,s),!a.isTextNoEmptyCell()||!u)continue;t.map(u.childNodes,r)}d._createHighlightMark()},editCellFromToolbar:function(e,t){return this._cellEditView.editFromToolbar(e,t)},isOnCellEdit:function(){var e=this,t=e._cellEditView,n=e._hiddenInputView;return t&&t.isOnEdit()||n&&n.isOnEdit()},_onCellEditViewEnter:function(e){e&&(e.blockId=this.block.getId()),this.trigger("cell-edit-view-enter",e)},setPasteAsText:function(e){this._isPasteAsText=e||!1}},{isRangeInCellEditArea:function(e){return f.isRangeIn(e)||m.isRangeIn(e)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(17),i=n(0);return t=o.extend({initialize:function(e){i.bindAll(this,"onMouseDown","onMouseMove","onMouseUp"),this.el=e.el,this.disableDocSelection=!0===e.disableDocSelection,this.document=this.el.ownerDocument,this._makeDraggable()},_makeDraggable:function(){var e=this,t=this.el;t.addEventListener("mousedown",this.onMouseDown),e._setUserSelect(t,"none")},_getUserSelect:function(e){return e.style.webkitUserSelect||e.style.mozUserSelect||e.style.msUserSelect||e.style.userSelect||""},_setUserSelect:function(e,t){e.style.webkitUserSelect=t,e.style.mozUserSelect=t,e.style.msUserSelect=t,e.style.userSelect=t},onMouseDown:function(e){if(1===e.which){var n=this,o=this.el,i=this.document;o.setCapture&&o.setCapture(),i.addEventListener("mousemove",this.onMouseMove),i.addEventListener("mouseup",this.onMouseUp),n.disableDocSelection&&(n._backupDocUserSelect=n._getUserSelect(i.body),n._setUserSelect(i.body,"none")),this.trigger(t.DRAG_START,e)}},onMouseMove:function(e){1===e.which&&this.trigger(t.DRAGGING,e)},cancel:function(){var e=this,t=this.el,n=this.document;t.releaseCapture&&t.releaseCapture(),n.removeEventListener("mousemove",this.onMouseMove),n.removeEventListener("mouseup",this.onMouseUp),e.disableDocSelection&&e._setUserSelect(n.body,e._backupDocUserSelect)},onMouseUp:function(e){1===e.which&&(this.cancel(),this.trigger(t.DRAG_END,e))}},{DRAG_START:"drag-start",DRAGGING:"dragging",DRAG_END:"drag-end"})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o={bold:"bold",italic:"italic",strike:"strikeThrough",underline:"underline"};return{TOGGLE_INLINE_STYLES_CMD_MAP:o,INLINE_STYLES_CMD_MAP:t.extend({"back-color":"backColor",color:"foreColor","font-family":"fontName","font-size":"fontSize"},o)}}.call(t,n,t,e))&&(e.exports=o)},,,,,,,,,,function(e,t,n){var o;void 0!==(o=function(e){n(183),n(184);var t=window.JST={},o=n(0),i=n(12);return n(185).files.forEach(function(e){var r=n(186)("./"+e+".jst");t["common/"+e]=o.template(i.trimTempalte(r))}),n(205).files.forEach(function(e){var r=n(206)("./"+e+".jst");t["web/"+e]=o.template(i.trimTempalte(r))}),n(221)}.call(t,n,t,e))&&(e.exports=o)},function(e,t){},function(e,t){},function(e,t){e.exports={files:["attachment-view-attachment-container","catalogue_view","table_view","table_cell_resize","table_cell_edit","high_light_item","color_picker","handwrite-view-container","header-footer","high_light_item_image","image-title-input","image-view-image-container","link_view","list_item_view","page_break_view","paragraph_view","todo","content-load-progress"]}},function(e,t,n){function o(e){return n(i(e))}function i(e){var t=r[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var r={"./attachment-view-attachment-container.jst":187,"./catalogue_view.jst":188,"./color_picker.jst":189,"./content-load-progress.jst":190,"./handwrite-view-container.jst":191,"./header-footer.jst":192,"./high_light_item.jst":193,"./high_light_item_image.jst":194,"./image-title-input.jst":195,"./image-view-image-container.jst":196,"./link_view.jst":197,"./list_item_view.jst":198,"./page_break_view.jst":199,"./paragraph_view.jst":200,"./table_cell_edit.jst":201,"./table_cell_resize.jst":202,"./table_view.jst":203,"./todo.jst":204};o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=186},function(e,t){e.exports='<div class="attachment-block-container">\n    <div class="attachment-container" title="<%- title %>">\n        <div class="attachment-icon svg-common <%- name %>"></div>\n        <div class="attachment-title">\n            <p class="attachment-title-name"><%- fileName %></p><p class="attachment-title-type"><%- fileType %></p>\n        </div>\n        <div class="attachment-size"><%= size %></div>\n        <div class="attachment-download svg-common"></div>\n        <div class="attachment-mask" draggable="<%-!!draggable%>">\n            <div class="attachment-icon svg-common <%- name %>"></div>\n            <div class="attachment-title">\n                <p class="attachment-title-name"><%- fileName %></p><p class="attachment-title-type"><%- fileType %></p>\n            </div>\n            <div class="attachment-size"><%= size %></div>\n            <div class="attachment-download svg-common"></div>\n        </div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="catalogue-header cannot-edit">\n    <div class="catalogue-refresh" title="刷新">\n        <i class="svg-common src--svg--catalogue-refresh"></i>\n    </div>\n    <div class="catalogue-delete" title="删除">\n        <i class="svg-common src--svg--catalogue_remove"></i>\n    </div>\n</div>\n<div class="para-text"></div>'},function(e,t){e.exports='<div class="color-picker-panel" tabindex="0">\n    <div class="color-picker-panel-inner">\n        <div class="color-picker-panel-board">\n            <div class="color-picker-panel-board-hsv" style="background-color: rgb(255, 0, 0);">\n                <div class="color-picker-panel-board-value"></div>\n                <div class="color-picker-panel-board-saturation"></div>\n            </div>\n            <span style="left: 126px; top: 93.5px;"></span>\n        </div>\n        <div class="color-picker-panel-wrap">\n            <div class="color-picker-panel-wrap-ribbon">\n                <div class="color-picker-panel-ribbon">\n                    <span style="left: 0%;"></span>\n                </div>\n            </div>\n            <div class="color-picker-panel-wrap-alpha">\n                <div class="color-picker-panel-alpha">\n                    <div class="color-picker-panel-alpha-bg" style="background: linear-gradient(to right, rgba(57, 57, 57, 0), rgb(57, 57, 57));"></div>\n                    <span style="left: 100%;"></span>\n                </div>\n            </div>\n            <div class="color-picker-panel-wrap-preview">\n                <div class="color-picker-panel-preview">\n                    <span style="background-color: rgb(57, 57, 57); opacity: 1;"></span>\n                </div>\n            </div>\n        </div>\n        <div class="color-picker-panel-wrap" style="height: 40px; margin-top: 6px;">\n            <div class="color-picker-panel-params">\n                <div class="color-picker-panel-params-input">\n                    <input type="text" class="color-picker-panel-params-hex" maxlength="6" value="393939">\n                    <input type="number" value="57">\n                    <input type="number" value="57">\n                    <input type="number" value="57">\n                    <input type="number" value="100">\n                </div>\n                <div class="color-picker-panel-params-lable">\n                    <label class="color-picker-panel-params-lable-hex">HEX</label>\n                    <label class="color-picker-panel-params-lable-number">R</label>\n                    <label class="color-picker-panel-params-lable-number">G</label>\n                    <label class="color-picker-panel-params-lable-number">B</label>\n                    <label class="color-picker-panel-params-lable-alpha">A</label>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n</div>'},function(e,t){e.exports='<div class="progressbar-layer">\n    </div>\n    <div class="progressbar-mark">\n    </div>\n    <div class="progress-message">\n    <span class="progress-message-text">\n       <span class="progress-message-number"></span>  的内容已加载完成，请稍后...\n    </span>\n</div>'},function(e,t){e.exports='<div class="handwrite-container">\n    <img  src="<%= src %>"/>\n</div>\n<% if (needCopyHack) {%>\n    <p class="handwrite-copy-hack">select me</p>\n<% } %>'},function(e,t){e.exports="<div class=\"header-footer-input\" contenteditable=\"<%= readonly ? 'false' : 'true' %>\"></div>"},function(e,t){e.exports='<div class="high-light-item" style="left: <%= left %>px; top: <%= top %>px; height: <%= height %>px; width: <%= width %>px;"></div>'},function(e,t){e.exports='<div class="high-light-item-image" style="left: <%= left %>px; top: <%= top %>px; height: <%= height %>px; width: <%= width %>px;"></div>'},function(e,t){e.exports='<div class="image-title-input" contenteditable="true"\n    style="position: absolute; left: <%- left %>px; top: <%- top %>px; width: <%- width%>px; text-align: <%- textAlign%>; min-height: <%- height%>px;"><%- title %></div>\n<div class="image-title-placeholder"\n    style="position: absolute; left: <%- left %>px; top: <%- top %>px; width: <%- width%>px; text-align: <%- textAlign%>; min-height: <%- height%>px;">\n    输入标题\n</div>\n'},function(e,t){e.exports='<div class="image-block-container">\n    <div class="image-container">\n        <img <% if (width || height) { %> class="filter-blur" <% } %> src="<%= src %>"\n            <% if (width && height) { %> style="width: <%- width%>px; height: <%- height%>px;"\n            <% } else if (width) { %> style="width: <%- width%>px; height: auto;"<% } %>/>\n        <div class="resize-handle" data-corner="0"></div>\n        <div class="resize-handle" data-corner="1"></div>\n        <div class="resize-handle" data-corner="2"></div>\n        <div class="resize-handle" data-corner="3"></div>\n        <div class="menu-wrapper">\n            <div class="yne-button-group">\n                <div class="yne-button-item yne-last" data-button-name="menu" title="快捷菜单">\n                    <span class="yne-button svg-common">快捷菜单</span>\n                    <span class="yne-arrow-down svg-common"></span>\n                </div>\n                <ul class="yne-popup-menu">\n                    <li class="yne-popup-item" data-cm-name="image-title"><span>标题</span></li>\n                    <li class="yne-popup-item" data-cm-name="float-left"><span>左浮动</span></li>\n                    <li class="yne-popup-item" data-cm-name="float-right"><span>右浮动</span></li>\n                    <li class="yne-popup-item" data-cm-name="clear-float"><span>清除浮动</span></li>\n                    <li class="yne-popup-item" data-cm-name="clear-resize"><span>清除缩放</span></li>\n                    <% if (hasOCR) {%>\n                        <li class="yne-popup-item" data-cm-name="image-ocr"><span>文本识别OCR</span></li>\n                    <% } %>\n                    <li class="yne-popup-item yne-popup-split"></li>\n                    <li class="yne-popup-item" data-cm-name="delete"><span>删除图片</span></li>\n                    <li class="yne-popup-item" data-cm-name="download"><span>另存为</span></li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    <div class="image-title"></div>\n    <div class="image-split"></div>\n    <% if (needCopyHack) {%>\n        <p class="image-copy-hack">select me</p>\n    <% } %>\n</div>\n'},function(e,t){e.exports='<div class="hover-menu hover-menu-show-link">\n    <div class="hover-menu-before"></div>\n    <div class="hover-menu-body">\n        <a href="<%= link%>" target=\'_blank\'><span><%= link%></span></a>\n        <% if (!isReadOnly) { %>\n            <div class="link-button">\n                <span class="link-modify-button">编辑</span>\n                <span class="link-split">|</span>\n                <span class="link-remove-button">移除</span>\n            </div>\n        <% } %>\n    </div>\n</div>\n<div class="hover-menu hover-menu-modify-link">\n    <div class="hover-menu-before"></div>\n    <div class="hover-menu-body">\n        <span class="link-label">链接</span>\n        <input class="link-input" type="text" name="link" value="<%= link%>" />\n        <div class="link-confirm-button">\n            <span class="link-button-text">确定</span>\n        </div>\n    </div>\n</div>'},function(e,t){e.exports='<% if (isOrdered) { %>\n    <ol class="li-box"><li><div class="para-text"></div></li></ol>\n<% } else { %>\n    <ul class="li-box"><li><div class="para-text"></div></li></ul>\n<% } %>'},function(e,t){e.exports='<div class="page-break">\r\n    <span class="spanMark topSpan"></span>\r\n    <span class="spanMark middleSpan"></span>\r\n    <span class="spanMark bottomSpan"></span>\r\n</div>'},function(e,t){e.exports='<div class="para-text"></div>'},function(e,t){e.exports='<div class="cell-edit-box" contenteditable="true"></div>'},function(e,t){e.exports='<div class="resize-up"></div>\n<div class="resize-right"></div>\n<div class="resize-down"></div>\n<div class="resize-left"></div>\n'},function(e,t){e.exports='<div class="table-layout">\n    <div class="table-layout-inner" contentEditable="false">\n        <div class="table-wrapper">\n            <table>\n                <colgroup></colgroup>\n                <tbody></tbody>   \n            </table>\n            <div class="row-resize-line"></div>\n            <div class="col-resize-line"></div>\n        </div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="todo-content">\n    <label class="todo-mark" contenteditable="false">\n        <span class="todo-inner"></span>\n    </label>\n    <div class="todo-input para-text">\n    </div>\n</div>'},function(e,t){e.exports={files:["toolbar-button-template","toolbar-combo-box-font-family","toolbar-combo-box-font-size","toolbar-combo-box-align","toolbar-combo-box-line-height","toolbar-combo-box-color","toolbar-combo-box-back-color","toolbar-combo-box-set-background","toolbar-combo-box-table","toolbar_view","toolbar-combo-box-show-more","toolbar-combo-box-insert-link","toolbar-combo-box-heading"],dependency:["common"]}},function(e,t,n){function o(e){return n(i(e))}function i(e){var t=r[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var r={"./toolbar-button-template.jst":207,"./toolbar-combo-box-align.jst":208,"./toolbar-combo-box-back-color.jst":209,"./toolbar-combo-box-color.jst":210,"./toolbar-combo-box-font-family.jst":211,"./toolbar-combo-box-font-size.jst":212,"./toolbar-combo-box-heading.jst":213,"./toolbar-combo-box-insert-link.jst":214,"./toolbar-combo-box-line-height.jst":215,"./toolbar-combo-box-set-background.jst":216,"./toolbar-combo-box-show-more.jst":217,"./toolbar-combo-box-table.jst":218,"./toolbar-combo-box-template.jst":219,"./toolbar_view.jst":220};o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=206},function(e,t){e.exports='<div class="button-wrapper button-wrapper-<%=name%>">\n    <div class="button button-<%=name%> svg-common" title="<%=label%>"></div>\n</div>'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common"></span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <ul class="combo-menu combo-menu-<%=name%>">\n    <% for (key in items) { %>\n        <li class="combo-item" data-value="<%=key%>">\n            <span class="combo-item-icon-<%=name%> <%=key%> svg-common">&nbsp;</span>\n            <span class="combo-item-span-<%=name%>"><%=items[key]%></span>\n        </li>\n    <% } %>\n    </ul>\n</div>'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value svg-common combo-value-<%=name%>">\n            <span class="combo-value-buttom-color"></span>\n        </span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <div class="combo-menu combo-menu-<%=name%>">\n        <div class="color-section color-section-default combo-item" data-value="<%=defaultValue%>">\n            <div class="color-cell combo-item back-color-cell-default" data-value="<%=defaultValue%>" style="background-color:<%=defaultValue%>;"></div>\n            <div class="color-label color-label-default">默认无背景色</div>\n        </div>\n        <hr class="color-section-split">\n        <div class="color-section color-section-theme">\n            <div class="color-label color-label-theme">主题颜色</div>\n            <div class="color-row">\n            <% for (key in items.theme) { %>\n                <div class="color-cell combo-item" data-value="<%=items.theme[key]%>" style="background-color:<%=items.theme[key]%>;"></div>\n            <% } %>\n            </div>\n            <div class="color-row-split"></div>\n            <div class="color-part-theme">\n            <% for (row in items.other) { %>\n                <div class="color-row">\n                <% for (key in items.other[row]) { %>\n                    <div class="color-cell combo-item" data-value="<%=items.other[row][key]%>" style="background-color:<%=items.other[row][key]%>;"></div>\n                <% } %>\n                </div>\n            <% } %>\n            </div>\n        </div>\n        <hr class="color-section-split">\n        <div class="color-section color-section-standard">\n            <div class="color-label color-label-standard">推荐颜色</div>\n            <div class="color-row">\n            <% for (key in items.standard) { %>\n                <div class="color-cell combo-item" data-value="<%=items.standard[key]%>" style="background-color:<%=items.standard[key]%>;"></div>\n            <% } %>\n            </div>\n        </div>\n        <hr class="color-section-split">\n        <div class="color-section color-section-other combo-item">\n            <div class="color-img-other"></div>\n            <div class="color-label color-label-other">其他颜色</div>\n        <div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common">\n            <span class="combo-value-buttom-color"></span>\n        </span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <div class="combo-menu combo-menu-<%=name%>">\n        <div class="color-section color-section-default combo-item" data-value="<%=defaultValue%>">\n            <div class="color-cell combo-item color-cell-default" data-value="<%=defaultValue%>" style="background-color:<%=defaultValue%>;"></div>\n            <div class="color-label color-label-default">默认颜色</div>\n        </div>\n        <hr class="color-section-split">\n        <div class="color-section color-section-theme">\n            <div class="color-label color-label-theme">主题颜色</div>\n            <div class="color-row">\n            <% for (key in items.theme) { %>\n                <div class="color-cell combo-item" data-value="<%=items.theme[key]%>" style="background-color:<%=items.theme[key]%>;"></div>\n            <% } %>\n            </div>\n            <div class="color-row-split"></div>\n            <div class="color-part-theme">\n            <% for (row in items.other) { %>\n                <div class="color-row">\n                <% for (key in items.other[row]) { %>\n                    <div class="color-cell combo-item" data-value="<%=items.other[row][key]%>" style="background-color:<%=items.other[row][key]%>;"></div>\n                <% } %>\n                </div>\n            <% } %>\n            </div>\n        </div>\n        <hr class="color-section-split">\n        <div class="color-section color-section-standard">\n            <div class="color-label color-label-standard">推荐颜色</div>\n            <div class="color-row">\n            <% for (key in items.standard) { %>\n                <div class="color-cell combo-item" data-value="<%=items.standard[key]%>" style="background-color:<%=items.standard[key]%>;"></div>\n            <% } %>\n            </div>\n        </div>\n        <hr class="color-section-split">\n        <div class="color-section color-section-other combo-item">\n            <div class="color-img-other"></div>\n            <div class="color-label color-label-other">其他颜色</div>\n        <div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common"></span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <ul class="combo-menu combo-menu-<%=name%>">\n    <% for (font in items) { %>\n        <li class="combo-item" data-value="<%=items[font].singleValue%>">\n            <span style="font-family:<%=items[font].fullValue%>;"><%=items[font].name%></span>\n        </li>\n    <% } %>\n    </ul>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common"></span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <ul class="combo-menu combo-menu-<%=name%>">\n    <% for (key in items) { %>\n        <li class="combo-item" data-value="<%=key%>">\n            <span><%=items[key]%></span>\n        </li>\n    <% } %>\n    </ul>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%>"></span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <ul class="combo-menu combo-menu-<%=name%>">\n    <% for (key in items) { %>\n        <li class="combo-item" data-value="<%=key%>">\n            <span style="font-size: <%=items[key][\'font-size\']%>px"><%=items[key].name%></span>\n        </li>\n    <% } %>\n    </ul>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper combo-link-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper combo-value-wrapper-<%=name%>">\n        <span class="combo-value combo-value-<%=name%> svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper  wrapper-<%=name%>">\n    <div class="combo-menu combo-menu-<%=name%>">\n        <span class="link-label">链接</span>\n        <input class="link-input" type="text" name="link" placeholder="输入链接" />\n        <div class="link-button">\n            <span class="link-button-text">确定</span>\n        </div>\n    </div>\n</div>\n\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common"></span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <ul class="combo-menu combo-menu-<%=name%>">\n    <% for (idx in items) { %>\n        <li class="combo-item" data-value="<%=items[idx].key%>">\n            <span class="combo-item-icon-<%=name%> line-height-<%=idx%>">&nbsp;</span>\n            <span class="combo-item-span-<%=name%>"><%=items[idx].value%></span>\n        </li>\n    <% } %>\n    </ul>\n</div>\n\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common">\n        </span>\n        <span class="combo-text combo-text-<%=name%>">纸张背景</span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <div class="combo-menu combo-menu-<%=name%> svg-common">\n        <div class="background-section-top">\n            <% for (row in items.normalUser) { %>\n            <div class="background-row">\n                <% for (key in items.normalUser[row]) { %>\n                    <% if (items.normalUser[row][key] === \'NoBackground\') { %>\n                        <div class="background-cell combo-item" data-value="<%=items.normalUser[row][key]%>">\n                            <svg class="background-cell-check-mark" xmlns="http://www.w3.org/2000/svg" viewBox="-16 -16 52 52"><path d="M1.05584113,8.97696545 C0.884930054,8.78831051 0.877161369,8.59965557 1.03253508,8.41100063 L1.52196226,7.7742902 C1.6617986,7.56991402 1.84047836,7.53847153 2.05800155,7.67996273 L6.39292802,10.6748599 C6.79689966,10.9421211 7.19310261,10.9185392 7.58153688,10.6041143 L19.1180347,0.982712344 C19.3044832,0.825499894 19.4831629,0.833360516 19.654074,1.00629421 L19.9104406,1.26569475 C20.0813517,1.43862845 20.0813517,1.61942277 19.9104406,1.80807771 L7.53492477,14.5187043 C7.17756524,14.880293 6.8279744,14.8881536 6.48615224,14.5422862 L1.05584113,8.97696545 Z"/></svg>\n                        </div>\n                    <% } else { %>\n                        <div class="background-cell combo-item" data-value="<%=items.normalUser[row][key]%>" style="background-image:url(\'<%=items.normalUser[row][key]%>\');">\n                            <svg class="background-cell-check-mark" xmlns="http://www.w3.org/2000/svg" viewBox="-16 -16 52 52"><path d="M1.05584113,8.97696545 C0.884930054,8.78831051 0.877161369,8.59965557 1.03253508,8.41100063 L1.52196226,7.7742902 C1.6617986,7.56991402 1.84047836,7.53847153 2.05800155,7.67996273 L6.39292802,10.6748599 C6.79689966,10.9421211 7.19310261,10.9185392 7.58153688,10.6041143 L19.1180347,0.982712344 C19.3044832,0.825499894 19.4831629,0.833360516 19.654074,1.00629421 L19.9104406,1.26569475 C20.0813517,1.43862845 20.0813517,1.61942277 19.9104406,1.80807771 L7.53492477,14.5187043 C7.17756524,14.880293 6.8279744,14.8881536 6.48615224,14.5422862 L1.05584113,8.97696545 Z"/></svg>\n                        </div>\n                    <% } %>\n                <% } %>\n                </div>\n            <% } %>\n        </div>\n        <hr class="background-section-split">\n        <div class="background-section-bottom">\n            <div class="background-label background-label-vip">会员特权</div>\n            <% for (row in items.VIP) { %>\n                <div class="background-row">\n                <% for (key in items.VIP[row]) { %>\n                    <div class="background-cell combo-item" data-value="<%=items.VIP[row][key]%>" style="background-image:url(\'<%=items.VIP[row][key]%>\');">\n                        <svg class="background-cell-check-mark" xmlns="http://www.w3.org/2000/svg" viewBox="-16 -16 52 52"><path d="M1.05584113,8.97696545 C0.884930054,8.78831051 0.877161369,8.59965557 1.03253508,8.41100063 L1.52196226,7.7742902 C1.6617986,7.56991402 1.84047836,7.53847153 2.05800155,7.67996273 L6.39292802,10.6748599 C6.79689966,10.9421211 7.19310261,10.9185392 7.58153688,10.6041143 L19.1180347,0.982712344 C19.3044832,0.825499894 19.4831629,0.833360516 19.654074,1.00629421 L19.9104406,1.26569475 C20.0813517,1.43862845 20.0813517,1.61942277 19.9104406,1.80807771 L7.53492477,14.5187043 C7.17756524,14.880293 6.8279744,14.8881536 6.48615224,14.5422862 L1.05584113,8.97696545 Z"/></svg>\n                    </div>\n                <% } %>\n                </div>\n            <% } %>\n        </div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="toolbar-more-split"></div>\n<div class="combo-display-wrapper combo-showmore-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper combo-value-wrapper-<%=name%>">\n        <span class="combo-value combo-value-<%=name%>">更多</span>\n        <span class="combo-expand-gray svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper  wrapper-<%=name%>">\n    <div class="combo-menu combo-menu-<%=name%>">\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <div class="combo-menu combo-menu-<%=name%>">\n    <% for (var i=0; i<maxRows; i++) { %>\n        <div class="combo-item-row">\n        <% for (var j=0; j<maxCols; j++) { %>\n            <span class="combo-item" data-row="<%=i%>" data-col="<%=j%>"></span>\n        <% } %>\n        </div>\n    <% } %>\n    <div class="combo-menu-label-<%=name%>">插入表格</div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper">\n    <div class="combo-value-wrapper"></div>\n    <div class="combo-expand-wrapper"></div>\n</div>\n<div class="combo-menu-wrapper"></div>\n'},function(e,t){e.exports='<div class="toolbar-container">\n    <% \n        _.each(items, function(conf, key){\n            if(conf.type === \'button\') {\n    %>\n                <button class="<%= key%>" action="<%= conf.action%>" name="<%= conf.name%>" type="button" data-yne-is-block="<%= !!conf.block%>"><%= conf.label%></button>\n    <%      \n            } else if(conf.type === \'select\') {\n    %>\n                <select class="<%= key%>" action="<%= conf.action%>" name="<%= conf.name%>" data-yne-is-block="<%= !!conf.block%>">\n    <%\n                    _.each(conf.options, function(value, key) {\n    %>\n                        <option value="<%= key%>"><%= value%></option>\n    <%                       \n                    });\n    %>\n                </select>\n    <%\n            }\n        });\n    %>\n\n</div>'},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(6),n(139),n(145),n(28),n(138),n(58),n(8),n(118),n(260),n(490),n(493)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h,g){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.xml2html=function(e){return(i.fromXml(e)||new i({})).toHtml()},t.html2xml=function(e){return(i.fromHtml(e)||new i({})).toXml()},t.html2html=function(e){return(i.fromHtml(e)||new i({})).toHtml()},t.ocr2xml=function(e){return(i.fromOCR(e)||new i({})).toXml()},t.prototype.getInstance=function(){return this.coreEditor},t.prototype.initialize=function(e){var t,i=this,r=n.extend({pageType:o.PAGE_TYPE_A4,parentEl:null,removeLocalImg:!1,render:!0,sessionType:0,useHttpsConvert:!1},e);if(r.render&&!r.parentEl)throw new Error("BulbEditor need `parentEl`!");null!=localStorage&&(r.viewMode=parseInt(localStorage.getItem(u.name+":view-mode"),10)),r.viewMode=d.parseToNumber(r.viewMode,0),0!==r.viewMode&&2!==r.viewMode&&(r.viewMode=0),i.coreEditor=t=new p(r),r.render&&t.render(),n.each(g,function(e){var n="yne-"+e;t.bind(n,function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(!i.coreEditor.isIdleTimeout()||"download-image"!==e&&"download-attachment"!==e)&&("view-mode-change"===e&&null!=localStorage&&null!=t[0]&&localStorage.setItem(u.name+":view-mode",t[0]),i.trigger.bind(i,e).apply(i,t))})})},t.FONT_NAME=c({DEFAULT:l.getFont(a["font-family"].default),LIST:l.getNames()}),t.FONT_SIZE=c({DEFAULT:a["font-size"].default,LIST:s.getAsArray()}),t}(h)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(2),n(58),n(1)],void 0!==(i=function(e,t,n,o,i,r){"use strict";var a={align:{type:"Enum",possible:{left:!0,right:!0,center:!0,justify:!0},default:"left"},"line-height":{type:"Number",default:1.75},indent:{type:"Number",default:0},"text-indent":{type:"Number",default:0},width:{type:"Number",default:null},float:{type:"Enum",possible:{none:!0,left:!0,right:!0},default:"none"},height:{type:"Number",default:1},color:{type:"String",default:"#999999"},"back-color":{type:"String",default:""},padding:{type:"String",default:""}},l={},s={},c={};return l[o.HR]={width:{type:"Number",default:100},margin:{type:"String",default:"none"}},s[o.PARAGRAPH]=["align","indent","text-indent","line-height","back-color","padding"],s[o.LIST_ITEM]=["align","indent","text-indent","line-height","back-color","padding"],s[o.HEADING]=["align","indent","text-indent","line-height","back-color","padding"],s[o.CATALOGUE]=["align","indent","text-indent","line-height","back-color","padding"],s[o.TODO]=["align","indent","text-indent","line-height","back-color","padding"],s[o.IMAGE]=["align","width","float","height","back-color","padding"],s[o.ATTACHMENT]=["align","float","back-color","padding"],s[o.HR]=["align","width","height","color","back-color","padding","margin"],s[o.TABLE]=["back-color","padding"],n.each(o.getAllBlockTypes(),function(e){s[e]||r.warn("no block style config for block["+e+"]")}),n.each(o.getAllBlockTypes(),function(e){var t={},o=s[e]||[],i=l[e];n.each(o,function(e){i&&i[e]?t[e]=i[e]:a[e]?t[e]=a[e]:r.error("no config for style named ["+e+"]")}),c[e]=t}),r.log("xml block style config",c),i(c)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(0),i=n(15),r=n(224),a=n(229),l=n(52),s=n(230);return t=i.extend({_mapper:{},_blackTagList:{},constructor:function(e){var t=this;t._mapper={},t._blackTagList={},o.each(e,function(e,n){!1===e?t._blackTagList[n]=!0:e&&o.isObject(e)&&t.define(n,e)})},parse:function(e,t){var n,i,a,c=this,u=new s,d=/<html[\S\s]*<\/html>/i;return e=e.replace(/<!--[\w\W]*?-->/i,""),d.test(e)&&(e=e.match(d)[0]),n=l(e,document,!0),n?i=new r(n):(n=document.createElement("div"),n.innerHTML=e,i=new r(n)),a=n.getElementsByTagName("style"),a&&o.each(a,function(e){u.parse(e.innerText)}),i.internalStylesParser=u,c._parseRecursively(i,c,t),i.blocks},_shouldBreak:function(e){return!e||!e.style||("none"===e.style.display||"hidden"===e.style.visibility)},_parseRecursively:function(e,t,n){var i,r,l,s,c,u=this,d=e.el;if(!0!==u._shouldBreak(d)){if(e.setup(),!0!==e.handleChildrenBySelf())for(i=d.firstChild;i;)1===i.nodeType?(c=i.tagName.toLowerCase(),u._blackTagList[c]||(l=u._findHandlers(i),l=o.isFunction(l)?l:a,s=new l(i,e,e.internalStylesParser,t,n),u._parseRecursively(s,t,n))):3===i.nodeType&&(r=i.textContent)&&e.capture({text:r,styles:e.styles,isText:!0}),i=i.nextSibling;e.finish()}},define:function(e,n,o){this._mapper[e]={Class:n,priority:o||t.PRIORITY.DEFAULT}},_findHandlers:function(e){var t=[],n=function(e,t){if(e)return e.matches?e.matches(t):e.webkitMatchesSelector?e.webkitMatchesSelector(t):void 0};if(o.each(this._mapper,function(o,i){n(e,i)&&t.push(o)}),0!==t.length)return t.sort(function(e,t){return t.priority-e.priority}),t[0].Class}},{PRIORITY:{HIGH:1,DEFAULT:0,LOW:-1}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(86),o=n(25);return t.extend({constructor:function(e){var n=this;t.call(this,e,null),n.blocks=[]},setup:function(){var e=this;t.prototype.setup.apply(e),e.blocks=[]},emit:function(e){var t=this;e&&e instanceof o&&t.blocks.push(e)},finish:function(){this.emitBlock()},getRoot:function(){return this}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(1),i={h1:32,h2:24,h3:18,h4:16,h5:13,h6:12},r={1:12,2:13,3:16,4:18,5:24,6:32,7:48},a={b:function(e){e.bold=!0},i:function(e){e.italic=!0},u:function(e){e.underline=!0},strike:function(e){e.strike=!0},code:function(e){e["font-family"]="monospace"},mark:function(e){e["back-color"]="#ffff00",e.color="#000000"},font:function(e,t){var n,o=t.getAttribute("color"),i=t.getAttribute("face"),a=t.getAttribute("size");o&&(e.color=o),i&&(e["font-family"]=i),a&&(n=r[a])&&(e["font-size"]=n)},pre:function(e){e["white-space"]="pre"},a:function(e,t){t&&t.href&&(e.color="#003884",e.underline=!0)}},l=function(e,n){var i=a[e];if(!i)return void o.error("The tag handler for `"+e+"` does not exist!");t.each(n,function(e){a[e]||(a[e]=i)})};return t.each(i,function(e,t){a[t]=function(t){t.bold=!0,t["font-size"]=e}}),l("b",["strong"]),l("i",["em","cite","var","address","dfn"]),l("strike",["s","del"]),l("u",["ins"]),l("code",["tt","kbd","samp","pre","xmp","plaintext","listing"]),a}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(22),o=n(38),i={};return function(e,n){var r,a;if((e=o(e).trim().toLowerCase().value())&&"inherit"!==e){if(n&&"transparent"===e)return e;if(r=i[e])return"null"===r?void 0:r;if(a=t(e),a.isValid())return 0===a.getAlpha()?void(i[e]="null"):(r=a.toHexString(),i[e]=r,r);i[e]="null"}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(59),n(1),n(114),n(20)],void 0!==(i=function(e,t,n,o,i,r,a){"use strict";return function(){function e(e){o(r.checkValid(e)),this.char=e,this.length=e.length,this.styles={}}return e.fromJSON=function(t){if(t&&t.char){var o=new e(t.char);return n.each(t.styles,function(e,t){o.setStyle(t,e)}),o}},e.prototype.clone=function(){var t=new e(this.char);return t.styles=n.clone(this.styles),this.unknownStyles&&(t.unknownStyles=n.clone(this.unknownStyles)),t},e.prototype.getStyle=function(e,t,o){void 0===t&&(t=!0);var r,l=t&&o&&void 0!==o[e]?o[e]:null,s=a.getConfig(e);return s?null==(r=this.styles[e])?t?null===l?s.default:l:null:(n["is"+s.type](r)||(i.warn("The value `"+r+"` of `"+e+"` is not valid type!"),r=null),t?null==r?null===l?s.default:l:r:r===s.default?null:r):null},e.prototype.getStyles=function(){var e=this,t={},o=a.getAllConfig();return n.each(o,function(n,o){t[o]=e.getStyle(o)}),t},e.prototype.getUnknownStyle=function(e){var t=this.unknownStyles;if(t)return t[e]},e.prototype.isLineBreak=function(){return"\r"===this.char||"\n"===this.char},e.prototype.removeStyles=function(){this.styles={}},e.prototype.setStyle=function(e,t){var o=this.styles,r=a.getConfig(e);if(!r)return void i.warn("The RichText does not support `"+e+"` style!");if(t&&!n["is"+r.type](t))switch(r.type){case"Number":t=Number(t),t=isNaN(t)?r.default:t;break;case"Boolean":t=t+""=="true";break;default:i.warn("The value `"+t+"` of `"+e+"` is not valid type!"),t=null}!t||(r.equalDefault?r.equalDefault(t):t===r.default)?delete o[e]:o[e]=t},e.prototype.setUnknownStyle=function(e,t){if(a.isSupport(e))return void i.warn("The RichText supports `"+e+"` style!");this.unknownStyles||(this.unknownStyles={}),this.unknownStyles[e]=t},e.prototype.toJSON=function(){var e=this,t={char:e.char},o={},i=!1,r=a.getAllConfig();return n.each(r,function(t,n){var r=e.getStyle(n,!1);r&&(o[n]=r,i=!0)}),i&&(t.styles=o),t},e.prototype.toString=function(){return this.char},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(38),i=["normal","nowrap","pre-line"],r=function(e,t){return t&&"normal"!==t&&"nowrap"!==t?"pre-line"===t?e.replace(/[ \t]+/g," "):e:e.replace(/[ \t\r\n]+/g," ")},a=function(e,t){return t&&"normal"!==t&&"nowrap"!==t?"pre-line"===t?e.replace(/^[ \t]+/g,""):e:e.replace(/^[ \t\r\n]+/g,"")},l=function(e,t){return t&&"normal"!==t&&"nowrap"!==t?"pre-line"===t?e.replace(/[ \t]+$/g,""):e:e.replace(/[ \t\r\n]+$/g,"")},s=function(e){var n=e.styles["white-space"];return!n||t.contains(i,n)};return function(e){var n,i,c,u,d,p;for(t.each(e,function(e){e.text=r(e.text,e.styles["white-space"])}),c=e.length,n=0;n<c&&(u=e[n],u.text=a(u.text,u.styles["white-space"]),!u.text);n++);for(n=0,i=1;i<c;i++)d=e[n],p=e[i],s(d)&&s(p)&&(o.endsWith(d.text," ")&&o.startsWith(p.text," ")&&(p.text=p.text.slice(1)),""===p.text)||(n=i);for(n=c-1;n>=0&&(u=e[n],u.text=l(u.text,u.styles["white-space"]),!u.text);n--);return e}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(50).extend({_computeStyles:function(){var e=this,t=e.parent;t&&(e.styles=t.styles)},capture:function(e){this.emit(e)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(15),i=n(133),r=n(132),a=n(7),l=n(1);return o.extend({_internalStyles:{},constructor:function(){this._internalStyles={}},parse:function(e){var n,o,r,a=this,s={},c={};if(!0===l.DEBUG)n=i.parse(e);else try{n=i.parse(e)}catch(e){return{}}return n.cssRules?(t.each(n.cssRules,function(e){e.selectorText&&e.style&&(c={},o=e.style,t.each(o,function(e){c[e]=o[e]}),-1!==e.selectorText.indexOf(",")?(r=e.selectorText.split(","),t.each(r,function(e){e=e.trim(),s[e]={selectorText:e,style:c}})):(e.selectorText=e.selectorText.trim(),s[e.selectorText]={selectorText:e.selectorText,style:c}))}),a._internalStyles=t.extend(a._internalStyles,s),s):{}},getInternalStyles:function(){return this._internalStyles},getStylesBySpecificity:function(e,n){var o=this,i={},r=o._internalStyles,l=[],s=0;return r?(t.each(r,function(t){try{a(e).is(t.selectorText)&&l.push(t)}catch(e){}}),l.sort(function(e,t){return-1*o._specificityCompare(e.selectorText,t.selectorText)}),t.some(l,function(e){if(e.style&&t.some(e.style,function(e,o){if(s===n.length)return!0;o in i||-1===t.indexOf(n,o)||(i[o]=e,s++)}),s===n.length)return!0}),i):{}},_specificityCompare:function(e,t){return r.compare(e,t)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(){return["maction","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msubsup","msup","mtable","mtd","mtext","mtr","munder","munderover","semantics"]}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(){return["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"]}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return{AnchorHandler:n(234),BreakHandler:n(235),HrHandler:n(236),ImageHandler:n(149),InlineHandler:n(88),ListHandler:n(151),ListItemHandler:n(237),ParagraphHandler:n(86),TableHandler:n(238),TodoHandler:n(250)}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(50);return t.extend({inheritStyleHandlers:{bold:!0,italic:!0,underline:!0,strike:!0,"font-family":!0,"font-size":!0,color:!0,"back-color":!0,"white-space":!0},constructor:function(e,n,o){t.call(this,e,n,o)},capture:function(e){var t=this,n=t.el.getAttribute("href");if(!n||"#"===n||0===n.indexOf("javascript"))return void t.emit(e);e&&!0===e.isText?(e.styles.href=e.styles.href||n,t.emit(e)):t.emit(e)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(88);return t.extend({inheritStyleHandlers:!1,inheritBlockStyles:{"line-height":!0,indent:!0,"text-indent":!0},finish:function(){var e=this;e.emit({isBr:!0,styles:e.styles})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(50),o=n(73),i=n(0),r=n(71),a=n(2);return t.extend({computeBulbStyles:function(){var e,t=this,n=t.el,o=n.getAttribute("yne-bulb-block");"hr"===o&&(e=r.getStyleNamesOfBlock(a.HR),i.each(e,function(e){var o=n.getAttribute("yne-style-"+e);o&&(t.styles[e]=o)}))},finish:function(){var e=this,t=new o;e.styles&&t.setBlockStyles(e.styles),e.emit(t)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(86),o=n(34),i=n(151);return t.extend({setup:function(){var e=this;e.ownerListHandler=e._findOwnerListHandler()},captureBlock:function(e){var t=this,n=null;t.emitBlock(),!t._listed&&e.getType&&"paragraph"===e.getType()?(n=t.createBlock(),n.append(e.getText()),t.emit(n)):t.emit(e)},emit:function(e){var n=this;e instanceof o&&(n._listed=!0),t.prototype.emit.call(n,e)},createBlock:function(){var e,n,i=this,r=i.ownerListHandler;return!i._listed&&r&&r.list?(r.increaseItemCounter(),n=r.list,e=new o({list:n}),n&&n.addItem&&n.addItem(e),e):t.prototype.createBlock.call(i)},_findOwnerListHandler:function(){for(var e=this.parent;e;){if(e instanceof i)return e;e=e.parent}}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(50),o=n(63),i=n(77),r=n(75),a=n(65),l=n(64),s=n(91),c=n(149),u=n(1),d=n(7),p=n(0),h=n(249),g=n(110),f=n(2),m=function(e,t){var n;if(e&&e.tagName){if((n=(e.tagName+"").toLowerCase())===t+"")return!0;if(p.contains(t,n))return!0}},_=function(e,t,n){if(!e)return n;var o=e.getAttribute(t);return o=parseInt(o||n,10),isNaN(o)&&(o=n),o},y=function(e,t,n){if(!e)return n;var o=e.style[t];return o=parseInt(o||n,10),isNaN(o)&&(o=n),o};return t.extend({DEFAULT_HEIGHT:40,DEFAULT_WIDTH:70,_styleHandlers:{bold:{tagList:["b","strong"],styleHandler:function(e){return g.bold.action(e,{},null)}},lineThrough:{tagList:["strike","s","del"],styleHandler:function(e){return g.strike.action(e,{},null)}},underline:{tagList:["u","ins"],styleHandler:function(e){return g.underline.action(e,{},null)}},italic:{tagList:["i","em","cite","var","address","dfn"],styleHandler:function(e){return g.italic.action(e,{},null)}},fontName:function(e){var t=g["font-family"].action(e,{},null);return t||("FONT"===e.tagName?(t=e.getAttribute("face"))||null:void 0)},fontSize:function(e){var t=g["font-size"].action(e,{},null);if(t)return t+"px"},textColor:function(e){var t=g.color.action(e,{},null);return t||("FONT"===e.tagName?(t=e.getAttribute("color"))||null:void 0)},backColor:function(e){return g["back-color"].action(e,{},null)},textAlign:function(e){return g.align.action(e,{},null)}},_tableStyleHandlers:{verticalAlign:function(e){var t=["THEAD","TBODY","TFOOT"];if(e)return e.style.verticalAlign||e.getAttribute("valign")||(e.tagName&&p.contains(t,e.tagName)?"middle":void 0)},textAlign:function(e){if(e)return e.style&&e.style.textAlign?e.style.textAlign:e.getAttribute("align")},textColor:function(e){return g.color.action(e,{},null)},backColor:function(e){return e.style.backgroundColor||null},bold:function(e){return e&&e.tagName&&"TH"===e.tagName?"true":g.bold.action(e,{},null)?"true":void 0},italic:function(e){if(g.italic.action(e,{},null))return"true"},underline:function(e){if(g.underline.action(e,{},null))return"true"},lineThrough:function(e){if(g.strike.action(e,{},null))return"true"},fontName:function(e){return g["font-family"].action(e,{},null)},fontSize:function(e){var t=g["font-size"].action(e,{},null);if(t)return t+"px"}},constructor:function(e,t,n,o){var i=this;i.el=e,i.parent=t,i.internalStylesParser=n,i._parser=o},handleChildrenBySelf:function(){return!0},_inheritStyles:function(e,t,n){var o=this,i={};return n=n||{},p.each(o._styleHandlers,function(o,r){var a;!1!==e[r]&&(p.isFunction(o)?a=o(t):(o.styleHandler&&(a=o.styleHandler(t)),!a&&o.tagList&&(a=m(t,o.tagList))),a&&"inherit"!==a||(a=n[r]),i[r]=a)}),i},_mergeStyles:function(e,t){var n=this,o=d.trim(e.value),i=o.length;p.each(n._styleHandlers,function(n,o){0===i?t[o]?e[o]=t[o]:e[o]=!1:e[o]&&t[o]!==e[o]&&(e[o]=!1)})},_inheritTableStyles:function(e,t){var n=this,o={},i=["TABLE","THEAD","TBODY","TFOOT","TR","TD","TH"];return p.contains(i,e.tagName+"")?(t=t||{},p.each(n._tableStyleHandlers,function(n,i){var r=n(e);null!=r&&"inherit"!==r||(r=t[i]),null!=r&&(o[i]=r)}),o):{}},_parseImage:function(e,t){var n,o,i=e.getAttribute("src");if(c.isNoteLink(e))return o=e.getAttribute("alt")||"",void(t.value+=o);i&&(c.isAttachment(e)?(n=e.getAttribute("path"),t.value=l.create({source:i,resource:n,fileLength:c.getAttachmentFileLength(e),fileName:c.getAttachmentFileName(e)})):c.isImage(e)&&(t.value=a.create({source:i})))},_shouldAddLineBreak:function(e){e=(e+"").toLowerCase();var t=["article","aside","blockquote","br","button","caption","col","colgroup","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","map","ol","output","p","pre","progress","section","textarea","tfoot","ul","video"];return p.contains(t,e)},_isLinkCell:function(e){if(!e)return!1;var t,n,o,i,r,a,l,s=e.querySelectorAll("a");if(!s||!s.length||1!==s.length)return!1;for(t=s[0],o=t,n=o.parentNode;n&&n!==e;){for(i=n.childNodes,r=i.length,a=0;a<r;a++)if((l=i[a])!==o&&!function(e){return!e||(1===e.nodeType?""===d.trim(e.textContent||""):3!==e.nodeType||""===d.trim(e.nodeValue||""))}(l))return!1;o=n,n=o.parentNode}return!0},_parseCell:function(e,t,n){var o,i,s,c,u,d=this,g={value:""},m=d.internalStylesParser,y=["font-size","font-family","font-style","font-weight","color","background-color","background","text-decoration","text-align","vertical-align","white-space","word-wrap","word-space"],v=r.createBlank(),b=!1;return u=d._parser.parse(e.innerHTML),p.any(u,f.isTextBlock.bind(f))?p.each(u,function(e){f.isTextBlock(e)?v.appendRichText(e.getText()):(f.isImage(e)||f.isAttachment(e)||f.isTable(e)||f.isHr(e))&&d._blockList.push(e)}):p.each(u,function(e){(f.isTable(e)||f.isHr(e))&&d._blockList.push(e),b?(f.isImage(e)||f.isAttachment(e))&&d._blockList.push(e):f.isImage(e)?(v=a.create({source:e.getSource(),width:e.getStyles("width"),height:e.getStyles("height")}),b=!0):f.isAttachment(e)&&(v=l.create({source:e.getSource(),resource:e.getResource(),fileLength:e.getFileLength(),fileName:e.getFileName()}),b=!0)}),o={value:v},o.value&&g.link&&(o.link=g.link),n===d.DEFAULT_HEIGHT&&(o.wrap="true"),p.each(d._styleHandlers,function(e,t){!0===g[t]?o[t]="true":g[t]&&(o[t]=g[t])}),i=_(e,"colspan",1),i>1&&(o.mergeWidth=i,o.mergeHeight=o.mergeHeight||1),i=_(e,"rowspan",1),i>1&&(o.mergeHeight=i,o.mergeWidth=o.mergeWidth||1),s=d._inheritTableStyles(e,t),p.each(s,function(e,t){null==o[t]&&e&&(o[t]=e)}),c=m.getStylesBySpecificity(e,y),p.each(c,function(t,n){var o=e.style.getPropertyValue(n);null!=o&&""!==o||e.style.setProperty(n,t)}),p.each(d._tableStyleHandlers,function(t,n){var i=t(e);null==o[n]&&null!=i&&(o[n]=i)}),h(o.backColor)&&delete o.backColor,o},_isArrayFull:function(e,t){var n;if(0===t)return!1;for(n=0;n<t;n++)if(null==e[n])return!1;return!0},_parseTbodyCells:function(e,t,n){var o,i=this,a=p.filter(t.children,i._isTableRow),l=[],s=e.widths.length,c=e.heights.length,u=0;return o=i._inheritTableStyles(t,n),p.each(a,function(t){var n=p.filter(t.children,i._isTableCell),a=i._inheritTableStyles(t,o),d=u,h=l[d];if(0!==n.length){for(;h&&i._isArrayFull(h,s);)u++,d++,h=l[d];for(h||(h=l[d]=[]),p.each(n,function(t){for(var n,o,s,u,p,g,f,m,y,v=0,b=h[v];b;)v++,b=h[v];for(n=v,u=i._parseCell(t,a,e.heights[d]),h[n]=u,o=_(t,"rowspan",1),s=_(t,"colspan",1),o>c-d&&(o=c-d,u.mergeHeight=o),p=0;p<o;p++)for(f=d+p,y=l[f],y||(y=l[f]=[]),g=0;g<s;g++)m=n+g,y[m]||(y[m]={mergePointDX:g,mergePointDY:p,value:r.createBlank(!0)})});h.length<s;)h.push({value:""});u++}}),l},_isTableCell:function(e){if(!e||!e.tagName)return!1;var t=e.tagName||"",n=["TD","TH"];return p.contains(n,t)},_isTableRow:function(e){return!(!e||!e.tagName)&&"TR"===e.tagName},_getTbodySize:function(e){var t,n,o,i,r,a,l=this,s=[],c=0,u=0,d=[];for(p.each(e,function(t){var n,o,i=u,r=s[i];if(n=p.filter(t.children,l._isTableCell),0!==n.length){for(;r&&l._isArrayFull(r,c);)i++,r=s[i];u=i,r||(r=s[i]=[],d[i]=e[i]),p.each(n,function(t,n){var a,c,u,p,h,g,f=_(t,"colspan",1),m=_(t,"rowspan",1),v=y(t,"width",0)||_(t,"width",0);for(o+=f,v=Math.max(Math.round(v/f),l.DEFAULT_WIDTH),p=n;null!=r[p];)p++;for(u=0;u<f;u++)h=p+u,r[h]=v;for(a=1;a<m;a++)for(c=i+a,g=s[c],g||(g=s[c]=[],d[c]=e[c]),u=0;u<f;u++)h=p+u,g[h]=v}),o=r.length,c<o&&(c=o)}}),t=s.length,a=[],n=0;n<c;n++){for(i=(s[0]||[])[n]||l.DEFAULT_WIDTH,o=1;o<t;o++)(r=(s[o]||[])[n])&&r>i&&(i=r);a.push(i)}return{rows:t,columns:c,columnWidthList:a,compactTrList:p.compact(d)}},_createBlankRow:function(e){for(var t=[];e>0;)t.push({value:""}),e--;return t},_parseColgroup:function(e){var t=this,n=p.filter(e.children,t._isCol);return p.map(n,function(e){return parseFloat(e.style.width)})},_isCol:function(e){return!(!e||!e.tagName)&&"COL"===e.tagName},_parseTbody:function(e,t,n){var o,i,r,a,l=this,s=p.filter(e.children,l._isTableRow),c=0,u={},d=[],h=0;for(a=l._getTbodySize(s),s=a.compactTrList,u.heights=p.map(s,function(e){if(e.style.height)return parseFloat(e.style.height);var t=p.filter(e.children,l._isTableCell),n=0;return p.some(t,function(e){if(!e.getAttribute("rowspan")){var t=y(e,"height",0)||_(e,"height",0);if(t)return n=t,!0}}),n=Math.max(n,l.DEFAULT_HEIGHT)});u.heights.length<a.rows;)u.heights.push(l.DEFAULT_HEIGHT);if(h=0,p.each(a.columnWidthList,function(e){h+=e}),h<n?(i=Math.ceil((n-h)/a.columns),d=p.map(a.columnWidthList,function(e){return e+i})):d=a.columnWidthList,u.widths=d,o=l._parseTbodyCells(u,e,t),r=o.length,(c=u.heights.length)>r)for(;r<c;)o.push(l._createBlankRow(a.columns)),r++;else if(c<r)for(;c<r;)u.heights.push(l.DEFAULT_HEIGHT),c++;return u.cells=o,u},_extendBodyInfo:function(e,t){var n,o,i,r=e.cells,a=e.heights.length,l=e.widths.length;if(!(l>=t))for(n=0;n<a;n++)for(o=r[n],i=o.length;i<t;i++)o.push({value:""})},_convertToTableCells:function(e,t){var n,o,a,l,c=e.length,d=[];for(n=0;n<c;n++)for(o=e[n],d[n]=[],a=0;a<t;a++)l=o[a],l?d[n].push(i.create({content:l.value||r.createBlank(),mergeWidth:l.mergeWidth,mergeHeight:l.mergeHeight,mergePointDX:l.mergePointDX,mergePointDY:l.mergePointDY,styles:p.pick(l,s.getAllStyleNames())})):u.error("No tdInfo  at row, col: "+n+", "+a);return d},_mergeTbody:function(e){if(e&&e.length){var t,n=this,o=0,i=[],r=[],a={};return p.each(e,function(e){var n=e.widths.length;n>o&&(o=n,t=e.widths)}),p.each(e,function(e){n._extendBodyInfo(e,o)}),p.each(e,function(e){i=i.concat(e.heights),r=r.concat(e.cells)}),r=n._convertToTableCells(r,o),a.widths=t,a.heights=i,a.cells=r,a}},_parseTable:function(e){var t,n,o=this,i=p.toArray(e.children),r=["thead","tbody","tfoot"],a={thead:[],tbody:[],tfoot:[]},l=[],s=o._blockList.length,c=o._inheritTableStyles(e,{}),u=y(e,"width",0)||_(e,"width",0);o._blockList.push(0),p.each(i,function(e){var t,i=(e.tagName||"").toLowerCase();"colgroup"===i&&(n=o._parseColgroup(e)),p.contains(r,i)&&(t=o._parseTbody(e,c,u),p.extend(t.widths,n),a[i].push(t))}),p.each(r,function(e){var t=a[e];t&&t.length&&(l=l.concat(t))}),(t=o._mergeTbody(l))&&(o._blockList[s]=t)},setup:function(){this._blockList=[]},finish:function(){var e=this;e._parseTable(e.el),p.each(e._blockList,function(t){var n;t&&t.heights&&t.cells&&t.cells.length>0?n=new o({tableCells:t.cells,rowHeights:t.heights,colWidths:t.widths}):t&&(n=t),n&&e.emit(n)})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(1),n(89)],void 0!==(i=function(e,t,n,o,i){"use strict";return function(){function e(){}return e.renderTable=function(t,n,o){var i,r,a,l,s,c=t.getRowCount(),u=t.getColumnCount();for(n=n||e._createTableEl(),i=n.querySelector("tbody"),e.table=t,l=0;l<c;l++){for(r=document.createElement("tr"),s=0;s<u;s++)a=t.getCell(l,s),a.isMergedCell()||r.appendChild(e._renderCell(l,s,null,{resourceMap:o}));r.style.height=t.getRowHeight(l)+"px",i.appendChild(r)}return e._renderColumns(n.querySelector("colgroup")),e.table=null,$(n).css({"border-collapse":"collapse","table-layout":"fixed","white-space":"nowrap",width:0}),n},e._createTableEl=function(){var e=document,t=e.createElement("table");return t.innerHTML="<colgroup></colgroup><tbody></tbody>",t},e._handleMergePointIfNeeded=function(e,t){if(t.isMergePoint()){var n=t.getMergePointAttr();n.width>0&&e.setAttribute("colspan",n.width),n.height>0&&e.setAttribute("rowspan",n.height)}},e._renderCell=function(t,o,r,a){r=r||document.createElement("td"),$(r).css({"font-size":14,color:"#393939",border:"1px solid #a7a7a7",overflow:"hidden","vertical-align":"middle","word-wrap":"break-word","background-color":"rgba(255, 255, 255, 0.3)"}),a=n.defaults(a||{},{withCellId:!0,resourceMap:null});var l,s=e.table.getCell(t,o),c=s.getContent();return a.withCellId&&r.setAttribute("data-cell-id",s.getCellId()),e._handleMergePointIfNeeded(r,s),e._setCellStyles(r,s.getBlockStyles(),!0),l=i.contentToHtml(c,a.resourceMap),r.innerHTML=l,r},e._renderColumns=function(t){var n=e.table;if(!t)return void o.warn("parameter is not valid",t);t.innerHTML="",n.forEachColumn(function(e){var o=n.getColumnWidth(e),i=document.createElement("col");i.style.width=o+"px",t.appendChild(i)})},e._setCellStyles=function(e,t,n){n=!1!==n;var o;o=t.textAlign,e.style.textAlign="center"===o||"right"===o||"left"===o?o:"",o=t.verticalAlign,e.style.verticalAlign="top"===o||"middle"===o||"bottom"===o?o:"",n||"true"===t.wrap?e.style.whiteSpace="pre-wrap":e.style.whiteSpace="nowrap",o=t.backColor,e.style.backgroundColor=o&&"inherit"!==o&&"transparent"!==o?o:""},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(58)],void 0!==(i=function(e,t,n){"use strict";return n({textAlign:{type:"Enum",possible:{left:!0,right:!0,center:!0,justify:!0},default:"left"},verticalAlign:{type:"Enum",possible:{top:!0,middle:!0,bottom:!0},default:"left"},wrap:{type:"Boolean",default:!1},backColor:{type:"String",default:{BACK_COLOR:"transparent"}.BACK_COLOR},"border|vertical":{type:"String",default:"1px solid #a7a7a7"},"border|horizontal":{type:"String",default:"1px solid #a7a7a7"}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(){return function(e,t,n,o){var i,r,a;for(i=0;i<n;i++)if(a=t?n-i-1:i,null==o){if(!1===e(a))return}else for(r=0;r<o;r++)if(!1===e(a,t?o-r-1:r))return}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(64),n(65)],void 0!==(i=function(e,t,n,o){"use strict";return{attach:n,image:o}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(244),n(245),n(246),n(247)],void 0!==(i=function(e,t,n,o,i,r,a){"use strict";var l=[o,i,r,a];return function(e){e=e||{};var t,o,i,r=JSON.parse(JSON.stringify(e)),a=l.length,s=r,c=[],u=function(e){c.push(o.name+".js: "+e)};for(t=0;t<a;t++){if(o=l[t],i=o.checkAndFix(s),n.each(i.errors,u),!0===i.stopCheck)return{errors:c,fixedData:i.fixedData};s=i.fixedData}return{errors:c,fixedData:s}}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(117)],void 0!==(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.checkAndFix=function(e){var t,i,r,a=e.cells,l=a.length,s=!1,c=!1,u=[];for(t=0;t<l;t++)i=a[t],n.isObject(i)?null==(r=i.value)||n.isString(r)||(c=!0,i.value=r+""):(s=!0,a[t]=o());return s&&u.push("Some cell is NOT Object type"),c&&u.push("The value of some cell is not String type"),{errors:u,fixedData:e,stopCheck:!1}},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0)],void 0!==(i=function(e,t,n){"use strict";return function(){function e(){}return e.checkAndFix=function(t){var o=t.cells,i=t.heights,r=t.widths,a=e.IS_VALID(o,i.length,r.length),l=[];return!0!==a&&(l.push(a),n.each(o,function(e){delete e.mergeWidth,delete e.mergeHeight,delete e.mergePointDX,delete e.mergePointDY})),{errors:l,fixedData:t,stopCheck:!1}},e.IS_VALID=function(e,t,o){var i={},r="";return n.some(e,function(t,a){if(!i[a+""]){var l,s,c,u,d,p,h,g,f,m,_,y;if(t.mergeWidth||t.mergeHeight){if(t.mergeWidth&&!n.isNumber(t.mergeWidth))return r="The mergeWidth is not Number type",!0;if(t.mergeHeight&&!n.isNumber(t.mergeHeight))return r="The mergeHeight is not Number type",!0;if(null!=t.mergePointDX||null!=t.mergePointDY)return r="The cell data is not valid, index: "+a,!0;for(l=t.mergeWidth||1,s=t.mergeHeight||1,c=Math.floor(a/o),u=a%o,f=0;f<s;f++)for(d=c+f,g=0;g<l;g++)if(f>0||g>0){if(p=u+g,h=d*o+p,m=e[h],m.mergeWidth||m.mergeHeight)return r="The merged cell should not have `mergeWidth` or `mergeHeight`, merge point cell index: "+a+", merged cell index: "+h,!0;if(m.value)return r="The `value` of merged cell should be empty string,merge point cell index: "+a+", index: "+h,!0;if(_=m.mergePointDX||0,y=m.mergePointDY||0,_!==g||y!==f)return r="The `mergePointDX` or `mergePointDY` of mergedCell is not valid, merge point cell index: "+a+",  merged cell index: "+h,!0;i[h+""]=!0}}i[a+""]=!0}}),r||!0},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0)],void 0!==(i=function(e,t,n){"use strict";return function(){function e(){}return e.checkAndFix=function(e){var t=e.cells,o=!1,i=[];return n.each(t,function(e){e.mergeWidth&&!e.mergeHeight?(e.mergeHeight=1,o=!0):e.mergeHeight&&!e.mergeWidth&&(e.mergeWidth=1,o=!0)}),o&&i.push("Some cell has no default value for mergeHeight or mergeWidth"),{errors:i,fixedData:e,stopCheck:!1}},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(78),n(117),n(248)],void 0!==(i=function(e,t,n,o,i,r){"use strict";return function(){function e(){}return e.checkAndFix=function(e){if(!e.cells||!n.isArray(e.cells))return{errors:["The `cells` property is not Array type!"],fixedData:r(),stopCheck:!0};var t,a,l=e.cells,s=e.widths,c=e.heights,u=!0,d=!0,p=[];for(s&&n.isArray(s)||(u=!1,p.push("The `widths` property is not Array type!")),c&&n.isArray(c)||(d=!1,p.push("The `heights` property is not Array type!")),u||d?u?d||(c=[],0===s.length&&(s.length=5),c.length=Math.ceil(l.length/s.length)):(s=[],0===c.length&&(c.length=5),s.length=Math.ceil(l.length/c.length)):(s=[],s.length=5,c=[],c.length=Math.ceil(l.length/s.length)),t=s.length*c.length,a=!1;t<l.length;)c.push(o.DEFAULT_ROW_HEIGHT),t=s.length*c.length,a=!0;for(a&&p.push("The widths.length * heights.length is less than cells.length"),t=s.length*c.length,a=!1;t>l.length;)l.push(i()),a=!0;return a&&p.push("The widths.length * heights.length is greater than cells.length"),a=!1,s=n.map(s,function(e){return e&&n.isNumber(e)?e:(a=!0,o.DEFAULT_COL_WIDTH)}),a&&p.push("The `widths` has unvalid value"),a=!1,c=n.map(c,function(e){return e&&n.isNumber(e)?e:(a=!0,o.DEFAULT_ROW_HEIGHT)}),a&&p.push("The `heights` has unvalid value"),{errors:p,fixedData:{cells:l,heights:c,widths:s},stopCheck:!1}},e}()}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(78),n(117)],void 0!==(i=function(e,t,n,o){"use strict";return function(e,t){e=e||1,t=t||1;var i,r=[],a=[],l=[],s=e*t;for(i=0;i<e;i++)a.push(n.DEFAULT_ROW_HEIGHT);for(i=0;i<t;i++)r.push(n.DEFAULT_COL_WIDTH);for(i=0;i<s;i++)l.push(o());return{cells:l,heights:a,widths:r}}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(22);return function(e){return!!e&&t.equals(e,"white")}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(45);return n(88).extend({finish:function(){var e,n,i=this.el;"todo"===i.getAttribute("data-media-type")&&(e=i.getAttribute("data-attr-content"),n=i.getAttribute("data-attr-checked"),t.isUndefined(e)&&t.isUndefined(n)||this.emit(new o({text:e||"",checked:"true"===n})))}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){function t(e,t){var n=e.match(/(@[\w_\-:\s]+)\n\s*\{(.|\n)*?\}/gm);null!==n&&n.forEach(function(e){var n=/@([\w_\-:\s]+)/.exec(e)[1].trim(),o=e.substring(e.indexOf("{")+1,e.indexOf("}")).trim(),i={};o.split(";").forEach(function(e){var t;-1!==e.indexOf(":")&&(t=e.split(":"),i[t[0].trim()]=t[1].trim())}),t[n]||(t[n]={}),l.extend(t[n],i)})}var o=n(86),i=n(33),r=n(34),a=n(1),l=n(0),s=n(3);return o.extend({setup:function(){var e,t,n,r,a,l,c,u=this.getRoot();o.prototype.setup.call(this),(e=this.el.getAttribute("style"))&&(t=/mso-list:(l\d+) (level\d+)/.exec(e))&&(a=t[1],l=t[2],n=this._getStyles(),(r=n["list "+a+":"+l])&&(c=u["mso-"+a],c||(c=u["mso-"+a]=new i({type:"bullet"===r["mso-level-number-format"]?i.UNORDERED:i.ORDERED,listId:s.newGUID()})),this.list=c,this.level=Number(l.replace("level","")),this.el.querySelector('[style="mso-list:Ignore"]').remove()))},createBlock:function(){if(!this.list)return o.prototype.createBlock.call(this);var e=this,t=e.list,n=new r({list:t,level:e.level});return t&&t.addItem&&t.addItem(n),n},_getStyles:function(){var e,n=this.getRoot(),o=this.el.ownerDocument,i={};return n.msoStyles?n.msoStyles:(e=o.querySelectorAll("style"),l.each(e,function(e){1===e.childNodes.length&&3===e.firstChild.nodeType&&t(e.firstChild.textContent,i)}),a.log(i),n.msoStyles=i,i)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(1),o=n(0),i=n(253);return function(e,n,r,a){var l,s=[];return e?(l=e.split(/\r\n?|\n/))&&l.length?(o.each(l,function(e){var t=i(e,o.clone(n),o.clone(r),a);t&&s.push(t)}),t.log("to paste text",s),s):void t.warn("lines do not exist or lines.length is 0!"):void t.warn("no text when paste plain text!")}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(254),o=n(19),i=n(92),r=n(0);return function(e,n,a,l){if(null!=e){var s,c,u=new o;return l||(s=i.matchEnd(e))&&0===s.result.index&&r.extend(n||(n={}),{href:s.fullURI,underline:!0,color:"#003884"}),c=t(e,n),u.setText(c),a&&r.each(a,function(e,t){u.setBlockStyle(t,e)}),u}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(10);return function(e,n){var o;return e+="",e=e.replace(/[\r\n]/g,""),o=new t({text:e}),n&&o.setStyles(0,o.getLength(),n),o}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(1),o=n(0),i=n(33),r=n(60),a=n(2),l=n(256),s=n(3);return function(e){var n,c,u,d=[],p={},h={},g={};if(o.isString(e))try{n=window.JSON.parse(e)}catch(n){t.error("parse json string error: ",e)}else o.isArray(e)&&(n=e);if(n&&n.length)return t.log("createBlocksFromJSON array: ",n),o.each(n,function(e){var t;(t=l(e))&&(e.listId&&e.listType&&a.isListItem(t)&&(c=e.listId,u=p[c],u||(u=new i({type:e.listType,listId:e.listId}),p[c]=u),t.setOwnerList(u)),e.ownerId&&a.isCatalogue(t)&&(c=e.ownerId,g[c]||(g[c]=s.newGUID(),h[g[c]]=new r({id:g[c]})),u=h[g[c]],t.setOwnerList(u)),d.push(t))}),d}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(74),o=n(2),i=n(51),r=n(72),a=n(73),l=n(61),s=n(34),c=n(19),u=n(63),d=n(45),p=n(93),h=n(150),g=n(1);return function(e){if(!e||!e.blockType&&!e.type)return void g.warn("jsonObj is null or jsonObj has no `blockType` property!");var n,f=e.blockType||e.type;switch(f){case o.PARAGRAPH:n=c.fromJSON(e);break;case o.LIST_ITEM:n=s.fromJSON(e);break;case o.IMAGE:n=l.fromJSON(e);break;case o.ATTACHMENT:n=t.fromJSON(e);break;case o.TABLE:n=u.fromJSON(e,!0);break;case o.HR:n=a.fromJSON(e);break;case o.HEADING:n=r.fromJSON(e);break;case o.CATALOGUE:n=i.fromJSON(e);break;case o.TODO:n=d.fromJSON(e);break;case o.QUOTE:n=p.fromJSON(e);break;case o.HANDWRITE:n=h.fromJSON(e);break;default:g.warn("jsonObj.blockType = "+f)}return n}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(1),o=n(0),i=n(10),r=n(19),a={create:function(){var e={};return e.data={},e.push=function(t,n){n||(n=1),e.data[t]?e.data[t]+=n:e.data[t]=n},e.count=function(){return Object.keys(e.data).length},e.mergeKeys=function(t){var n,i,r,l,s,c=a.create(),u=e.data;return o.each(e.orderedKeys(),function(e){r&&e-r<t?(l=u[r],s=u[e],i=l+s,n=(r*l+e*s)/i,c.push(n,i),r=null):(r&&c.push(r,u[r]),r=e)}),r&&c.push(r,u[r]),c.count()!==e.count()?c.mergeKeys(t):c},e.mostFrequencyKey=function(){var t,n=0;return o.each(e.data,function(e,o){e>=n&&(n=e,t=parseInt(o))}),t},e.orderedKeys=function(){var t;return t=Object.keys(e.data),t.sort(function(e,t){return e-t})},e}},l=function(e){var t={},n=e.split(",");return t.left=parseInt(n[0]),t.top=parseInt(n[1]),t.width=parseInt(n[2]),t.height=parseInt(n[3]),t.right=t.left+t.width,t.bottom=t.top+t.height,t},s=function(e){var t={},n=e.split(",");return t.left=parseInt(n[0]),t.top=parseInt(n[1]),t.right=parseInt(n[2]),t.bottom=parseInt(n[5]),t.width=t.right-t.left,t.height=t.bottom-t.top,t},c=function(e,t){return"yd"===t?s(e):l(e)},u=function(e,t){var n=(t.box.bottom-e.box.top)/e.box.height,o=(t.box.bottom-e.box.top)/t.box.height;return Math.max(n,o)>.8},d=function(e){return/^[a-z][a-z\d\s.,\/#!$%\^&\*;:{}=\-_`~()]*$/i.test(e)},p=function(e){var t=[/Epdf/,/For Evaluation Purposes Only/],n=!1;return t.forEach(function(t){t.test(e)&&(n=!0)}),n},h=function(e,t){e.box.top=e.box.top<t.box.top?e.box.top:t.box.top,e.box.bottom=e.box.bottom>t.box.bottom?e.box.bottom:t.box.bottom,e.box.left=e.box.left<t.box.left?e.box.left:t.box.left,e.box.right=e.box.right>t.box.right?e.box.right:t.box.right,e.box.height=e.box.bottom-e.box.top,e.box.width=e.box.right-e.box.left,e.words=t.words.concat(e.words),e.text=t.text+"  "+e.text},g=function(e,t){var n,i,r=e.json,a=t.type,l=[];for(r.box=c(r.boundingBox,a),o.each(r.lines,function(e){var t,i="";e.box=c(e.boundingBox,a),"ms"===a&&(o.each(e.words,function(e){e.box=c(e.boundingBox,a),d(e.text)&&(i+=" "),i+=e.text}),e.text=i),p(e.text)?(t=r.lines.indexOf(e),l.push(t)):(n&&u(e,n)&&(h(e,n),t=r.lines.indexOf(n),l.push(t)),n=e)}),i=l.length-1;i>=0;i-=1)r.lines.splice(l[i],1)},f=function(e){var t,n=e.json,i=a.create(),r=a.create(),l=a.create(),s=a.create(),c={};o.each(n.lines,function(e){i.push(e.box.left),r.push(e.box.right),t&&l.push(e.box.bottom-t.box.bottom),t=e,s.push(e.box.height)}),c.baseLineHeight=l.mostFrequencyKey(),c.baseFontHeight=s.mergeKeys().mostFrequencyKey(),c.regionLeft=i.mergeKeys(c.baseFontHeight).mostFrequencyKey(),c.regionRight=r.mergeKeys(c.baseFontHeight).mostFrequencyKey(),e.stat=c},m=function(e){var t,n,o,i,r,a,l=e.json,s=[],c=e.stat.regionLeft,u=e.stat.regionRight,d=e.stat.baseFontHeight,p=e.stat.baseLineHeight,h=!1,g=!1,f="";for(t={startLineIndex:0},r=0;r<l.lines.length;r+=1){if(i=l.lines[r],h=g,c+1.5*d<i.box.left&&r!==t.startLineIndex&&(h=!0),o&&i.box.bottom-o.box.bottom>1.5*p&&(h=!0),h){for(t.endLineIndex=r-1,t.text=f.trim(),s.push(t),n=Math.floor((i.box.bottom-o.box.bottom)/p-1),a=0;a<n;a+=1)s.push({text:""});t={startLineIndex:r},f=i.text}else f+=i.text;o=i,g=u-1.5*d>i.box.right}t.endLineIndex=r,t.text=f,s.push(t),e.paragraphs=s},_=function(e){var t,n=e.json;t={startLineIndex:0,endLineIndex:n.lines.length-1,text:""},o.each(n.lines,function(e){t.text+=e.text}),e.paragraphs=[t]},y=function(e){var t=e.json,n=e.stat,i=e.paragraphs;o.each(i,function(e){var o,i=t.lines[e.startLineIndex];if(i){if(Math.ceil((i.box.left-n.regionLeft)/n.baseFontHeight)/2>=1)return void(e.text="\t"+e.text);e.startLineIndex+1<=e.endLineIndex&&(o=t.lines[e.startLineIndex+1]),o&&Math.ceil((i.box.left-o.box.left)/n.baseFontHeight)/2>=1&&(e.text="\t"+e.text)}})},v=function(e){var t,n,o,a=new r;return o=e.fontSize,t=e.text,t=t.replace(/[\r\n]/g,""),n=new i({text:t}),n.setStyle(0,n.getLength(),"font-size",o),a.setText(n),a},b=function(e,t){var n={};return n.json=e,g(n,t),t.parseParagraph?(f(n),m(n),t.parseIndent&&y(n)):_(n),n};return function(e,n){var i,a,l=[];if(o.isString(e))try{i=window.JSON.parse(e)}catch(n){t.error("parse json string error: ",e)}return i&&o.each(i,function(e){o.each(e.regions,function(e){var t=b(e,n);o.each(t.paragraphs,function(e){a=v(e),l.push(a)})}),l.push(new r)}),l}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(17),n(1)],void 0!==(i=function(e,t,n,o,i){"use strict";return function(e){function t(t,o,r,a,l){var s=e.call(this,{})||this;return s.listItemNodeProps={},i.DEBUG&&(s.listItemNodeProps.debugId=n.uniqueId()),s.listItemNodeProps.level=t||0,s.listItemNodeProps.block=o,s.listItemNodeProps.start=r,s.listItemNodeProps.end=a,s.addChildNodes(l),s}return r(t,e),t.prototype.addChildNodes=function(e){var t=this;e&&(n.isArray(e)||(e=[e]),n.each(e,function(e){e.parentNode=t,t.childNodes||(t.childNodes=[]),t.childNodes.push(e)}))},t.prototype.childrenCount=function(){return this.childNodes?this.childNodes.length:0},t.prototype.getChildStartIndex=function(){var e=this.childNodes||[],t=e[0];return t?t.getStartIndex():1},t.prototype.getLevel=function(){return this.listItemNodeProps.level},t.prototype.getParentNode=function(){return this.parentNode},t.prototype.getStartIndex=function(){return this.listItemNodeProps.block?this.listItemNodeProps.block.getIndex():1},t.prototype.hasChildren=function(){return this.childrenCount()>0},t.prototype.isChildOrdered=function(){var e=this.childNodes||[],t=e[0];return!!t&&t.isOrdered()},t.prototype.isOrdered=function(){return this.listItemNodeProps.block?this.listItemNodeProps.block.isOrdered():!!this.parentNode&&this.parentNode.isOrdered()},t.prototype.toHtml=function(e){var t,o,i,r,a,l,s=this.listItemNodeProps.block,c=[];return e=!0===e,this.hasChildren()?(a=s?s.toHtml(this.listItemNodeProps.start,this.listItemNodeProps.end,e):"",c.push(a),t=this.isChildOrdered()?"ol":"ul",i="<"+t+' yne-block-type="list"',o=this.getChildStartIndex(),o>1&&(i+=' start="'+o+'"'),i+=">",c.push(i),l=this.childNodes,n.each(l,function(t){var n=t.toHtml(e);c.push(n)}),r="</"+t+">",c.push(r)):(a=s?s.toHtml(this.listItemNodeProps.start,this.listItemNodeProps.end,e):"<li></li>",c.push(a)),c.join("")},t.prototype.initialize=function(){},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(74),n(51),n(72),n(73),n(61),n(34),n(19),n(93),n(63),n(45),n(153)],void 0!==(i=function(e,t,n,o,i,r,a,l,s,c,u,d,p,h){"use strict";var g={attach:o,catalogue:i,heading:r,"horizontal-line":a,image:l,"list-item":s,para:c,quote:u,table:d,todo:p,unknown:h};return n.each(g,function(e,t){e.prototype.xmlNodeName=t}),g}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(6),n(261),n(262),n(265),n(282),n(139),n(10),n(28),n(138),n(27),n(119),n(68),n(362),n(363),n(364),n(1),n(365),n(388),n(390),n(429),n(432),n(489),n(2)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h,g,f,m,_,y,v,b,k,C,S,I,w,E){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.callMacNativeApi=function(e,t){return k.callNativeApi(e,t)},t.prototype.canRemoveFormat=function(){return this.controller.canRemoveFormat()},t.prototype.getNoteViewWrapper=function(){return this.$noteViewWrapper},t.prototype.getNoteViewFrame=function(){return this.$noteViewFrame},t.prototype.initNoteViewWrapper=function(){var e=this,t=$(e.editorProps.parentEl);e.$noteViewWrapper||(e.$noteViewWrapper=$('<div class="note-view-wrapper"></div>'),e.$noteViewFrame=$('<div class="note-view-frame"></div>'),e.$noteViewWrapper.append(e.$noteViewFrame),t.append(e.$noteViewWrapper),e.progressTracker=new w({}),null!=e.noteView&&e.noteView.setOptions({noteviewFrame:e.getNoteViewFrame(),noteviewWrapper:e.getNoteViewWrapper()})),e._updateNoteViewWrapperSize(),function(){var n,o,i,r=window.devicePixelRatio;n=function(){var a=!1;o!==t.width()&&(a=!0,o=t.width()),i!==t.height()&&(a=!0,i=t.height()),r!==window.devicePixelRatio&&(a=!0,r=window.devicePixelRatio),a&&e.onResize(),setTimeout(n,500)},setTimeout(n,500)}()},t.prototype.insertNoteLink=function(e,t){if(e&&t){var n,o,i=f.fillAsUrl(e);n=new u({text:t}),o=n.getLength(),n.setStyles(0,o,{color:"rgb(0, 56, 132)",href:i,underline:!0}),this.insertText(n,!1)}},t.prototype.insertText=function(e,t){this.controller.insertText(e,t)},t.prototype.isLegacyHost=function(){var e=!0;return null!=this.getEditorProps().webVersion&&(e=!1),e},t.prototype.isSameList=function(e){return this.controller.isSameList(e)},t.prototype.onResize=function(){this._updateNoteViewWrapperSize(),this.noteView.trigger("resize")},t.prototype.render=function(){var e=this,t=e.noteView;t&&(e.toolbar.render(),$(e.editorProps.parentEl).append(e.toolbar.$el),e.toolbar.shrink(),e.initNoteViewWrapper(),e.$noteViewFrame.append(t.$el),e.$noteViewWrapper.append(e.linkView.$el),t.setOptions({pageType:e.editorProps.pageType}),e.setViewMode(e.editorProps.viewMode,!0,!1),t.render(),e.$noteViewWrapper.append(e.imgTitleInput.$el))},t.prototype.reset=function(){e.prototype.reset.call(this),this.toolbar.$el.find(".button-undo").removeClass("active"),this.toolbar.$el.find(".button-redo").removeClass("active"),this.toolbar&&(this.toolbar.reset(),this.toolbar.isRendered&&this.toolbar.show())},t.prototype.setDefaultFont=function(e,t){var n=d.getFontFirstValue(e),o=p.getAsArray();n&&(this.defaultFontName=n),o.indexOf(t)>-1&&(this.defaultFontSize=t),this.note&&this.note.isEmptyContent()&&this.useDefaultFontAsEditingStyle()},t.prototype.setHtmlContent=function(e,t,n,o){this._setContent(!1,e,t,n,o)},t.prototype.setXmlContent=function(e,t,n,o){this._setContent(!0,e,t,n,o)},t.prototype.showToolbar=function(){this.toolbar&&this.toolbar.isRendered&&this.toolbar.show()},t.prototype.updateFormatPainterCursorUI=function(e){this.noteView.updateFormatPainterCursorUI(e)},t.prototype.useDefaultFontAsEditingStyle=function(){this.controller.setDefaultFont(this.defaultFontName,this.defaultFontSize)},t.prototype.setPrintNote=function(e){this.toPrintPage=e},t.prototype.getPrintNote=function(){return this.toPrintPage},t.prototype.getFirstLineTextContent=function(){var e,t=this._firstNotEmptyTextBlockIndex(),n="";return-1===t?"":(e=this.note.getBlockAt(t),e&&(n=e.toPlain()),n)},t.prototype.bindEventsForController=function(){if(!this.controller)return void v.warn("no controller!");e.prototype.bindEventsForController.call(this),h.bubble(["yne-selection-change","yne-editing-state-change","yne-replace-image","yne-replace-attachment","yne-open-link","yne-download-attachment","yne-download-image","yne-preview-image","contextmenu","yne-show-words","yne-save-content","yne-blob-paste","yne-get-image-url","yne-need-paste","yne-require-innerlink"],this.controller,this),h.bubble({find:"yne-find"},this.controller,this)},t.prototype.initialize=function(t){var o=this;o.editorProps=t||{},o.editorProps.theme=o.editorProps.theme||"",$(o.editorProps.parentEl).html(""),o.editorProps.theme&&$(o.editorProps.parentEl).addClass(o.editorProps.theme),g.setUseConvert(o.editorProps.useHttpsConvert),n.bindAll(o,"_updateNoteViewWrapperSize","onResize"),o.note=c.createBlank(!0),o.noteView=new I({editor:o,inlineStyleViewMapper:S,note:o.note}),o.linkView=new y({editor:o}),o.imgTitleInput=new _({editor:o}),o.controller=new s({editor:o,imgTitleInput:o.imgTitleInput,note:o.note,noteView:o.noteView,removeLocalImg:o.editorProps.removeLocalImg}),o.toolbar=new C({editor:o}),o._initContextMenu(),o._addEventListener(),e.prototype.initialize.call(this,t),o.colorpicker=new m({editor:o}),$(o.editorProps.parentEl).append(o.colorpicker.$el),h.bubble(["color-picker-show"],o,o.colorpicker)},t.prototype.updateContainerBackground=function(e){var t=this.noteView.$el;return this.currentBackground!==e&&(e&&e!==o.DEFAULT_BACKGROUND?(t.css("background-image",'url("'+e+'")'),this.currentBackground=e):(t.css("background-image",""),this.currentBackground=o.DEFAULT_BACKGROUND),!0)},t.prototype._addEventListener=function(){this.noteView.on("blur",this._onBlur.bind(this)),this.noteView.on("focus",this._onFocus.bind(this))},t.prototype._initContextMenu=function(){var e,t,o=this;if(!o.contextMenu&&(e=o.contextMenu=new i({editor:o}),t=n.map(b,function(e){return e()}),e.addItems(t),o.on("contextmenu",function(t){var n=a(o);e.onContextMenu(t,n)}),v.DEBUG)){if(function(){var e=(window.ynote||{}).toString();return e&&e.indexOf("ObjCRuntimeObject")>-1}())return;o.on("yne-context-menu",function(e,t,o){var i,r,a=[];n.each(t,function(e){if(!e.isHidden){if(2===e.type)return void a.push("------------------");var t=e.isDisabled?"[":" ",n=e.isDisabled?"]":" ";a.push(t+e.index+". "+e.label+n)}}),i="context-menu: \n"+a.join("\n"),(r=window.prompt(i))&&(r=parseInt(r,10),isNaN(r)||o(r))})}},t.prototype._onBlur=function(){var e=this.controller.noteSelection;this.oldRangeWhenBlur=e.getRange()},t.prototype._onFocus=function(){var e=this.controller.noteSelection;this.oldRangeWhenBlur&&e.setRange(this.oldRangeWhenBlur)},t.prototype._setContent=function(e,t,o,i,r){var a=this,l=this,s=!0===i.isAsync,u=function(e){e.isAsync=s,l.updateContentSetProgress(e),e.percent>=1&&(l.makeReadOnly(!!l.noteProps.isReadOnly),null!=r&&r({resultCode:1}),a.getPrintNote()&&(window.print(),a.setPrintNote(!1)))};l.reset(),l.contentLoading=!0,l.updateContentSetProgress({percent:0,message:"加载中",isAsync:s}),null==i?l.noteProps=l.options||{}:(l.noteProps={},n.extend(l.noteProps,i)),l.controller.setOptions({note:l.note}),l.noteView.setOptions({isNoteSet:!0,note:l.note,pageType:l.editorProps.pageType}),l.setViewMode(l.editorProps.viewMode,!0,!1),l.setReadOnly(l.noteProps.isReadOnly),l.setBackground(l.noteProps.bgImageId),!l.noteProps.isReadOnly&&l.isCollabEnabled()&&l.makeReadOnly(!0),l.controller.setDefaultFont(l.noteProps.defaultFontName,l.noteProps.defaultFontSize),l.noteView.render(),l.updateContentSetProgress({percent:.05,isAsync:s}),e?c.fromXml(t,l.note,o,{progressCallBack:u,isAsync:s}):null==c.fromHtml(t,l.note,o,{progressCallBack:u,isAsync:s})&&(c.createBlank(!0,l.note),u({percent:1})),l.notSetContent=!1},t.prototype._updateNoteViewWrapperSize=function(){var e,t=this.$noteViewWrapper,n=$(this.editorProps.parentEl);t&&(e=$(t),e.height(n.height()-this.toolbar.$el.outerHeight()-e.outerHeight()+e.height()))},t.prototype._firstNotEmptyTextBlockIndex=function(){var e,t,n=this.note.blocks,o=n.length,i=-1;for(e=0;e<o;e++)if(t=n[e],E.isTextOrTableBlock(t)&&!t.isEmptyContent()){i=e;break}return i},t}(l)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(15),n(1),n(13)],void 0!==(i=function(e,t,n,o,i,a){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.filterItems=function(e){var o=!1,i=[];return n.each(e,function(e){var r=e;switch(e&&e.simplify&&(r=e.simplify()),r.type){case a.TYPE.SPLIT:o||(o=!0,i.push(r));break;case a.TYPE.SUBMENU:r.isHidden||(o=!1,r=n.extend({},r,{items:t.filterItems(r.items)}),i.push(r));break;default:r.isHidden||(o=!1,i.push(r))}}),i},t.prototype.addItems=function(e){this.items=this.items.concat(e),n.each(e,this.prepareItem.bind(this))},t.prototype.onContextMenu=function(e,o){var i,r=this,a={left:e.pageX,top:e.pageY};r.resetAll(),n.invoke(r.items,"checkStatus",e,o||{}),i=t.filterItems(r.items),r.editor.trigger("yne-context-menu",a,i,function(e){r.select(e),r.resetAll()})},t.prototype.prepareItem=function(e){var t=this,o=e.keyHandlerName;e.index=t.indexArray.length,e.editor=t.editor,o&&!t.editor.getController().hasKeyHandler(o)&&i.error("The keyHandlerName ["+o+"] of ContextMenuItem ["+e.name+"] does not exist!"),t.indexArray.push(e),e.type===a.TYPE.SUBMENU&&n.each(e.items,t.prepareItem.bind(t))},t.prototype.resetAll=function(){var e;n.map(this.items,function(t){if((e=t.reset)&&n.isFunction(e))return e.apply(t)})},t.prototype.select=function(e){var t=this.indexArray[e];if(t&&!t.items&&t.select)return t.select()},t.prototype.initialize=function(e){this.editor=e.editor,this.items=[],this.indexArray=[]},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(2),o=n(0),i=n(38),r=n(7),a=n(14),l=n(53),s=function(e,t){return e=r.trim(e||""),t=r.trim(t||""),!(!e||!t)&&(e===t||(i.startsWith(t,e)||i.endsWith(t,e)||i.startsWith(e,t)||i.endsWith(e,t)))},c={imageBlock:function(e,n,o){var i,r,a=e.getNoteRange();a&&a.isInSingleBlock()&&(i=a.getStartBlockRange(),r=i.block,t.isImage(r)&&(o.imgBlock=r,o.isImgAttachBlock=!0))},attachmentBlock:function(e,n,o){var i,r,a=e.getNoteRange();a&&a.isInSingleBlock()&&(i=a.getStartBlockRange(),r=i.block,t.isAttachment(r)&&(o.attachmentBlock=r,o.isImgAttachBlock=!0))},tableBlock:function(e,n,i){var r,a,s,c,u=e.getNoteRange();if(u&&u.isInSingleBlock()&&(a=u.getStartBlockRange(),c=a.block,t.isTable(c))){if(!(s=a.getAsRectRange()))return;r={},s.onlyMergePointAndCell()&&(r.onlyMergePointAndCell=!0),s.isOnlyImgCell()&&o.extend(r,{cell:s.getFirstCell().cell,type:l.IMAGE}),s.isOnlyAttachCell()&&o.extend(r,{cell:s.getFirstCell().cell,type:l.ATTACHMENT}),i.tableInfo=r}},hrefInfo:function(e,t,n){var o,i,l,c,u,d,p,h,g,f=t.target,m=r(f);m.is(".block-view a *")&&(o=function(e,t){if(e&&e.parentNode)for(var n=e.parentNode;n;){if(n.webkitMatchesSelector&&n.webkitMatchesSelector(t))return n;n=n.parentNode}}(f,"a"))&&(i=document.createRange(),i.selectNodeContents(o),l=a.fromNativeRange(i,e.noteView),i.detach(),l&&l.isInSingleBlock()&&(c=l.getStartBlockRange(),u=c.block,u&&u.getCommonInlineStyle&&(d=u.getCommonInlineStyle("href",c)),d&&(p=c.getDataAsPlain(),h=s(d,p),h&&(g=u.getCommonInlineStyles(c)),n.hrefInfo={noteRange:l,href:d,hrefAsLinkText:h,commonStyles:g})))},isRangeCollapsed:function(e,t,n){var o=e.getNoteRange();o&&(n.isRangeCollapsed=o.isCollapsed())}};return function(e){var t={};return o.each(c,function(n){n(e,event,t)}),t}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(15),n(1),n(26)],void 0!==(i=function(e,t,n,o,i,a){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.create=function(e,n,o){return n&&e?new t({filter:o,note:n,noteRange:e}):void i.error("Failed to create NoteRangeWalker, unvalid parameters",e,n,o)},t.prototype.current=function(){return this.walkerProps.blockRanges[this.walkerProps.blockRangeIndex]},t.prototype.first=function(){return this.walkerProps.blockRangeIndex=0,this._getAtIndex(this.walkerProps.blockRangeIndex)},t.prototype.last=function(){if(this._getAtIndex(this.walkerProps.endIndex),this.walkerProps.blockRangeIndex=this.walkerProps.blockRanges.length-1,-1!==this.walkerProps.blockRangeIndex)return this.walkerProps.blockRanges[this.walkerProps.blockRangeIndex]},t.prototype.next=function(){return this.walkerProps.blockRangeIndex++,this._getAtIndex(this.walkerProps.blockRangeIndex)},t.prototype.previous=function(){return this.walkerProps.blockRangeIndex--,this._getAtIndex(this.walkerProps.blockRangeIndex)},t.prototype.reset=function(){this.walkerProps.blockRangeIndex=-1},t.prototype.initialize=function(e){var t,o;e=n.defaults(e||{},{filter:function(){return!0},note:null,noteRange:null}),this.walkerProps=e,t=this.walkerProps.note=e.note,o=this.walkerProps.noteRange=e.noteRange,this.walkerProps.filter=e.filter,this.walkerProps.startRange=o.getStartBlockRange(),this.walkerProps.endRange=o.getEndBlockRange(),this.walkerProps.startIndex=t.getBlockIndex(this.walkerProps.startRange.block),this.walkerProps.endIndex=t.getBlockIndex(this.walkerProps.endRange.block),this.walkerProps.blockIndex=this.walkerProps.startIndex-1,this.walkerProps.blockRanges=[],this.walkerProps.blockRangeIndex=-1},t.prototype._getAtIndex=function(e){var t,n,o,i;if(o=this.walkerProps.blockRanges[e])return o.clone(!0);if(!this._hasWalked()){for(i=this.walkerProps.blockIndex+1;i<=this.walkerProps.endIndex&&(this.walkerProps.blockIndex=i,this.walkerProps.startIndex!==this.walkerProps.endIndex?i===this.walkerProps.startIndex?(t=this.walkerProps.startRange.clone(!0),t.extendToBlockEnd()):i===this.walkerProps.endIndex?(t=this.walkerProps.endRange.clone(!0),t.extendToBlockStart()):(n=this.walkerProps.note.getBlockAt(i),t=a.createRangeByBlock({allContent:!0,block:n})):t=this.walkerProps.startRange.clone(!0),!(!0===this.walkerProps.filter(t)&&(this.walkerProps.blockRanges.push(t),o=this.walkerProps.blockRanges[e])));i++);return o}},t.prototype._hasWalked=function(){return this.walkerProps.blockIndex>=this.walkerProps.endIndex},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(63),n(122),n(15),n(1)],void 0!==(i=function(e,t,n,o,i,a,l){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.create=function(e){return!e||!e.table||null==e.left||null==e.top||!e.width||!e.height||e.left<0||e.top<0||e.width<1||e.height<1?void l.error("Failed to create RectRange",e):new t(e)},t.prototype.clone=function(){var e=this.getRect();return t.create(e)},t.prototype.equals=function(e){var t=e.getRect();return this.props.table===e.getTable()&&this.props.height===t.height&&this.props.left===t.left&&this.props.top===t.top&&this.props.width===t.width},t.prototype.forEach=function(e,t){var n=this;n.forEachRow(function(o){return n.forEachColumn(function(t){return e(o,t)},t)},t)},t.prototype.forEachCell=function(e,t){var n=this,o={};n.forEach(function(t,i){var r,a=n.props.table.getCell(t,i,{findMergePointIfNeeded:!0,withPosition:!0});if(a&&(r=a.row+"-"+a.col,!0!==o[r]))return o[r]=!0,e(a.cell,a.row,a.col)},t)},t.prototype.forEachRow=function(e,t){var n,o=this;for(n=0;n<o.props.height;n++)if(!1===e(t?o.props.top+o.props.height-n:o.props.top+n))return!1},t.prototype.forEachColumn=function(e,t){var n,o=this;for(n=0;n<o.props.width;n++)if(!1===e(t?o.props.left+o.props.width-n:o.props.left+n))return!1},t.prototype.getDataAsHtml=function(){return this._getAsNewTable().toHtml()},t.prototype.getDataAsJSON=function(e){return this._getAsNewTable().toJSON(e)},t.prototype.getDataAsPlain=function(){return this._getAsNewTable().toPlain({returnString:!0})},t.prototype.getFirstCell=function(){return this.props.table.getCell(this.props.top,this.props.left,{findMergePointIfNeeded:!0,withPosition:!0})},t.prototype.getFirstCellRect=function(){return{col:this.props.left,row:this.props.top}},t.prototype.getLastCell=function(){return this.props.table.getCell(this.props.top+this.props.height-1,this.props.left+this.props.width-1,{findMergePointIfNeeded:!0,withPosition:!0})},t.prototype.getRect=function(){var e={};return e.height=this.props.height,e.left=this.props.left,e.top=this.props.top,e.width=this.props.width,e},t.prototype.getTable=function(){return this.props.table},t.prototype.isMerge=function(){},t.prototype.isOnlyAttachCell=function(){var e,t,n=this,o=n.props.table;return!(!(e=o.getCell(n.props.top,n.props.left))||!e.isAttachmentCell())&&(e.isMergePoint()?(t=e.getMergePointAttr(),t.width===n.props.width&&t.height===n.props.height):1===n.props.width&&1===n.props.height)},t.prototype.isOnlyImgCell=function(){var e,t,n=this,o=n.props.table;return!(!(e=o.getCell(n.props.top,n.props.left))||!e.isImageCell())&&(e.isMergePoint()?(t=e.getMergePointAttr(),t.width===n.props.width&&t.height===n.props.height):1===n.props.width&&1===n.props.height)},t.prototype.onlyOneCell=function(){return 1===this.props.width&&1===this.props.height},t.prototype.overlaps=function(){},t.prototype.onlyMergePointAndCell=function(){var e,t,n=this,o=n.props.table;return e=o.getCell(n.props.top,n.props.left),!!e.isMergePoint()&&(t=e.getMergePointAttr(),n.props.width===t.width&&n.props.height===t.height)},t.prototype.toJSON=function(){return this.getRect()},t.prototype.toString=function(){var e,t=this,o={};return o.height=t.props.height,o.left=t.props.left,o.top=t.props.top,o.width=t.props.width,e=n.map(o,function(e,t){return t+":"+e}),"RectRange("+e.join(",")+")"},t.prototype.initialize=function(e){var t=this;e=e||{},t.props=t.props||{},t.props.table=e.table,t._setRect(e),t._checkBoundary(),t._fixMerge()},t.prototype._checkBoundary=function(){var e=this.props.table,t=e.getColumnCount(),n=e.getRowCount();this.props.left<0?this.props.left=0:this.props.left>=t&&(this.props.left=t-1),this.props.top<0?this.props.top=0:this.props.top>=n&&(this.props.top=n-1),this.props.width<1&&(this.props.width=1),this.props.left+this.props.width>t&&(this.props.width=t-this.props.left),this.props.height<1&&(this.props.height=1),this.props.top+this.props.height>n&&(this.props.height=n-this.props.top)},t.prototype._fixMerge=function(){this._walkToFixMergeCells({})},t.prototype._getAsNewTable=function(){var e,t,n,i,r,a=this.props.table,l=[],s=[],c=[],u=this.props.top;for(u=0;u<this.props.height;u++)for(i=[],l.push(i),t=this.props.top+u,s.push(a.getRowHeight(t)),e=0;e<this.props.width;e++)n=this.props.left+e,0===u&&c.push(a.getColumnWidth(n)),i.push(a.getCell(t,n));return r=new o({colWidths:c,rowHeights:s,tableCells:l}),r.setBlockStyles(a.getBlockStyles()),r},t.prototype._markAsWalked=function(e,t){var n,o,i;for(n=0;n<e.width;n++)for(o=0;o<e.height;o++)i=this._makeMarkKey(e.top+o,e.left+n),t[i]=!0},t.prototype._makeMarkKey=function(e,t){return e+","+t},t.prototype._setRect=function(e){this.props=this.props||{},this.props.height=e.height,this.props.left=e.left,this.props.top=e.top,this.props.width=e.width},t.prototype._shouldExtend=function(e,t,n){var o,r,a,s,c=this.props.table;return(!n||!n[this._makeMarkKey(e,t)])&&((a=c.getCell(e,t,{findMergePointIfNeeded:!0,withPosition:!0}))&&a.cell?(s=a.cell,s.isMergePoint()?(r=s.getMergePointAttr(),o={height:r.height,left:a.col,top:a.row,width:r.width}):o={height:1,left:t,top:e,width:1},this._markAsWalked(o,n),!i.contains(this.props,o)&&i.union(this.props,o)):(l.warn("no table cell at row/col",e,t),!1))},t.prototype._walkToFixMergeCells=function(e){var t=this,n=function(n){var o,i,r=n?t.props.top:t.props.top+t.props.height-1;for(i=0;i<t.props.width;i++)if(o=t._shouldExtend(r,t.props.left+i,e))return o},o=function(n){var o,i,r=n?t.props.left:t.props.left+t.props.width-1;for(i=1;i<t.props.height;i++)if(o=t._shouldExtend(t.props.top+i,r,e))return o},i=n(!0)||n(!1)||o(!0)||o(!1);i&&(t._setRect(i),t._walkToFixMergeCells(e))},t}(a)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(266),n(54),n(6),n(2),n(26),n(94),n(14),n(55),n(27),n(8),n(118),n(1),n(281)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h,g,f,m){"use strict";return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isSessionInitDone=!1,t}return r(t,e),t.prototype.buildCollabProperties=function(){var e={};return null!=this.collabEngine?e=this.collabEngine.buildCollabProperties(null):e.coreEditor=this,e.isCollabEnabled=this.isCollabEnabled(),e},t.prototype.buildCollabSession=function(e,t){var n=this,o=e.collabServer,i=e.userInfo;null!=this.collabEngine&&(this.collabEngine.closeCollabSession(null,null),this.collabEngine=null),this._initCollabEngine(),e.collabServer=o.address,e.useWSS=!!o.useWSS,e.nickname=i.nickname,e.userId=i.userId,e.portraitUrl=i.portraitUrl,this.collabEngine.buildCollabSession(e,function(e){1===e.resultCode&&n.trigger("yne-session-built",e.isCollabStarted),t(e)})},t.prototype.canRemoveFormat=function(){throw new Error("should be overridden.")},t.prototype.closeCollabSession=function(e,t){null!=this.collabEngine&&this.collabEngine.closeCollabSession(e,t),this.collabEngine=null},t.prototype.getCollabId=function(){if(null!=this.collabEngine)return this.collabEngine.getCollabId()},t.prototype.getLastNotOwnExecCmd=function(){if(null!=this.collabEngine)return this.collabEngine.getLastNotOwnExecCmd()},t.prototype.getModifiers=function(e,t){return null!=this.collabEngine?this.collabEngine.getModifiers(e,t):{status:a.ERRORID_COLLAB_ENGINE_NULL}},t.prototype.getCollabContent=function(e,t){var n={status:0,resultCode:0},o=this;return null!=this.collabEngine?(t&&(this.isReadOnly()||this.makeReadOnly(!0),this.noteView.removeNote()),this.isContentLoading()?this.getCollabContentTimer=setTimeout(function(){o.getCollabContent(e,!1)},1e3):(n=this.collabEngine.getCollabContent(e),n.status=n.resultCode),n):{status:a.ERRORID_COLLAB_ENGINE_NULL}},t.prototype.hasCachedDataCmd=function(){return null!=this.collabEngine&&this.collabEngine.hasCachedDataCmd()},t.prototype.isLastOwnDataCmdExecuted=function(){if(null!=this.collabEngine)return this.collabEngine.isLastOwnDataCmdExecuted()},t.prototype.isValidLocalDataCmd=function(e){if(null!=this.collabEngine)return this.collabEngine.isValidLocalDataCmd(e)},t.prototype.noteSetNotification=function(){var e=this;null!=this.collabEngine&&this.collabEngine.sendContentSetInfo(this.note.getFileVersion(),function(t){t.result===a.CJSON_INITIALIZE_DONE&&(e.isSessionInitDone=!0),e.trigger("yne-session-initialized",t.result,t)})},t.prototype.pushLocalDataCommand=function(e,t){null!=this.collabEngine&&this.collabEngine.pushLocalDataCommand(e,t)},t.prototype.saveNotification=function(e,t){null!=this.collabEngine&&this.collabEngine.saveNotification(e,t)},t.prototype.sendBlockLockInfo=function(e){null!=this.collabEngine&&this.collabEngine.sendOwnLockInfo(e)},t.prototype.sendCachedDataCommand=function(){null!=this.collabEngine&&this.collabEngine.sendCachedDataCmd(!1)},t.prototype.updateUserInfo=function(e){var t=this.getEditorProps();null!=e&&(n.extend(t.userInfo,e),null!=this.collabEngine&&this.collabEngine.updateSessionInfos(e))},t.prototype.applyCollabCmdRedoUndo=function(e){this.controller.cmdManager.applyCollabCmdRedoUndo(e)},t.prototype.buildNoteRangeFromJSON=function(e){return d.buildNoteRangeFromJSON(e,this)},t.prototype.createDataCommand=function(e,t){return this.controller.createCmd(e,t)},t.prototype.dropRedoCmd=function(){this.controller.cmdManager.dropRedoCmd()},t.prototype.dropUndoCmds=function(e,t,n){this.controller.cmdManager.dropUndoCmds(e,t,n)},t.prototype.getClientId=function(){return this.clientId},t.prototype.getDefaultNoteRange=function(){return this.controller.defaultNoteRange()},t.prototype.getInnerBlocksWithEdge=function(e){var t,n,o;return e&&c.isHeaderFooterRange(e.getStartBlockRange())?[e.getStartBlockRange().block]:(u.isNoteRange(e)&&(t=e.getStartBlockRange().block,n=e.getEndBlockRange().block,o=this.note.getInterBlocks(t,n,!0)),o)},t.prototype.getNextBlockById=function(e){var t=null,n=this.getBlockById(e);return n&&(t=this.note.getNextBlock(n)),t},t.prototype.getNoteVersion=function(){return this.note?this.note.getFileVersion():null},t.prototype.getPreBlockById=function(e){var t=null,n=this.getBlockById(e);return n&&(t=this.note.getPreBlock(n)),t},t.prototype.isListItem=function(e){return l.isListItem(e)},t.prototype.isNoteValidForCollab=function(){return this.controller.note.isValidForCollab()},t.prototype.isReadyForEdit=function(){return!0===this.isSessionInitDone},t.prototype.isContentLoading=function(){return!0===this.contentLoading},t.prototype.isTable=function(e){return l.isTable(e)},t.prototype.isTodo=function(e){return l.isTodo(e)},t.prototype.reset=function(){null!=this.getCollabContentTimer&&clearTimeout(this.getCollabContentTimer),e.prototype.reset.call(this)},t.prototype.setNoteVersion=function(e){f.log("SetNoteVersion:"+e),this.note.setFileVersion(e),this.trigger("yne-note-version-change",e)},t.prototype.buildBlockRangeFromJSON=function(e){var t,n;return e&&e.blockId?(t=e.blockId,n=this.getBlockById(t),n?s.createRangeByBlock({block:n,end:e.endPosition,rect:e.simpleValue1,start:e.startPosition,type:e.simpleValue2}):void f.log("block is NOT existing:",e)):void f.error("The blockRangeJSON.blockId is not valid!")},t.prototype.buildInnerCommandFromJSON=function(e,t){var o=e[a.CJSON_ACTION],i={};return i.collabProperties=n.clone(t.collabProperties),i.collabProperties.cmdJSON=e,this.createDataCommand(o,i)},t.prototype.getBlockById=function(e){return this.note.getBlockById(e)},t.prototype.getEditorProps=function(){return this.editorProps},t.prototype.getNoteProps=function(){return this.noteProps},t.prototype.getNote=function(){return this.note},t.prototype.isCollabEnabled=function(){return!(null==this.noteProps||!this.noteProps.isCollabEnabled)},t.prototype.isIdleTimeout=function(){return this.idleTimeout},t.prototype.isMyOwnLockedBlock=function(e){var t,n=!1,o=this._getMyOwnBlockId();return null!=e&&null!=o&&""!==o&&(u.isNoteRange(e)&&e.isInSingleBlock()?t=e.getStartBlockRange().getBlockId():s.isBlockRange(e)&&(t=e.getBlockId()),t&&t===o&&!this.isTable(this.getBlockById(t))&&(n=!0)),n},t.prototype.render=function(){e.prototype.render.call(this),this.isCollabEnabled()||this.updateNoteViewVisibility(!0)},t.prototype.setIdleTimeout=function(e){e&&(this.noteView.render(),this.setReadOnly(!0)),this.idleTimeout=e},t.prototype.updateEditorOptions=function(e){var t=this;if(t.options||(t.options=e?n.clone(e):{}),e)for(var o in e)e.hasOwnProperty(o)&&("shareKey"===o&&t.options[o]!==e[o]&&(t.idleTimeout=!1),t.options[o]=e[o]);t.options.isCollabEnabled=g.parseToBoolean(t.options.isCollabEnabled,!0),t.options.isCollabEnabled||(t.idleTimeout=!1),t.options.hideAttendeeHint=g.parseToBoolean(t.options.hideAttendeeHint,!1),t.options.disableBackground=g.parseToBoolean(t.options.disableBackground,!1),t.options.useWSS=g.parseToBoolean(t.options.useWSS,!1),t.options.pageType=g.parseToPageType(t.options.pageType),t.options.sessionId||(t.options.sessionId=t.clientId),t.options.readOnly=g.parseToBoolean(t.options.readOnly,!1),t.options.hasOriginFile=g.parseToBoolean(t.options.hasOriginFile,!1),n.extend(t.editorProps,t.options)},t.prototype.notifyErrorToHost=function(e){this.trigger("yne-useraction-failed",e)},t.prototype.onDocSelectionChange=function(){f.log("TODO: onDocSelectionChange Event")},t.prototype.recoverFromIdleTimeout=function(){var e;this.idleTimeout&&this.isCollabEnabled()&&(e={code:0,customCode:8e3,shareKey:this.getCollabId()},this.trigger("yne-session-closed",e))},t.prototype.testSendMsgToCollabServer=function(e){null!=this.collabEngine&&this.collabEngine.sendMessageToCollabServer(e)},t.prototype.bindEventsForController=function(){var e=this,t=this.controller;t.on("command-exec",function(t,n){if(!t||!t.name)return void f.error("The command is not valid",t);e.isCollabEnabled()?(n=n||{},n.collabProperties=n.collabProperties||{},n.collabProperties.finalNoteVersion&&e.setNoteVersion(n.collabProperties.finalNoteVersion),t&&t.effected&&(!n.collabProperties.isCollabCmd||n.collabProperties.isCollabCmd&&n.collabProperties.isOwnCmd&&!n.collabProperties.isLocalExecutedCmd)&&(e.contentChanged=!0,e.trigger("yne-content-change"))):t&&t.effected?(e.contentChanged=!0,e.trigger("yne-content-change")):f.warn("The command has no effected",t)}),p.bubble(["redo-stack-change","undo-stack-change","selectstart","mouse-down","command-exec","esc","yne-clipboard-status","yne-clipboard-error","yne-get-clipboard","yne-clipboard-set","color-picker-show","yne-user-action-collection","cell-edit-view-enter","cell-edit-view-exit","cell-edit-view-history-change"],t,this)},t.prototype._getMyOwnBlockId=function(){var e=this.collabEngine.getMyOwnBlockIds();return null!=e&&e.length>0?e[0]:null},t.prototype._initCollabEngine=function(){var e=this;e.idleTimeout=!1,e.isSessionInitDone=!1,e.collabEngine=new o.default(e,n,f),e.collabEngine.on(i.default.WS_CLOSED,function(t){8e3===t.customCode&&h.IS_PC?e.setIdleTimeout(!0):e.trigger("yne-session-closed",t)}),e.collabEngine.on(i.default.DATACMD_FAILURE,function(t){e.trigger("yne-useraction-failed",t.message)}),e.collabEngine.on(i.default.DATACMD_SUCCESS,function(t){e.trigger("yne-datacommand-success",t.rawCollabJSON)}),e.collabEngine.on(i.default.LOCK_LOCKED,function(t){var n,o=t.sessionProps;null!=o&&null!=o.lockedBlkIds&&o.lockedBlkIds.length>0&&(n=o.lockedBlkIds[0],e._lockBlock(n,o))}),e.collabEngine.on(i.default.LOCK_RELEASED,function(t){e._unlockBlock(t.unlockedBlockId)}),e.collabEngine.on(i.default.SESSION_CHNAGED,function(t){null!=t&&t.length>0&&n.each(t,function(t){t.propUpdated&&null!=t.nickname&&null!=t.lockedBlkIds&&t.lockedBlkIds.length>0&&t.sessionId!==e.clientId&&(t.lockUpdated=!0,e._lockBlock(t.lockedBlkIds[0],t))}),e.trigger("yne-collabsession-change",t)})},t.prototype._lockBlock=function(e,t){var n=this.note,o=this.getBlockById(e);null==o||this.isTable(o)||n.lockBlock(e,t)},t.prototype._unlockBlock=function(e){this.note.unlockBlock(e)},t}(m)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(66),n(274),n(36),n(275),n(276),n(277),n(31),n(54)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h,g,f,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=function(){},v=function(e){function t(t,r,u){var d=e.call(this)||this;if(d.localCmdPerSec=0,null==r)throw new Error("Missing underscorejs");if(null==u)throw new Error("Missing logger instance");return p.ExternalLibs.setUnderscore(r),p.ExternalLibs.setLogger(u),d.isLocalCmdTooFast=!1,d.coreEditor=t,d.clientId=d.coreEditor.getClientId(),d.keyTranslator=new l.CollabKeyTranslator,d.collabPropsHandler=new o.CmdCollabPropsHandler(d.clientId,d.keyTranslator,d.coreEditor),d.wsClient=new f.WebSocketClient(d.collabPropsHandler),d.cmdMergeHandler=new i.CmdMergeHandler,d.nondataCmdHandler=new h.NonDataCmdHandler(d.wsClient),d.sessionHandler=new s.CollabSessionHandler(d.clientId,d.nondataCmdHandler),d.blockLockHandler=new n.BlockLockHandler(d.clientId,d.sessionHandler,d.nondataCmdHandler),d.conflictHandler=new a.CollabConfilctHandler(d.coreEditor,d.blockLockHandler),d.redoundoHandler=new g.RedoUndoHandler(d.coreEditor),d.dataCmdHandler=new c.DataCmdHandler(d.coreEditor,d.blockLockHandler,d.conflictHandler,d.redoundoHandler,d.cmdMergeHandler,d.keyTranslator,d.wsClient),d._createEventEmitter(),d}return r(t,e),t.prototype.buildCollabProperties=function(e){return this.collabPropsHandler.buildCollabProperties(e)},t.prototype.buildCollabSession=function(e,t){var n,o,i=this,r={resultCode:u.CustomResultCode.NO_ERROR};e.sessionId=this.clientId,t=t||y,null!=this.callbackBuildCollabSession&&(r.resultCode=u.CustomResultCode.STOP_CALL,r.message="StopPreviousCall",this.callbackBuildCollabSession(r)),this.callbackBuildCollabSession=function(e){clearTimeout(i.timeoutBuildCollabSession),i.wsClient.off(_.default.SESSION_INIT_BUILT,n),i.wsClient.off(_.default.WS_CLOSED,o),t(e)};try{o=function(e){p.loggerInst.log("WS_CLOSED Callback in buildCollabSession"),i.callbackBuildCollabSession(e)},this.wsClient.once(_.default.WS_CLOSED,o),n=function(e){p.loggerInst.log("SESSION_INIT_BUILT Callback in buildCollabSession"),i.callbackBuildCollabSession(e)},this.nondataCmdHandler.once(_.default.SESSION_INIT_BUILT,n),this.wsClient.connect(e),this.timeoutBuildCollabSession=setTimeout(function(){var e={resultCode:u.CustomResultCode.TIME_OUT};e.message="TimeOut",i.callbackBuildCollabSession(e)},5e3)}catch(e){r.resultCode=u.CustomResultCode.EXCEPTION,r.message=e.message||e,this.callbackBuildCollabSession(r)}},t.prototype.closeCollabSession=function(e,t,n){var o={resultCode:u.CustomResultCode.NO_ERROR};n=n||y;try{this.wsClient.close(e,t),this.blockLockHandler.destroy(),this.blockLockHandler=null,this.collabPropsHandler.destroy(),this.collabPropsHandler=null,this.conflictHandler.destroy(),this.conflictHandler=null,this.cmdMergeHandler.destroy(),this.cmdMergeHandler=null,this.dataCmdHandler.destroy(),this.dataCmdHandler=null,this.nondataCmdHandler.destroy(),this.nondataCmdHandler=null,this.redoundoHandler.destroy(),this.redoundoHandler=null,this.sessionHandler.destroy(),this.sessionHandler=null}catch(e){o.resultCode=u.CustomResultCode.EXCEPTION,o.message=e.message||e}n(o)},t.prototype.isLastOwnDataCmdExecuted=function(){return this.dataCmdHandler.isLastOwnCmdExecuted()},t.prototype.sendContentSetInfo=function(e,t){var n=this,o={collabId:this.wsClient.getCollabId(),isReadOnly:this.wsClient.isReadOnlySession(),nickname:this.wsClient.getNickname(),result:d.ConstValueInJSON.SESSION_INIT_DONE,resultCode:u.CustomResultCode.NO_ERROR,sessionId:this.wsClient.getSessionId(),userId:this.wsClient.getUserId()},i={};t=t||y,null!=this.callbackSendContentSetInfo&&(o.resultCode=u.CustomResultCode.STOP_CALL,o.message="StopPreviousCall",this.callbackSendContentSetInfo(o)),this.callbackSendContentSetInfo=function(e){clearTimeout(n.timeoutSendContentSetInfo),n.nondataCmdHandler.off(_.default.SESSION_INIT_DONE,n.callbackSendContentSetInfo),t(e)},this.coreEditor.isNoteValidForCollab()?(i.noteVersion=e,this.nondataCmdHandler.once(_.default.SESSION_INIT_DONE,this.callbackSendContentSetInfo),this.nondataCmdHandler.sendCollabNonDataCommand(u.CmdNames.NONDATACMD_CLINTPONG,i),this.timeoutSendContentSetInfo=setTimeout(function(){o.resultCode=u.CustomResultCode.TIME_OUT,null!=n.callbackSendContentSetInfo&&n.callbackSendContentSetInfo(o)},5e3)):(o.result=d.ConstValueInJSON.SESSION_INIT_INVALID,this.callbackSendContentSetInfo(o))},t.prototype.getCollabContent=function(e){var t=this,n={resultCode:0},o=function(n){n.resultCode===u.CustomResultCode.NO_ERROR&&(n.version=t.coreEditor.getNoteVersion(),n.content=t.coreEditor.getXmlContent(),n.sessionCount=t.sessionHandler.getSessionCount()),null!=t.callbackGetCollabContent&&t.dataCmdHandler.off(_.default.DATACMD_NO_PENDING,t.callbackGetCollabContent),t.callbackGetCollabContent=null,clearTimeout(t.timeoutGetCollabContent),e(n)};return e=e||y,this.coreEditor.isContentLoading()?(n.resultCode=0,o(n)):this.dataCmdHandler.hasPendingCmds()?this.wsClient.isOpened()?(n.resultCode=0,null==this.callbackGetCollabContent&&(this.callbackGetCollabContent=function(e){null==e&&(e={resultCode:u.CustomResultCode.NO_ERROR}),o(e)},this.dataCmdHandler.once(_.default.DATACMD_NO_PENDING,this.callbackGetCollabContent),this.timeoutGetCollabContent=setTimeout(function(){n.resultCode=u.CustomResultCode.TIME_OUT,n.message="TimeOut",null!=t.callbackGetCollabContent&&t.callbackGetCollabContent(n)},6e4))):(n.resultCode=u.WSCustomCode.COLLAB_SESSION_CLOSED,o(n)):(n.resultCode=u.CustomResultCode.NO_ERROR,o(n)),n},t.prototype.getModifiers=function(e,t){var n=this,o={status:0,resultCode:u.CustomResultCode.NO_ERROR};return t=t||y,null!=this.callbackGetModifiers&&(o.resultCode=u.CustomResultCode.STOP_CALL,o.status=2,o.message="StopPreviousCall",this.callbackGetModifiers(o)),this.callbackGetModifiers=function(e){n.nondataCmdHandler.off(_.default.NONDATACMD_MODIFIERS_RESULT,n.callbackGetModifiers),n.callbackGetModifiers=null,clearTimeout(n.timeoutGetModifiers),t(e)},o=this.nondataCmdHandler.getModifiers(e),0!==o.status?(t(o),o):(this.nondataCmdHandler.once(_.default.NONDATACMD_MODIFIERS_RESULT,this.callbackGetModifiers),this.timeoutGetModifiers=setTimeout(function(){null!=n.callbackGetModifiers&&(o.resultCode=u.CustomResultCode.TIME_OUT,o.status=2,o.message="TimeOut",n.callbackGetModifiers(o))},5e3),o)},t.prototype.saveNotification=function(e,t){var n={};n.noteVersion=e,n.isHistorySave=!!t,this.nondataCmdHandler.sendCollabNonDataCommand(u.CmdNames.NONDATACMD_NOTESAVE,n)},t.prototype.getLastNotOwnExecCmd=function(){return this.dataCmdHandler.getLastNotOwnExecCmd()},t.prototype.getMyOwnBlockIds=function(){return this.blockLockHandler.getOwnBlockIds()},t.prototype.sendOwnLockInfo=function(e){var t={};t.lockedBlockId=e,t.sessionId=this.clientId,this.nondataCmdHandler.sendCollabNonDataCommand(u.CmdNames.NONDATACMD_COLLABINFO,t)},t.prototype.sendCachedDataCmd=function(e){this.dataCmdHandler.sendCachedDataCommand(e)},t.prototype.hasCachedDataCmd=function(){return this.dataCmdHandler.hasPendingCmds()},t.prototype.pushLocalDataCommand=function(e,n){var o=u.CustomResultCode.NO_ERROR;return o=this.dataCmdHandler.pushLocalDataCommand(e,n),o===u.CustomResultCode.NO_ERROR&&1===this.dataCmdHandler.getCachedCmdCount()&&(this._checkCommandSendDelay(),this._updateCmdSpeed(!0)),o===u.CustomResultCode.NO_ERROR&&e.isLocalExecutedCmd&&++this.localCmdPerSec>t.LACAL_CMD_SPEED_LIMITATION&&(this.isLocalCmdTooFast=!0),o},t.prototype.isValidLocalDataCmd=function(e){var t=!0,n={closeSession:!1,resultCode:u.CustomResultCode.NO_ERROR};return t&&(t=this._isLocalCommandTooFast()),t&&!1===e.isReadyToApply&&(n.message="命令不满足执行条件",n.resultCode=u.DataCmdFailureCode.LOCAL_NOT_READY_APPLY,this.emit(_.default.DATACMD_FAILURE,n),t=!1),t&&!this.wsClient.isOpened()&&(n.resultCode=u.WSCustomCode.SESSION_NOT_OPENED,n.message="协同链接已断开",this.emit(_.default.DATACMD_FAILURE,n),t=!1),t&&!this.coreEditor.isNoteValidForCollab()&&(n.resultCode=u.DataCmdFailureCode.LOCAL_INVALID_FOR_COLLAB,n.message="笔记不满足协同条件",this.emit(_.default.DATACMD_FAILURE,n),t=!1),t&&!e&&(n.message="空的本地命令，已被忽略",n.resultCode=u.DataCmdFailureCode.LOCAL_EMPTY_CMD,this.emit(_.default.DATACMD_FAILURE,n),t=!1),!t||e.isCollabRedo||e.isCollabUndo||(t=!this._isLocalCommandConflict(e)),t&&(e.isCollabRedo||e.isCollabUndo)&&!1===(t=this.redoundoHandler.ValidateLocalRedoUndo(e))&&(n.message="目标区域已经被修改，不能撤销或重做",n.resultCode=u.DataCmdFailureCode.LOCAL_DIRTY_BLOCKS,this.emit(_.default.DATACMD_FAILURE,n)),t},t.prototype.updateSessionInfos=function(e){this.nondataCmdHandler.sendCollabNonDataCommand(u.CmdNames.NONDATACMD_COLLABINFO,e)},t.prototype.sendMessageToCollabServer=function(e){this.wsClient.send(e)},t.prototype.getCollabId=function(){return this.wsClient.getCollabId()},t.prototype._sendDataCmdFailedMessage=function(e,t){var n={};n.errToClose=t,n.dataCmdErrorCode=e.toString(),this.nondataCmdHandler.sendCollabNonDataCommand(u.CmdNames.NONDATACMD_DATACMDFAILED,n)},t.prototype._createEventEmitter=function(){var e=this;e.wsClient.on(_.default.WS_CLOSED,function(t){e.emit(_.default.WS_CLOSED,t)}),e.nondataCmdHandler.on(_.default.SESSION_INIT_BUILT,function(t){e.emit(_.default.SESSION_INIT_BUILT,t)}),e.nondataCmdHandler.on(_.default.SESSION_INIT_DONE,function(t){e.emit(_.default.SESSION_INIT_DONE,t)}),e.sessionHandler.on(_.default.SESSION_CHNAGED,function(t){p.underscoreInst.each(t,function(t){if(t.propUpdated){var n=e.blockLockHandler.getLockedBlockIdsBy(t.sessionId);null!=n&&n.length>0&&(t.lockedBlkIds=n)}}),e.emit(_.default.SESSION_CHNAGED,t)}),e.blockLockHandler.on(_.default.LOCK_LOCKED,function(t){var n;t.sessionProps&&t.sessionProps.lockedBlkIds&&t.sessionProps.lockedBlkIds.length>0&&(n=t.sessionProps.lockedBlkIds[0]),null!=n&&(t.sessionId===e.wsClient.getSessionId()?e.sendOwnLockInfo(n):e.emit(_.default.LOCK_LOCKED,t))}),e.blockLockHandler.on(_.default.LOCK_RELEASED,function(t){t.sessionId!==e.wsClient.getSessionId()&&e.emit(_.default.LOCK_RELEASED,t)}),e.dataCmdHandler.on(_.default.DATACMD_FAILURE,function(t){e._sendDataCmdFailedMessage(t.resultCode,t.closeSession),e.emit(_.default.DATACMD_FAILURE,t)}),e.dataCmdHandler.on(_.default.DATACMD_SUCCESS,function(t){e.emit(_.default.DATACMD_SUCCESS,t)})},t.prototype._checkCommandSendDelay=function(){!this.isLocalCmdTooFast&&null!=this.dataCmdHandler&&this.dataCmdHandler.getCmdDelay()>t.MAX_CMD_DELAY_MILLIS?this.wsClient.close(u.WSCustomCode.FAILED_SEND_LOCAL_CMD,"ExceedMaxSendDelay"):null!=this.dataCmdHandler&&this.dataCmdHandler.getCachedCmdCount()>0&&this.wsClient.isOpened()&&window.setTimeout(this._checkCommandSendDelay.bind(this),t.MAX_CMD_DELAY_MILLIS)},t.prototype._isLocalCommandConflict=function(e){var t=!1,n=e.getStartingRange(),o=e.getCollabProps();if(n&&(t=this.conflictHandler.isNoteRangeConflict(n,e.name,o))){var i={closeSession:o.errorToClose,message:o.dataCmdError,resultCode:o.errorCode};this.emit(_.default.DATACMD_FAILURE,i)}return t},t.prototype._isLocalCommandTooFast=function(){var e=!0,t=this.dataCmdHandler.getCachedCmdCount();if(this.isLocalCmdTooFast&&t>0){e=!1,t=this.dataCmdHandler.getCachedCmdCount();var n={closeSession:!1,message:"命令输入过快，等待执行命令个数："+t,resultCode:u.DataCmdFailureCode.LOCAL_CMD_TOO_FAST};this.emit(_.default.DATACMD_FAILURE,n),this.sendCachedDataCmd(!1)}return e},t.prototype._updateCmdSpeed=function(e){var n,o=0;null!=this.dataCmdHandler&&(o=this.dataCmdHandler.getCachedCmdCount()),e&&(this.isLocalCmdTooFast=!1),o>0?(n=o/t.LACAL_CMD_SPEED_LIMITATION,n<1&&(n=1),this.localCmdPerSec=0,this.wsClient.isOpened()&&window.setTimeout(this._updateCmdSpeed.bind(this,!1),1e3*n)):this.isLocalCmdTooFast=!1},t.LACAL_CMD_SPEED_LIMITATION=20,t.MAX_CMD_DELAY_MILLIS=4e3,t}(m.YEvent);t.default=v}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(66),n(36),n(31),n(54)],void 0!==(i=function(e,t,n,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t,n,o){var i=e.call(this)||this;if(null==t)throw new Error("ownSID cannot be null in BlockLockHandler");return i.lockedBlocksMap={},i.sessionId=t,i.sessionHandler=n,i.nonDataCmdHandler=o,i.sessionHandler.on(a.default.SESSION_LOCK_UPDATE,i._onSessionLockChanged.bind(i)),i.sessionHandler.on(a.default.SESSION_QUIT,i._onSessionQuit.bind(i)),i.nonDataCmdHandler.on(a.default.LOCK_RELEASED,function(e){i._releaseLockOf(e.sessionId)}),i}return r(t,e),t.prototype.destroy=function(){this.lockedBlocksMap=null,this.sessionHandler=null,this.nonDataCmdHandler=null,this.removeAllListeners(null)},t.prototype.isBlockLockedBy=function(e,t){var n,o=!1;return null!=e&&null!=t&&null!=(n=this.lockedBlocksMap[e])&&n===t&&(o=!0),o},t.prototype.getOwnBlockIds=function(){var e=this,t=[];return o.underscoreInst.each(this.lockedBlocksMap,function(n,o){n===e.sessionId&&t.push(o)}),t},t.prototype.getLockedBlockIdsBy=function(e){var t=[];return o.underscoreInst.each(this.lockedBlocksMap,function(n,o){e===n&&t.push(o)}),t},t.prototype.updateLockByDataCmd=function(e){var t,n=e.getCollabProps();if(null!=(t=e.isCollabUndo?e.getStartingRange():e.getEndingRange())){var o=t.getEndBlockRange();if(null!=o){var i=o.block.getId();if(null!=i&&(this._releaseLockOf(n.cmdSessionId),null==this.lockedBlocksMap[i])){var r=this.sessionHandler.getSessionPropertiesBy(n.cmdSessionId);null!=r&&(r.lockedBlkIds=[i],this._lockBlock(r))}}}},t.prototype._releaseLockOf=function(e){var t=this,n=[];o.underscoreInst.each(this.lockedBlocksMap,function(t,o){t===e&&n.push(o)}),o.underscoreInst.each(n,function(n){t._unlockBlock(n,e)})},t.prototype._onSessionQuit=function(e){this._releaseLockOf(e.sessionId)},t.prototype._onSessionLockChanged=function(e){var t=this,n=!1;o.underscoreInst.each(e,function(e){n=!1,null!=e.lockedBlkIds&&e.lockedBlkIds.length>0&&(o.underscoreInst.some(e.lockedBlkIds,function(o){return t.lockedBlocksMap[o]!==e.sessionId&&(n=!0),n}),n&&(t._releaseLockOf(e.sessionId),t._lockBlock(e)))})},t.prototype._unlockBlock=function(e,t){delete this.lockedBlocksMap[e];var o={resultCode:n.CustomResultCode.NO_ERROR,sessionId:t,unlockedBlockId:e};this.emit(a.default.LOCK_RELEASED,o)},t.prototype._lockBlock=function(e){var t=this,n={resultCode:1,sessionId:e.sessionId,sessionProps:e},i=!1;o.underscoreInst.each(e.lockedBlkIds,function(n){t.lockedBlocksMap[n]!==e.sessionId&&(t.lockedBlocksMap[n]=e.sessionId,i=!0)}),i&&this.emit(a.default.LOCK_LOCKED,n)},t}(i.YEvent);t.BlockLockHandler=l}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(31)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n,o){var i=e.call(this)||this;return i.clientId=t,i.collabKeyTranslator=n,i.coreEditor=o,i}return r(t,e),t.prototype.destroy=function(){this.removeAllListeners(null)},t.prototype.buildCollabProperties=function(e){var t,n,o,i,r={coreEditor:this.coreEditor,isCollabEnabled:this.coreEditor.isCollabEnabled()};return e?(r.cmdSessionId=e.sessionId,t=r.cmdSessionId===this.clientId,r.isOwnCmd=t,r.finalNoteVersion=parseInt(e.finalVersion,10),r.ownerName=e.cmdOwner,r.isCollabEnabled=!0,r.isCollabCmd=!0,r.isServerCmd=!1,n=e.collabCmds,n.nondataCmds?i=n.nondataCmds[0]:(this.collabKeyTranslator.decode(n),o=n.dataCommands[0]),null!=i?r.isServerCmd=!0===i.isServerCmd:null!=o&&(r.isLocalExecutedCmd=!0===o.isLocalExecutedCmd,r.cmdId=o.cmdId)):r.cmdSessionId=this.clientId,r},t}(n.YEvent);t.CmdCollabPropsHandler=o}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(36),n(31)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.destroy=function(){this.removeAllListeners(null)},t.prototype.mergeLocalCommands=function(e){var t,o,i=null,r=0;if(e&&e.length>0)if(1===e.length)i=e[0];else{for(i=e.shift();e.length>0&&(t=e[0],i.canBeMerged(t));)n.loggerInst.log("merge pending command:",i,t),i.mergeLocalCmd(t),e.shift(),r++;r>0&&e[0]&&e[0].isCollabUndo&&(o=n.underscoreInst.clone(i),o.isLocalExecutedCmd=e[0].isLocalExecutedCmd,o.setCollabUndo(!0),o.setCollabRedo(!1),e[0]=o),e.unshift(i)}},t}(o.YEvent);t.CmdMergeHandler=i}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(2),n(66),n(36),n(31)],void 0!==(i=function(e,t,n,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t,n){var o=e.call(this)||this;return o.coreEditor=t,o.lockHandler=n,o}return r(t,e),t.prototype.destroy=function(){this.lockHandler=null,this.removeAllListeners(null)},t.prototype.isConflictWithOwnLockedBlock=function(e,t,n){var r,a,l,s,c=this.lockHandler.getOwnBlockIds(),u=!1;return null!=c&&c.length>0&&(s=c[0]),i.loggerInst.log("LOCK/UNLOCK: isConflictWithOwnLockedBlock Enter"),"comp.AppendBlank"!==t&&s&&(r=this.coreEditor.getBlockById(s),r&&!this.coreEditor.isTable(r)&&(a=this.coreEditor.getInnerBlocksWithEdge(e),a&&0!==a.length?i.underscoreInst.some(a,function(e){return e.getId()===s&&(n.collabProperties.dataCmdError="协同命令执行失败：编辑目标段落被锁定",n.collabProperties.errorToClose=!!n.collabProperties.isLocalExecutedCmd,n.collabProperties.errorCode=o.DataCmdFailureCode.COLLAB_TARGET_BLOCK_LOCKED,u=!0),u}):i.loggerInst.warn("Failed to get the blocks from range",e)),u||null==n.dropRange||null==n.dropRange.block||(l=n.dropRange.block.getId())&&(u=l===s)&&(n.collabProperties.dataCmdError="协同命令执行失败：拖拽目标段落被锁定",n.collabProperties.errorToClose=!!n.collabProperties.isLocalExecutedCmd,n.collabProperties.errorCode=o.DataCmdFailureCode.COLLAB_TARGET_BLOCK_LOCKED)),i.loggerInst.log("LOCK/UNLOCK: isConflictWithOwnLockedBlock Exit"),u},t.prototype.isNoteRangeConflict=function(e,t,n){var r,a,l,s,c,u=this,d=!1;return i.loggerInst.log("LOCK/UNLOCK: isNoteRangeConflict Enter"),a=n.cmdSessionId,c=!n.isCollabCmd||n.isOwnCmd,"comp.AppendBlank"!==t&&"ManagerAdapter"!==t&&(r=this.coreEditor.getInnerBlocksWithEdge(e),r&&0!==r.length?(i.underscoreInst.some(r,function(e){return i.loggerInst.log("LOCK/UNLOCK: "+e.getId()+" LockState:"+e.isLocked()),e.isLocked()&&(d=c||!u.lockHandler.isBlockLockedBy(e.getId(),a))&&(n.dataCmdError="目标段落已被其他用户锁定",n.isCollabCmd?(n.errorToClose=!!n.isLocalExecutedCmd,n.errorCode=o.DataCmdFailureCode.COLLAB_TARGET_BLOCK_LOCKED):n.errorCode=o.DataCmdFailureCode.LOCAL_TARGET_BLOCK_LOCKED),d}),d||(d=this._isConflictWithNeighborBlock(t,e,n))):(n.dataCmdError="目标段落不存在",n.isCollabCmd?(n.errorToClose=!0,n.errorCode=o.DataCmdFailureCode.COLLAB_BLOCKS_MISSING):n.errorCode=o.DataCmdFailureCode.LOCAL_BLOCKS_MISSING,d=!0),d||null==n.cmdJSON||null==n.cmdJSON.dropRange||(l=n.cmdJSON.dropRange.blockId,l&&(s=this.coreEditor.getBlockById(l)),s&&s.isLocked()&&(d=c||!this.lockHandler.isBlockLockedBy(l,a)))),i.loggerInst.log("LOCK/UNLOCK: isNoteRangeConflict Exit"),d},t.prototype._isConflictWithNeighborBlock=function(e,t,r){var a,l,s,c,u=r.cmdSessionId,d=!1;if(!t)return i.loggerInst.warn("_isConflictWithNeighborBlock:noteRange should not be null"),!1;switch(a=t.getStartBlockRange(),l=!r.isCollabCmd||r.isOwnCmd,e){case"comp.KeyBackspace":a&&n.isTextBlock(a.block)&&0===a.start&&!this.coreEditor.isTodo(a.block)&&(s=this.coreEditor.getPreBlockById(a.getBlockId()))&&t.isCollapsed()&&!this.coreEditor.isListItem(a.block)&&0===a.block.getBlockStyle("text-indent")&&s.isLocked()&&(d=l||!this.lockHandler.isBlockLockedBy(s.getId(),u))&&(r.dataCmdError="目标段落已被其他用户锁定",r.isCollabCmd?(r.errorToClose=!0,r.errorCode=o.DataCmdFailureCode.COLLAB_TARGET_BLOCK_LOCKED):r.errorCode=o.DataCmdFailureCode.LOCAL_TARGET_BLOCK_LOCKED);break;case"comp.KeyDelete":t.isCollapsed()&&n.isTextBlock(a.block)&&a.end===a.block.getLength(!1)&&(c=this.coreEditor.getNextBlockById(a.getBlockId()))&&c.isLocked()&&(d=l||!this.lockHandler.isBlockLockedBy(c.getId(),u))&&(r.dataCmdError="目标段落已被其他用户锁定",r.isCollabCmd?(r.errorToClose=!0,r.errorCode=o.DataCmdFailureCode.COLLAB_TARGET_BLOCK_LOCKED):r.errorCode=o.DataCmdFailureCode.LOCAL_TARGET_BLOCK_LOCKED)}return d},t}(a.YEvent);t.CollabConfilctHandler=l}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(36),n(31)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.KEY_MAP_DECODE={a:{key:"sessionId",type:0},b:{key:"finalVersion",type:0},c:{key:"cmdOwner",type:0},d:{key:"collabCmds",type:1},e:{key:"dataCommands",type:1},f:{key:"action",type:0},g:{key:"cmdId",type:0},h:{key:"nondataCmds",type:1},i:{key:"updateVersion",type:0},j:{key:"startNoteRange",type:1},k:{key:"startBlockRange",type:1},l:{key:"rangeType",type:0},m:{key:"startPosition",type:0},n:{key:"endPosition",type:0},o:{key:"isInSingleBlock",type:0},p:{key:"cmdNoteVersion",type:0},q:{key:"isLocalExecutedCmd",type:0},r:{key:"skipBlockLocking",type:0},s:{key:"blockId",type:0},t:{key:"richText",type:0},u:{key:"newBlkId",type:0},v:{key:"inlineStyles",type:0},w:{key:"blockStyles",type:0},x:{key:"newStartBlkId",type:0},y:{key:"newEndBlkId",type:0},z:{key:"dropRange",type:1},0:{key:"colNums",type:0},1:{key:"rowNums",type:0},2:{key:"simpleValue1",type:0},3:{key:"src",type:0},4:{key:"simpleValue2",type:0},5:{key:"recogLink",type:0},6:{key:"attachRes",type:0},7:{key:"fileName",type:0},8:{key:"fileLen",type:0},9:{key:"innerCmds",type:1},A:{key:"affectedBlockIds",type:0},B:{key:"endNoteRange",type:1},C:{key:"isCollabUndo",type:0},D:{key:"preBlockId",type:0},E:{key:"deletedBlocks",type:0},F:{key:"insertedBlocks",type:0},G:{key:"isCollabRedo",type:0},H:{key:"resIds",type:0},J:{key:"dataBefore",type:0},K:{key:"dataAfter",type:0},L:{key:"endBlockRange",type:1},N:{key:"blockIds",type:0},O:{key:"styleNameValues",type:0},P:{key:"oldStyleNameValues",type:0},Q:{key:"abstractSimpleValue1",type:0},R:{key:"indentStep",type:0},S:{key:"listId",type:0},T:{key:"listType",type:0},U:{key:"abstractSimpleValue2",type:0},V:{key:"oldLevels",type:0},W:{key:"newLevels",type:0},X:{key:"listItemIds",type:0},Y:{key:"headerFooterInfo",type:0}},t._assembleEncodeMap(),t}return r(t,e),t.prototype.destroy=function(){},t.prototype.decode=function(e){var t,o,i=this;if(!1===this.isValidKeyMap)return void n.loggerInst.error("KeyMap is not valid, skip decode.");if(n.underscoreInst.isArray(e))return void n.underscoreInst.each(e,function(e){i.decode(e)});if(null!==e&&"object"==typeof e){t=n.underscoreInst.keys(e);for(var r=0,a=t;r<a.length;r++){var l=a[r];e.hasOwnProperty(l)&&(l in this.KEY_MAP_DECODE&&(o=this.KEY_MAP_DECODE[l].key,e[o]=e[l],delete e[l],null!==e[o]&&"object"==typeof e[o]&&1===this.KEY_MAP_DECODE[l].type&&this.decode(e[o])))}}},t.prototype.encode=function(e){var t,o,i=this;if(!1===this.isValidKeyMap)return void n.loggerInst.error("KeyMap is not valid, skip encode.");if(n.underscoreInst.isArray(e))return void n.underscoreInst.each(e,function(e){i.encode(e)});if(null!==e&&"object"==typeof e){t=n.underscoreInst.keys(e);for(var r=0,a=t;r<a.length;r++){var l=a[r];e.hasOwnProperty(l)&&(l in this.KEY_MAP_ENCODE?(o=this.KEY_MAP_ENCODE[l].key,e[o]=e[l],delete e[l],null!==e[o]&&"object"==typeof e[o]&&1===this.KEY_MAP_ENCODE[l].type&&this.encode(e[o])):(n.loggerInst.log("key:",typeof l),n.loggerInst.error('Key - "',l,'" does NOT exist in COLLAB_MAP_ENCODE!')))}}},t.prototype._assembleEncodeMap=function(){var e,t;this.isValidKeyMap=!0,this.KEY_MAP_ENCODE={};for(t in this.KEY_MAP_DECODE)if(this.KEY_MAP_DECODE.hasOwnProperty(t)){if(e=this.KEY_MAP_DECODE[t].key,n.underscoreInst.has(this.KEY_MAP_DECODE,e)){this.isValidKeyMap=!1,n.loggerInst.error("original JSON key is conflict with encoded key, please rename it",e);break}if(n.underscoreInst.has(this.KEY_MAP_ENCODE,e)){this.isValidKeyMap=!1,n.loggerInst.error("original JSON key is duplicated, please rename them",e);break}this.KEY_MAP_ENCODE[e]={},this.KEY_MAP_ENCODE[e].key=t,this.KEY_MAP_ENCODE[e].type=this.KEY_MAP_DECODE[t].type}},t}(o.YEvent);t.CollabKeyTranslator=i}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(36),n(31),n(54)],void 0!==(i=function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,n){var o=e.call(this)||this;return o.sessionsMap={},o.nondataCmdHandler=n,o.nondataCmdHandler.on(i.default.SESSION_CHNAGED,o._onSessionChanged.bind(o)),o.nondataCmdHandler.on(i.default.SESSION_QUIT,o._onSessionQuit.bind(o)),o}return r(t,e),t.prototype.destroy=function(){this.sessionsMap=null,this.removeAllListeners(null)},t.prototype.getSessionCount=function(){return n.underscoreInst.size(this.sessionsMap)},t.prototype.getSessionPropertiesBy=function(e){var t=this.sessionsMap[e];if(t)return n.underscoreInst.clone(t)},t.prototype._onSessionChanged=function(e){var t,o,r=this,a=[],l=[],s=!1;e.length>0&&(n.underscoreInst.each(this.sessionsMap,function(e){e.propUpdated=!1,a.push(e)}),n.underscoreInst.each(e,function(e){if(null==r.sessionsMap[e.sessionId]&&(r.sessionsMap[e.sessionId]={sessionId:e.sessionId},a.push(r.sessionsMap[e.sessionId]),s=!0),o=e.lockedBlkIds,delete e.lockedBlkIds,t=r.sessionsMap[e.sessionId],t.propUpdated=!1,n.underscoreInst.each(Object.keys(e),function(n){t[n]!==e[n]&&(t[n]=e[n],t.propUpdated=!0,s=!0)}),null!=o&&o.length>0){var i={lockedBlkIds:o,sessionId:e.sessionId};n.underscoreInst.defaults(i,t),l.push(i)}}),s&&this.emit(i.default.SESSION_CHNAGED,a),l.length>0&&this.emit(i.default.SESSION_LOCK_UPDATE,l))},t.prototype._onSessionQuit=function(e){var t=[];delete this.sessionsMap[e.sessionId],this.emit(i.default.SESSION_QUIT,e),n.underscoreInst.each(this.sessionsMap,function(e){e.propUpdated=!1,t.push(e)}),this.emit(i.default.SESSION_CHNAGED,t)},t}(o.YEvent);t.CollabSessionHandler=a}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(66),n(36),n(124),n(31),n(54)],void 0!==(i=function(e,t,n,o,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t,n,o,i,r,a,s){var c=e.call(this)||this;return c.regularCmdSendIntervalMS=2e3,c.pendingSentCmdsQueue=[],c.coreEditor=t,c.blockLockHandler=n,c.conflictHandler=o,c.redoundoHandler=i,c.cmdMergeHandler=r,c.keyTranslator=a,c.wsClient=s,c.callbackWSOnMessage=c._execCollabDataCommand.bind(c),c.wsClient.on(l.default.WS_MESSAGE,c.callbackWSOnMessage),c}return r(t,e),t.prototype.destroy=function(){this.wsClient.off(l.default.WS_MESSAGE,this.callbackWSOnMessage),this.wsClient=null,this.removeAllListeners(null),this.pendingSentCmdsQueue=[]},t.prototype.getLastNotOwnExecCmd=function(){return this.lastNotOwnExecCmd},t.prototype.hasPendingCmds=function(){return this.pendingSentCmdsQueue&&this.pendingSentCmdsQueue.length>0},t.prototype.isLastOwnCmdExecuted=function(){var e=!0;return this.pendingSentCmdsQueue.length>0&&(e=this.pendingSentCmdsQueue[0].isLocalExecutedCmd),e},t.prototype.getCachedCmdCount=function(){return this.pendingSentCmdsQueue.length},t.prototype.getCmdDelay=function(){var e=this.pendingSentCmdsQueue[0],t=0;return null!=e&&null!=e.sendingToCollabServerMillis&&(t=Date.now()-e.sendingToCollabServerMillis),t},t.prototype.pushLocalDataCommand=function(e,t){var i=n.CustomResultCode.NO_ERROR;return e.isLocalExecutedCmd||0!==this.pendingSentCmdsQueue.length||(o.loggerInst.log("Process: sending non-local-executed first command"),i=this._sendCollabDataCommand(e,!1)),!t&&e.isLocalExecutedCmd&&0===this.pendingSentCmdsQueue.length&&(o.loggerInst.log("Process: delay sending local-executed first command"),this.sendCachedDataCommand(!0)),i===n.CustomResultCode.NO_ERROR&&(this.pendingSentCmdsQueue.push(e),!this.pendingSentCmdsQueue[0].sendingToCollabServerMillis&&(t||this.pendingSentCmdsQueue.length>1&&!e.isLocalExecutedCmd)&&(i=this.sendCachedDataCommand(!1)),o.loggerInst.log("Process: enqueue Command:(len:"+this.pendingSentCmdsQueue.length+")",e)),!0===e.isLocalExecutedCmd&&this.blockLockHandler.updateLockByDataCmd(e),i},t.prototype.sendCachedDataCommand=function(e){var t=n.CustomResultCode.NO_ERROR;return e?this.cmdSendingTimer=setTimeout(this._dispatchCachedDataCommand.bind(this),this.regularCmdSendIntervalMS):(clearTimeout(this.cmdSendingTimer),t=this._dispatchCachedDataCommand()),t},t.prototype._execCollabDataCommand=function(e){var t,n=e.collabCmdsJSON,o=e.collabProps,i={collabProperties:o};try{if(this.keyTranslator.decode(n),null==n.dataCommands)return null;if(null!=this.lastCmdId&&this.lastCmdId===o.cmdId)return null;null!=o.cmdId&&(this.lastCmdId=o.cmdId);var r=n.dataCommands[0],a=r.action,s=this.coreEditor.getDefaultNoteRange(),c=!1,u=!1,d=void 0,p=void 0,h=void 0;d=this.coreEditor.getNoteRange(),i.collabProperties.cmdJSON=r,c=this._validateCollabDataCmd(n,i),c&&(t=this._executeDataCommand(a,i)),!i.collabProperties.isOwnCmd&&"comp.DeleteNoteRange"===a&&i.range.isInSingleBlock()&&d.isInSingleBlock()&&(h=i.range.getStartBlockRange().block,p=d.getStartBlockRange().block,this.coreEditor.isTable(h)&&p.getId()===h.getId()&&(u=!0)),u&&s&&this.coreEditor.setNoteRange(s),this._postCollabDataCmdExecution(t,i)}finally{this.pendingSentCmdsQueue.length>0?this.sendCachedDataCommand(!1):this.emit(l.default.DATACMD_NO_PENDING)}return t},t.prototype._dispatchCachedDataCommand=function(){for(var e,t;this.pendingSentCmdsQueue.length>0&&(o.loggerInst.log("Process: sending cached command from queue"),e=this.pendingSentCmdsQueue[0],this.cmdMergeHandler.mergeLocalCommands(this.pendingSentCmdsQueue),(t=this._sendCollabDataCommand(e,!0))!==n.CustomResultCode.NO_ERROR)&&!e.isLocalExecutedCmd;)o.loggerInst.warn("skip failed-sent command and try next",e),this.pendingSentCmdsQueue.shift();return t},t.prototype._sendCollabDataCommand=function(e,t){var i,r,a,s=[],c={},u=null;if(t){if(e.sendingToCollabServerMillis)return o.loggerInst.warn("current cmd has been sent",e),n.CustomResultCode.NO_ERROR;if(e.isLocalExecutedCmd||e.isCollabRedo||e.isCollabUndo)o.loggerInst.log("Update-Range: NoUpdate");else{if(r=this._updateLocalCmdStartRange(e),!e.isValidStartNoteRange())return this.emit(l.default.DATACMD_FAILURE,n.DataCmdFailureCode.LOCAL_INVALID_STARTRANGE),n.DataCmdFailureCode.LOCAL_INVALID_STARTRANGE;if(r&&this.conflictHandler.isNoteRangeConflict(r,e.name,e.getCollabProps()))return o.loggerInst.log("Do NOT send Conflict Local Command"),e.getCollabProps().errorCode}}if(u=e.toCollabJSON())s[0]=u,c.dataCommands=s,o.loggerInst.log("_sendCollabDataCommand(original):",JSON.stringify(c)),this.keyTranslator.encode(c),i=JSON.stringify(c),o.loggerInst.log("_sendCollabDataCommand(compressd):",i),(a=this.wsClient.send(i))===n.CustomResultCode.NO_ERROR&&(e.sendingToCollabServerMillis=Date.now());else{a=n.DataCmdFailureCode.LOCAL_INVALID_CMDJSON;var d={closeSession:e.isLocalExecutedCmd,message:"无效的命令格式，无法协同",resultCode:a};this.emit(l.default.DATACMD_FAILURE,d)}return a===n.CustomResultCode.NO_ERROR&&e.isLocalExecutedCmd&&(o.loggerInst.log("Update-Range: set local command as last executed command"),this._setLastOwnExecutedCmd(e)),a},t.prototype._updateLocalCmdStartRange=function(e){var t;return this.lastOwnExecCmd?this.lastOwnExecCmd.isLocalExecutedCmd?o.loggerInst.log("Update-Range: last own executed command is local executed"):null!=(t=this.lastOwnExecCmd.getEndingRange())&&(e.setStartingRange(t),o.loggerInst.log("Update-Range: UpdateTo-",t.getStartBlockRange())):o.loggerInst.log("Update-Range: No last own executed command"),t},t.prototype._postCollabDataCmdExecution=function(e,t){var i,r=t.collabProperties.isLocalExecutedCmd,a=t.collabProperties.isOwnCmd;if(a&&(i=this.pendingSentCmdsQueue.shift()),t.collabProperties.dataCmdError){o.loggerInst.error(t.collabProperties.dataCmdError),e&&(e.effected||r)&&(t.collabProperties.errorToClose=!0);var s={closeSession:t.collabProperties.errorToClose,message:t.collabProperties.dataCmdError,resultCode:t.collabProperties.errorCode};return a&&this.emit(l.default.DATACMD_FAILURE,s),void(null==e&&this.coreEditor.setNoteVersion(t.collabProperties.finalNoteVersion))}if(!e)return void o.loggerInst.error("execCommand should NOT be null when no dataCmdError");if(a&&this.coreEditor.isReadyForEdit()&&(o.loggerInst.log("clear sendingToCollabServerMillis:",e,i),e.sendingToCollabServerMillis=null,i.sendingToCollabServerMillis=null,o.loggerInst.log("Process: Dequeue Command(len:"+this.pendingSentCmdsQueue.length+")")),e.setCmdFinalNoteVersion(this.coreEditor.getNoteVersion()),!a&&e.effected&&(this.redoundoHandler.pushNotOwnExecCmd(e),this.lastNotOwnExecCmd=e),a){var c={rawCollabJSON:t.collabProperties.rawWSMessage,resultCode:n.CustomResultCode.NO_ERROR};this.emit(l.default.DATACMD_SUCCESS,c),r||this._setLastOwnExecutedCmd(e)}this.blockLockHandler.updateLockByDataCmd(e)},t.prototype._setLastOwnExecutedCmd=function(e){this.lastOwnExecCmd=e},t.prototype._executeDataCommand=function(e,t){var n=t.collabProperties.cmdJSON,i=n.isCollabUndo,r=n.isCollabRedo;return o.loggerInst.log("Executing "+e),i||r?this.redoundoHandler.applyCollabRedoUndo(e,t):this.coreEditor.execCommand(e,t)},t.prototype._validateCollabDataCmd=function(e,t){var r,a=t.collabProperties,l=a.cmdJSON,s=this.coreEditor.getNoteVersion(),c=a.finalNoteVersion,u=!this.coreEditor.isReadyForEdit(),d=a.isLocalExecutedCmd,p=l.startNoteRange,h=!0;return o.loggerInst.log("Executing Validation Enter"),u?0===c?(h=!1,o.loggerInst.log("Executing Validation - ignore cmd whose finalVersion is 0")):o.loggerInst.log("Executing Validation - executing unsaved cmd"):i.Utils.isCmdVersionMatchNoteVersion(c,s)?d||(r=this.coreEditor.buildNoteRangeFromJSON(p),a.isOwnCmd||(h=!this.conflictHandler.isConflictWithOwnLockedBlock(r,l.action,t)),h&&(l.isCollabUndo||l.isCollabRedo?(h=this.redoundoHandler.ValidateCollabRedoUndo(l.affectedBlockIds,l.cmdNoteVersion))||(a.errorToClose=!0,a.errorCode=n.DataCmdFailureCode.COLLAB_DIRTY_BLOCKS,a.dataCmdError="协同：目标区域已经被修改，不能撤销或重做"):h=!this.conflictHandler.isNoteRangeConflict(r,l.action,a))):(h=!1,a.errorToClose=!0,a.errorCode=n.DataCmdFailureCode.COLLAB_NOTEVERSION_MISMATCH,a.dataCmdError="命令对应版本和本地笔记版本不匹配:("+s+"/"+c+")"),o.loggerInst.log("Executing Validation Exit"),h},t}(a.YEvent);t.DataCmdHandler=s}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.SESSION_INIT_DONE="done",e.SESSION_INIT_COLLABSTARTED="collabStarted",e.SESSION_INIT_TIMEOUT="timeout",e.SESSION_INIT_INVALID="notValidForCollab",e}();t.ConstValueInJSON=n}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(66),n(36),n(124),n(31),n(54)],void 0!==(i=function(e,t,n,o,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var n=e.call(this)||this;if(n.retryIntervalMilliSec=1e3,n.retryMaxCount=2,null==t)throw new Error("wsClient should NOT be null");return n.wsClient=t,n.callbackWSOnMessage=n._execCollabNondataCommand.bind(n),n.wsClient.on(l.default.WS_MESSAGE,n.callbackWSOnMessage),n}return r(t,e),t.prototype._queueCollabCmdJSON=function(e){var t;return t=this._sendCollabJSON(e),t&&(e.sendingToCollabServerMillis=Date.now(),e.retryRemainedCount=this.retryMaxCount,this.retriableCmdsQueue.push(e),null==this.retryCollabJSONDispatcher&&(this.retryCollabJSONDispatcher=setTimeout(this._handleCollabJSONRetry.bind(this),this.retryIntervalMilliSec))),t},t.prototype.destroy=function(){this.wsClient.off(l.default.WS_MESSAGE,this.callbackWSOnMessage),this.wsClient=null,this.removeAllListeners(null)},t.prototype.getModifiers=function(e){return this.wsClient.isOpened()?this.modifiers&&1===this.modifiers.status&&this.modifiers.endVersion===e||(this.modifiers={resultCode:n.CustomResultCode.NO_ERROR,status:0},this._requestModifiers(e)||(this.modifiers.status=2)):this.modifiers={resultCode:n.WSCustomCode.SESSION_NOT_OPENED,status:2},this.modifiers},t.prototype.sendCollabNonDataCommand=function(e,t){var o,i=!0;return o=this._buildCollabCmdJSON(e,t),e===n.CmdNames.NONDATACMD_GETMODIFIERS?this._isModifiersReqeustSent(t.endNoteVersion)||(this._clearRetryQueueByAction(e),i=this._queueCollabCmdJSON(o)):i=e===n.CmdNames.NONDATACMD_COLLABINFO||e===n.CmdNames.NONDATACMD_NOTESAVE?this._queueCollabCmdJSON(o):this._sendCollabJSON(o),i},t.prototype._execCollabNondataCommand=function(e){var t,o=e.collabCmdsJSON,i=e.collabProps,r=i.cmdSessionId;if(null!=o.nondataCmds){switch(t=o.nondataCmds[0],t.action){case n.CmdNames.NONDATACMD_BLOCKSELECTION:break;case n.CmdNames.NONDATACMD_COLLABCLOSE:var a={resultCode:n.CustomResultCode.NO_ERROR,sessionId:r};this.emit(l.default.SESSION_QUIT,a);break;case n.CmdNames.NONDATACMD_COLLABINFO:this._handleCollabInfo(t,i);break;case n.CmdNames.NONDATACMD_SESSIONINITIALIZED:var s={collabId:this.wsClient.getCollabId(),collabVersion:t.collabVersion,isReadOnly:this.wsClient.isReadOnlySession(),nickname:this.wsClient.getNickname(),result:t.initResult,resultCode:1,sessionId:this.wsClient.getSessionId(),userId:this.wsClient.getUserId()};this.emit(l.default.SESSION_INIT_DONE,s);break;case n.CmdNames.NONDATACMD_LOCKRELEASE:var c={resultCode:n.CustomResultCode.NO_ERROR,sessionId:r,unlockedBlockId:null};this.emit(l.default.LOCK_RELEASED,c);break;case n.CmdNames.NONDATACMD_SEVERPING:this._handleServerPing(t);break;case n.CmdNames.NONDATACMD_GETMODIFIERS:this._handleModifiers(t);break;case n.CmdNames.NONDATACMD_NOTESAVE:this._handleNoteSave(t);break;default:throw new Error("unknown nondata cmd:"+t.action)}this._removeFromRetryQueue(t.cmdId)}},t.prototype._requestModifiers=function(e){var t={};return t.endNoteVersion=e,this.sendCollabNonDataCommand(n.CmdNames.NONDATACMD_GETMODIFIERS,t)},t.prototype._handleCollabJSONRetry=function(){var e,t,i=this,r=!1;o.underscoreInst.each(this.retriableCmdsQueue,function(a){if(!0===r||null==i.wsClient||!1===i.wsClient.isOpened())return void(r=!0);(e=Date.now()-a.sendingToCollabServerMillis)>i.retryIntervalMilliSec&&(t=a.retryRemainedCount,t>0?(o.loggerInst.log("NonDataCmd-Resend:",a),delete a.sendingToCollabServerMillis,delete a.retryRemainedCount,i._sendCollabJSON(a),a.sendingToCollabServerMillis=Date.now(),a.retryRemainedCount=t-1):(o.loggerInst.error("NondataCmd-Send Failed after retry:",a),i.wsClient&&i.wsClient.isOpened()&&i.wsClient.close(n.WSCustomCode.FAILED_RECEIVE_COLLAB_CMD,n.WSCustomCode[n.WSCustomCode.FAILED_RECEIVE_COLLAB_CMD]),r=!0))}),r&&(this.retriableCmdsQueue=[]),this.retriableCmdsQueue.length>0?this.retryCollabJSONDispatcher=setTimeout(this._handleCollabJSONRetry.bind(this),this.retryIntervalMilliSec):(clearTimeout(this.retryCollabJSONDispatcher),this.retryCollabJSONDispatcher=null)},t.prototype._sendCollabJSON=function(e){return null!=e&&this.wsClient.send(JSON.stringify(e)),!0},t.prototype._isModifiersReqeustSent=function(e){var t,i;return o.underscoreInst.some(this.retriableCmdsQueue,function(o){return t=o.nondataCmds[0],t.action===n.CmdNames.NONDATACMD_GETMODIFIERS&&t.endVersion===e&&(i=!0,!0)}),i},t.prototype._buildCollabCmdJSON=function(e,t){var o,r=[],a={};switch(o={action:e,cmdId:i.Utils.newGUID()},r.push(o),a.nondataCmds=r,e){case n.CmdNames.NONDATACMD_BLOCKSELECTION:o.blockId=t.selectedBlockId;break;case n.CmdNames.NONDATACMD_COLLABINFO:var l={sessionId:t.sessionId};void 0!==t.nickname&&(l.nickname=t.nickname),void 0!==t.lockedBlockId&&(l.lockedBlkIds=[],l.lockedBlkIds.push(t.lockedBlockId)),void 0!==t.portraitUrl&&(l.portraitUrl=t.portraitUrl),this._buildSessionInfoJSON(o,l);break;case n.CmdNames.NONDATACMD_DATACMDFAILED:o.dataCmdError=t.dataCmdErrorCode,o.errToClose=!!t.errToClose;break;case n.CmdNames.NONDATACMD_CLINTPONG:o.versionUpdate=t.noteVersion;break;case n.CmdNames.NONDATACMD_GETMODIFIERS:o.endVersion=t.endNoteVersion;break;case n.CmdNames.NONDATACMD_NOTESAVE:o.versionUpdate=t.noteVersion,o.isHistorySave=t.isHistorySave;break;default:throw a=null,new Error("Unsupported NondataCmd:"+e)}return a},t.prototype._buildSessionInfoJSON=function(e,t){var n={sessionId:t.sessionId};null!=t.nickname&&(n.nickname=t.nickname),null!=t.portraitUrl&&(n.portraitUrl=t.portraitUrl),null!=t.lockedBlkIds&&t.lockedBlkIds.length>0&&(n.lockedBlkId=t.lockedBlkIds[0]),e.sessionProp=[],e.sessionProp.push(n)},t.prototype._handleCollabInfo=function(e,t){var n=e.sessionProp,i=[];o.underscoreInst.each(n,function(e){var n={sessionId:null};null!=e.lockedBlkId&&(n.lockedBlkIds=[e.lockedBlkId],delete e.lockedBlkId),o.underscoreInst.extend(n,e),null==n.sessionId&&(n.sessionId=t.cmdSessionId),i.push(n)}),this.emit(l.default.SESSION_CHNAGED,i)},t.prototype._handleServerPing=function(e){if(null!=e.collabNoteReady){var t={isCollabStarted:e.collabNoteReady,resultCode:n.CustomResultCode.NO_ERROR,sessionId:this.wsClient.getSessionId()};this.emit(l.default.SESSION_INIT_BUILT,t)}},t.prototype._handleModifiers=function(e){var t=this;this.modifiers.status=1,this.modifiers.startVersion=e.startVersion,this.modifiers.endVersion=e.endVersion,this.modifiers.modifiers=[],o.underscoreInst.each(e.modifiers,function(e){var n={userId:e.userId};t.modifiers.modifiers.push(n)}),this._clearRetryQueueByAction(n.CmdNames.NONDATACMD_GETMODIFIERS),this.emit(l.default.NONDATACMD_MODIFIERS_RESULT,this.modifiers)},t.prototype._clearRetryQueueByAction=function(e){var t;this.retriableCmdsQueue=o.underscoreInst.reject(this.retriableCmdsQueue,function(n){return t=n.nondataCmds[0],t.action===e&&(o.loggerInst.log("remove cmd from retryQueue by actionName:",e),!0)})||[]},t.prototype._removeFromRetryQueue=function(e){var t;this.retriableCmdsQueue=o.underscoreInst.reject(this.retriableCmdsQueue,function(n){return t=n.nondataCmds[0],t.cmdId===e&&(o.loggerInst.log("remove cmd from retryQueue:",e),!0)})||[]},t.prototype._handleNoteSave=function(e){o.loggerInst.log("SaveNotification:",e)},t}(a.YEvent);t.NonDataCmdHandler=s}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(36),n(31)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var n=e.call(this)||this;return n.coreEditor=t,n.executedNotOwnCmdQueue=[],n}return r(t,e),t.prototype.destroy=function(){this.removeAllListeners(null)},t.prototype.applyCollabRedoUndo=function(e,t){var n,o=t.collabProperties.cmdJSON,i=o.isCollabUndo,r=o.isCollabRedo;return i?(t.collabProperties.isCollabUndo=!0,t.collabProperties.isCollabRedo=!1):r&&(t.collabProperties.isCollabUndo=!1,t.collabProperties.isCollabRedo=!0),n=this.coreEditor.createDataCommand(e,t),n&&(n.isOriginalCmd=!0,this.coreEditor.applyCollabCmdRedoUndo(n)),n},t.prototype.pushNotOwnExecCmd=function(e){this.executedNotOwnCmdQueue.push(e)},t.prototype.ValidateLocalRedoUndo=function(e){var t,o=!0,i=!1;return e.isCollabUndo?t=this.lastValidUndoCmd:e.isCollabRedo&&(t=this.lastValidRedoCmd),o&&((o=!this._isConflicted(e.getAffectedBlockIds(),e.getCmdFinalNoteVersion()))||(i=!0)),o&&t&&t.cmdId===e.cmdId&&(o=!1,n.loggerInst.warn("skip duplicated redo/undo command")),o?e.isCollabRedo?(this.lastValidRedoCmd=e,this.lastValidUndoCmd=null):e.isCollabUndo&&(this.lastValidUndoCmd=e,this.lastValidRedoCmd=null):(n.loggerInst.warn("Skip invalid Redo/Undo"),i&&(n.loggerInst.warn("Drop invalid Redo/Undo"),e.isCollabRedo?this.coreEditor.dropRedoCmd():e.isCollabUndo&&this.coreEditor.dropUndoCmds(null,null,null))),o},t.prototype.ValidateCollabRedoUndo=function(e,t){return!this._isConflicted(e,t)},t.prototype._isConflicted=function(e,t){var o,i,r=this,a=!1;return i=n.underscoreInst.filter(this.executedNotOwnCmdQueue,function(e){return e.getCmdFinalNoteVersion()>t}),i=i||[],i.length>0&&n.underscoreInst.some(i,function(t){if(r._isNoteRangeOverlap(e,t.getAffectedBlockIds()))return a=!0,o=t.getCollabProps(),n.loggerInst.log("Conflict: data has been edited by "+o.ownerName),!0}),a},t.prototype._isNoteRangeOverlap=function(e,t){var o=!1;return e&&e.length>0&&t&&t.length>0&&n.underscoreInst.some(e,function(e){return n.underscoreInst.some(t,function(t){return e===t&&(o=!0),o}),o}),o},t}(o.YEvent);t.RedoUndoHandler=i}.apply(t,o))&&(e.exports=i)},function(e,t,n){(function(o){var i,r,a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();i=[n,t,n(66),n(36),n(124),n(31),n(54)],void 0!==(r=function(e,t,i,r,l,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u,d={BUILDVERSION:"buildVersion",COLLABID:"collabId",NICKNAME:"nickname",NOTEVERSION:"noteVersion",PORTRAIT:"portraitUrl",RECONNECT:"reconnect",SESSIONID:"sessionId",SESSIONTYPE:"sessionType",USERID:"userId"};!function(e){e[e.normal=0]="normal",e[e.readonly=1]="readonly",e[e.owner=2]="owner"}(u||(u={}));var p=function(e){function t(t){var i=e.call(this)||this;if("undefined"==typeof window&&void 0!==o){o.WebSocket=n(278).w3cwebsocket}return i.collabPropsHandler=t,i}return a(t,e),t.prototype.connect=function(e){var t,n=e.useWSS?"wss":"ws";if("undefined"==typeof WebSocket)throw new Error("There is NO WebSocket type in Context.");if(null==e.collabServer)throw new Error("Param of options.collabServer should not be null");if(null==e.shareKey)throw new Error("Param of options.shareKey should not be null");if(null==e.nickname)throw new Error("Param of options.nickname should not be null");if(null==e.portraitUrl)throw new Error("Param of options.portraitUrl should not be null");if(null==e.userId)throw new Error("Param of options.userId should not be null");if(null==e.sessionId)throw new Error("Param of options.sessionId should not be null");if(null==e.sessionType)throw new Error("Param of options.sessionType should not be null");if(null==e.buildVersion)throw new Error("Param of options.buildVersion should not be null");t=n+"://"+e.collabServer+"?"+d.COLLABID+"="+e.shareKey+"&"+d.NICKNAME+"="+e.nickname+"&"+d.PORTRAIT+"="+e.portraitUrl+"&"+d.USERID+"="+e.userId+"&"+d.SESSIONTYPE+"="+e.sessionType+"&"+d.SESSIONID+"="+e.sessionId+"&"+d.BUILDVERSION+"="+e.buildVersion,this.sessionOptions=e,r.loggerInst.log("Connect to",t),this.wsInst=new WebSocket(t),this.wsInst.onopen=this._onOpen.bind(this),this.wsInst.onclose=this._onClose.bind(this),this.wsInst.onmessage=this._onMessage.bind(this),this.wsInst.onerror=this._onError.bind(this)},t.prototype.getSessionId=function(){return this.sessionOptions.sessionId},t.prototype.getNickname=function(){return this.sessionOptions.nickname},t.prototype.getPortraitUrl=function(){return this.sessionOptions.portraitUrl},t.prototype.getUserId=function(){return this.sessionOptions.userId},t.prototype.getCollabId=function(){return this.sessionOptions.shareKey},t.prototype.isReadOnlySession=function(){return this.sessionOptions.sessionType===u.readonly},t.prototype.isOpened=function(){return null!=this.wsInst&&this.wsInst.readyState===this.wsInst.OPEN},t.prototype.send=function(e){var t,n=i.CustomResultCode.NO_ERROR;return t=2*e.length/1024,l.Utils.isMessageTooLarge(t)?n=i.WSCustomCode.MESSAGE_TOO_BIG:this.wsInst&&this.wsInst.readyState===WebSocket.OPEN?(r.loggerInst.log("sending message:",e),this.wsInst.send(e)):n=i.WSCustomCode.SESSION_NOT_OPENED,n},t.prototype.close=function(e,t){this.wsInst&&this.wsInst.readyState===WebSocket.OPEN&&(this.wsInst.onopen=null,this.wsInst.onclose=null,this.wsInst.onmessage=null,this.wsInst.onerror=null,this.wsInst.close(e,t),e!==i.WSCustomCode.CLOSED_BY_HOST&&this.emit(c.default.WS_CLOSED,this._assembleSessionError(e,e)))},t.prototype.sendDataCmdErrorCode=function(e){this.send(e.toString())},t.prototype._onOpen=function(e){r.loggerInst.log("Connection is opened.");var t={resultCode:i.CustomResultCode.NO_ERROR};this.emit(c.default.WS_OPENED,t)},t.prototype._onClose=function(e){r.loggerInst.log("Connection is closed."),this.emit(c.default.WS_CLOSED,this._assembleSessionError(e.code,parseInt(e.reason,10)))},t.prototype._onMessage=function(e){r.loggerInst.log("Received Message in WSClient:",e.data);try{if(null!=e.data&&""!==e.data){var t=JSON.parse(e.data),n=this.collabPropsHandler.buildCollabProperties(t);n.rawWSMessage=e.data;var o={collabCmdsJSON:t.collabCmds,collabProps:n,resultCode:i.CustomResultCode.NO_ERROR};this.emit(c.default.WS_MESSAGE,o)}}catch(e){r.loggerInst.error("Exception in WebSocketClient._onMessage:",e)}},t.prototype._onError=function(e){r.loggerInst.log("Caught Error:",e)},t.prototype._assembleSessionError=function(e,t){var n;switch(r.underscoreInst.isNaN(t)&&(t=1006===e?i.WSCustomCode.COLLAB_SERVER_UNREACHABLE:1005===e?i.WSCustomCode.COLLAB_SERVER_SHUTDOWN:1001===e?i.WSCustomCode.COLLAB_SESSION_CLOSED:e),t){case 2e3:n="连接总数超过上限";break;case 2001:n="单个文件连接总数超过上限";break;case 2002:n="重复的session链接";break;case 2003:n="所有者链接超过上限";break;case 3e3:n="转发命令失败";break;case 3001:n="添加链接失败";break;case 3003:n="命令转发进程无响应";break;case 3004:n="创建链接失败";break;case 3005:n="创建命令转发进程失败";break;case 3006:n="广播命令失败";break;case 3007:n="初始化链接失败";break;case 3008:n="未转发命令总数超上限";break;case 4001:n="等待命令返回超时";break;case 4002:n="发送命令失败";break;case 8e3:n="笔记长时间无操作";break;case 9e3:n="链接协同服务器失败";break;case 9003:n="协同服务器被强制关闭";break;case 9004:n="协同链接异常关闭，请检测session是否初始化成功";break;case 9100:n="当前编辑器版本太低";break;case 9101:n="链接被主动强制关闭";break;case 9102:n="协同命令执行失败";break;case 9103:n="重连次数超限";break;default:n="未知错误"}return{code:e,customCode:t,reason:n,resultCode:e,shareKey:this.sessionOptions.shareKey}},t}(s.YEvent);t.WebSocketClient=p}.apply(t,i))&&(e.exports=r)}).call(t,n(83))},function(e,t,n){function o(e,t){return t?new r(e,t):new r(e)}var i=function(){return this}(),r=i.WebSocket||i.MozWebSocket,a=n(279);r&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(o,e,{get:function(){return r[e]}})}),e.exports={w3cwebsocket:r?o:null,version:a}},function(e,t,n){e.exports=n(280).version},function(e,t){e.exports={_args:[["websocket@1.0.25","/home/cloudstorage/web-tools/tools/workplace/bulbeditor"]],_from:"websocket@1.0.25",_id:"websocket@1.0.25",_inBundle:!1,_integrity:"sha512-M58njvi6ZxVb5k7kpnHh2BvNKuBWiwIYvsToErBzWhvBZYwlEiLcyLrG41T1jRcrY9ettqPYEqduLI7ul54CVQ==",_location:"/websocket",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"websocket@1.0.25",name:"websocket",escapedName:"websocket",rawSpec:"1.0.25",saveSpec:null,fetchSpec:"1.0.25"},_requiredBy:["/"],_resolved:"http://npm.deploy.ml/websocket/-/websocket-1.0.25.tgz",_spec:"1.0.25",_where:"/home/cloudstorage/web-tools/tools/workplace/bulbeditor",author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},config:{verbose:!1},contributors:[{name:"Iñaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{debug:"^2.2.0",nan:"^2.3.3","typedarray-to-buffer":"^3.1.2",yaeti:"^0.0.6"},description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^1.0.0",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^2.0.4",jshint:"^2.0.0","jshint-stylish":"^2.2.1",tape:"^4.0.1"},directories:{lib:"./lib"},engines:{node:">=0.10.0"},homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",name:"websocket",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit"},version:"1.0.25"}},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(3),n(6),n(30),n(20),n(27),n(8),n(118),n(17),n(1),n(147)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h){"use strict";return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentBackground=i.DEFAULT_BACKGROUND,t}return r(t,e),t.prototype.canUndo=function(){return this.controller.canUndo()},t.prototype.canRedo=function(){return this.controller.canRedo()},t.prototype.clearHighlight=function(){this.note&&this.note.highlight([""]),this.note.clearHighlight()},t.prototype.countWords=function(e){var t=this.getNoteRange();return this.note.countWords(t,e)},t.prototype.execCommandByToolbar=function(e,t){var n,o,i=this.getNoteRange(),r=this.getTableOnCellEdit(i);r&&(n=this.noteView.getBlockViewByBlock(r))&&n.editCellFromToolbar&&(o=n.editCellFromToolbar(e,t)),o||("undo"===e?this.undo():"redo"===e?this.redo():this.execCommand(e,t))},t.prototype.execCommand=function(e,t){return this.controller.execCommand(e,t)},t.prototype.focus=function(){this.noteView.$el.focus()},t.prototype.getController=function(){return this.controller},t.prototype.getHtmlContent=function(e,t,n){var o;if(null!=this.getHtmlContentTimer&&(clearTimeout(this.getHtmlContentTimer),this.getHtmlContentTimer=null),!this.contentLoading||null==t)return o=this.note.toHtml(null,!0===e),null!=t&&t({status:1,content:o}),o;n&&(this.isReadOnly()||this.makeReadOnly(!0),this.noteView.removeNote()),this.getHtmlContentTimer=setTimeout(this.getHtmlContent.bind(this,e,t,n),100)},t.prototype.getNoteRange=function(){return this.controller.getNoteRange()},t.prototype.getPlainContent=function(){return this.note.toPlain()},t.prototype.getSchemaVersion=function(){return this.note.getSchemaVersion()},t.prototype.getXmlContent=function(e,t){var n;if(null!=this.getXmlContentTimer&&(clearTimeout(this.getXmlContentTimer),this.getXmlContentTimer=null),!this.contentLoading||null==e)return n=this.note.toXml(),null!=e&&e({status:1,content:n}),n;t&&(this.isReadOnly()||this.makeReadOnly(!0),this.noteView.removeNote()),this.getXmlContentTimer=setTimeout(this.getXmlContent.bind(this,e,t),100)},t.prototype.hasHandWriteBlock=function(){return this.note.hasHandWriteBlock()},t.prototype.highlight=function(e,t){this.note&&this.note.highlight(e,t)},t.prototype.insertImage=function(e){return this.controller.insertImage(e)},t.prototype.insertAttachment=function(e){return this.controller.insertAttachment(e)},t.prototype.isNotSetContent=function(){return this.notSetContent},t.prototype.isReadOnly=function(){return this.controller.isReadOnly()},t.prototype.nextHighlight=function(){this.note&&this.note.nextHighlight()},t.prototype.preHighlight=function(){this.note&&this.note.preHighlight()},t.prototype.getNoteContentStatus=function(){return!!this.note&&this.note.getContentStatus()},t.prototype.querySelectionInlineStyle=function(e){return this.controller.querySelectionInlineStyle(e)},t.prototype.querySelectionBlockStyle=function(e){return this.controller.querySelectionBlockStyle(e)},t.prototype.querySelectionInlineStyles=function(){return this.controller.querySelectionInlineStyles()},t.prototype.querySelectionBlockStyles=function(){return this.controller.querySelectionBlockStyles()},t.prototype.redo=function(){return this.controller.redo()},t.prototype.render=function(){null!=this.noteProps&&(this.noteProps.sessionType?(this.noteProps.sessionType=parseInt(this.noteProps.sessionType,10),1===this.noteProps.sessionType?this.setReadOnly(!0):this.setReadOnly(!1)):this.noteProps.readOnly?this.setReadOnly(!0):this.setReadOnly(!1))},t.prototype.rerenderNoteView=function(){this.noteView.render()},t.prototype.resetEditingInlineStates=function(){return this.controller.resetEditingInlineStates()},t.prototype.setEditingInlineStyles=function(e){return this.controller.setEditingInlineStyles(e)},t.prototype.reset=function(){var e=this.getNoteViewWrapper();this.controller&&this.controller.reset(),this.noteView&&this.noteView.reset(),this.note&&this.note.reset(),h.reset(),this.notSetContent=!0,e&&this.noteView.isInPageMode()&&e.find(".page-break").remove(),null!=this.getHtmlContentTimer&&(clearTimeout(this.getHtmlContentTimer),this.getHtmlContentTimer=null),null!=this.getXmlContentTimer&&(clearTimeout(this.getXmlContentTimer),this.getXmlContentTimer=null),this.contentChanged=!1,this.contentLoading=!1,this.currentBackground=i.DEFAULT_BACKGROUND},t.prototype.resetFont=function(){a.resetCssRules(),l.reset(),this.noteView.reRenderTextBlockView()},t.prototype.selectAll=function(){return this.controller.selectAll()},t.prototype.setAllBackgrounds=function(e,t){this.trigger("set-all-backgrounds",n.clone(e),t),this.currentBackground=i.DEFAULT_BACKGROUND},t.prototype.setBackground=function(e){var t=this.currentBackground;this.updateContainerBackground(e)&&this.trigger("set-background",t,e)},t.prototype.setFont=function(e,t){if(e||t){var n,o={};e&&(n=l.getDefault("font-size"),o["font-size"]=function(t){var o=t["font-size"];if(null!=o)return Math.round(e*o/n)+"px"},a.setCssRules(o)),t&&(l.setDefault("font-family",t),a.resetInlineStyleDefaultForHtml("font-family")),this.noteView.reRenderTextBlockView()}},t.prototype.setNoteRange=function(e){this.controller.noteSelection.setRange(e)},t.prototype.setPasteAsText=function(e){this.controller.setPasteAsText(e)},t.prototype.setReadOnly=function(e){e=!!e,this.noteProps.isReadOnly=e,this.makeReadOnly(e)},t.prototype.setViewMode=function(e,t,n){e=c.IS_PC?u.parseToNumber(e,1):u.parseToNumber(e,0),this.updateEditorProps({viewMode:e}),c.IS_PC&&(1===e?$(this.getNoteViewWrapper()).toggleClass("read-mode",!0):$(this.getNoteViewWrapper()).toggleClass("read-mode",!1)),this.noteView.setViewMode(e,!this.isNotSetContent()),!0===t&&this.trigger("view-mode-change",e),!0===n&&this.trigger("yne-view-mode-change",e),this.controller.resizeSpecialBlock()},t.prototype.undo=function(){return this.controller.undo()},t.prototype.updateBackground=function(e){var t=this.currentBackground;this.updateContainerBackground(e)&&(t||(t=i.DEFAULT_BACKGROUND),this.trigger("yne-background-changed",t,e))},t.prototype.updateEditorProps=function(e){null==this.editorProps&&(this.editorProps={}),n.extend(this.editorProps,e),n.extend(this.options,e)},t.prototype.updateNoteViewVisibility=function(e){e?this.noteView.$el.css("visibility","visible"):this.noteView.$el.css("visibility","hidden")},t.prototype.initialize=function(e){var t=this;this.clientId=o.newGUID(),this.notSetContent=!0,this.bindEventsForController(),this.on("background-failed-update",function(e,n){null!=n&&t.updateContainerBackground(n),0===e&&t.trigger("yne-background-failed-update",e)}),this.contentChanged=!1,this.contentLoading=!1},t.prototype.makeReadOnly=function(e){this.controller.setReadOnly(e),c.IS_PC?e?this.toolbar.toggleToolbar(!1):this.toolbar.toggleToolbar(!0):e?this.toolbar.disable():this.toolbar.enable()},t.prototype.bindEventsForController=function(){var e=this,t=this.controller;t.on("command-exec",function(t,n){if(!t||!t.name)return void p.error("The command is not valid",t);t&&t.effected?(e.contentChanged=!0,e.trigger("yne-content-change")):p.warn("The command has no effected",t)}),s.bubble(["redo-stack-change","undo-stack-change","selectstart","mouse-down","command-exec","esc","yne-clipboard-status","yne-clipboard-error","yne-get-clipboard","yne-clipboard-set","color-picker-show","yne-user-action-collection","cell-edit-view-enter","cell-edit-view-exit","cell-edit-view-history-change"],t,this)},t.prototype.updateContentSetProgress=function(e){var t=this;!0===t.contentLoading&&(e.isAsync&&t.progressTracker.updateContentSetProgress(e),n.isNumber(e.percent)&&e.percent>=1&&(t.isLegacyHost()&&!t.noteProps.isReadOnly&&t.makeReadOnly(!1),t.contentLoading=!1))},t.prototype.getTableOnCellEdit=function(e){var t,n=e&&e.isSingleTableSelected();if(n)return t=e.getStartBlockRange(),t&&t.isOnCellEdit&&t.isOnCellEdit()?t.block:void 0},t}(d)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(38),n(3),n(34),n(37),n(283),n(27),n(8),n(17),n(1),n(109),n(284),n(327),n(6),n(2),n(19),n(10),n(71),n(20),n(91),n(5),n(26),n(14),n(328),n(161),n(162),n(163),n(330)],void 0!==(i=function(e,t,n,o,i,a,l,s,c,u,d,p,h,g,f,m,_,y,v,b,k,C,S,I,w,E,T,N,A){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.addDragHint=function(e,t){var n,o,i=this,r=i.getRangeByPoint(e,t),a=i.noteView,l=a.parseNativeRange(r)[0];return i.getNoteRange()?(n=i.getNoteRange().getStartBlockRange())&&l?!(l.block===n.block&&l.start>=n.start&&l.start<n.end)&&(i.lastDragOver?o=i.lastDragSpace.parentNode.removeChild(i.lastDragSpace):(o=document.createElement("span"),o.id="drop-hint",i.lastDragOver={}),i.lastDragOver.x=e,i.lastDragOver.y=t,i.lastDragSpace=o,void r.insertNode(o)):(p.error("addDragHint:startRange and dragRange should not be null",n,l),!1):(p.error("addDragHint:Failed to get NoteRange"),!1)},t.prototype.canRemoveFormat=function(){var e=this,t=e.getNoteRange();return t&&!t.isCollapsed()},t.prototype.canUndo=function(){return this.cmdManager.canUndo()},t.prototype.canRedo=function(){return this.cmdManager.canRedo()},t.prototype.createCmd=function(e,t){return this._createCmd(e,t)},t.prototype.defaultNoteRange=function(){var e,t,n=this,o=n.note;if(o&&(e=o.getBlockAt(0)))return t=I.createRangeByBlock({allContent:!1,block:e,collapseToStart:!0}),new w({endRange:t,startRange:t})},t.prototype.execBackTab=function(){var e=this;e.execCommand("comp.KeyTab",{inlineStyles:e.editingInlineStates,withShiftKey:!0})},t.prototype.execCommand=function(e,t){p.log("execCommand",e,t);var o,r,a=this;return t=n.defaults(t||{},{collabProperties:a.editor.buildCollabProperties()}),r=t.collabProperties.isCollabCmd,a.isReadOnly()&&!r?void a.editor.notifyErrorToHost(m.INVALIDACTION_EDIT_READ_ONLY):(t.isOriginalCmd=!0,!(o=a._createCmd(e,t))||o.cmdError?void p.error("Failed to create/initialize command:"+e):i.isInlineStateSetCommand(o)?void n.each(t.inlineStyles,function(e,t){a.setEditingInlineState(t,e)}):a.isCollabEnabled()?(o.isOriginalCmd=!0,r?a._executeCollabCmd(o,t):a._handleLocalCmdInCollabMode(o,t),t.collabProperties.dataCmdError&&p.error(t.collabProperties.dataCmdError),o):a._executeLocalCmd(o,t))},t.prototype.execCmdByShortCut=function(e,t){this.editor.execCommandByToolbar(e,t)},t.prototype.execDeleteBackward=function(e){var t,n,o=this;if(e=e||o.getNoteRange(),t=e.getStartBlockRange(),n=t.block,!e)return void p.error("noteRange not found");_.isHeading(n)&&e.isCollapsed()&&t.isCollapsed()&&0===t.start?o.resetEditingInlineStates():n.isEmpty()||o._updateDeleteInlineStates(o.queryBackwardFirstInlineStyles(e)),o.execCommand("comp.KeyBackspace",{inlineStyles:o.editingInlineStates})},t.prototype.execDeleteForward=function(){var e=this,t=e.getNoteRange();if(!t)return void p.error("noteRange not found");e._updateDeleteInlineStates(e.queryForwardFirstInlineStyles(t)),e.execCommand("comp.KeyDelete")},t.prototype.execDeleteToEnd=function(){var e,t,n=this,o=n.getNoteRange();if(o){if(!o.isCollapsed())return n._onDeleteSelection();e=o.clone(!0),t=o.getEndBlockRange(),t.expandToEnd(),n.execDeleteBackward(e)}},t.prototype.execInsertDate=function(){var e,t=this,n=new Date,i=function(e){return o.pad(e,2,"0","left")};e=" "+n.getFullYear()+"/"+i(n.getMonth()+1)+"/"+i(n.getDate())+" "+i(n.getHours())+":"+i(n.getMinutes())+" ",t.insertText(e,!1)},t.prototype.execKeyHandler=function(e){var t=this;t.keyHandlerManager.execWithName(e,t,{})},t.prototype.getDefaultFont=function(){return this.defaultFont},t.prototype.getEditingInlineState=function(e){var t=this,n=t.editingInlineStates||{};return e?n[e]:n},t.prototype.getNextCaretBlockRange=function(){var e,t,n,o=this,i=o.getNoteRange(),r=i.getStartBlockRange(),a=r.block;return _.isTextOrTableBlock(a)||(e=o._getNextCaretBlock(a))&&(t=I.createRangeByBlock({allContent:!1,block:e,collapseToStart:!0}),n=new w({endRange:t,startRange:t}),o.noteSelection.setRange(n)),n},t.prototype.getNoteRange=function(){var e=this,t=e.noteSelection.getRange();return t||(t=e.defaultNoteRange()),t},t.prototype.getRangeByPoint=function(e,t){var n,o;return n=document.caretRangeFromPoint(e,t),o=document.createRange(),o.setStart(n.startContainer,n.startOffset),o},t.prototype.hasKeyHandler=function(e){return this.keyHandlerManager.hasHandler(e)},t.prototype.innerGoto=function(e){var t,n;if(t=document.getElementById(e),this.pageViewManager&&!t&&(this.pageViewManager.activePageByBlockId(e),t=document.getElementById(e)),!t)return p.warn("No find the block!");window.location.hash="#"+e,n=document.createRange(),n.setStart(t.lastChild,1),n.setEnd(t.lastChild,1),l.setRange(n,window),window.location.hash=""},t.prototype.insertAttachment=function(e){var t,n=this,o=n.getNoteRange();if(!e||!e.src)return p.log("Error: attachment data is invald! "+e);switch(t=e.resource&&e.fileName?"attachment":"image",n.noteSelection.setRange(o),t){case"attachment":n.execCommand("comp.InsertAttachment",{fileLength:e.fileLength,fileName:e.fileName,resource:e.resource,src:e.src});break;case"image":n.insertImage(e.src)}},t.prototype.insertImage=function(e){var t=this,n=t.getNoteRange();e&&(t.noteSelection.setRange(n),t.execCommand("comp.InsertImage",{src:e}))},t.prototype.insertText=function(e,t){var o,i,r=this,a=k.getAllDefault();p.log("===> insertText...",e),e instanceof v?o=e:(i=r.editingInlineStates,o=new v({text:e}),n.isEqual(a,i)||o.setStyles(0,o.getLength(),i)),r.execCommand("comp.KeyTextInput",{recogLink:t,text:o})},t.prototype.isCollabEnabled=function(){return null!=this.editor&&this.editor.isCollabEnabled&&this.editor.isCollabEnabled()},t.prototype.isReadOnly=function(){return this.readOnly},t.prototype.isSameList=function(e){var t=this,n=t.note,o=t.getNoteRange();return!!o&&n.isSameList(o,e)},t.prototype.isValidNoteRange=function(e){var t=this,n=function(e){var n;return!(!e||!e.block)&&(n=e.block,t.note.getBlockIndex(n)>-1)};return!!e&&(t.isValidHeaderFooterRange(e)||n(e.getStartBlockRange())&&n(e.getEndBlockRange()))},t.prototype.isValidHeaderFooterRange=function(e){var t=this.note,o=e.getStartBlockRange(),i=e.getEndBlockRange();return n.all([o,i],function(e){if(!e||!e.block)return!1;var n=e.block;return t.getHeaderFooter(!0)===n||t.getHeaderFooter(!1)===n})},t.prototype.moveCaretWithDirection=function(e,t){this._onMoveCaretWithDirection(e,t)},t.prototype.lockBlockById=function(e){this.isCollabEnabled()&&this._sendBlockLockInfo(e)},t.prototype.onCommand=function(e,t){this.execCommand(e,t)},t.prototype.onUpdateSelection=function(e,t){this.noteSelection.setRange(e,T.createCommandTypeEvent(t))},t.prototype.onPaste=function(e){var t,n,o,i,r,a,l,s=this;if(e.preventDefault(),u.IS_MAC)return void s._pasteForMac();if(t=new N({event:e}),s.isPasteAsText)return l=t.getData("text/plain"),void s._pastePlain(l,s.isPasteAsText);if(n=t.getData("text/yne-json"),o=t.getData("text/yne-image-json"),r=t.getData("text/yne-note-id"),!(n&&s._pasteJSON(n,o,r)||(i=t.getData("text/yne-table-json"))&&s.pasteYTableJson(i))){if((a=t.getData("text/html"))&&s._pasteHTML(a))return void p.log("paste html ok");if(l=t.getData("text/plain"))return void s._pastePlain(l,s.isPasteAsText);s._pasteBlobImg(e)}},t.prototype.pasteForTable=function(e){var t,n=this.getNoteRange(),o=n.getStartBlockRange(),i=n.getEndBlockRange(),r=o.block,a=i.block,l=this.noteView;return!(!_.isTable(r)||r.getId()!==a.getId())&&(!(!(t=l.getBlockViewByBlock(r))||!t.pasteBlockList)&&t.pasteBlockList(e))},t.prototype.queryBackwardFirstInlineStyles=function(e){var t,n,o,i,r;return(e=e||this.getNoteRange())?(t=e.getStartBlockRange(),n=t.block,_.isTextBlock(n)?n.isEmptyContent()?n.getInlineStylesForEmpty()||this.editingInlineStates:(i=t.start,r=n.getLength(),(e.isCollapsed()||i>=r)&&(i=i>0?i-1:0),o=n.getTextStylesAtIndex(i),this._omitLinkStylesIfNeeded(o,e)):void 0):void p.warn("noteRange is null")},t.prototype.queryForwardFirstInlineStyles=function(e){var t,n,o,i,r;return(e=e||this.getNoteRange())?(t=e.getEndBlockRange(),n=t.block,_.isTextBlock(n)?n.isEmptyContent()?n.getInlineStylesForEmpty()||k.getAllDefault():(i=t.end,r=n.getLength(),(!e.isCollapsed()||i>=r)&&(i=i>0?i-1:0),o=n.getTextStylesAtIndex(i),this._omitLinkStylesIfNeeded(o,e)):void 0):void p.error("noteRange is null")},t.prototype.querySelectionInlineStyle=function(e,t){var n=this,o=n.note;return t=t||n.getNoteRange(),t?o.getCommonInlineStyle(t,e):void p.warn("noteRange not found")},t.prototype.querySelectionBlockStyle=function(e,t){var n=this,o=n.note;return t=t||n.getNoteRange(),t?o.getRangeBlockStyle(t,e):void p.warn("noteRange not found")},t.prototype.querySelectionInlineStyles=function(e){var t,o,i,r,a=this,l={},s=k.getStyleNames();return(e=e||a.getNoteRange())?(t=e.getStartBlockRange(),e.isSingleTableSelected()&&t.isOnCellEdit()&&(o=t.block,i=a.noteView.getBlockViewByBlock(o))?(r=i.getCellEditView(),l=r.queryInlineStylesForBulb()):(n.each(s,function(t){l[t]=a.querySelectionInlineStyle(t,e)}),l)):void p.warn("noteRange not found")},t.prototype.querySelectionBlockStyles=function(e){var t,o,i=this,r={};return(e=e||i.getNoteRange())?(t=b.getAllStyleNames(),o=C.getAllStyleNames(),t=t.concat(o),n.each(t,function(t){r[t]=i.querySelectionBlockStyle(t,e)}),r):void p.warn("noteRange not found")},t.prototype.redo=function(){var e=this,t=e.cmdManager;if(!e.isCollabEnabled())return t.redo();var n={collabProperties:{coreEditor:e.editor,isCollabRedo:!0}};return this._redoUndoLocalCmdInCollabMode(n)},t.prototype.removeDragHint=function(){var e;this.lastDragSpace&&this.lastDragSpace.parentNode&&(e=this.lastDragSpace.parentNode,e.removeChild(this.lastDragSpace)),this.lastDragOver=this.lastDragSpace=null},t.prototype.removeShortCut=function(e){var t=this.keyHandlerManager;t&&t.unbind(e)},t.prototype.reset=function(){var e=this;e.cmdManager&&e.cmdManager.reset(),e.noteSelection&&e.noteSelection.reset(),e.resetEditingInlineStates(),e.defaultFont=null,e.readOnly=!1},t.prototype.resetEditingInlineStates=function(){var e=this,t=k.getAllDefault();e.setEditingInlineStates(null),e.trigger("yne-editing-state-change",t)},t.prototype.setEditingInlineStyles=function(e){var t=this;t.setEditingInlineStates(e),e||(e=k.getAllDefault()),t.trigger("yne-editing-state-change",e)},t.prototype.resizeSpecialBlock=function(){var e=this,t=e.note;n.each(t.blocks,function(e){(_.isTable(e)||_.isImage(e))&&e.trigger("view-resize")})},t.prototype.selectAll=function(){return this.noteView.onSelectAll()},t.prototype.setDefaultFont=function(e,t){this.defaultFont=this.defaultFont||{},e&&(this.defaultFont["font-family"]=e,this.setEditingInlineState("font-family",e)),t&&(this.defaultFont["font-size"]=t,this.setEditingInlineState("font-size",t))},t.prototype.setEditingInlineState=function(e,t){var n=this,o={};n.isReadOnly()||(n.editingInlineStates||(n.editingInlineStates={}),n.editingInlineStates[e]=t,o[e]=t,n.trigger("yne-editing-state-change",o),n.isLinkStylesChanged=n._isLinkStyles(e))},t.prototype.setEditingInlineStates=function(e){var t=this;t.editingInlineStates=e,t.isLinkStylesChanged=!1},t.prototype.setOptions=function(e){var t,n=this;n.reset(),n.readOnly=e.isReadOnly,t=n.note=e.note,c.bubble(["color-picker-show","yne-user-action-collection"],t,n,!0),c.addListeners({"get-block-view":"_onGetBlockView","get-default-set-font":"_onGetDefaultSetFont"},t,n,!0)},t.prototype.setPasteAsText=function(e){this.isPasteAsText=e},t.prototype.setReadOnly=function(e){var t=this;e=!!e,t.isReadOnly()!==e&&(t.readOnly=e,n.each(["note"],function(n){var o=t[n];o&&o.setReadOnly&&o.setReadOnly(e)}))},t.prototype.toggleInlineStyle=function(e){var t,n=this,o=n.getNoteRange(),i={};if(!o)return void p.warn("noteRange not found");o.isCollapsed()?t=!n.editingInlineStates[e]:(t=n.querySelectionInlineStyle(e),t=!0!==t),i[e]=t,n.execCommand("comp.ApplyStyles",{inlineStyles:i})},t.prototype.undo=function(){var e=this,t=e.cmdManager;if(!e.isCollabEnabled())return t.undo();var n={collabProperties:{coreEditor:e.editor,isCollabUndo:!0}};return this._redoUndoLocalCmdInCollabMode(n)},t.prototype.updateShortCut=function(e,t){var n=this.keyHandlerManager;n&&n.updateKey(e,t)},t.prototype.zoomInEditor=function(){this.editor.setZoomPercent(1)},t.prototype.zoomOutEditor=function(){this.editor.setZoomPercent(-1)},t.prototype.zoomEditor=function(){this.editor.zoomEditor(1,!0)},t.prototype.getRangeData=function(e){var t=this,n=t.note,o={"text/yne-json":e.getDataAsJSON(n),"text/html":'<meta charset="utf-8">'+e.getDataAsHtml(n),"text/plain":e.getDataAsPlain(n),"text/yne-note-id":n.getNoteId()},i=t._getImgDomInRange(e);return o["text/yne-image-json"]=t._getImageDataAsJson(i),t._addYneTableData(n,e,o),o},t.prototype.initialize=function(e){var t=this,n=e.noteView;t.cmdManager=new f(e),t.cmdFactory=new g(e),t.removeLocalImg=e.removeLocalImg||!1,t.setOptions(e),t.noteView=n,t.noteSelection=new E({noteView:t.noteView}),t._initKeyHandlerManager(e.keyHandlerNames),t.editor=e.editor,t.imgTitleInput=e.imgTitleInput,t._bindEvents()},t.prototype.pasteYTableJson=function(e){var t=this;if(n.isString(e))try{e=JSON.parse(e)}catch(e){return void p.error("parse ytable json  string error")}return t._pasteJSON([{blockType:_.TABLE,data:e}])},t.prototype._addYneTableData=function(e,t,n){if(t.isSingleTableSelected()){var o=t.getStartBlockRange(),i=o.getDataAsJSON(!0);i&&(n["text/yne-table-json"]=JSON.stringify(i))}},t.prototype._bindEvents=function(){var e=this,t=e.cmdManager,n=e.noteView;c.addListeners({"update-selection":"onUpdateSelection","command-exec":"_onCommandExec"},t,e),c.bubble(["redo-stack-change","undo-stack-change"],t,e),c.addListeners({"selection-change":"_onSelectionChange"},e.noteSelection,e),c.bubble({contextmenu:!0,selectstart:!0,"mouse-down":!0,"yne-replace-image":!0,"yne-replace-attachment":!0,"yne-download-image":!0,"yne-preview-image":!0,"yne-download-attachment":!0,"yne-open-image":!0,"yne-open-attachment":!0,"yne-on-paste":!0,"yne-blob-paste":!0,"open-link":"yne-open-link","cell-edit-view-exit":!0,"cell-edit-view-history-change":!0,"yne-image-ocr":!0},n,e),c.bubble(["link-menu-hide","locked-change"],n,e.editor.linkView),c.addListeners({"delete-selection":"_onDeleteSelection","text-input":"_onTextInput","key-pressed":"_onKey",command:"onCommand",copy:"_onCopy",cut:"_onCut",paste:"onPaste",dragstart:"_onDragStart",dragover:"_onDragOver",drop:"_onDrop",dragend:"_onDragEnd","note-append-blankparagraph":"_onAppendBlankParagraph",onCompositionStart:"_onCompositionStart","inner-goto":"innerGoto","header-footer-view-text-change":"_onHeaderFooterViewTextChange","backup-drag-range":"_onBackupDragRange","get-note-range":"_onGetNoteRange","move-caret":"_onMoveCaretWithDirection","global-redo":"redo","global-undo":"undo","cell-edit-view-enter":"_onEnterTableEdit","cell-edit-view-selection-change":"_onCellEditViewSelectionChange","cell-edit-view-command-executed":"_onCellEditViewSelectionChange","save-content":"_onSaveContent"},n,e),n.on("get-editing-styles",function(t){t(e.editingInlineStates)}),e.editor&&e.editor.onDocSelectionChange&&e.noteSelection.on("doc-change-selection",e.editor.onDocSelectionChange,e.editor),n.on("yne-click",function(){e.editor.recoverFromIdleTimeout(),e.trigger("yne-click")}),n.on("link-menu-show",function(t){e.editor.linkView.trigger("link-menu-show",t)}),n.on("get-image-items",e._getImgItems),e.imgTitleInput&&c.bubble(["img-title-edit-start","img-title-edit-end","img-title-edit-focus","img-title-edit-exit","img-title-edit-update","locked-change"],n,e.imgTitleInput)},t.prototype._createCmd=function(e,t){var n=this,o=n.cmdFactory;return t.range||i.isCollabCommand(t)||(t.range=n.getNoteRange()||w.createMock()),o.create(e,n.note,t)},t.prototype._executeCollabCmd=function(e,t){var n,o=this,i=o.getNoteRange();!1===(n=o.cmdManager.exec(e,i,t))&&t.collabProperties.isOwnCmd&&o.editor.notifyErrorToHost(m.INVALIDACTION_FAILED_COLLABCMD)},t.prototype._executeLocalCmd=function(e,t){var n,o=this;if(!e||!1!==e.isReadyToApply)return n=o.getNoteRange(),o.cmdManager.exec(e,n,t)},t.prototype._getImgDomInRange=function(e){var t,o,i,r,a=this,l=a.note,s=a.noteView,c=e.getStartBlockRange(),u=e.getEndBlockRange(),d=l.getBlockIndex(c.block),p=l.getBlockIndex(u.block),h={};for(t=d;t<=p;t++)o=null,i=l.getBlockAt(t),_.isImage(i)&&(r=s.blockViews[t].getImgElement(),h[i.getId()]={img:r,source:i.getSource()}),_.isTable(i)&&(t===d&&(o=c),t===p&&(o=u),n.extend(h,s.blockViews[t].getImageDomMapByTableRange({selectAll:!o,tableRange:o})));return h},t.prototype._getImageDataAsJson=function(e){var t=s.getBase64Data(e);return JSON.stringify(t)},t.prototype._getNextCaretBlock=function(e){for(var t=this.note.getNextBlock(e);t&&(!this._isCaretBlock(t)||t.isLocked());)t=this.note.getNextBlock(t);return t},t.prototype._getImgItems=function(e){var t=this,o=t.note.blocks,i=[],r=0;n.each(o,function(t){if(t&&_.isImage(t)){var n=t.getSource().replace(location.protocol+"//"+location.hostname,"");e===t&&(r=i.length),i.push({index:i.length,name:t.getTitle(),preSrc:n,src:n})}}),t.trigger("yne-preview-image",[r,i])},t.prototype._getPreCaretBlock=function(e){for(var t=this.note.getPreBlock(e);t&&(!this._isCaretBlock(t)||t.isLocked());)t=this.note.getPreBlock(t);return t},t.prototype._getUploadData=function(e,t,o){var i,r=0,a=[],l={},c={};if(!(n.isEmpty(e)||n.isEmpty(t)&&n.isEmpty(o)))return i=s.setBlockIds(o,e),n.each(e,function(e,t){e.base64&&(a.push({id:r,url:t,blob:s.base64ToBlob(e.base64),isGroup:u.isFromWebGroup(t)}),l[r]=e.imgBlockIds,r++)}),n.each(t,function(e){var t=e.getSource(),o=e.getResource(),i=t+"_"+o,s=e.getId();n.isUndefined(c[i])?(c[i]=r,l[r]=[s],a.push({id:r,source:t,resource:e.getResource(),isGroup:u.isFromWebGroup(t)}),r++):l[c[i]].push(s)}),{data:a,map:l,replaceImgList:i}},t.prototype._handleLocalCmdInCollabMode=function(e,t){var n,o,i,r=this,a=!0,l=!0;if(n=r.getNoteRange(),e.setCmdOriginalNoteVersion(r.note.getFileVersion()),!r.editor.isValidLocalDataCmd(e))return void p.warn("skip invalid local command");o=r.noteView.isOnComposition&&"comp.KeyBackspace"===e.name,i=e.isSingleBlockAffected()&&r.editor.isMyOwnLockedBlock(t.range)&&r.editor.isLastOwnDataCmdExecuted(),o||i?(a=r.cmdManager.exec(e,n,t),!1===a?(l=!1,r.editor.notifyErrorToHost(m.INVALIDACTION_FAILED_LOCALCMD)):e.effected?e.isLocalExecutedCmd=!0:l=!1):e.isLocalExecutedCmd=!1,l?r.editor.pushLocalDataCommand(e,o):p.warn("NotReadyToSend:",e)},t.prototype._initKeyHandlerManager=function(e){var t=this,o=t.keyHandlerManager=new S({});o.on("bind-key",function(e){var n=t.noteView;n&&n.bindKey(e)}),o.on("unbind-key",function(e){var n=t.noteView;n&&n.unbindKey(e)}),e=e||o.getAvailableHandlerNames(),n.each(e,function(e){o.bind(e)})},t.prototype._isCaretBlock=function(e){return _.isTextBlock(e)||_.isImage(e)||_.isAttachment(e)||_.isTable(e)},t.prototype._isLinkStyles=function(e){return n.contains(["color","underline"],e)},t.prototype._isPartlyOverlapWithAnchor=function(e){var t,n,o,i,r,a,l;return!(!e||!e.isInSingleBlock())&&(t=e.getStartBlockRange(),(n=t.block)instanceof y&&(o=t.start,i=t.end,o===i?(o>0&&(a=n.getTextStyle("href",o-1,o)[0]),o<n.getLength()&&(l=n.getTextStyle("href",o,o+1)[0]),(a||l)&&a!==l):(r=n.getCommonInlineStyle("href",{end:i,start:o}))&&r===m.INTERM))},t.prototype._onMoveCaretWithDirection=function(e,t){var n,o,i,r,a,l,s,c=this;return(n=c.getNoteRange())?n.canDrawedByNative()?void p.log("The noteRange can be drawed by native selection!"):(i=n.getStartBlockRange(),o=i.block,void((_.isImage(o)||_.isAttachment(o)||_.isTable(o)||_.isHr(o)||_.isUnknown(o)||_.isHandWrite(o))&&(e?(r=c._getNextCaretBlock(o),a=!0):(r=c._getPreCaretBlock(o),a=!1),r?(l=I.createRangeByBlock({allContent:!1,block:r,collapseToStart:a}),s=new w({endRange:l,startRange:l}),c.noteSelection.setRange(s),t&&t.preventDefault()):e&&c.noteView.focusLastBlankLine()))):void p.log("The noteRange is null!")},t.prototype._notifyEditingStatesChange=function(){var e,t,o,i=this,r=i.getNoteRange(),a=i.editingInlineStates||{},l=!1;!i.isReadOnly()&&r&&(e=r.getStartBlockRange(),r.isInSingleBlock()&&_.isTextBlock(e.block)&&e.block.getLength()<e.start&&(l=!0),(l||a&&r.isCollapsed())&&(!r.isSingleTableSelected()||e.getAsRectRange())||(a=i.querySelectionInlineStyles(r)||{}),o=n.clone(a),t=r.clone(!0),t.collapse(!0),n.each(["font-family","font-size"],function(e){var n;a[e]===m.INTERM&&(n=i.querySelectionInlineStyle(e,t),a[e]=n)}),a.heading=null,i.trigger("yne-editing-state-change",a,o))},t.prototype._onAppendBlankParagraph=function(){this.execCommand("comp.AppendBlank",{inlineStyles:this.editingInlineStates})},t.prototype._onCellEditViewSelectionChange=function(){var e,t,n=this,o=n.getNoteRange(),i=o.getStartBlockRange(),r=i.block,a=n.noteView.getBlockViewByBlock(r);a&&(e=a.getCellEditView(),t=e.queryInlineStylesForBulb(),n.trigger("yne-editing-state-change",t))},t.prototype._onCommandExec=function(e,t){this.trigger("command-exec",e,t)},t.prototype._onCompositionStart=function(e){var t,o,i=this,r=i.getNoteRange(),a=[],l=!1;if(!r)return void p.error("_onCompositionStart:noteRange should not be null");if(i.isCollabEnabled()){if(o=i.note.getInterBlocks(r.getStartBlockRange().block,r.getEndBlockRange().block,!0),n.each(o,function(e){var t=i.noteView.getBlockViewByBlock(e);a.push(t),t.isCollabLocked()&&(l=!0)}),e(l,a),l)return;t=r.getStartBlockRange(),t&&r.isInSingleBlock()&&_.isTextBlock(t.block)&&!i.editor.isMyOwnLockedBlock(t)&&(i.editor.sendCachedDataCommand(),i._sendBlockLockInfo(t.block.getId()))}},t.prototype._omitLinkStylesIfNeeded=function(e,t){return e&&e.href&&this._isPartlyOverlapWithAnchor(t)&&(e.href=void 0,this.isLinkStylesChanged||(e.color="#393939",e.underline=!1)),e},t.prototype._onCut=function(e){var t=this,n=t.getNoteRange();e.preventDefault(),p.log("on cut!"),t._setClipboardByRange(n,e),!n||n.isCollapsed()||n.isSingleTableSelected()||t.execCommand("comp.DeleteNoteRange",{range:n})},t.prototype._onCopy=function(e){var t=this,n=t.getNoteRange();p.DEBUG&&(p.profile("on-copy"),p.time("on-copy")),e.preventDefault(),p.log("on copy!"),t._setClipboardByRange(n,e),p.DEBUG&&(p.timeEnd("on-copy"),p.profileEnd("on-copy"))},t.prototype._onDeleteSelection=function(){var e=this,t=e.getNoteRange();t&&!t.isCollapsed()&&e.execDeleteBackward(t)},t.prototype._onGetDefaultSetFont=function(e){e(this.getDefaultFont())},t.prototype._onKey=function(e,t){var n=this,o=n.noteView,i=n.keyHandlerManager;o&&(o.directionKeyJustMoved=!1),i.execWithKey(e,n,t)},t.prototype._onBackupDragRange=function(){var e=this.getNoteRange();e&&!e.isCollapsed()&&(this.dragTextRange=e)},t.prototype._onDragStart=function(e,t){var n,o,i,r=this;if(n=_.isTextBlock(t)?r.dragTextRange:r.getNoteRange(),r.startNoteRange=n,!n||n.isCollapsed())return void p.log("no note range or note range is collapsed!");i=new A({event:e}),o={"text/html":n.getDataAsHtml(r.note),"text/plain":n.getDataAsPlain(r.note),"text/yne-json":n.getDataAsJSON(r.note)},i.setDataMap(o),i.clearData("text/uri-list"),i.setProperty("effectAllowed","move")},t.prototype._onDragOver=function(e,t){var o=this,i=e.clientX,r=e.clientY,a=e.dataTransfer.types;if(!n.contains(a,"text/yne-json"))return n.contains(a,"Files")&&(e.preventDefault(),e.stopPropagation()),!0;if(e.preventDefault(),e.stopPropagation(),!this.lastDragOver||o.lastDragOver.x!==i||o.lastDragOver.y!==r){if(!_.isTextBlock(t)&&!_.isListItem(t))return e.dataTransfer.dropEffect="none",void o.removeDragHint();e.dataTransfer.dropEffect="move",!1===o.addDragHint(i,r)&&(e.dataTransfer.dropEffect="none")}},t.prototype._onDrop=function(e){var t,o,r,a,l=this,s=e.dataTransfer,c=s.types,u=l.noteView,d=l.getRangeByPoint(e.clientX,e.clientY);e.preventDefault(),e.stopPropagation(),n.contains(c,"text/yne-json")&&(t=s.getData("text/yne-json"),o=h.parseJSON(t),n.map(o,function(e){e.setId(i.newGUID())}),r=u.parseNativeRange(d),(a=r[0])&&a.isCollapsed()&&u.trigger("command","comp.DragBlocks",{blocks:o,dropRange:a,range:l.startNoteRange})),n.contains(c,"Files")&&l.noteSelection.setRange(d),l.removeDragHint()},t.prototype._onDragEnd=function(){this.removeDragHint()},t.prototype._onHeaderFooterViewTextChange=function(e,t){this.onCommand("comp.SetHeaderFooter",{content:e,headerFooter:t,range:w.createForHeaderFooter(t)})},t.prototype._onGetNoteRange=function(e){e(this.getNoteRange())},t.prototype._onGetBlockView=function(e,t){var n=this,o=n.noteView;o&&t(o.getBlockViewByBlock(e))},t.prototype._onEnterTableEdit=function(e){e.blockId&&(this.editor.sendCachedDataCommand(),this._sendBlockLockInfo(e.blockId)),this.trigger("cell-edit-view-enter",e)},t.prototype._onSaveContent=function(){this.trigger("yne-save-content")},t.prototype._onSelectionChange=function(e){var t=this;t.lastDeleteInlineStates?(t.setEditingInlineStates(t.lastDeleteInlineStates),t.lastDeleteInlineStates=null):t._shouldKeepEditingStates(e)||t._updateEditingStates(),t._notifyEditingStatesChange(),t.trigger("yne-selection-change")},t.prototype._onTextInput=function(e){this.insertText(e,!1)},t.prototype._pasteBlobImg=function(e){var t,n,o=this;(t=e.originalEvent.clipboardData.items)&&1===t.length&&0===t[0].type.indexOf("image")&&(n=t[0].getAsFile(),o.trigger("yne-blob-paste",{data:n,isImg:!0},function(e){e&&e.source&&o.insertImage(e.source)}))},t.prototype._pasteForMac=function(){var e,t,o,i,r,a,l,s=this,c=s.editor,u=window.ynote;return u&&u.macClipboardData||p.error("YNote does not exist!"),s.isPasteAsText?(e=c.callMacNativeApi("macClipboardData",["text/plain"]),void s._pastePlain(e,s.isPasteAsText)):(t=c.callMacNativeApi("macClipboardData",["text/yne-table-json"]))&&s.pasteYTableJson(t)||(o=c.callMacNativeApi("macClipboardData",["text/yne-json"]),i=c.callMacNativeApi("macClipboardData",["text/yne-image-json"]),r=c.callMacNativeApi("macClipboardData",["text/yne-note-id"]),o&&s._pasteJSON(o,i,r))?void 0:(a=c.callMacNativeApi("macClipboardData",["text/html"]))&&s._pasteHTML(a)?void p.log("mac paste html ok"):(l=c.callMacNativeApi("macClipboardData",["image"]))?(l=JSON.parse(l),void n.each(l,function(e){s.insertImage(e)})):(e=c.callMacNativeApi("macClipboardData",["text/plain"]),e?void s._pastePlain(e,s.isPasteAsText):void 0)},t.prototype._pasteJSON=function(e,t,o){p.log("Paste JSON\n",e);var r,l,c=this,u={},d=s.parseImageJson(t),g=h.parseJSON(e),f=[],m=[],y={},v={};return n.each(g,function(e){_.isHeading(e)&&(y[e.getId()]=e)}),n.each(g,function(e){var t,n;_.isCatalogue(e)?(t=y[e.getHref()])&&(e.setIndent(t.getLevel()-1),n=i.newGUID(),v[n]=!0,t.setId(n),e.setHref(n)):_.isHeading(e)||(e.setId(i.newGUID()),_.isListItem(e)?(r=e.getListId(),u[r]||(u[r]=a.getOrCreateListById(c.note.getAllBlocks(),r,e.getListType())),e.setOwnerList(u[r])):_.isAttachment(e)?f.push(e):_.isImage(e)&&m.push(e))}),n.each(y,function(e){v[e.getId()]||e.setId(i.newGUID())}),c.note.isSameNote(o)||(l=c._uploadImageData(d||{},f,m)),c._pasteBlockList(g,l)},t.prototype._pasteHTML=function(e){p.log("Paste HTML\n",e);var t=this,o={},r={},a=h.parseHtml(e);return n.each(a,function(e){_.isHeading(e)&&(o[e.getId()]=e)}),n.each(a,function(e){var n,a;if(_.isCatalogue(e)&&(n=o[e.getHref()])&&(e.setIndent(n.getLevel()-1),a=i.newGUID(),r[a]=!0,n.setId(a),e.setHref(a)),_.isTextBlock(e)){var l=t.getNoteRange(),s=l.getStartBlockRange().block;e.setBlockStyles(s.getBlockStyles())}}),n.each(o,function(e){r[e.getId()]||e.setId(i.newGUID())}),t._pasteBlockList(a)},t.prototype._pastePlain=function(e,t){var o,i,r,a=this,l=a.getNoteRange();return t&&(i=a.querySelectionInlineStyles(l),r=a.querySelectionBlockStyles(l)),o=h.parsePlain(e,i,r,t),n.each(o,function(e){if(_.isTextBlock(e)){var t=a.getNoteRange(),n=t.getStartBlockRange().block;e.setBlockStyles(n.getBlockStyles())}}),a._pasteBlockList(o)},t.prototype._pasteBlockList=function(e,t){var o,i=this;if(e&&e.length&&(!0===i.removeLocalImg&&(e=n.filter(e,function(e){var o=/^(http:\/\/|https:\/\/|\/\/)/i;return _.isImage(e)&&-1===n.indexOf(t||[],e)?o.test(e.getSource()):!_.isAttachment(e)||o.test(e.getResource())})),e&&e.length))return o=i.editingInlineStates,i.editingInlineStates=null,i.execCommand("comp.InsertBlocks",{blocks:e}),i.editingInlineStates=o,!0},t.prototype._redoUndoLocalCmdInCollabMode=function(e){var t,o=this;return e.collabProperties.isCollabUndo?t=o.cmdManager.getUndoCmd():e.collabProperties.isCollabRedo&&(t=o.cmdManager.getRedoCmd()),t?(t=n.clone(t),t.setCmdOriginalNoteVersion(o.note.getFileVersion()),t.isLocalExecutedCmd=!1,e.collabProperties.isCollabUndo?(t.setCollabUndo(!0),t.setCollabRedo(!1)):e.collabProperties.isCollabRedo&&(t.setCollabRedo(!0),t.setCollabUndo(!1)),o.editor.isValidLocalDataCmd(t)?void(i.isInlineStateSetCommand(t)||o.editor.pushLocalDataCommand(t,!0)):void p.warn("skip invalid redo/undo local command")):void p.warn("skip empty redo/undo local command")},t.prototype._setClipboardByRange=function(e,t){var n,o,i,r=this;if(!e||e.isCollapsed())return void p.log("no note range or note range is collapsed!");n=r.getRangeData(e),i=new N({event:t}),i.setDataMap(n),o=e.isInSingleBlock()&&_.isAttachment((e.getStartBlockRange()||{}).block),r.trigger("yne-clipboard-set",o)},t.prototype._sendBlockLockInfo=function(e){var t=this;t.editor.hasCachedDataCmd()?window.setTimeout(t._sendBlockLockInfo.bind(t,e),100):t.editor.sendBlockLockInfo(e)},t.prototype._shouldKeepEditingStates=function(e){var t,o,i,r={do:["key.Space","key.Enter","comp.ApplyStyles","comp.IndentOutdent","comp.InsertAttachment","comp.InsertHorizontalRule","comp.InsertImage","comp.InsertList","comp.InsertTable","comp.KeyTab","comp.KeyTextInput"],redo:["comp.ApplyStyles","comp.IndentOutdent","comp.InsertList"],undo:["comp.ApplyStyles","comp.IndentOutdent","comp.InsertList"]};return!!(e&&e.isCommandType&&e.isCommandType())&&(t=e.getData()||{},o=t.cmdType,i=t.cmdName,n.contains(r[o],i))},t.prototype._updateDeleteInlineStates=function(e){e&&e.href&&(e=null),this.lastDeleteInlineStates=e},t.prototype._updateEditingStates=function(){var e=this,t=e.getNoteRange(),n=e.queryBackwardFirstInlineStyles(t);e.setEditingInlineStates(n)},t.prototype._uploadImageData=function(e,t,o){if(!(n.isEmpty(e)||n.isEmpty(t)&&n.isEmpty(e.data))){var i,r,a=this,l=[],s={},c=e.data,u=a.note,d=a.editor;if(i=a._getUploadData(c,t,o))return l=i.data,s=i.map,r=i.replaceImgList,d.trigger("yne-upload-image",{data:l,isImg:!0},function(e){setTimeout(function(){var t=[],o=[];n.each(e,function(e,i){n.each(s[i],function(i){var r=u.getBlockById(i);r&&(t.push(r),_.isImage(r)?o.push(n.defaults(e,{source:r.getSource()||"uploadfail"})):_.isAttachment(r)&&o.push(n.defaults(e,{resource:r.getResource(),source:r.getSource()})))})}),t.length>0&&(a.execCommand("comp.ReplaceResource",{ignoreUndoRedo:!0,resProps:o,resources:t}),n.each(t,function(e){e.trigger("content-change")}))})},function(){n.each(n.union(t,r),function(e){e.setFakeLoading(!0)})}),r}},t}(d)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){function t(e,t){var n=[];return o.each(e,function(e){if(r.isImage(e)){var o=e.getSource(),i=t[o];i&&i.base64&&(n.push(e),i.imgBlockIds?i.imgBlockIds.push(e.getId()):i.imgBlockIds=[e.getId()])}}),n}var o=n(0),i=n(1),r=n(2),a=function(e){var t=document.createElement("CANVAS"),n=t.getContext("2d"),o=null;if(!e)return null;t.height=e.naturalHeight,t.width=e.naturalWidth,n.fillStyle="white",n.fillRect(0,0,t.width,t.height),n.drawImage(e,0,0);try{o=t.toDataURL("image/jpeg",1)}catch(e){i.warn(e.message)}return o};return{getBase64Data:function(e){if(!e)return{};var t,n={data:{}},i=n.data;return o.each(e,function(e){(t=a(e.img))&&(i[e.source]={base64:t})}),n},parseImageJson:function(e){var t=null;if(!e)return null;try{t=JSON.parse(e)}catch(e){return i.error("no imagejson or parse imagejson error"),null}return t},base64ToBlob:function(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],o=atob(t[1]),i=o.length,r=new Uint8Array(i);i--;)r[i]=o.charCodeAt(i);return new Blob([r],{type:n})},imgToBase64:a,setBlockIds:t}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(15),o=n(1),i=n(4),r=n(14),a=n(3);return n(285),t.extend({_editor:null,initialize:function(e){this._editor=e.editor},create:function(e,t,n){var l,s=null;if(n.collabProperties=n.collabProperties||{},e+="",l=i.get(e)){if(s=new l({note:t,args:n}),!this._editor.isCollabEnabled())return s.isSimple||s.setStartingRange(n.range),s;if(n.collabProperties.dataCmdError)return o.error(n.collabProperties.dataCmdError),null;if(s.isSimple)return s;!a.isCollabCommand(n)&&s.isOriginalCmd&&(r.isNoteRange(n.range)?s.setStartingRange(n.range):(n.collabProperties.dataCmdError="original cmd args.range should be noteRange",s=null))}else o.warn("No class for `"+e+"` command");return s}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){n(155),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(300),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(311),n(313),n(314),n(315),n(317),n(319),n(320),n(322),n(324),n(325),n(326)}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(11),a=n(21),l=n(55),s=n(3);return t=o.extend({name:"comp.AppendBlank",_cmdArgs:null,_note:null,_newBlkId:null,_preBlkId:null,_preBlock:null,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args||{},s.isCollabCommand(e._cmdArgs)||(e._newBlkId=s.newGUID(),e._preBlock=e._note.getLastBlock(),e._preBlock&&(e._preBlkId=e._preBlock.getId())),t.__super__.initialize.apply(e,arguments)},apply:function(){var e,t,n=this;return e=r.createNewParagraph(n._preBlock,n._newBlkId,""),r.setBlockStyle(e,n._cmdArgs.inlineStyles),!1!==n.executeAtomicCommand(new a({note:n._note,newBlks:[e],preBlk:n._preBlock}))&&(t=l.buildNoteRangeFromParagraph(e,0,0),n.setEndingRange(t),!0)},fromCollabJSON:function(){var e=this,n=e.options.args.collabProperties.cmdJSON;n&&(e._newBlkId=n.newBlkId,n.preBlkId&&(e._preBlock=e._note.getBlockById(n.preBlkId))),t.__super__.fromCollabJSON.apply(e)},toCollabJSON:function(){var e,n=this;return n.rangeIsRequired=!1,n.resetAffectedBlockIds(),e=t.__super__.toCollabJSON.apply(n),e.newBlkId=n._newBlkId,n._preBlkId&&(e.preBlkId=n._preBlkId),e}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(1),a=n(0),l=n(11),s=n(3);return t=o.extend({name:"comp.ApplyStyles",_note:null,_cmdArgs:null,_blockStyleNameValues:null,_inlineStyleNameValues:null,initialize:function(){var e,n=this;if(n._note=n.options.note,n._cmdArgs=n.options.args,e=n._cmdArgs.range,t.__super__.initialize.apply(n),!s.isCollabCommand(n._cmdArgs)){if(!e)return r.error("note range should NOT be null:",n.name),void(n.isReadyToApply=!1);n._blockStyleNameValues=n._cmdArgs.blockStyles,n._inlineStyleNameValues=n._cmdArgs.inlineStyles}},apply:function(){var e=this,t=e._cmdArgs.range;return!l.setStylesOnNoteRange(e,e._note,t,a.clone(e._blockStyleNameValues),a.clone(e._inlineStyleNameValues))&&(e.setEndingRange(t),!0)},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;n&&(n.blockStyles&&(e._blockStyleNameValues=n.blockStyles),n.inlineStyles&&(e._inlineStyleNameValues=n.inlineStyles)),t.__super__.fromCollabJSON.apply(e)},isInlineStateSet:function(){var e=this,t=e._cmdArgs.range,n=!1;return t&&t.isCollapsed()&&(!e._blockStyleNameValues||a.isEmpty(e._blockStyleNameValues))&&e._inlineStyleNameValues&&!a.isEmpty(e._inlineStyleNameValues)&&(n=!0),n},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n&&(e._blockStyleNameValues&&!a.isEmpty(e._blockStyleNameValues)&&(n.blockStyles=e._blockStyleNameValues),e._inlineStyleNameValues&&!a.isEmpty(e._inlineStyleNameValues)&&(n.inlineStyles=e._inlineStyleNameValues)),n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(158),i=n(4),r=n(1),a=n(3);return t=o.extend({name:"comp.DeleteNoteRange",_cmdArgs:null,_note:null,initialize:function(){var e,n=this;if(n._note=n.options.note,n._cmdArgs=n.options.args,t.__super__.initialize.apply(n),!a.isCollabCommand(n._cmdArgs)){if(!(e=n._cmdArgs.range))return n.isReadyToApply=!1,void r.error("note range should NOT be null",this.name);if(e.isCollapsed()&&!n._cmdArgs.isTableDelete)return n.isReadyToApply=!1,r.error("should NOT trigger the cmd when NoteRange is collapsed",e),!1}},isSingleBlockAffected:function(){var e,n,o=this,i=o._args.range,r=t.__super__.isSingleBlockAffected.apply(o),a=0;return r&&i&&i.isCollapsed()&&(n=i.getStartBlockRange(),e=n.block,a=n.start,o._note.getNextBlock(e)&&a===e.getEndOffset()&&(r=!1)),r}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(1),a=n(0),l=n(2),s=n(11),c=n(14),u=n(21),d=n(56),p=n(47),h=n(23),g=n(26),f=n(97),m=n(3);return t=o.extend({name:"comp.DragBlocks",_note:null,_cmdArgs:null,_dropBlockRange:null,_insertedBlocks:null,_newEndBlankParaId:null,_insertedBlocksJSON:null,initialize:function(){var e,n=this;if(n._note=n.options.note,n._cmdArgs=n.options.args,t.__super__.initialize.apply(n),!m.isCollabCommand(n._cmdArgs)){if(!(e=n._cmdArgs.range))return r.error(n.name+":note range should NOT be null"),void(n.isReadyToApply=!1);if(n._dropBlockRange=n._cmdArgs.dropRange,n._insertedBlocks=[],n._insertedBlocksJSON=[],a.each(n._cmdArgs.blocks,function(e){n._insertedBlocks.push(e),n._insertedBlocksJSON.push(e.toCollabJSON())}),n._newEndBlankParaId=m.newGUID(),!(n._dropBlockRange&&n._dropBlockRange.block&&l.isTextBlock(n._dropBlockRange.block)&&n._dropBlockRange.isCollapsed()))return n.isReadyToApply=!1,void r.error("drag destination should be a single pos in text block",n._dropBlockRange);if(n._isDropRangeInStartNoteRange(n._dropBlockRange))return n.isReadyToApply=!1,void r.error("dropBlockRange should not be in the startNoteRange",e,n._dropBlockRange)}},apply:function(){var e,t=this;return e=g.createRangeByBlock({block:t._dropBlockRange.block,start:t._dropBlockRange.start,end:t._dropBlockRange.end}),e=t._handleStartNoteRangeData(e),t._insertDraggedData(e),!0},_handleStartNoteRangeData:function(e){var t,n,o,i,r,c,u,p=this,g=p._cmdArgs.range,f=[];return t=g.getStartBlockRange(),n=t.block,o=g.getEndBlockRange(),i=o.block,u=p._isFullSelectionInTextBlock(t),g.isCollapsed()||s.deleteSelectedContent(p,p._note,g),g.isInMultiBlock()?(l.isTextBlock(n)&&!n.isEmpty()||(f.push(n),n=null),l.isTextBlock(i)&&!i.isEmpty()||(f.push(i),i=null),a.isEmpty(f)&&(e.block.getId()===i.getId()&&(e=p._rebuildDropRangeWhenNoteRangeMerge(t,o,e)),p.executeAtomicCommand(new d({block:n,start:n.getLength(),text:i.getText()})),f.push(i)),p.executeAtomicCommand(new h({note:p._note,blocks:f}))):l.isTextBlock(n)?u&&(r=p._note.getPreBlock(n),c=p._note.getNextBlock(n),l.isImage(r)||l.isImage(c)||l.isAttachment(r)||l.isAttachment(c)||l.isTable(r)||l.isTable(c)||(p.executeAtomicCommand(new h({note:p._note,blocks:[n]})),n=null)):(s.replaceBlockWithParagraph(p,p._note,n,""),n=null),e},_insertDraggedData:function(e){var t,n,o,i,r,f,m=this,_=m._cmdArgs.range,y=m._insertedBlocks[0],v=a.last(m._insertedBlocks),b=e.block;t=_.getStartBlockRange(),t.block.getId(),n=_.getEndBlockRange(),n.block.getId(),m._tuneDropBlockRange(e,t,n),l.isTextBlock(y)&&!l.isHeading(y)?(m._insertedBlocks.shift(),m.executeAtomicCommand(new d({block:e.block,start:e.start,text:y.getText()})),r=g.createRangeByBlock({block:e.block,start:e.start,end:e.start+y.getLength()}),f=r,e.start+=y.getLength(),e.end=e.start):(r=g.createRangeByBlock({block:m._insertedBlocks[0]}),f=r),a.isEmpty(m._insertedBlocks)||(o=e.block.sliceText(e.start,e.block.getLength()),_.isInMultiBlock()&&(f=l.isTextBlock(v)?g.createRangeByBlock({block:v,start:0,end:v.getLength()}):g.createRangeByBlock({block:v})),0===e.start?(b=m._note.getPreBlock(e.block),l.isTextBlock(v)?(v.append(o),m.executeAtomicCommand(new h({note:m._note,blocks:[e.block]}))):0===e.block.getLength()&&m.executeAtomicCommand(new h({note:m._note,blocks:[e.block]}))):e.start<e.block.getLength()&&(m.executeAtomicCommand(new p({block:e.block,start:e.start,end:e.block.getLength()})),l.isTextBlock(v)?v.append(o):(i=l.isListItem(e.block)?s.createNewListItem(e.block,m._newEndBlankParaId,o):l.isHeading(e.block)?s.createNewHeading(e.block,m._newEndBlankParaId,o,e.block.getLevel()):l.isTodo(e.block)?s.createNewTodo(e.block,{id:m._newEndBlankParaId,text:o,checked:e.block.getChecked()}):s.createNewParagraph(e.block,m._newEndBlankParaId,o),m._insertedBlocks.push(i),_.isInMultiBlock()&&(f=g.createRangeByBlock({block:i,start:0,end:0})))),m.executeAtomicCommand(new u({note:m._note,newBlks:m._insertedBlocks,preBlk:b}))),m.setEndingRange(c.create({startRange:r,endRange:f}))},_isDropRangeInStartNoteRange:function(e){var t,n=this,o=n._cmdArgs.range,i=o.getStartBlockRange(),r=o.getEndBlockRange(),l=e,s=l.block.getId(),c=!1;return s===i.block.getId()&&l.start>=i.start&&l.start<=i.end&&(c=!0),!c&&o.isInMultiBlock()&&(s===r.block.getId()&&l.start>=r.start&&l.start<=r.end?c=!0:(t=n._note.getInterBlocks(i.block,r.block),a.some(t,function(e){return s===e.getId()&&(c=!0),c}))),c},_isFullSelectionInTextBlock:function(e){var t=!1,n=0;return l.isTextBlock(e.block)&&(n=e.block.getLength()),n>0&&0===e.start&&e.end===n&&(t=!0),t},_rebuildDropRangeWhenNoteRangeMerge:function(e,t,n){var o;return o=n.start+e.start-t.end,g.createRangeByBlock({block:e.block,start:o,end:o})},_tuneDropBlockRange:function(e,t,n){var o=t.block.getId(),i=n.block.getId();e.block.getId()===o&&e.start>t.end&&(e.start-=t.end-t.start,e.end-=e.start),o!==i&&e.block.getId()===i&&e.start>n.end&&(e.start-=n.end-n.start,e.end-=e.start)},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties.cmdJSON,i=n.collabProperties.coreEditor;t.__super__.fromCollabJSON.apply(e),o&&(e._newEndBlankParaId=o.newEndBlkId,e._dropBlockRange=i.buildBlockRangeFromJSON(o.dropRange),e._insertedBlocks=[],a.each(o.insertedBlocks,function(t){e._insertedBlocks.push(f.buildBlockFromJSON(t,i))}))},isSingleBlockAffected:function(){var e=this,t=e._cmdArgs.range,n=t.getStartBlockRange();return!(!t.isInSingleBlock()||e._dropBlockRange.block.getId()!==n.block.getId())},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n&&(n.newEndBlkId=e._newEndBlankParaId,n.dropRange=e._dropBlockRange.toCollabJSON(),n.insertedBlocks=e._insertedBlocksJSON),n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(11),a=n(6),l=n(0),s=n(1),c=n(3);return t=o.extend({name:"comp.FormatPainter",_cmdArgs:null,_note:null,_inlineStyles:null,_blockStyles:null,initialize:function(){var e,n=this;if(n._note=n.options.note,n._cmdArgs=n.options.args||{},e=n._cmdArgs.range,t.__super__.initialize.apply(n,arguments),!c.isCollabCommand(n._cmdArgs)){if(!e)return s.error(n.name+":note range should NOT be null"),void(n.isReadyToApply=!1);n._inlineStyles=n._cmdArgs.data.inlineStyles,n._blockStyles=n._cmdArgs.data.blockStyles}},apply:function(){var e=this,t=e._cmdArgs.range,n={},o={};return!!t.isCollapsed()||(l.each(e._inlineStyles,function(e,t){"href"!==t&&e!==a.INTERM&&null!==e&&void 0!==e&&(n[t]=e)}),l.each(e._blockStyles,function(e,t){e!==a.INTERM&&null!==e&&void 0!==e&&(o[t]=e)}),l.isEmpty(o)&&l.isEmpty(n)||(r.resetAllStyles(e,e._note,t),r.setStylesOnNoteRange(e,e._note,t,o,n)),e.setEndingRange(t),!0)},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;n&&(e._inlineStyles=n.inlineStyles,e._blockStyles=n.blockStyles),t.__super__.fromCollabJSON.apply(e)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e.inlineStyles=n._inlineStyles,e.blockStyles=n._blockStyles,e}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(2),a=n(11),l=n(1),s=n(99),c=n(3);return t=o.extend({name:"comp.IndentOutdent",_cmdArgs:null,_note:null,_indentStep:null,initialize:function(){var e,n,o,i=this;if(i._note=i.options.note,i._cmdArgs=i.options.args||{},t.__super__.initialize.apply(i,arguments),!c.isCollabCommand(i._cmdArgs)){if(e=i._cmdArgs.range,i._indentStep=i._cmdArgs.indentStep,!e||!e.canDrawedByNative())return l.error(i.name+":note range should NOT be null or cannot be Drawed by native"),void(i.isReadyToApply=!1);if(n=e.getStartBlockRange(),o=n.block,e.isInSingleBlock()&&!r.isTextBlock(o))return void(i.isReadyToApply=!1)}},apply:function(){var e,t,n,o,i,l=this,c=l._cmdArgs.range;return e=c.getStartBlockRange(),t=e.block,n=c.getEndBlockRange(),o=n.block,c.isInMultiBlock()?(i=l._note.getInterBlocks(t,o,!0),a.isInSameList(i)?l._isFirstListItem(i[0])?a.updateBlocksIndentLevel(l,i[0].getOwnerList().getItems(),l._indentStep):l.executeAtomicCommand(new s({listItems:i,deltaLevel:l._indentStep})):a.updateBlocksIndentLevel(l,i,l._indentStep),l.setEndingRange(c),!0):(r.isListItem(t)?l._isFirstListItem(t)?a.updateBlocksIndentLevel(l,t.getOwnerList().getItems(),l._indentStep):l.executeAtomicCommand(new s({listItems:[t],deltaLevel:l._indentStep})):a.updateBlocksIndentLevel(l,[t],l._indentStep),l.setEndingRange(c),!0)},_isFirstListItem:function(e){return 1===e.getLevel()&&1===e.getIndex()},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;n&&(e._indentStep=n.indentStep),t.__super__.fromCollabJSON.apply(e)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e&&(e.indentStep=n._indentStep),e}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(80),i=n(4),r=n(2),a=n(74),l=n(64),s=n(21),c=n(67),u=n(3),d=n(11);return t=o.extend({name:"comp.InsertAttachment",_cmdArgs:null,_note:null,_attachBlkId:null,_attachSrc:null,_attachRes:null,_attachFileName:null,_attchFileLen:null,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args||{},t.__super__.initialize.apply(e,arguments),u.isCollabCommand(e._cmdArgs)||(e._attachBlkId=u.newGUID(),e._attachSrc=e._cmdArgs.src,e._attachRes=e._cmdArgs.resource,e._attachFileName=e._cmdArgs.fileName,e._attchFileLen=e._cmdArgs.fileLength)},insertResource:function(e,t,n){var o,i=this,l=i._cmdArgs.range,c=[];return r.isTable(e)&&l.isSingleTableSelected()?i._insertAttachmentInTable(e):(o=new a({source:i._attachSrc,resource:i._attachRes,fileName:i._attachFileName,fileLength:i._attchFileLen}),d.setResourceBlockStyleByPreBlock(o,e),t&&c.push(t),c.push(o),n&&c.push(n),o.setId(i._attachBlkId),i.executeAtomicCommand(new s({note:i._note,newBlks:c,preBlk:e})),o)},_insertAttachmentInTable:function(e){var t,n=this,o=n._cmdArgs.range,i=o.getStartBlockRange(),r=i.getAsRectRange();if(r)return t=r.getFirstCellRect(),n.executeAtomicCommand(new c({table:e,cellRect:t,content:new l({source:n._attachSrc,resource:n._attachRes,fileName:n._attachFileName,fileLength:n._attchFileLen})})),e},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),n&&(e._attachBlkId=n.newBlkId,e._attachSrc=n.src,e._attachRes=n.attachRes,e._attachFileName=n.fileName,e._attchFileLen=n.fileLen)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e&&(e.newBlkId=n._attachBlkId,e.src=n._attachSrc,e.attachRes=n._attachRes,e.fileName=n._attachFileName,e.fileLen=n._attchFileLen),e}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(1),a=n(0),l=n(2),s=n(11),c=n(14),u=n(21),d=n(56),p=n(23),h=n(47),g=n(126),f=n(26),m=n(97),_=n(10),y=n(3);return t=o.extend({name:"comp.InsertBlocks",_note:null,_cmdArgs:null,_insertedBlocks:null,_newEndBlankParaId:null,_insertedBlocksJSON:null,initialize:function(){var e=this;if(e._note=e.options.note,e._cmdArgs=e.options.args,t.__super__.initialize.apply(e),!y.isCollabCommand(e._cmdArgs)){if(!e._cmdArgs.range)return r.error(e.name+":note range should NOT be null"),void(e.isReadyToApply=!1);e._insertedBlocks=[],e._insertedBlocksJSON=[],a.each(e._cmdArgs.blocks,function(t){e._insertedBlocks.push(t),e._insertedBlocksJSON.push(t.toCollabJSON())}),e._newEndBlankParaId=y.newGUID()}},apply:function(){var e,t,n,o=this,i=o._note,r=o._cmdArgs.range,c=a.last(o._insertedBlocks);return o._getCollabRequiredData(o._insertedBlocks),l.isTextBlock(c)?t=f.createRangeByBlock({block:c,start:c.getLength(),end:c.getLength()}):(n=i.getNextBlock(o.startingRange.getEndBlockRange().block),l.isTextBlock(n)&&(t=f.createRangeByBlock({block:n,start:n.getLength(),end:n.getLength()}))),r.isCollapsed()||s.deleteSelectedContent(o,o._note,r),e=r.isInMultiBlock()?o._handleMultiBlockSelection(t):o._handleSingleBlockSelection(t),o.setEndingRange(e),!0},_handleMultiBlockSelection:function(e){var t=this,n=t._cmdArgs.range,o=n.getStartBlockRange(),i=o.block,r=n.getEndBlockRange(),a=r.block,s=t._insertedBlocks[0];return 1===t._insertedBlocks.length&&l.isTextBlock(s)&&l.isTextBlock(i)&&l.isTextBlock(a)?(t._insertedBlocks.shift(),e=f.createRangeByBlock({block:i,start:i.getLength()+s.getLength(),end:i.getLength()+s.getLength()}),s.append(a.getText()),t.executeAtomicCommand(new p({note:t._note,blocks:[a]})),t.executeAtomicCommand(new d({block:i,start:i.getLength(),text:s.getText()}))):e=t._insertBlocksBetweenStartEndBlock(o,r,e),c.create({startRange:e,endRange:e})},_getCollabRequiredData:function(e){var t=this,n=[];e&&e.length>0&&a.each(e,function(e){n.push(e.getId())}),n.push(t._newEndBlankParaId),t.pushAffectedBlockIds(n)},_handleSingleBlockSelection:function(e){var t,n=this,o=n._cmdArgs.range,i=o.getStartBlockRange(),r=i.block;return t=l.isTextBlock(r)?n._handleSingleTextStartBlock(r,e):n._handleSingleNonTextStartBlock(r,e),a.isEmpty(n._insertedBlocks)||(t.needToRebuildLIs&&n._rebuildListItems(n._insertedBlocks,t.refBlockForInsert,t.deltaLevel),n.executeAtomicCommand(new u({note:n._note,newBlks:n._insertedBlocks,preBlk:t.refBlockForInsert}))),c.create({startRange:t.newEndBlockRange,endRange:t.newEndBlockRange})},_handleSingleNonTextStartBlock:function(e,t){var n=this,o=n._insertedBlocks[0],i=a.last(n._insertedBlocks),r=n._note.getPreBlock(e),c=n._note.getNextBlock(e),u={};return u.refBlockForInsert=r,u.newEndBlockRange=t,u.needToRebuildLIs=!1,n.executeAtomicCommand(new p({note:n._note,blocks:[e]})),l.isTextBlock(o)||l.isTextBlock(r)||n._insertedBlocks.unshift(s.createNewParagraph(e,e.getId(),"")),l.isTextBlock(i)||l.isTextBlock(c)||(n._insertedBlocks.push(s.createNewParagraph(e,n._newEndBlankParaId,"")),u.newEndBlockRange=f.createRangeByBlock({block:a.last(n._insertedBlocks),start:0,end:0})),u},_handleSingleTextStartBlock:function(e,t){var n,o=this,i=o._cmdArgs.range,r=i.getStartBlockRange(),s=o._note.getPreBlock(e),c=o._note.getNextBlock(e),u=o._insertedBlocks[0],m=a.last(o._insertedBlocks),y="",v=1===o._insertedBlocks.length,b={};return b.refBlockForInsert=e,b.newEndBlockRange=t,b.needToRebuildLIs=!1,b.deltaLevel=0,r.start<e.getLength()&&(y=e.sliceText(r.start,e.getLength())),v&&l.isTextBlock(u)||(l.isTextBlock(m)?(n=y instanceof _?y:_.createBlank(),m.append(n),o.executeAtomicCommand(new h({block:e,start:r.start,end:e.getLength()}))):""===y&&l.isTextBlock(c)?b.newEndBlockRange=f.createRangeByBlock({block:c,start:0,end:0}):(o._insertedBlocks.push(o._buildNewBlockFromStartBlock(e,o._newEndBlankParaId,y)),b.newEndBlockRange=f.createRangeByBlock({block:a.last(o._insertedBlocks),start:0,end:0}),o.executeAtomicCommand(new h({block:e,start:r.start,end:e.getLength()})))),l.isTextBlock(u)?e.getLength()>0||l.isListItem(e)||!l.isListItem(u)&&!l.isHeading(u)&&!l.isCatalogue(u)&&!l.isTodo(u)&&!l.isQuote(u)?(o._insertedBlocks.shift(),v&&(b.newEndBlockRange=f.createRangeByBlock({block:e,start:r.start+u.getLength(),end:r.start+u.getLength()})),o.executeAtomicCommand(new g({blocks:[e],styleNameValues:u.getBlockStyles()})),o.executeAtomicCommand(new d({block:e,start:r.start,text:u.getText()})),l.isListItem(e)&&l.isListItem(o._insertedBlocks[0])&&(b.needToRebuildLIs=!0,l.isListItem(u)&&(b.deltaLevel=o._insertedBlocks[0].getLevel()-u.getLevel()))):(b.refBlockForInsert=s,o.executeAtomicCommand(new p({note:o._note,blocks:[e]})),l.isListItem(s)&&l.isListItem(u)&&(b.needToRebuildLIs=!0,b.deltaLevel=1-s.getLevel())):0===e.getLength()&&l.isTextBlock(s)&&(b.refBlockForInsert=s,o.executeAtomicCommand(new p({note:o._note,blocks:[e]}))),b},_buildNewBlockFromStartBlock:function(e,t,n){return l.isHeading(e)?s.createNewHeading(e,t,n,e.getLevel()):l.isCatalogue(e)?s.createNewCatalogue(e,{paraId:t,text:n,href:e.getHref()}):l.isListItem(e)?s.createNewListItem(e,t,n):l.isTodo(e)?s.createNewTodo(e,{id:t,text:n,checked:e.getChecked()}):l.isQuote(e)?s.createNewQuote(e,{id:t,text:n}):s.createNewParagraph(e,t,n)},_insertBlocksBetweenStartEndBlock:function(e,t,n){var o=this,i=e.block,r=t.block,c=o._note.getPreBlock(i),u=o._note.getNextBlock(r),h=o._insertedBlocks[0],g=a.last(o._insertedBlocks),m=i,_=[],y=0;return l.isTextBlock(r)?l.isTextBlock(g)?(_.push(r),g.append(r.getText())):l.isTextBlock(g)||(n=f.createRangeByBlock({block:r,start:0,end:0})):(_.push(r),l.isTextBlock(u)||l.isTextBlock(g)?l.isTextBlock(g)||(n=f.createRangeByBlock({block:u,start:0,end:0})):(o._insertedBlocks.push(s.createNewParagraph(r,r.getId(),"")),n=f.createRangeByBlock({block:a.last(o._insertedBlocks),start:0,end:0}))),l.isTextBlock(i)?l.isTextBlock(h)?i.getLength()>0||l.isListItem(i)||!l.isListItem(h)?(o._insertedBlocks.shift(),o.executeAtomicCommand(new d({block:i,start:i.getLength(),text:h.getText()})),l.isListItem(h)&&l.isListItem(o._insertedBlocks[0])&&(y=o._insertedBlocks[0].getLevel()-h.getLevel())):(m=c,o.executeAtomicCommand(new p({note:o._note,blocks:[i]}))):0===i.getLength()&&l.isTextBlock(c)&&(m=c,o.executeAtomicCommand(new p({note:o._note,blocks:[i]}))):(_.push(i),m=c,l.isTextBlock(c)||l.isTextBlock(h)||o._insertedBlocks.unshift(s.createNewParagraph(i,i.getId(),""))),a.isEmpty(_)||o.executeAtomicCommand(new p({note:o._note,blocks:_})),o._insertedRemainedBlocks(m,y),n},_insertedRemainedBlocks:function(e,t){var n=this;a.isEmpty(n._insertedBlocks)||(l.isListItem(n._insertedBlocks[0])&&l.isListItem(e)&&n._rebuildListItems(n._insertedBlocks,e,t),n.executeAtomicCommand(new u({note:n._note,newBlks:n._insertedBlocks,preBlk:e})))},_rebuildListItems:function(e,t,n){var o,i,r=e[0],s=0;isNaN(n)&&(n=0),i=r.listId,o=t.getOwnerList(),s=t.getLevel()-r.getLevel()+n,a.chain(e).groupBy(function(e){if(l.isListItem(e))return e.listId}).each(function(e,t){e.length>0&&t===i&&a.each(e,function(e){0!==s&&e.setLevel(e.getLevel()+s),e.setOwnerList(o)})})},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties.cmdJSON,i=n.collabProperties.coreEditor;t.__super__.fromCollabJSON.apply(e),o&&(e._newEndBlankParaId=o.newEndBlkId,e._insertedBlocks=[],a.each(o.insertedBlocks,function(t){e._insertedBlocks.push(m.buildBlockFromJSON(t,i))}))},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n&&(n.newEndBlkId=e._newEndBlankParaId,n.insertedBlocks=e._insertedBlocksJSON),n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(0),i=n(80),r=n(4),a=n(51),l=n(60),s=n(6),c=n(11),u=n(21),d=n(3);return t=i.extend({name:"comp.InsertCatalogue",_cmdArgs:null,_note:null,_blkId:null,_ownerId:null,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args||{},t.__super__.initialize.apply(e,arguments),e._initBlocks()},_initBlocks:function(){var e,t,n=this,i=n._note,r=i.blocks,u=[],p=[];n._ownerId=n._ownerId||d.newGUID(),t=new l({id:n._ownerId}),o.each(r,function(e){c.isForCatalogueBlock(e)&&u.push(e)}),n._catalogueIds=n._catalogueIds||[],o.each(u,function(o,i){e=new a({indent:o.getLevel()-1,text:o.getText().toString().trim(),href:o.getId(),ownerList:t}),p.push(e),n._catalogueIds[i]?e.setId(n._catalogueIds[i]):n._catalogueIds[i]=e.getId()}),0===u.length&&(e=new a({indent:0,text:s.INSERT_BLANK_CATALOGUE_TEXT,ownerList:t}),p.push(e),n._catalogueIds[0]?e.setId(n._catalogueIds[0]):n._catalogueIds[0]=e.getId()),n._newCatalogues=p},insertResource:function(e,t,n){var i=this,r=i._newCatalogues,a=r[r.length-1];return o.each(r,function(t){c.setResourceBlockStyleByPreBlock(t,e)}),r.length<1?e:(t&&r.unshift(t),n&&r.push(n),i.executeAtomicCommand(new u({note:i._note,newBlks:r,preBlk:e})),a)},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),n&&(e._ownerId=n.listId,e._catalogueIds=n.blockIds)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e&&(e.listId=n._ownerId,e.blockIds=n._catalogueIds),e}}),r.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(11),r=n(4),a=n(14),l=n(26),s=n(3),c=n(2);return t=o.extend({name:"comp.InsertHeading",_cmdArgs:null,_note:null,_blkId:null,_level:null,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args||{},e._level=e._cmdArgs.level,t.__super__.initialize.apply(e,arguments),s.isCollabCommand(e._cmdArgs)||(e._blkId=s.newGUID())},apply:function(){var e,t,n,o=this,r=o._cmdArgs.range,s=r.getStartBlockRange(),u=r.getEndBlockRange(),d=s.block,p=u.block;if(r.isInMultiBlock())n=o._note.getInterBlocks(d,p,!0),n.forEach(function(i,r){return 0===r?void(e=o._helpSetBlock(i)):r===n.length-1?void(t=o._helpSetBlock(i)):void o._helpSetBlock(i)}),o.setEndingRange(new a({startRange:l.createRangeByBlock({block:e,start:s.start,end:s.end}),endRange:l.createRangeByBlock({block:t,start:u.start,end:u.end})}));else{if(!c.isTextBlock(p))return!1;t=o._helpSetBlock(p),i.setTextBlockAsEndingRange(o,t,u.start,u.end)}},_helpSetBlock:function(e){var t=this;return c.isTextBlock(e)?"default"===t._level||c.isHeading(e)&&e.getLevel()===t._level?i.replaceBlockWithParagraph(t,t._note,e,e.getText(),""):i.replaceBlockWithHeading(t,t._note,e,e.getText(),t._level):e},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),n&&(e._blkId=n.blockId,e._level=n.listType)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e&&(e.blockId=n._blkId,e.listType=n._level),e}}),r.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(80),i=n(4),r=n(73),a=n(21),l=n(3);return t=o.extend({name:"comp.InsertHorizontalRule",_cmdArgs:null,_note:null,_hLineBlkId:null,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args||{},t.__super__.initialize.apply(e,arguments),l.isCollabCommand(e._cmdArgs)||(e._hLineBlkId=l.newGUID())},insertResource:function(e,t,n){var o,i,l=this,s=[];return o=new r,o.setId(l._hLineBlkId),i=e.getBlockStyles(),i["back-color"]&&o.setBlockStyle("back-color",i["back-color"]),i.padding&&o.setBlockStyle("padding",i.padding),t&&s.push(t),s.push(o),n&&s.push(n),l.executeAtomicCommand(new a({note:l._note,newBlks:s,preBlk:e})),o},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),n&&(e._hLineBlkId=n.newBlkId)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e&&(e.newBlkId=n._hLineBlkId),e}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(80),i=n(4),r=n(2),a=n(65),l=n(61),s=n(21),c=n(67),u=n(3);return t=o.extend({name:"comp.InsertImage",_cmdArgs:null,_note:null,_imgBlkId:null,_imgSrc:null,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args||{},t.__super__.initialize.apply(e,arguments),u.isCollabCommand(e._cmdArgs)||(e._imgBlkId=u.newGUID(),e._imgSrc=e._cmdArgs.src)},insertResource:function(e,t,n){var o,i,a=this,c=a._cmdArgs.range,u=[];return r.isTable(e)&&c.isSingleTableSelected()?a._insertImageInTable(e):(i=new l({source:a._imgSrc}),e&&(o=e.getBlockStyles(),o["back-color"]&&i.setBlockStyle("back-color",o["back-color"]),o.padding&&i.setBlockStyle("padding",o.padding)),t&&u.push(t),u.push(i),n&&u.push(n),i.setId(a._imgBlkId),a.executeAtomicCommand(new s({note:a._note,newBlks:u,preBlk:e})),i)},_insertImageInTable:function(e){var t,n=this,o=n._cmdArgs.range,i=o.getStartBlockRange(),r=i.getAsRectRange();if(r)return t=r.getFirstCellRect(),n.executeAtomicCommand(new c({table:e,cellRect:t,content:new a({source:n._imgSrc})})),e},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),n&&(e._imgBlkId=n.newBlkId,e._imgSrc=n.src)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e&&(e.newBlkId=n._imgBlkId,e.src=n._imgSrc),e}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(10),a=n(11),l=n(1),s=n(0),c=n(2),u=n(79),d=n(56),p=n(125),h=n(299),g=n(67),f=n(3);return t=o.extend({name:"comp.InsertLink",_cmdArgs:null,_note:null,_linkSrc:null,initialize:function(){var e,n,o,i=this;if(i._note=i.options.note,i._cmdArgs=i.options.args,t.__super__.initialize.apply(i,arguments),!f.isCollabCommand(i._cmdArgs)){if(e=i._cmdArgs.range,n=e.getStartBlockRange(),o=n.block,!i._cmdArgs.src)return void(i.isReadyToApply=!1);if(!c.isTable(o)){if(!e||!e.canDrawedByNative())return l.error(i.name+":note range should NOT be null or cannot be Drawed by native"),void(i.isReadyToApply=!1);if(e.isInMultiBlock()||!c.isTextBlock(o))return i.isReadyToApply=!1,void l.error("Cannot be executed in multi-selected blocks or non-text blocks:",i.name)}i._linkSrc=u.completeUrl(i._cmdArgs.src||""),i._linkStyles=i._cmdArgs.styles||{}}},apply:function(){var e,t,n,o,i,u=this,g=u._cmdArgs.range,f=s.extend(u._linkStyles,{color:"#003884",underline:!0,href:u._linkSrc});return(e=g.getStartBlockRange())?(t=e.block,c.isTable(t)?(u._setTableBlock(f,g),void u.setEndingRange(g)):c.isCatalogue(t)?(0===t.getLength()?(n=new r({text:u._linkSrc}),o=n.getLength(),u.executeAtomicCommand(new d({block:t,start:e.start,text:n})),u.executeAtomicCommand(new h({block:t,href:u._linkSrc})),a.setTextBlockAsEndingRange(u,t,o,o)):(u.executeAtomicCommand(new h({block:t,href:u._linkSrc})),u.setEndingRange(g)),!0):(e.isCollapsed()?(n=new r({text:u._linkSrc}),o=n.getLength(),n.setStyle(0,o,"href",u._linkSrc),s.each(f,function(e,t){n.setStyle(0,o,t,e)}),i=e.start+o,u.executeAtomicCommand(new d({block:t,start:e.start,text:n})),a.setTextBlockAsEndingRange(u,t,i,i)):(f.href=u._linkSrc,u.executeAtomicCommand(new p({blocks:[t],styleNameValues:f,start:e.start,end:e.end})),u.setEndingRange(g)),!0)):(l.error(u.name+":startBlockRange should not be null"),!1)},_setTableBlock:function(e,t){var n=this,o=n._linkSrc,i=t.getStartBlockRange(),a=i.block,l=i.getAsRectRange();l&&l.forEach(function(t,i){var l,s,c,u,d;c=a.getCell(t,i),c.isMergedCell()||(l=c.getContent(t,i),c.isTextNoEmptyCell()&&(s=l.toRichText(),d=s.getLength()),d=d||o.length,u=s||new r({text:o}),u.setStyles(0,d,e),n.executeAtomicCommand(new g({table:a,content:u,cellRect:{row:t,col:i}})))})},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),o&&(e._linkSrc=o.src,e._linkStyles=o.inlineStyles)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n&&(n.src=e._linkSrc,n.inlineStyles=e._linkStyles),n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(3);return t=o.extend({name:"atom.SetCatalogueHref",_href:null,_block:null,_oldHref:null,initialize:function(){var e=this,n=e.options,o=n.args;r.isCollabCommand(o)||(e._block=n.block||o.block,e._href=n.href||o.href),t.__super__.initialize.apply(e,arguments)},apply:function(){var e=this,t=e._href,n=e._block;n.setHref&&(e._oldHref=n.getHref(),n.setHref(t))},doUnapply:function(){var e=this;e._block.setHref(e._oldHref)},getEndingRange:function(){return this.options.args.range},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._block=e.getBlockById(r.blockId),n._href=r.styleNameValues,n._oldHref=r.oldStyleNameValues)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e&&(e.blockId=n._block.getId(),e.styleNameValues=n._href,e.oldStyleNameValues=n._oldHref),e}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(11),a=n(1),l=n(2),s=n(0),c=n(14),u=n(26),d=n(33),p=n(34),h=n(23),g=n(21),f=n(301),m=n(3);return t=o.extend({name:"comp.InsertList",_cmdArgs:null,_note:null,_listType:null,_listId:null,initialize:function(){var e,n,o=this;if(o._note=o.options.note,o._cmdArgs=o.options.args,e=o._cmdArgs.range,t.__super__.initialize.apply(o,arguments),!m.isCollabCommand(o._cmdArgs)){if(!e)return o.isReadyToApply=!1,void a.error(o.name+":note range should NOT be null");if(n=e.getStartBlockRange().block,e.isInSingleBlock()&&!l.isTextBlock(n))return o.isReadyToApply=!1,void a.error("Single Block must be text block:",o.name,e);if(e.isInSingleBlock()&&l.isListItem(n)&&s.some(n.getOwnerList().getItems(),function(e){return e.isLocked()}))return void(o.isReadyToApply=!1);o._listType=o._cmdArgs.type,o._listId=m.newGUID()}},apply:function(){var e=this;return e._cmdArgs.range.isInSingleBlock()?e._handleSingleBlockSelection():e._handleMultiBlockSelection(),!0},_handleMultiBlockSelection:function(){var e,t,n,o,i,a,f,m,_=this,y=_._cmdArgs.range,v=y.getStartBlockRange(),b=v.block,k=_._note.getPreBlock(b),C=y.getEndBlockRange(),S=C.block,I=_._note.getInterBlocks(b,S,!0),w=[],E=!0;for(o=0;o<I.length;++o)if(e=I[o],l.isListItem(e)){if(t=e.getOwnerList(),n&&n.getId()!==t.getId()){E=!1;break}n=t}else if(l.isTextBlock(e)){E=!1;break}E&&n.getType()===_._listType?s.each(I,function(e){"getLevel"in e&&e.getLevel()&&e.setBlockStyle("indent",e.getLevel()-1),l.isTextBlock(e)?w.push(r.createNewParagraph(e,e.getId(),e.getText())):w.push(e)}):(a=l.isListItem(k)&&k.getType()===_._listType?k.getOwnerList():new d({type:_._listType,listId:_._listId}),s.each(I,function(e){e.resetLockState(),l.isTextBlock(e)?l.isListItem(e)?(i=new p({id:e.getId(),level:e.getLevel(),list:a,text:e.getText()}),i.setBlockStyles(e.getBlockStyles()),w.push(i)):(i=new p({id:e.getId(),level:1,list:a,text:e.getText()}),i.setBlockStyles(e.getBlockStyles()),f=i.getBlockStyle("indent")||0,m=i.getBlockStyle("text-indent")||0,0!==f&&(i.setLevel(f+i.getLevel()),i.setBlockStyle("indent",0)),0!==m&&(i.setLevel(m+i.getLevel()),i.setBlockStyle("text-indent",0)),w.push(i)):w.push(e)})),s.isEmpty(w)||(_.executeAtomicCommand(new h({note:_._note,blocks:I})),_.executeAtomicCommand(new g({note:_._note,newBlks:w,preBlk:k})),l.isTextBlock(v.block)&&(v=u.createRangeByBlock({block:w[0],start:v.start,end:v.end})),C=w.length>1&&l.isTextBlock(C.block)?u.createRangeByBlock({block:s.last(w),start:C.start,end:C.end}):v,y=c.create({startRange:v,endRange:C})),_.setEndingRange(y)},_handleSingleBlockSelection:function(){var e,t,n,o,i=this,a=i._cmdArgs.range,s=a.getStartBlockRange(),c=s.block;l.isListItem(c)?(n=c.getOwnerList(),n.getType()!==i._listType?(i.executeAtomicCommand(new f({lists:[n],isToggle:!0})),i.setEndingRange(a)):(o=r.replaceBlockWithParagraph(i,i._note,c,c.getText()),r.setTextBlockAsEndingRange(i,o,o.getLength(),o.getLength()))):(e=i._note.getPreBlock(c),t=i._note.getNextBlock(c),e&&l.isListItem(e)&&e.getOwnerList().getType()===i._listType?o=r.replaceBlockWithListItem(i,i._note,e,c,c.getText(),e):t&&l.isListItem(t)&&t.getOwnerList().getType()===i._listType?o=r.replaceBlockWithListItem(i,i._note,t,c,c.getText(),e):(n=new d({type:i._listType,listId:i._listId}),o=new p({id:c.getId(),level:1,list:n,text:c.getText()}),o.setBlockStyles(c.getBlockStyles()),i.executeAtomicCommand(new h({note:i._note,blocks:[c]})),i.executeAtomicCommand(new g({note:i._note,newBlks:[o],preBlk:e}))),r.setTextBlockAsEndingRange(i,o,o.getLength(),o.getLength()))},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),o&&(e._listId=o.listId,e._listType=o.listType)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n&&(n.listId=e._listId,n.listType=e._listType),n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(0),a=n(33),l=n(2),s=n(3);return t=o.extend({name:"atom.SetListType",_lists:null,_newTypes:null,_oldTypes:null,initialize:function(){var e=this,n=e.options,o=n.args;t.__super__.initialize.apply(e),s.isCollabCommand(o)||(e._lists=n.lists,e._newTypes={},n.newType?r.each(e._lists,function(t,o){e._newTypes[o]=n.newType}):n.isToggle&&r.each(e._lists,function(t,n){e._newTypes[n]=t.isOrdered()?a.UNORDERED:a.ORDERED}))},apply:function(){var e=this;return e._oldTypes={},r.each(e._newTypes,function(t,n){e._oldTypes[n]=e._lists[n].getType(),t!==e._lists[n].getType()&&e._lists[n].setType(t)}),!0},doUnapply:function(){var e=this;return r.each(e._oldTypes,function(t,n){e._lists[n].getType()!==t&&e._lists[n].setType(t)}),!0},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties.cmdJSON;i&&(e=o.collabProperties.coreEditor.getNote(),i.dataBefore&&(n._oldTypes=i.dataBefore),n._newTypes=i.dataAfter,n._lists=n._getListByIds(e,i.listId)),t.__super__.fromCollabJSON.apply(n)},toCollabJSON:function(){var e=this,n=[],o=t.__super__.toCollabJSON.apply(e);return e._oldTypes&&(o.dataBefore=e._oldTypes),o.dataAfter=e._newTypes,r.each(e._lists,function(e){n.push(e.getId())}),o.listId=n,o},_getListByIds:function(e,t){var n=[];return r.some(e.getAllBlocks(),function(e){return l.isListItem(e)&&e.getOwnerList()&&r.contains(t,e.getOwnerList().getId())&&n.push(e.getOwnerList()),n.length===t.length}),n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(80),i=n(4),r=n(63),a=n(21),l=n(3),s=n(78),c=n(11);return t=o.extend({name:"comp.InsertTable",_cmdArgs:null,_note:null,_tableBlkId:null,_columnNums:null,_rowNums:null,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args||{},t.__super__.initialize.apply(e,arguments),l.isCollabCommand(e._cmdArgs)||(e._tableBlkId=l.newGUID(),e.skipBlockLocking=!0,e._columnNums=1,e._rowNums=1,e._cmdArgs.cols&&(e._columnNums=e._cmdArgs.cols),e._cmdArgs.rows&&(e._rowNums=e._cmdArgs.rows))},insertResource:function(e,t,n){var o,i=this,l=[];return o=r.createBlankTable(i._columnNums,i._rowNums,i._tableBlkId,s.DEFAULT_TABLE_WIDTH),c.setResourceBlockStyleByPreBlock(o,e),t&&l.push(t),l.push(o),n&&l.push(n),i.executeAtomicCommand(new a({note:i._note,newBlks:l,preBlk:e})),o},_initArray:function(e,t){for(var n=[];e--;)n[e]=t;return n},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),n&&(e._tableBlkId=n.newBlkId,e._columnNums=n.colNums,e._rowNums=n.rowNums)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e&&(e.newBlkId=n._tableBlkId,e.colNums=n._columnNums,e.rowNums=n._rowNums),e}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(26),a=n(14),l=n(21),s=n(23),c=n(3),u=n(11),d=n(2);return t=o.extend({name:"comp.InsertTodo",_cmdArgs:null,_note:null,_todoBlkId:null,_checked:!1,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args||{},t.__super__.initialize.apply(e,arguments),c.isCollabCommand(e._cmdArgs)||(e._todoBlkId=c.newGUID(),e._checked=e._cmdArgs.checked)},apply:function(){var e,t,n,o,i=this,l=i._cmdArgs.range,s=l.getStartBlockRange(),c=l.getEndBlockRange(),p=s.block,h=c.block;l.isInMultiBlock()?(o=i._note.getInterBlocks(p,h,!0),n=o.every(function(e){return d.isTodo(e)||!d.isTextBlock(e)}),o.forEach(function(r,a){return 0===a?void(e=i._helpSetBlock(r,n)):a===o.length-1?void(t=i._helpSetBlock(r,n)):void i._helpSetBlock(r,n)}),s=r.createRangeByBlock({block:e,start:s.start,end:s.end}),c=r.createRangeByBlock({block:t,start:c.start,end:c.end}),l=a.create({startRange:s,endRange:c}),i.setEndingRange(l)):(t=i._helpSetBlock(h,!0),u.setTextBlockAsEndingRange(i,t,c.start,c.end))},_helpSetBlock:function(e,t){var n,o,i=this,r=i._note,a=e.getId();return d.isTodo(e)?t&&(n=u.replaceBlockWithParagraph(i,i._note,e,e.getText())):d.isTextBlock(e)&&(o=r.getPreBlock(e),n=u.createNewTodo(e,{id:a,text:e.getText(),checked:i._checked}),i.executeAtomicCommand(new s({note:r,blocks:[e]})),i.executeAtomicCommand(new l({note:r,newBlks:[n],preBlk:o}))),n},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),n&&(e._todoBlkId=n.newBlkId,e._checked=n.simpleValue1)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e&&(e.newBlkId=n._todoBlkId,e.simpleValue1=n._checked),e}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(26),a=n(14),l=n(21),s=n(23),c=n(3),u=n(11),d=n(2);return t=o.extend({name:"comp.InsertQuote",_cmdArgs:null,_note:null,_quoteBlkId:null,_checked:!1,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args||{},t.__super__.initialize.apply(e,arguments),c.isCollabCommand(e._cmdArgs)||(e._quoteBlkId=c.newGUID())},apply:function(){var e,t,n,o,i=this,l=i._cmdArgs.range,s=l.getStartBlockRange(),c=l.getEndBlockRange(),p=s.block,h=c.block;l.isInMultiBlock()?(o=i._note.getInterBlocks(p,h,!0),n=o.every(function(e){return d.isQuote(e)}),o.forEach(function(r,a){return 0===a?void(e=i._helpSetBlock(r,n)):a===o.length-1?void(t=i._helpSetBlock(r,n)):void i._helpSetBlock(r,n)}),s=r.createRangeByBlock({block:e,start:s.start,end:s.end}),c=r.createRangeByBlock({block:t,start:c.start,end:c.end}),l=a.create({startRange:s,endRange:c}),i.setEndingRange(l)):(t=i._helpSetBlock(h,!0),u.setTextBlockAsEndingRange(i,t,c.start,c.end))},_helpSetBlock:function(e,t){var n,o,i=this,r=i._note,a=e.getId();return d.isQuote(e)?t&&(n=u.replaceBlockWithParagraph(i,i._note,e,e.getText())):d.isTextBlock(e)&&(o=r.getPreBlock(e),n=u.createNewQuote(e,{id:a,text:e.getText(),checked:i._checked}),i.executeAtomicCommand(new s({note:r,blocks:[e]})),i.executeAtomicCommand(new l({note:r,newBlks:[n],preBlk:o}))),n},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),n&&(e._quoteBlkId=n.newBlkId)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e&&(e.newBlkId=n._quoteBlkId),e}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(1),a=n(2),l=n(11),s=n(23),c=n(47),u=n(56),d=n(126),p=n(99),h=n(79),g=n(55),f=n(3);return t=o.extend({name:"comp.KeyBackspace",_cmdArgs:null,_note:null,initialize:function(){var e,n,o,i=this;if(i._note=i.options.note,i._cmdArgs=i.options.args,i._inlineStyles=i._cmdArgs.inlineStyles,t.__super__.initialize.apply(i),!f.isCollabCommand(i._cmdArgs)){if(e=i._cmdArgs.range,n=e.getStartBlockRange(),o=n.block,!e)return i.isReadyToApply=!1,void r.error(i.name+":note range should NOT be null");if(e.isInSingleBlock()&&a.isTable(o))return i.isReadyToApply=!1,void r.error("should NOT trigger the cmd when in Table.")}},apply:function(){var e,t,n,o,i,r,c,d,p=this,h=p._cmdArgs.range,f=[];return e=h.getStartBlockRange(),t=e.block,t,n=h.getEndBlockRange(),o=n.block,i=o,r=p._note.getPreBlock(t),d=p._cmdArgs.inlineStyles,h.isCollapsed()||l.deleteSelectedContent(p,p._note,h),h.isCollapsed()&&a.isTextBlock(t)?0===e.start?p._deleteAtTextBlockStart(r,t,d):p._deleteAtTextBlockMiddle(t,e.start):h.isInSingleBlock()&&a.isTextBlock(t)?(l.setTextBlockAsEndingRange(p,t,e.start,e.start),!0):(a.isTextBlock(t)||(r&&!a.isTable(r)?(f.push(t),i=r,a.isTextBlock(r)&&(c=r.getLength())):(i=l.replaceBlockWithParagraph(p,p._note,t,""),c=0)),h.isInMultiBlock(o)&&(a.isTextBlock(o)?a.isTextBlock(t)?(p.executeAtomicCommand(new u({block:t,start:t.getLength(),text:o.getText()})),f.push(o),c=e.start,i=t):(c=0,i=o):f.push(o)),f.length>0&&p.executeAtomicCommand(new s({note:p._note,blocks:f})),a.isTextBlock(i)?l.setTextBlockAsEndingRange(p,i,c,c):p.setEndingRange(g.buildNoteRangeFromNonTextBlock(i)),!0)},_deleteAtTextBlockStart:function(e,t,n){var o,i,r,c=this;return a.isListItem(t)?(t.getIndex()>0&&t.getLevel()>1?c.executeAtomicCommand(new p({listItems:[t],newLevel:t.getLevel()-1})):t=l.replaceBlockWithParagraph(c,c._note,t,t.getText(),n),l.setTextBlockAsEndingRange(c,t,0,0),!0):a.isTodo(t)?(t=l.replaceBlockWithParagraph(c,c._note,t,t.getText(),n),l.setTextBlockAsEndingRange(c,t,0,0),!0):(i=t.getBlockStyle("text-indent"))&&i>0?(c.executeAtomicCommand(new d({blocks:[t],styleNameValues:{"text-indent":i-1}})),l.setTextBlockAsEndingRange(c,t,0,0),!0):(o=t.getBlockStyle("indent"))&&o>0?(c.executeAtomicCommand(new d({blocks:[t],styleNameValues:{indent:o-1}})),l.setTextBlockAsEndingRange(c,t,0,0),!0):e?a.isTextBlock(e)?(r=e.getLength(),c.executeAtomicCommand(new u({block:e,start:e.getLength(),text:t.getText()})),c.executeAtomicCommand(new s({note:c._note,blocks:[t]})),l.setTextBlockAsEndingRange(c,e,r,r),!0):(a.isHr(e)?(c.executeAtomicCommand(new s({note:c._note,blocks:[e]})),l.setTextBlockAsEndingRange(c,t,0,0)):c.setEndingRange(g.buildNoteRangeFromNonTextBlock(e)),!0):(l.setTextBlockAsEndingRange(c,t,0,0),!0)},_deleteAtTextBlockMiddle:function(e,t){var n=this;if(h.isAtHrefBorder(e,t,!0))return void n._deleteHrefAtCursorPos(e,t);n.executeAtomicCommand(new c({block:e,start:t-1,end:t,inlineStyles:n._inlineStyles})),l.setTextBlockAsEndingRange(n,e,t-1,t-1)},_deleteHrefAtCursorPos:function(e,t){var n,o=this;-1!==(n=h.findHrefBorder(e,t,!0))&&l.deleteHref(o,e,n,t)},isSingleBlockAffected:function(){var e,n=this,o=n._args.range,i=t.__super__.isSingleBlockAffected.apply(n),r=0;return i&&o.isCollapsed()&&(e=o.getStartBlockRange(),r=e.start,n._note.getPreBlock(e.block)&&0===r&&(i=!1)),i}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(158),i=n(4),r=n(1),a=n(2),l=n(3);return t=o.extend({name:"comp.KeyDelete",_cmdArgs:null,_note:null,initialize:function(){var e,n,o,i,s,c=this;if(c._note=c.options.note,c._cmdArgs=c.options.args,t.__super__.initialize.apply(c),!l.isCollabCommand(c._cmdArgs)){if(e=c._cmdArgs.range,n=e.getStartBlockRange(),i=n.block,o=e.getEndBlockRange(),s=o.block,!e)return c.isReadyToApply=!1,void r.error(c.name+":note range should NOT be null");if(e.isInSingleBlock()&&a.isTable(i))return c.isReadyToApply=!1,void r.error("should NOT trigger the cmd when in Table.");if(e.isInSingleBlock()&&a.isTextBlock(i)&&e.isCollapsed()&&n.start===i.getLength()&&!c._note.getNextBlock(i))return c.isReadyToApply=!1,void r.warn("do NOT support the command at the end of note:",c.name);a.isTextBlock(s)&&o.end===s.getLength()&&a.isCatalogue(c._note.getNextBlock(s))&&(c.isReadyToApply=!1,r.warn("do NOT support when next is Catalogue block."))}},isSingleBlockAffected:function(){var e,n,o=this,i=o._args.range,r=t.__super__.isSingleBlockAffected.apply(o),a=0;return r&&i.isCollapsed()&&(n=i.getStartBlockRange(),e=n.block,a=n.start,o._note.getNextBlock(e)&&a===e.getEndOffset()&&(r=!1)),r},isValidStartNoteRange:function(){var e,t,n=this,o=!0;return e=n.getStartingRange(),e&&e.isInSingleBlock()&&(t=e.getStartBlockRange().block,a.isTable(t)&&(o=!1)),o}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(1),a=n(0),l=n(2),s=n(11),c=n(21),u=n(47),d=n(23),p=n(99),h=n(79),g=n(3);return t=o.extend({name:"comp.KeyEnter",_note:null,_cmdArgs:null,_newBlkId:null,initialize:function(){var e,n,o,i=this;if(i._note=i.options.note,i._cmdArgs=i.options.args,t.__super__.initialize.apply(i),!g.isCollabCommand(i._cmdArgs)){if(e=i._cmdArgs.range,n=e.getStartBlockRange(),o=n.block,!e)return i.isReadyToApply=!1,void r.error(i.name+":note range should NOT be null");if(e.isInSingleBlock()&&l.isTable(o))return i.isReadyToApply=!1,void r.error("should NOT trigger the cmd when in Table.");i._newBlkId=g.newGUID()}},apply:function(){var e,t,n,o,i,r,c,d=this,p=d._cmdArgs.range,g=!1,f=[];return e=p.getStartBlockRange(),t=e.block,r=t,n=p.getEndBlockRange(),o=n.block,c=o,p.isCollapsed()||s.deleteSelectedContent(d,d._note,p),l.isTextBlock(t)&&(l.isCatalogue(t)||(r=s.createNewParagraph(t,t.getId(),t.getText()),h.isAtHrefBorder(r,e.start,!0)&&s.deleteHref(d,r,0,t.getLength())),s.recogLink(d,t,0,t.getLength())),p.isInMultiBlock()?(l.isTextBlock(t)||(r=s.replaceBlockWithParagraph(d,d._note,t,"")),l.isTextBlock(o)||(c=s.replaceBlockWithParagraph(d,d._note,o,"")),l.isListItem(r)?c=d._replaceBlockWithListItem(c,r,c.getText()):l.isTextBlock(r)&&l.isListItem(c)&&(c=s.replaceBlockWithParagraph(d,d._note,c,c.getText())),s.setTextBlockAsEndingRange(d,c,0,0),!0):(l.isTextBlock(t)?(i=t.sliceText(e.start,t.getLength()),d.executeAtomicCommand(new u({block:t,start:e.start,end:t.getLength()}))):r=s.replaceBlockWithParagraph(d,d._note,t,""),l.isListItem(t)?t.isEmpty()&&0===i.getLength()?(r=d._reduceListItemLevel(t),c=r):(c=d._insertListItem(t,d._newBlkId,i,d._cmdArgs.inlineStyles),g=!0):(c=l.isHeading(t)?i.toString().length>0?d._insertHeading(r,d._newBlkId,i,t.getLevel()):d._insertParagraph(r,d._newBlkId,i):l.isCatalogue(t)?d._insertCatalogueHelp(r,{startBlock:t,paraId:d._newBlkId,text:i}):l.isTodo(t)?t.isEmpty()&&0===i.getLength()?s.replaceBlockWithParagraph(d,d._note,t,""):d._insertTodo(r,{startBlock:t,id:d._newBlkId,text:i,checked:!1,inlineStyles:d._cmdArgs.inlineStyles}):d._insertParagraph(r,d._newBlkId,i,d._cmdArgs.inlineStyles),g=!0),s.setTextBlockAsEndingRange(d,c,0,0),a.each(d._note.getInterBlocks(t,o,!0),function(e){f.push(e.getId())}),g&&f.push(d._newBlkId),d.pushAffectedBlockIds(f),!0)},_insertListItem:function(e,t,n,o){var i,r=this;return i=s.createNewListItem(e,t,n),s.setBlockStyle(i,o),r.executeAtomicCommand(new c({note:r._note,newBlks:[i],preBlk:e})),i},_insertParagraph:function(e,t,n,o){var i,r=this;if(i=s.createNewParagraph(e,t,n,!o))return o&&s.setBlockStyle(i,o),r.executeAtomicCommand(new c({note:r._note,newBlks:[i],preBlk:e})),i},_insertHeading:function(e,t,n,o){var i,r=this;return i=s.createNewHeading(e,t,n,o,!0),r.executeAtomicCommand(new c({note:r._note,newBlks:[i],preBlk:e})),i},_insertTodo:function(e,t){var n,o=this;return n=s.createNewTodo(e,t),s.setBlockStyle(n,t.inlineStyles),o.executeAtomicCommand(new c({note:o._note,newBlks:[n],preBlk:e})),n},_insertCatalogueHelp:function(e,t){var n=this,o=t.startBlock;return t.text.getLength()<1?t.href="":t.href=o.getHref(),n._insertCatalogue(e,t)},_insertCatalogue:function(e,t){var n,o=this;return n=s.createNewCatalogue(e,t),o.executeAtomicCommand(new c({note:o._note,newBlks:[n],preBlk:e})),n},_reduceListItemLevel:function(e){var t=this,n=e;return e.getLevel()<=1?n=s.replaceBlockWithParagraph(t,t._note,e,""):t.executeAtomicCommand(new p({listItems:[e],newLevel:e.getLevel()-1})),n},_replaceBlockWithListItem:function(e,t,n){var o=this;return o.executeAtomicCommand(new d({note:o._note,blocks:[e]})),o._insertListItem(t,e.getId(),n,o._cmdArgs.inlineStyles)},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),o&&(e._newBlkId=o.newBlkId)},isSingleBlockAffected:function(){return!1},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.newBlkId=e._newBlkId,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(1),a=n(2),l=n(11),s=n(47),c=n(99),u=n(3);return t=o.extend({name:"comp.KeyTab",_cmdArgs:null,_note:null,_withShiftKey:!1,initialize:function(){var e,n,o,i=this;if(i._note=i.options.note,i._cmdArgs=i.options.args,t.__super__.initialize.apply(i),!u.isCollabCommand(i._cmdArgs)){if(e=i._cmdArgs.range,i._cmdArgs.withShiftKey&&(i._withShiftKey=!0),!e||!e.canDrawedByNative())return r.error(i.name+":note range should NOT be null"),void(i.isReadyToApply=!1);if(n=e.getStartBlockRange(),o=n.block,e.isInSingleBlock()&&!a.isTextBlock(o))return void(i.isReadyToApply=!1)}},apply:function(){var e,t,n,o,i,r,s,u=this,d=u._cmdArgs.range,p=1;if(e=d.getStartBlockRange(),t=e.block,n=d.getEndBlockRange(),o=n.block,u._withShiftKey&&(p=-1),(r=d.isInMultiBlock())||0===e.start&&e.end===t.getLength())return s=!r,i=u._note.getInterBlocks(t,o,!0),l.isInSameList(i)?u._isFirstListItem(i[0])?l.updateBlocksIndentLevel(u,i[0].getOwnerList().getItems(),p):u.executeAtomicCommand(new c({listItems:i,deltaLevel:p})):u._withShiftKey&&s?t.getBlockStyle("text-indent")?u._updateBlockTextIndent(t,p):l.updateBlocksIndentLevel(u,[t],p):s&&0===e.end?u._updateBlockTextIndent(t,p):l.updateBlocksIndentLevel(u,i,p),u.setEndingRange(d),!0;0===e.start?a.isListItem(t)?u._isFirstListItem(t)?(l.updateBlocksIndentLevel(u,t.getOwnerList().getItems(),p),u.setEndingRange(d)):(u.executeAtomicCommand(new c({listItems:[t],deltaLevel:p})),u.setEndingRange(d)):u._withShiftKey?t.getBlockStyle("text-indent")?u._updateBlockTextIndent(t,p):(l.updateBlocksIndentLevel(u,[t],p),u.setEndingRange(d)):u._updateBlockTextIndent(t,p):u._withShiftKey?u._handleShiftTabNotAtStart(e):u._insertTabChar()},_handleShiftTabNotAtStart:function(e){var t,n,o,i,r=this,a=e.block,c=!0;for(t=a.getText().getReadOnlyData(),n=e.start,i=n-1;i>=0;i--)if("\t"!==t[i].char){if(" "!==t[i].char){c=!1;break}n-i==4&&(o=i)}else o||(o=i);c?(o=o||0,r.executeAtomicCommand(new s({block:a,start:o,end:n})),l.setTextBlockAsEndingRange(r,a,o,o)):r._insertTabChar()},_insertTabChar:function(){var e=this,t=e._cmdArgs.inlineStyles,n=e._cmdArgs.range,o=n.getStartBlockRange();l.deleteSelectedContent(e,e._note,n),l.insertTabChar(e,o.block,o.start,t),l.setTextBlockAsEndingRange(e,o.block,o.start+1,o.start+1)},_isFirstListItem:function(e){return 1===e.getLevel()&&1===e.getIndex()},_updateBlockTextIndent:function(e,t){var n=this;l.updateBlockTextIndentLevel(n,e,t),n.setEndingRange(n._cmdArgs.range)},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties.cmdJSON;o&&o.simpleValue1&&(e._withShiftKey=!0),t.__super__.fromCollabJSON.apply(e)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return e._withShiftKey&&(n.simpleValue1=!0),n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(10),a=n(11),l=n(1),s=n(2),c=n(23),u=n(56),d=n(67),p=n(3);return t=o.extend({name:"comp.KeyTextInput",_cmdArgs:null,_note:null,_inputtedText:null,_recogLink:!1,initialize:function(){var e,n=this;if(n._note=n.options.note,n._cmdArgs=n.options.args,e=n._cmdArgs.range,t.__super__.initialize.apply(n,arguments),!p.isCollabCommand(n._cmdArgs)){if(!e)return n.isReadyToApply=!1,void l.error(n.name+":note range should NOT be null");n._recogLink=n._cmdArgs.recogLink,n._inputtedText=n._cmdArgs.text}},apply:function(){var e,t,n,o,i,r,l,d,p=this,h=p._cmdArgs.range;return e=h.getStartBlockRange(),t=e.block,n=t,r=e.start,o=h.getEndBlockRange(),i=o.block,h.isInSingleBlock()&&s.isTable(t)?p._insertTextInTable(e,t,p._inputtedText):(h.isCollapsed()||a.deleteSelectedContent(p,p._note,h),s.isTextBlock(t)||(n=a.replaceBlockWithParagraph(p,p._note,t,""),r=0),h.isInMultiBlock()&&(s.isTextBlock(i)&&(d=i.getText()),p.executeAtomicCommand(new c({note:p._note,blocks:[i]}))),l=r+p._inputtedText.getLength(),d&&p._inputtedText.append(d),p.executeAtomicCommand(new u({block:n,start:r,text:p._inputtedText})),p._recogLink&&a.recogLink(p,n,0,r),a.setTextBlockAsEndingRange(p,n,l,l),!0)},_insertTextInTable:function(e,t,n){var o,i,r=this;(o=e.getAsRectRange())&&(i=o.getFirstCell(),r.executeAtomicCommand(new d({table:t,cellRect:{row:i.row,col:i.col},content:n})))},canBeMerged:function(e){var n,o,i,r=this;if(t.__super__.canBeMerged.apply(r,[e])){if(!r.startingRange||!e.getStartingRange())return!1;if(n=r.startingRange.getStartBlockRange(),i=e.getStartingRange().getStartBlockRange(),!e.getStartingRange().isCollapsed())return!1;if(r.isLocalExecutedCmd){if(!r.endingRange)return!1;if(o=r.endingRange.getEndBlockRange(),!s.isTextBlock(o))return!1;if(i.getBlockId()!==o.getBlockId())return!1;if(o.end!==i.start)return!1}else{if(n.getBlockId()!==i.getBlockId())return!1;if(n.start!==i.start)return!1}return" "!==e.getInputtedText().toString()}return!1},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),o&&(e._inputtedText=r.fromCollabJSON(o.richText),o.recogLink&&(e._recogLink=!0))},getInputtedText:function(){return this._inputtedText},mergeLocalCmd:function(e){var t,n,o=this,i=e.getInputtedText();o.endingRange&&(t=o.endingRange.getEndBlockRange()),i&&i.getLength()>0&&(o._inputtedText.append(i),o.isLocalExecutedCmd&&(n=t.end+i.getLength(),a.setTextBlockAsEndingRange(o,t.block,n,n)))},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n&&(n.richText=e._inputtedText.toCollabJSON(),e._recogLink&&(n.recogLink=e._recogLink)),n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(1),a=n(11);return t=o.extend({name:"comp.RemoveFormat",_note:null,_cmdArgs:null,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args,t.__super__.initialize.apply(e)},apply:function(){var e=this,t=e._cmdArgs.range;return!t||t.isCollapsed()?(r.error("collapsed时应该修改编辑器当前样式状态，不应进入此命令",t),!1):(a.resetAllStyles(e,e._note,t,e._args.blockStyles,e._args.inlineStyles,{resetAllStyles:e._args.resetAllStyles,isRemoveFormat:!0}),e.setEndingRange(t),!0)}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(0),a=n(312),l=n(3);return t=o.extend({name:"comp.ReplaceResource",_note:null,_cmdArgs:null,_resources:null,_resProps:null,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args,t.__super__.initialize.apply(e),l.isCollabCommand(e._cmdArgs)||(e._resources=e._cmdArgs.resources,e._resProps=e._cmdArgs.resProps,e.endingRange=e._cmdArgs.endingRange)},apply:function(){var e=this;return e.executeAtomicCommand(new a({resources:e._resources,newResProps:e._resProps}),e.endingRange),!0},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.coreEditor,o=e._cmdArgs.collabProperties.cmdJSON;o&&(e._resProps=o.simpleValue1,e._resources=[],r.each(o.resIds,function(t){e._resources.push(n.getBlockById(t))}),o.simpleValue2&&(e._cmdArgs.ignoreUndoRedo=!0),o.endNoteRange&&(e.endingRange=o.endNoteRange)),t.__super__.fromCollabJSON.apply(e)},isSingleBlockAffected:function(){return!1},toCollabJSON:function(){var e=this,n=[],o=t.__super__.toCollabJSON.apply(e);return o&&(r.each(e._resources,function(e){n.push(e.getId())}),o.simpleValue1=e._resProps,o.resIds=n,e._cmdArgs.ignoreUndoRedo&&(o.simpleValue2=!0),o.endNoteRange=e.endingRange),o}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(0),a=n(2),l=n(3);return t=o.extend({name:"atom.SetResourceProps",_resources:null,_newResProps:null,_oldResProps:null,initialize:function(){var e=this,n=e.options,o=n.args;t.__super__.initialize.apply(e),l.isCollabCommand(o)||(e._resources=n.resources,e._newResProps=n.newResProps)},apply:function(){var e=this;return e._oldResProps={},r.each(e._resources,function(t,n){e._oldResProps[n]={},a.isImage(t)?(e._newResProps[n].source&&(e._oldResProps[n].source=t.getSource(),t.setSource(e._newResProps[n].source)),r.isUndefined(e._newResProps[n].title)||(e._oldResProps[n].title=t.getTitle(),t.setTitle(e._newResProps[n].title))):a.isAttachment(t)&&(e._newResProps[n].source&&(e._oldResProps[n].source=t.getSource(),t.setSource(e._newResProps[n].source)),e._newResProps[n].resource&&(e._oldResProps[n].resource=t.getResource(),t.setResource(e._newResProps[n].resource)),e._newResProps[n].fileName&&(e._oldResProps[n].fileName=t.getFileName(),t.setFileName(e._newResProps[n].fileName)),e._newResProps[n].fileLength&&(e._oldResProps[n].fileLength=t.getFileLength(),t.setFileLength(e._newResProps[n].fileLength)))}),!0},doUnapply:function(){var e=this;return r.each(e._resources,function(t,n){a.isImage(t)?(e._oldResProps[n].source&&t.setSource(e._oldResProps[n].source),r.isUndefined(e._oldResProps[n].title)||t.setTitle(e._oldResProps[n].title)):a.isAttachment(t)&&(e._oldResProps[n].source&&t.setSource(e._oldResProps[n].src),e._oldResProps[n].resource&&t.setResource(e._oldResProps[n].resource),e._oldResProps[n].fileName&&t.setFileName(e._oldResProps[n].fileName),e._oldResProps[n].fileLength&&t.setFileLength(e._oldResProps[n].fileLength))}),!0},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties.cmdJSON;i&&(e=o.collabProperties.coreEditor.getNote(),i.dataBefore&&(n._oldResProps=i.dataBefore),n._newResProps=i.dataAfter,n._resources=n._getResByIds(e,i.resIds)),t.__super__.fromCollabJSON.apply(n)},toCollabJSON:function(){var e=this,n=[],o=t.__super__.toCollabJSON.apply(e);return e._oldResProps&&(o.dataBefore=e._oldResProps),o.dataAfter=e._newResProps,r.each(e._resources,function(e){n.push(e.getId())}),o.resIds=n,o},_getResByIds:function(e,t){var n=[];return r.some(e.getAllBlocks(),function(e){return r.contains(t,e.getId())&&n.push(e),t.length===n.length}),n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(0),i=n(9),r=n(4),a=n(2),l=n(11),s=n(51),c=n(60),u=n(10),d=n(6),p=n(23),h=n(21),g=n(3);return t=i.extend({name:"comp.RefreshCatalogue",_cmdArgs:null,_note:null,_ownerId:null,_delete:!1,_catalogueIds:null,_catalogues:null,_newCatalogues:null,_blankParaId:null,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args||{},e._ownerId=e._cmdArgs.ownerId,e._delete=e._cmdArgs.delete,t.__super__.initialize.apply(e,arguments),e._initBlocks()},_initBlocks:function(){var e,t,n=this,i=n._note,r=i.blocks,u=[],p=[],h=[];o.each(r,function(e){a.isCatalogue(e)&&e.getOwnerId()===n._ownerId&&u.push(e),l.isForCatalogueBlock(e)&&p.push(e)}),(u.length>0||!n._ownerId)&&(n._catalogueIds=n._catalogueIds||[],n._ownerId=n._ownerId||g.newGUID(),t=new c({id:n._ownerId}),o.each(p,function(o,i){e=new s({indent:o.getLevel()-1,text:o.getText().toString().trim(),href:o.getId(),ownerList:t}),h.push(e),n._catalogueIds[i]?e.setId(n._catalogueIds[i]):n._catalogueIds[i]=e.getId()}),0===p.length&&(e=new s({indent:0,text:d.INSERT_BLANK_CATALOGUE_TEXT,ownerList:t}),h.push(e),n._catalogueIds[0]?e.setId(n._catalogueIds[0]):n._catalogueIds[0]=e.getId())),n._catalogues=u,n._newCatalogues=h,(0===h.length||n._delete)&&(n._blankParaId=n._blankParaId||g.newGUID())},apply:function(){var e=this,t=e._catalogues,n=e._newCatalogues,i=t[t.length-1]||e.startingRange.getEndBlockRange().block,r=n[n.length-1];o.each(n,function(e){l.setResourceBlockStyleByPreBlock(e,i)}),e._blankParaId?(r=l.createNewParagraph(null,e._blankParaId,new u({text:""})),l.setResourceBlockStyleByPreBlock(r,i),e.executeAtomicCommand(new h({note:e._note,newBlks:[r],preBlk:i}))):e.executeAtomicCommand(new h({note:e._note,newBlks:n,preBlk:i})),t.length>0&&e.executeAtomicCommand(new p({note:e._note,blocks:e._note.getInterBlocks(t[0],t[t.length-1],!0)})),l.setTextBlockAsEndingRange(e,r,r.getLength(),r.getLength())},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(e),n&&(e._ownerId=n.listId,e._catalogueIds=n.blockIds,e._delete=n.simpleValue1,e._blankParaId=n.newBlkId)},toCollabJSON:function(){var e,n=this;return e=t.__super__.toCollabJSON.apply(n),e&&(e.listId=n._ownerId,e.blockIds=n._catalogueIds,e.simpleValue1=n._delete,e.newBlkId=n._blankParaId),e}}),r.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(3);return t=o.extend({_cmdArgs:null,_oldData:null,_content:null,_align:null,_headerFooter:null,name:"comp.SetHeaderFooter",initialize:function(e){var n=this;n._oldData={},n._cmdArgs=e.args,r.isCollabCommand(n._cmdArgs)||(n._content=n._cmdArgs.content,n._align=n._cmdArgs.align,n._headerFooter=n._cmdArgs.headerFooter),n.startingRange=e.args.range,n.endingRange=e.args.endingRange,t.__super__.initialize.apply(n)},apply:function(){var e=this,t=e._align,n=e._content,o=e._headerFooter;o&&(null!=t&&(e._oldData.align=o.getAlign()),null!=n&&(e._oldData.content=o.getContent(!1)),o.setContentAndStyle(n,t),e.effected=!0)},doReapply:function(){var e=this,t=e._align,n=e._content;e._headerFooter.setContentAndStyle(n,t)},doUnapply:function(){var e=this,t=e._headerFooter,n=e._oldData;n&&t.setContentAndStyle(n.content,n.align)},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties,o=n.cmdJSON,i=n.coreEditor.note;t.__super__.fromCollabJSON.apply(e),o&&(e._content=o.headerFooterInfo.content,e._align=o.headerFooterInfo.align,e._headerFooter=i.getHeaderFooter(o.headerFooterInfo.isFooter))},toCollabJSON:function(){var e,n=this,o=t.__super__.toCollabJSON.apply(n);return o&&(e={},e.content=n._content,e.align=n._align,e.isFooter=n._headerFooter.isFooter,o.headerFooterInfo=e),o}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(0),i=n(9),r=n(4),a=n(316),l=n(159),s=n(14),c=n(3);return t=i.extend({name:"comp.SetBlockProps",_cmdArgs:null,_note:null,_blocks:null,_props:null,updateSelectionDisabled:!0,initialize:function(){var e=this;e._note=e.options.note,e._cmdArgs=e.options.args,t.__super__.initialize.apply(e),c.isCollabCommand(e._cmdArgs)||(e._blocks=e._cmdArgs.blocks,e._props=e._cmdArgs.props)},apply:function(){var e=this,t=e._blocks[0],n=new l({block:t,start:t.getEndOffset(),end:t.getEndOffset()});return e.executeAtomicCommand(new a({blocks:this._blocks,props:this._props}),new s({startRange:n,endRange:n})),!0},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;n&&(e._blocks=[],o.each(n.blockIds,function(t){e._blocks.push(e._note.getBlockById(t))}),e._props=n.simpleValue1),t.__super__.fromCollabJSON.apply(e)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e),i=[];return o.each(e._blocks,function(e){i.push(e.getId())}),n.blockIds=i,n.simpleValue1=e._props,n}}),r.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){function t(e){return e.charAt(0).toUpperCase()+e.slice(1)}function o(e){return"set"+t(e)}function i(e){return"get"+t(e)}var r,a=n(18),l=n(4),s=n(0),c=n(3);return r=a.extend({name:"atom.SetBlockProps",_blocks:null,_oldPropsMap:{},_props:null,initialize:function(e){var t=this,n=t.options.args;t._oldPropsMap={},c.isCollabCommand(n)||(t._blocks=e.blocks,t._props=e.props),r.__super__.initialize.apply(t,arguments)},apply:function(){var e,t=this;s.each(t._blocks,function(n){e={},s.each(t._props,function(t,r){e[r]=n[i(r)](),n[o(r)](t)}),t._oldPropsMap[n.getId()]=e})},doUnapply:function(){var e,t=this;s.each(t._blocks,function(n){e=t._oldPropsMap[n.getId()],s.each(e,function(e,t){n[o(t)](e)})})},fromCollabJSON:function(){var e=this,t=e.options.args,n=t.collabProperties,o=n.cmdJSON;r.__super__.fromCollabJSON.apply(e),e._note=n.coreEditor.getNote(),o&&(e._blocks=[],s.each(o.blockIds,function(t){e._blocks.push(e._note.getBlockById(t))}),e._props=o.simpleValue1,e._oldPropsMap=o.simpleValue2)},toCollabJSON:function(){var e=this,t=r.__super__.toCollabJSON.apply(e),n=[];return s.each(e._blocks,function(e){n.push(e.getId())}),t.blockIds=n,t.simpleValue1=e._props,t.simpleValue2=e._oldPropsMap,t}}),l.add(r),r}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(318),a=n(3);return t=o.extend({name:"comp.SetTableCellsSize",_table:null,_sizes:null,initialize:function(){var e=this,n=e.options.args;a.isCollabCommand(n)||(e._table=n.table,e._sizes=n.sizes),t.__super__.initialize.apply(e)},apply:function(){var e=this,t=e._table,n=e._sizes;return!(n.length<1)&&(n.forEach(function(n){e.executeAtomicCommand(new r({table:t,size:n}))}),!0)},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._sizes=r.simpleValue1)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.simpleValue1=e._sizes,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(3);return t=o.extend({name:"atom.SetTableCellSize",_table:null,_size:null,_oldSize:null,effected:!1,initialize:function(){var e=this,n=e.options.args;this._oldSize={},t.__super__.initialize.apply(e),r.isCollabCommand(n)||(e._table=e.options.table,e._size=e.options.size)},apply:function(){var e=this._table,t=this._size;return null!=t.row&&(this._oldSize.row=t.row,this._oldSize.height=e.getRowHeight(t.row),e.setRowHeight(t.row,t.height),this.effected=!0),null!=t.col&&(this._oldSize.col=t.col,this._oldSize.width=e.getColumnWidth(t.col),e.setColumnWidth(t.col,t.width),this.effected=!0),this.effected},doUnapply:function(){var e=this._table,t=this._oldSize;null!=t.row&&e.setRowHeight(t.row,t.height),null!=t.col&&e.setColumnWidth(t.col,t.width)},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._size=r.simpleValue1,n._oldSize=r.simpleValue2)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.simpleValue1=e._size,n.simpleValue2=e._oldSize,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(11),a=n(43),l=n(76),s=n(160),c=n(3);return t=o.extend({name:"comp.InsertTableRowCol",_table:null,_rect:null,_cellsData:null,effected:!1,initialize:function(){var e,n=this,o=n.options.args;this._rect={},t.__super__.initialize.apply(n),c.isCollabCommand(o)||(this._cellsData=o.cellsData||[[]],this._sizes=o.sizes,e=o.range,e?n._transformRangeToData(e,o):(this._rect=o.rect,this._table=o.table))},_transformRangeToData:function(e,t){var n,o=e.getStartBlockRange(),i=o.getAsRectRange(),r=t.describe;i&&(n=i.getRect(),null!=r.row&&(this._rect.row=r.row===a.UP?n.top:n.top+n.height),null!=r.col&&(this._rect.col=r.col===a.LEFT?n.left:this._rect.col=n.left+n.width),this._table=o.block)},apply:function(){var e=this,t=e._rect,n=e._cellsData,o=e._sizes;null!=t.row&&(e._insertRows(t.row,n,o),this.effected=!0),null!=t.col&&(e._insertCols(t.col,n,o),this.effected=!0)},_insertRows:function(e,t,n){var o=this,i=o._table;t.forEach(function(n,a){0===n.length&&(n=i.creatRowData(e+a)),t[a]=n,r.fixMergeCellBeforeRowColChange({index:e+a,table:i,cmd:o,insertData:n})}),o.executeAtomicCommand(new s({cellsData:t,sizes:n,rect:this._rect,table:i}))},_insertCols:function(e,t,n){var o=this,i=o._table,a=i.getCells();t.forEach(function(n,l){a.forEach(function(e,t){n[t]=n[t]||i.createCell()}),t[l]=n,r.fixMergeCellBeforeRowColChange({index:e+l,table:i,cmd:o,isCol:!0,insertData:n})}),o.executeAtomicCommand(new s({cellsData:t,sizes:n,rect:this._rect,table:i}))},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._rect=r.simpleValue1,n._sizes=r.simpleValue2,n._cellsData=l.cellsFromCollabJSON(r.dataBefore))},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.simpleValue1=e._rect,n.simpleValue2=e._sizes,n.dataBefore=l.cellsToCollabJSON(e._cellsData),n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(23),a=n(321),l=n(11),s=n(14),c=n(42),u=n(3);return t=o.extend({name:"comp.DeleteTableRowCol",_table:null,_rect:null,_oldData:null,_count:null,_range:null,effected:!1,initialize:function(){var e,n=this,o=n.options.args;this._rect={},t.__super__.initialize.apply(n),u.isCollabCommand(o)||(e=o.range,e?n._transformRangeToData(e,o):(this._rect=o.rect,this._count=o.count,n._table=o.table))},_transformRangeToData:function(e,t){var n,o,i=this,r=e.getStartBlockRange(),a=t.describe;(n=r.getAsRectRange())&&(o=n.getRect(),a.row&&(this._rect.row=o.top,this._count=o.height),a.col&&(this._rect.col=o.left,this._count=o.width),i._rectOfRectRange=o,this._table=r.block)},apply:function(){var e,t,n,o,i,r,u=this,d=u._count,p=u._rect,h=u._table;if(null!=p.row){if(e=h.getRowCount(),0===p.row&&e===d)return u._deleteTable();for(n=0;n<d;n++)l.fixMergeCellBeforeRowColChange({index:p.row,table:h,cmd:u,isDelete:!0}),u.executeAtomicCommand(new a({count:1,rect:p,table:h}));this.effected=!0}if(null!=p.col){if(t=h.getColumnCount(),0===p.col&&t===d)return u._deleteTable();for(n=0;n<d;n++)l.fixMergeCellBeforeRowColChange({index:p.col,table:h,cmd:u,isDelete:!0,isCol:!0}),u.executeAtomicCommand(new a({count:1,rect:p,table:h}));this.effected=!0}u._rectOfRectRange&&(o=c.create({block:h,type:c.TYPES.NORMAL,rect:u._rectOfRectRange}),o&&(i=o.getAsRectRange()),i||(o=c.create({block:h,type:c.TYPES.FIRST_CELL})),r=s.create({startRange:o,endRange:o}),u.setEndingRange(r))},_deleteTable:function(){this._applyCommandToComposite(new r({blocks:[this._table],note:this.options.note})),this.setEndingRange(s.createMock()),this.effected=!0},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._rect=r.simpleValue1,n._count=r.simpleValue2)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.simpleValue1=e._rect,n.simpleValue2=e._count,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(18),i=n(4),r=n(76),a=n(3);return t=o.extend({name:"atom.DeleteTableRowCol",_table:null,_rect:null,_oldCellsData:null,_count:null,effected:!1,initialize:function(){var e=this,n=e.options,o=n.args;a.isCollabCommand(o)||(this._count=n.count,this._rect=n.rect,this._table=n.table),t.__super__.initialize.apply(e)},apply:function(){var e=this,t=e._rect,n=e._table,o=e._count;null!=t.row&&(e._oldCellsData=n.deleteRows(t.row,o),this.effected=!0),null!=t.col&&(e._oldCellsData=n.deleteCols(t.col,o),this.effected=!0)},doUnapply:function(){var e=this,t=e._rect,n=e._table,o=e._oldCellsData;null!=t.row&&n.insertRows(t.row,o.rowsData,o.heights),null!=t.col&&n.insertCols(t.col,o.colsData,o.widths)},fromCollabJSON:function(){var e,n,o=this,i=o.options.args,a=i.collabProperties,l=a.cmdJSON;t.__super__.fromCollabJSON.apply(o),n=a.coreEditor.getNote(),l&&(o._table=n.getBlockById(l.blockId),o._rect=l.simpleValue1,o._count=l.simpleValue2,(e=l.dataBefore)&&(o._oldCellsData=e,e.rowsData&&(o._oldCellsData.rowsData=r.cellsFromCollabJSON(e.rowsData)),e.colsData&&(o._oldCellsData.colsData=r.cellsFromCollabJSON(e.colsData))))},toCollabJSON:function(){var e,n=this,o=t.__super__.toCollabJSON.apply(n);return o.blockId=n._table.getId(),o.simpleValue1=n._rect,o.simpleValue2=n._count,e=n._oldCellsData,e&&(o.dataBefore=e,e.rowsData&&(o.dataBefore.rowsData=r.cellsToCollabJSON(e.rowsData)),e.colsData&&(o.dataBefore.colsData=r.cellsToCollabJSON(e.colsData))),o}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(127),a=n(98),l=n(323),s=n(3);return t=o.extend({name:"comp.ToggleMergeTableCell",_table:null,_rect:null,_oldData:null,_range:null,effected:!1,initialize:function(){var e,n=this,o=n.options.args;s.isCollabCommand(o)||(e=o.range,e?n._transformRangeToData(e,o):(this._rect=o.rect,n._table=o.table)),t.__super__.initialize.apply(n)},_transformRangeToData:function(e){var t,n,o=e.getStartBlockRange();(t=o.getAsRectRange())&&(n=t.getRect(),this._range=e,this._rect=n,this._table=o.block)},apply:function(){var e,t,n,o=this,i=o._rect,s=o._table,c=!1,u=!1,d=null;if(i&&(1!==i.width||1!==i.height)){for(s.isMergeRect(i)&&(c=!0),t=i.top;t<i.top+i.height;t++)for(n=i.left;n<i.left+i.width;n++)e=s.getCell(t,n),t===i.top&&n===i.left?(e.isEmpty()||(u=!0),o.executeAtomicCommand(new r({table:s,type:r.TYPES.POINT,value:c?null:{width:i.width,height:i.height},rect:{row:t,col:n}}))):(u||d||e.isEmpty()||(d=e.getContent()),c||(o._applyCommandToComposite(new l({args:{table:s,content:"",range:o._range,cellRect:{row:t,col:n}}})),o.executeAtomicCommand(new a({table:s,styles:null,rect:{width:1,height:1,top:t,left:n}}))),o.executeAtomicCommand(new r({table:s,type:r.TYPES.CELL,value:c?null:{dy:t-i.top,dx:n-i.left},rect:{row:t,col:n}})));d&&o._applyCommandToComposite(new l({args:{table:s,content:d,cellRect:{row:i.top,col:i.left}}})),o.effected=!0}},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._rect=r.simpleValue1)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.simpleValue1=e._rect,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(67),a=n(3),l=n(89);return t=o.extend({name:"comp.SetTableCellContent",_table:null,_cellRect:null,_oldContent:null,initialize:function(){var e=this,n=e.options.args;a.isCollabCommand(n)||(e._table=n.table,e._cellRect=n.cellRect,e._content=n.content),t.__super__.initialize.apply(e)},apply:function(){var e=this;e.executeAtomicCommand(new r({table:e._table,cellRect:e._cellRect,content:e._content}))},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._content=l.contentFromCollabJSON(r.simpleValue1),n._oldContent=l.contentFromCollabJSON(r.simpleValue2),n._cellRect=r.newBlkId)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.simpleValue1=l.contentToCollabJSON(e._content),n.simpleValue2=l.contentToCollabJSON(e._oldContent),n.newBlkId=e._cellRect,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(98),a=n(3);return t=o.extend({name:"comp.SetTableCellBlockStyle",_table:null,_styles:null,_rect:null,_toggle:null,effected:!1,initialize:function(){var e,n=this,o=n.options.args;t.__super__.initialize.apply(n),a.isCollabCommand(o)||(e=o.range,n._styles=o.styles,n._toggle=o.toggle,n._transformRangeToData(e,o))},_transformRangeToData:function(e){var t,n,o=e.getStartBlockRange();(t=o.getAsRectRange())&&(n=t.getRect(),this._rect=n,this._table=o.block)},apply:function(){var e=this;if(!e._rect)return e.effected;e.executeAtomicCommand(new r({table:e._table,rect:e._rect,styles:e._styles,toggle:e._toggle})),e.effected=!0},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._rect=r.simpleValue1,n._styles=r.simpleValue2||null,n._toggle=r.newBlkId||null)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.simpleValue1=e._rect,n.simpleValue2=e._styles||null,n.newBlkId=e._toggle||null,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(160),a=n(67),l=n(127),s=n(98),c=n(76),u=n(3);return t=o.extend({name:"comp.InsertTableCells",_table:null,_widths:null,_heights:null,_cellsData:null,_rect:null,effected:!1,initialize:function(){var e=this,n=e.options.args;t.__super__.initialize.apply(e),u.isCollabCommand(n)||(e._table=n.table,e._widths=n.widths,e._heights=n.heights,e._cellsData=n.cellsData,e._transformRangeToData(n.range))},_transformRangeToData:function(e){var t,n=e.getStartBlockRange();n.getAsRectRange&&(t=n.getAsRectRange(),this._rect=t.getRect())},apply:function(){var e,t,n,o,i,r,l,c=this,u=c._table,d=c._rect,p=c._cellsData;if(!p)return c._clearCellsData();if(!p[0]||p[0].length<1)return!1;for(e=p.length,t=p[0].length,c._handleExtendCol(),c._handleExtendRow(),o=0;o<e;o++)for(r=o+d.top,i=0;i<t;i++)l=i+d.left,n=p[o][i],c._handleOldMergePoint(u.getCell(r,l),r,l),c._handleMergePointCell(n,o,i),n.isMergedCell()||(c.executeAtomicCommand(new a({content:n.getContent(),table:u,cellRect:{row:o+d.top,col:i+d.left}})),c.executeAtomicCommand(new s({rect:{top:d.top+o,left:d.left+i,width:1,height:1},styles:n.getBlockStyles(),table:u})),this.effected=!0)},_handleExtendCol:function(){var e,t,n,o=this,i=o._table,a=o._rect,l=o._widths,s=o._cellsData,c=s[0].length,u=i.getColumnCount(),d=i.getRowCount(),p=[];if((e=a.left+c-u)>0){for(s.forEach(function(t,n){t.slice(-e).forEach(function(e,t){p[t]=p[t]||[],p[t][a.top+n]=e})}),t=0;t<d;t++)for(n=0;n<p.length;n++)p[n][t]=p[n][t]||i.createCell({row:t,col:a.left+n});o.executeAtomicCommand(new r({rect:{col:u},table:i,cellsData:p,sizes:l?l.slice(-e):null})),o.effected=!0}},_handleExtendRow:function(){var e,t,n,o=this,i=o._table,a=o._rect,l=o._heights,s=o._cellsData,c=s.length,u=i.getColumnCount(),d=i.getRowCount(),p=[];if((e=a.top+c-d)>0){for(s.slice(-e).forEach(function(e,t){p[t]=p[t]||[],e.forEach(function(e,n){p[t][a.left+n]=e})}),t=0;t<p.length;t++)for(n=0;n<u;n++)p[t][n]=p[t][n]||i.createCell({row:a.top+a.height,col:n});o.executeAtomicCommand(new r({rect:{row:d},table:i,cellsData:p,sizes:l?l.slice(-e):null})),o.effected=!0}},_handleMergePointCell:function(e,t,n){var o=this,i=o._table,r=o._rect;e.isMergePoint()?(e.getMergePointAttr(),o.executeAtomicCommand(new l({rect:{row:r.top+t,col:r.left+n},value:e.getMergePointAttr(),type:l.TYPES.POINT,table:i}))):e.isMergedCell()&&o.executeAtomicCommand(new l({rect:{row:r.top+t,col:r.left+n},value:e.getMergedCellAttr(),type:l.TYPES.CELL,table:i}))},_handleOldMergePoint:function(e,t,n){var o,i,r=this,a=r._table,l=r._rect,s=r._cellsData,c=s.length,u=s[0].length;if(e&&(e.isMergePoint()&&(o=e.getMergePointAttr(),this._clearCellsAttr(t,n,o.width,o.height)),e.isMergedCell())){if(!(i=a.getCell(t,n,{findMergePointIfNeeded:!0,withPosition:!0}))||l.top+c>=i.row&&l.top<=i.row&&l.left+u>i.col&&l.left<=i.col)return;o=i.cell.getMergePointAttr(),this._clearCellsAttr(i.row,i.col,o.width,o.height)}},_clearCellsAttr:function(e,t,n,o){var i,r,a=this,s=a._table;for(i=0;i<o;i++)for(r=0;r<n;r++)a.executeAtomicCommand(new l({table:s,rect:{row:e+i,col:t+r}}))},_clearCellsData:function(){var e,t,n=this,o=n._rect,i=n._table;for(e=0;e<o.height;e++)for(t=0;t<o.width;t++)n.executeAtomicCommand(new a({content:"",table:i,cellRect:{row:e+o.top,col:t+o.left}}));n.executeAtomicCommand(new s({rect:o,table:i}))},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._rect=r.simpleValue1,n._widths=r.simpleValue2.widths,n._heights=r.simpleValue2.heights,n._cellsData=c.cellsFromCollabJSON(r.dataBefore))},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.simpleValue1=e._rect,n.simpleValue2={widths:e._widths,height:e._heights},n.dataBefore=c.cellsToCollabJSON(e._cellsData),n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(9),i=n(4),r=n(157),a=n(3);return t=o.extend({name:"comp.SetTableCellInlineStyle",_table:null,_styles:null,_rect:null,_toggle:null,initialize:function(){var e,n=this,o=n.options.args;t.__super__.initialize.apply(n),a.isCollabCommand(o)||(e=o.range,n._styles=o.styles,n._toggle=o.toggle,n._transformRangeToData(e,o))},_transformRangeToData:function(e){var t,n,o=e.getStartBlockRange();(t=o.getAsRectRange())&&(n=t.getRect(),this._rect=n,this._table=o.block)},apply:function(){var e=this;e._rect&&e.executeAtomicCommand(new r({table:e._table,rect:e._rect,styles:e._styles,toggle:e._toggle}))},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties,r=i.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=i.coreEditor.getNote(),r&&(n._table=e.getBlockById(r.blockId),n._rect=r.simpleValue1,n._styles=r.simpleValue2||null,n._toggle=r.newBlkId||null)},toCollabJSON:function(){var e=this,n=t.__super__.toCollabJSON.apply(e);return n.blockId=e._table.getId(),n.simpleValue1=e._rect,n.simpleValue2=e._styles||null,n.newBlkId=e._toggle||null,n}}),i.add(t),t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(15),i=n(0),r=n(1),a=n(16),l=n(6),s=n(155),c=function(e){return e&&e.name===s.prototype.name},u=n(55),d=n(14);return t={_editor:null,_undoStack:null,_redoStack:null,_notOwnManagerAdapterStack:null,initialize:function(e){var t=this;t._undoStack=[],t._redoStack=[],t._notOwnManagerAdapterStack=[],t._editor=e.editor},exec:function(e,t,n){var o,i,a,l,s=this,u=!1,p=!0,h=!1;return e?s._editor.isCollabEnabled()&&(u=n.collabProperties.isCollabCmd&&n.collabProperties.isOwnCmd,p=!n.collabProperties.isCollabCmd,u&&(c(e)?s._localManagerAdapterOverriden(e)?e.setIgnoreUndoRedo(!0):h=!0:n.collabProperties.cmdJSON.isLocalExecutedCmd&&(h=!0)),h)?(r.log("Skip local-executed collab command and update noteVersion",e),s._updateUndoCmdFinalVersion(e.cmdId,n.collabProperties.finalNoteVersion),s.trigger("command-exec",e,n),!0):(l=e.apply(),i={cmdName:e.name,cmdType:"do"},o=e.getEndingRange(),!1!==l&&!d.isNoteRange(o)&&e.getStartingRange()&&(r.warn("endingRange should be a noteRange, so set it to be same as startEndingRange:",o),o=e.getStartingRange(),e.setEndingRange(o)),a=p||u,o&&a&&!e.updateSelectionDisabled&&s.trigger("update-selection",o,i),a&&!e.effected?(s.trigger("command-exec",e,n),l):(c(e)&&(e.sendInfoToInner({canUndo:s.canUndo(),canRedo:s.canRedo()}),a||s._notOwnManagerAdapterStack.push(e)),s._editor.isCollabEnabled()?n.collabProperties.dataCmdError?(s.trigger("command-exec",e,n),!1):(a&&(e.getIgnoreUndoRedo()||s._pushToUndoStack(e),s._redoStack=[]),s.trigger("command-exec",e,n),!0):(e.getIgnoreUndoRedo()||s._undoStack.push(e),s._redoStack=[],s.trigger("command-exec",e,n),!0))):(r.log("Skip empty local command"),!1)},canUndo:function(){return 0!==this._undoStack.length},undo:function(){if(!this.canUndo())return r.warn("Can Not undo"),!1;var e,t=this,n=t._undoStack,o=t._redoStack,i=n.pop();return i.doUnapply(),o.push(i),t.trigger("command-exec",i),e={cmdName:i.name,cmdType:"undo"},t.trigger("update-selection",i.getStartingRange(),e),!0},canRedo:function(){return 0!==this._redoStack.length},redo:function(){if(!this.canRedo())return!1;var e,t=this,n=t._undoStack,o=t._redoStack,i=o.pop();return i.doReapply(),n.push(i),t.trigger("command-exec",i),e={cmdName:i.name,cmdType:"redo"},t.trigger("update-selection",i.getEndingRange(),e),!0},reset:function(){var e=this;e._undoStack=[],e._redoStack=[],e._notOwnManagerAdapterStack=[]},registerManager:function(e,t){var n,o=this;if(!e||!e.on)return void r.warn("commandManager is not Valid!");o.unregisterManager(e),e.on("command-executed",function(i,a){var l=s.create(t,i,a);if(!l)return void r.warn("ManagerAdapter failed to create command!");l.isOriginalCmd=!0,l.isLocalExecutedCmd=!0,l.setCmdOriginalNoteVersion(o._editor.getNoteVersion()),o._pushToUndoStack(l),o._redoStack=[],o.trigger("command-exec",l),e.triggerGlobalUndoStatus(o.canUndo(),o.canRedo()),o._editor.isCollabEnabled()&&(n=window.JSON.parse(a))&&0!==n.colWidths.length&&0!==n.rowHeights.length&&o._editor.pushLocalDataCommand(l,!0)})},unregisterManager:function(e){e&&e.on&&e.off("command-executed")},applyCollabCmdRedoUndo:function(e){var t,n=this,o=e.options.args,i=o.collabProperties.cmdJSON,a=o.collabProperties.isOwnCmd;if(a&&o.collabProperties.isLocalExecutedCmd)return r.log("skip local-executed-own redo/undo",e),void n.trigger("command-exec",e,o);o.collabProperties.isCollabUndo?(e.setCollabUndo(!0),e.setCollabRedo(!1),t=e.doUnapply(o)):o.collabProperties.isCollabRedo&&(e.setCollabUndo(!1),e.setCollabRedo(!0),t=e.doReapply(o)),!1!==t?(o.collabProperties.isCollabUndo&&e.setStartingRange(u.buildNoteRangeFromJSON(i.startNoteRange,n._editor)),o.collabProperties.isCollabRedo&&e.setEndingRange(u.buildNoteRangeFromJSON(i.endNoteRange,n._editor)),a&&(o.collabProperties.isCollabUndo?(n._pushToRedoStack(n._undoStack.pop()),n.trigger("update-selection",e.getStartingRange())):o.collabProperties.isCollabRedo&&(n._pushToUndoStack(n._redoStack.pop()),n.trigger("update-selection",e.getEndingRange())))):a&&(o.collabProperties.isCollabUndo?n.dropUndoCmds():o.collabProperties.isCollabRedo&&n.dropRedoCmd(),n._editor.notifyErrorToHost(l.INVALIDACTION_FAILED_COLLABCMD,o.collabProperties.coreEditor)),a&&c(e)&&e.sendInfoToInner({canUndo:n.canUndo(),canRedo:n.canRedo()}),n.trigger("command-exec",e,o)},dropRedoCmd:function(){r.log("Drop Redo Command"),this._redoStack.pop(),this.trigger("redo-stack-change")},dropUndoCmds:function(e,t,n){var o,i=this;r.log("Drop Undo Command:",e,t,n),e?(o=i._getUndoCmdIndexById(e))>=0&&(n?i._undoStack.splice(o,t,n):i._undoStack.splice(o,t)):i._undoStack.pop(),this.trigger("undo-stack-change")},getRedoCmd:function(){return i.last(this._redoStack)},getUndoCmd:function(){return i.last(this._undoStack)},_getUndoCmdIndexById:function(e){var t=this,n=-1,o=0;return i.some(t._undoStack,function(t){return t.getCmdId()===e&&(n=o),n>=0||(o++,!1)}),n},_pushToRedoStack:function(e){var t=this;if(!e)return void r.log("null command should NOT be pushed to Redo Stack");t._redoStack.push(e)},_pushToUndoStack:function(e){var t=this;return e?e.getIgnoreUndoRedo()?void r.log("this command no need undo redo."):(t._undoStack.push(e),void(t._undoStack.length>l.MAX_UNDO_STACK_SIZE&&t._undoStack.shift())):void r.log("null command should NOT be pushed to Undo Stack")},_localManagerAdapterOverriden:function(e){var t,n=this,o=!1,i=0;for(n._notOwnManagerAdapterStack&&(i=n._notOwnManagerAdapterStack.length);i>0&&(t=n._notOwnManagerAdapterStack[i-1],t.getCmdOriginalNoteVersion()===e.getCmdOriginalNoteVersion());i--)if(e.getBlockId()===t.getBlockId()){o=!0;break}return o},_updateUndoCmdFinalVersion:function(e,t){var n=this;i.some(n._undoStack,function(n){if(n.cmdId===e)return n.setCmdFinalNoteVersion(t),!0})}},i.extend(t,a.Events),o.extend(t)}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(14),n(27),n(17),n(1),n(37),n(161)],void 0!==(i=function(e,t,n,o,i,a,l,s){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.collapseToStart=function(){this.noteRange&&this.noteRange.collapse&&(this.noteRange.collapse(!0),this._drawRange(),this._triggerSelectionChange())},t.prototype.collapseToEnd=function(){this.noteRange&&this.noteRange.collapse&&(this.noteRange.collapse(!1),this._drawRange(),this._triggerSelectionChange())},t.prototype.getNativeRange=function(){return l.getRange(window)},t.prototype.getRange=function(){return this.noteRange},t.prototype.isCollapsed=function(){var e=this.noteRange;return!!e&&e.isCollapsed()},t.prototype.reset=function(){this.noteRange=null},t.prototype.setRange=function(e,t,n){this._setRange(e,{scrollIntoView:n,selectionChangeEvent:t,toDraw:!0,trigger:!0})},t.prototype.initialize=function(e){this.noteView=e.noteView,this._bindEvents()},t.prototype._bindEvents=function(){o.addListeners({selectionchange:"_onDocSelectionChange","set-range":"_onSetRange"},this.noteView,this)},t.prototype._convertToNoteRange=function(e){return n.fromNativeRange(e,this.noteView)},t.prototype._drawRange=function(e){e=!1!==e,this.noteView.trigger("draw-range",this.noteRange,e)},t.prototype._onDocSelectionChange=function(e){a.log("on doc selection change!");var t=l.getRange(),n=this._convertToNoteRange(t);if(this.noteRange=n,a.log("NoteSelection -> contentchange"),n&&!n.canDrawedByNative())return void this.setRange(n);this.trigger("doc-change-selection",n),this._triggerSelectionChange()},t.prototype._onSetRange=function(e,t,n,o){this._setRange(e,{selectionChangeEvent:o,toDraw:t,trigger:n})},t.prototype._setRange=function(e,t){var n=this._convertToNoteRange(e);if(!n||!n.getStartBlockRange()||!n.getEndBlockRange())return void a.warn("Failed convert native range to note range!");t=t||{},this.noteRange=n,t.toDraw&&this._drawRange(t.scrollIntoView),t.trigger&&this._triggerSelectionChange(t.selectionChangeEvent)},t.prototype._triggerSelectionChange=function(e){e||(e=s.createUserTypeEvent()),a.log("---------note-selection-change---------"),this.trigger("selection-change",e)},t}(i)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(){return{encode:function(e){return window.btoa(window.unescape(encodeURIComponent(e)))},decode:function(e){return decodeURIComponent(window.escape(window.atob(e)))}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),n(340),n(341),n(342),n(343),n(344),n(345),n(346),n(331),n(347),n(348),n(349),n(350),n(351),n(352),n(353),n(354),n(355),n(356),n(357),n(358),n(359),n(360),n(361)],void 0!==(i=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"underline",key:"mod+u",action:function(e){e.toggleInlineStyle("underline")}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"backspace",key:"backspace",action:function(e){e.execDeleteBackward()}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"del",key:"del",action:function(e){e.execDeleteForward()}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5),n(14),n(26),n(2)],void 0!==(i=function(e,t,n,o,i,r){"use strict";var a=this;Object.defineProperty(t,"__esModule",{value:!0});var l=function(e,t,n){var l=e.noteView;l&&(l.directionKeyJustMoved=!0),e.moveCaretWithDirection(!0,t);var s=e.getNoteRange(),c=s.getEndBlockRange(),u=c.block,d=e.note.getLastBlock(),p=e.note.getNextBlock(u);if(!u.isEmpty()||r.isHr(p))switch(n){case"right":u.getLength()===c.end&&d===u&&e.execCommand("comp.AppendBlank",{inlineStyles:a.editingInlineStates});break;case"down":d===u&&e.execCommand("comp.AppendBlank",{inlineStyles:a.editingInlineStates})}else if(d!==u&&p){var h=i.createRangeByBlock({allContent:!1,block:p,collapseToStart:!1});e.noteSelection.setRange(new o({startRange:h,endRange:h})),t.preventDefault()}};n.register({name:"down",key:"down",preventDefault:!1,action:l}),n.register({name:"right",key:"right",preventDefault:!1,action:l})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(2),n(5)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){var t,o;t=e.getNoteRange(),o=t.getEndBlockRange(),t.isInSingleBlock()&&n.isHeading(o.block)&&o.isCollapsed()&&o.start===o.block.getLength()&&e.resetEditingInlineStates(),e.execCommand("comp.KeyEnter",{inlineStyles:e.getEditingInlineState()})};o.register({name:"enter",key:"enter",action:i}),o.register({name:"alt+enter",key:"alt+enter",action:i}),o.register({name:"shift+enter",key:"shift+enter",action:i})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"esc",key:"esc",preventDefault:!1,action:function(e){e.trigger("esc")}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(2),n(1),n(5)],void 0!==(i=function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i.register({name:"space",key:"space",action:function(e){var t,i=e.getNoteRange();if(i&&(t=i.getStartBlockRange().block,i.isInSingleBlock()&&t&&n.isTable(t)))return void o.error("should NOT trigger insertText when select only Table.");e.insertText(" ",!1)}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"tab",key:"tab",action:function(e){var t=e.getEditingInlineState();e.execCommand("comp.KeyTab",{inlineStyles:t})}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t){var n=e.noteView;n&&(n.directionKeyJustMoved=!0),e.moveCaretWithDirection(!1,t)};n.register({name:"up",key:"up",preventDefault:!1,action:o}),n.register({name:"left",key:"left",preventDefault:!1,action:o})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5),n(0),n(1)],void 0!==(i=function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["ctrl+backspace","ctrl+del","shift+backspace","shift+del","alt+backspace","alt+del","mod+backspace","mod+del"];o.each(r,function(e){n.register({name:e,key:e,preventDefault:!0,action:function(){i.log("shortcut prevented:",e)}})})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"bold",key:"mod+b",action:function(e){e.toggleInlineStyle("bold")}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(38),n(5)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return n.pad(e,2,"0","left")};o.register({name:"insertDate",key:"alt+shift+d",action:function(e){var t=new Date,n=t.getFullYear()+"/"+i(t.getMonth()+1)+"/"+i(t.getDate())+" "+i(t.getHours())+":"+i(t.getMinutes());e.insertText(" "+n+" ",!1)}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"italic",key:"mod+i",action:function(e){e.toggleInlineStyle("italic")}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){e.redo()};n.register({name:"redo",key:"mod+y",action:o}),n.register({name:"redo_2",key:"mod+shift+z",action:o})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(1),n(5)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o.register({name:"reloadPage",key:"mod+shift+r",preventDefault:!1,action:function(){if(n.DEBUG){window.clearJstCache&&(window.clearJstCache(),window.alert("Clear JST cache... Done!"));var e=window.location.href;window.location.href=e}}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"save",key:"mod+s",action:function(e){e.trigger("yne-save-content")}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"undo",key:"mod+z",action:function(e){e.undo()}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"selectAll",key:"mod+a",read:!0,action:function(e){e.selectAll()}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(2),n(5)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){var t,o,i,r,a=e.getNoteRange(),l=e.noteView;(t=l.getHtmlContentEditable())||a&&a.isInSingleBlock()&&a.isMatchBlockTypes(e.note,[n.IMAGE,n.ATTACHMENT])&&(i=a.getStartBlockRange(),o=i.block,(r=l.getBlockViewByBlock(o))&&(l.setHtmlContentEditable(!0),r.el.focus(),window.setTimeout(function(){l.setHtmlContentEditable(!1)},0)))};o.register({name:"copy",key:"mod+c",preventDefault:!1,read:!0,action:i}),o.register({name:"cut",key:"mod+x",preventDefault:!1,action:i})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(8),n(5)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o.register({name:"paste",key:"mod+v",preventDefault:!1,action:function(e,t){var o=e.editor;e.setPasteAsText(!1),n.IS_MAC&&(t.preventDefault(),o.callMacNativeApi("menuPaste"))}}),o.register({name:"pasteAsText",key:"mod+shift+v",preventDefault:!1,action:function(e){e.setPasteAsText(!0)}}),o.register({name:"pasteAsText_alternative",key:"mod+shift+option+v",preventDefault:!1,action:function(e){e.setPasteAsText(!0)}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(8),n(5)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=!0;(n.IS_WEB_NOTE||n.IS_WEB_GROUP)&&(i=!1),o.register({name:"find",key:"mod+f",read:!0,preventDefault:i,action:function(e){e.trigger("find")}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"shiftTab",key:"shift+tab",action:function(e){var t=e.getEditingInlineState();e.execCommand("comp.KeyTab",{inlineStyles:t,withShiftKey:!0})}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(8),n(5)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.IS_PC&&(o.register({name:"zoomIn_0",key:"mod+plus",action:function(e){e.zoomInEditor()}}),o.register({name:"zoomIn_1",key:"mod+shift+plus",action:function(e){e.zoomInEditor()}}),o.register({name:"zoomIn_2",key:"mod+=",action:function(e){e.zoomInEditor()}}),o.register({name:"zoomIn_3",key:"mod+shift+=",action:function(e){e.zoomInEditor()}}))}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(8),n(5)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.IS_PC&&(o.register({name:"zoomOut_0",key:"mod+-",action:function(e){e.zoomOutEditor()}}),o.register({name:"zoomOut_1",key:"mod+shift+-",action:function(e){e.zoomOutEditor()}}),o.register({name:"zoomOut_2",key:"mod+0",action:function(e){e.zoomEditor(1,!0)}}))}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(8),n(5)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o.register({name:"deleteToEnd",key:"ctrl+k",action:function(e){n.IS_MAC&&e.execDeleteToEnd()}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(8),n(5)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o.register({name:"deleteForward",key:"ctrl+d",action:function(e){n.IS_MAC&&e.execDeleteForward()}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(24),n(1),n(8),n(5)],void 0!==(i=function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={insertHeading_1:"1",insertHeading_2:"2",insertHeading_3:"3",insertHeading_4:"4"},l=function(e,t,n){if(o.log(t),null==a[n])return void o.warn("Unsupported shortKey:",n);e.execCmdByShortCut("comp.InsertHeading",{level:a[n]})};n.isSafari()&&!i.IS_MAC||(r.register({name:"insertHeading_1",key:"mod+1",preventDefault:!0,action:l}),r.register({name:"insertHeading_2",key:"mod+2",preventDefault:!0,action:l}),r.register({name:"insertHeading_3",key:"mod+3",preventDefault:!0,action:l}),r.register({name:"insertHeading_4",key:"mod+4",preventDefault:!0,action:l}))}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"strikeout",key:"mod+e",action:function(e){e.toggleInlineStyle("strike")}})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(33),n(24),n(1),n(8),n(5)],void 0!==(i=function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(e,t,o){var r;if(i.log(t),"insertOrderList"===o)r=n.ORDERED;else{if("insertUnorderList"!==o)return void i.warn("Unsupported shortKey:",o);r=n.UNORDERED}e.execCmdByShortCut("comp.InsertList",{type:r})};o.isSafari()&&!r.IS_MAC||(a.register({name:"insertUnorderList",key:"mod+l",preventDefault:!0,action:l}),a.register({name:"insertOrderList",key:"mod+shift+l",preventDefault:!0,action:l}))}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(24),n(1),n(8),n(5)],void 0!==(i=function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t,n){o.log(t,n),e.execCmdByShortCut("comp.InsertTodo",{checked:!1})};n.isSafari()&&!i.IS_MAC||r.register({name:"insertTodo",key:"mod+d",preventDefault:!0,action:a})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(24),n(1),n(8),n(5)],void 0!==(i=function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t,n){o.log(t,n),e.execCmdByShortCut("comp.InsertHorizontalRule")};n.isSafari()&&!i.IS_MAC||r.register({name:"insertHR",key:"mod+h",preventDefault:!0,action:a})}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(16),o=n(0),i=n(7),r=n(12),a=n(22),l=n(81),s=[["r","g","b"],["h","s","v"],["h","s","l"]],c=[[255,255,255],[360,100,100],[360,100,100]];return t.View.extend({className:"color-picker",name:"colorpicker",label:"选色器",templateName:"color_picker",events:{mousedown:"onMouseDown","mousedown .color-picker-panel":"onPanelMouseDown","mousedown .color-picker-panel-board":"onBoardMousedown","mousedown .color-picker-panel-alpha":"onAlphaMousedown","mousedown .color-picker-panel-ribbon":"onRibbonMousedown","click .color-picker-panel-params-lable-number":"onParamsLabelClick"},initialize:function(e){var t=this;t.editor=e.editor,t.render(),t.hidePicker(),t.mode=0,o.bindAll(t,"onDocumentMouseDown","onBoardMousedown","onBoardDrag","onBoardDragEnd","onAlphaMousedown","onAlphaDrag","onAlphaDragEnd","onRibbonMousedown","onRibbonDrag","onRibbonDragEnd","onParamsLabelClick"),t.on("color-picker-show",t.showPicker),i(document).on("mousedown",t.onDocumentMouseDown)},render:function(){var e,t=this,n=t.$el;e=r.render("common",t.templateName),n.html(e),t.panel=n.find(".color-picker-panel")[0],t.board=n.find(".color-picker-panel-board")[0],t.boardBg=i(t.board).find(".color-picker-panel-board-hsv"),t.ribbon=n.find(".color-picker-panel-ribbon")[0],t.alpha=n.find(".color-picker-panel-alpha")[0],t.preview=n.find(".color-picker-panel-preview")[0],t.inputs=n.find(".color-picker-panel-params-input"),t.inputHex=i(t.inputs).find("input")[0],t.inputR=i(t.inputs).find("input")[1],t.inputG=i(t.inputs).find("input")[2],t.inputB=i(t.inputs).find("input")[3],t.inputA=i(t.inputs).find("input")[4],t.labelR=n.find(".color-picker-panel-params-lable-number")[0],t.labelG=n.find(".color-picker-panel-params-lable-number")[1],t.labelB=n.find(".color-picker-panel-params-lable-number")[2],t.bindEvents()},bindEvents:function(){var e=this;o.bindAll(e,"onHexChange","onRedChange","onGreenChange","onBlueChange","onAlphaChange","updateInputHex","updateInputR","updateInputG","updateInputB","updateInputA","onKeyDown","onLastInputKeyDown"),i(e.inputHex).on("input propertychange",e.onHexChange),i(e.inputHex).on("blur",e.updateInputHex),i(e.inputHex).on("keydown",e.onKeyDown),i(e.inputR).on("input propertychange",e.onRedChange),i(e.inputR).on("blur",e.updateInputR),i(e.inputR).on("keydown",e.onKeyDown),i(e.inputG).on("input propertychange",e.onGreenChange),i(e.inputG).on("blur",e.updateInputG),i(e.inputG).on("keydown",e.onKeyDown),i(e.inputB).on("input propertychange",e.onBlueChange),i(e.inputB).on("blur",e.updateInputB),i(e.inputB).on("keydown",e.onKeyDown),i(e.inputA).on("input propertychange",e.onAlphaChange),i(e.inputA).on("blur",e.updateInputA),i(e.inputA).on("keydown",e.onLastInputKeyDown)},showPicker:function(e){var t=this,n=t.solidColor(e.selectedValue);n.isValid()||(n=t.solidColor(e.value)),n.isValid()||(n=a("#393939")),t.color=n,t.mode=0,t.item=e,t.$el.show(),t.updateUI()},solidColor:function(e){var t=a(e),n=t.toRgb();return 0===n.r&&0===n.g&&0===n.b&&0===n.a&&t.setAlpha(1),t},hidePicker:function(){var e,t=this;t.removeWindowListeners(),t.$el.hide(),t.item&&(e=t.color.toRgbString(),t.item.changeValue(e),t.item=null)},removeWindowListeners:function(){var e=this;i(window).off("mousemove",e.onBoardDrag),i(window).off("mouseup",e.onBoardDragEnd),i(window).off("mousemove",e.onAlphaDrag),i(window).off("mouseup",e.onAlphaDragEnd),i(window).off("mousemove",e.onRibbonDrag),i(window).off("mouseup",e.onRibbonDragEnd)},onDocumentMouseDown:function(){this.hidePicker()},onMouseDown:function(e){this.hidePicker(),e.stopPropagation(),e.preventDefault()},onPanelMouseDown:function(e){e.stopPropagation()},onBoardMousedown:function(e){var t=this;t.onBoardDrag(e),t.removeWindowListeners(),i(window).on("mousemove",t.onBoardDrag),i(window).on("mouseup",t.onBoardDragEnd)},onBoardDrag:function(e){var t=this,n=e.clientX,o=e.clientY;e.preventDefault(),t.pointMoveTo({x:n,y:o})},onBoardDragEnd:function(e){var t=this;t.onBoardDrag(e),t.removeWindowListeners()},pointMoveTo:function(e){var t,n,o=this,r=o.board.getBoundingClientRect(),l=e.x-r.left,s=e.y-r.top,c=o.color.toHsv(),u=i(o.boardBg).css("background-color"),d=c.h;t=a(u),t.isValid()&&(d=t.toHsv().h),l=Math.max(0,l),l=Math.min(l,200),s=Math.max(0,s),s=Math.min(s,150),n=a.fromRatio({h:d/360,s:l/200,v:1-s/150,a:c.a}),n.isValid()&&(o.color=n,o.updateBoardPoint(l-4,s-4),o.updatePreview(),o.updateAlpha(),o.updateInputHex(),o.updateInputG(),o.updateInputB(),o.updateInputR())},onAlphaMousedown:function(e){var t=this;t.onAlphaDrag(e),t.removeWindowListeners(),i(window).on("mousemove",t.onAlphaDrag),i(window).on("mouseup",t.onAlphaDragEnd)},onAlphaDrag:function(e){var t=this,n=e.clientX,o=e.clientY;e.preventDefault(),t.alphaMoveTo({x:n,y:o})},onAlphaDragEnd:function(e){var t=this;t.onAlphaDrag(e),t.removeWindowListeners()},alphaMoveTo:function(e){var t,n=this,o=n.alpha.getBoundingClientRect(),i=o.width,r=e.x-o.left;r=Math.max(0,r),r=Math.min(r,i),t=r/i,n.color.setAlpha(t),n.updateAlpha(100*t),n.updatePreview(),n.updateInputA()},onRibbonMousedown:function(e){var t=this;t.onRibbonDrag(e),t.removeWindowListeners(),i(window).on("mousemove",t.onRibbonDrag),i(window).on("mouseup",t.onRibbonDragEnd)},onRibbonDrag:function(e){var t=this,n=e.clientX,o=e.clientY;e.preventDefault(),t.ribbonMoveTo({x:n,y:o})},onRibbonDragEnd:function(e){var t=this;t.onRibbonDrag(e),t.removeWindowListeners()},ribbonMoveTo:function(e){var t,n,o=this,i=o.ribbon.getBoundingClientRect(),r=i.width,l=e.x-i.left,s=o.color.toHsv();l=Math.max(0,l),l=Math.min(l,r),t=l/r,n=a.fromRatio({h:t,s:s.s,v:s.v,a:s.a}),n.isValid()&&(o.color=n,o.updateRibbon(100*t),o.updateBoardBg(360*t),o.updatePreview(),o.updateAlpha(),o.updateInputHex(),o.updateInputR(),0===o.mode&&(o.updateInputG(),o.updateInputB()))},onHexChange:function(){var e,t=this,n=i(t.inputHex).val();n.length>0&&n.length<6&&(n=n.concat("0".repeat(6-n.length))),e=a(n),e.isValid()&&(e.setAlpha(t.color.getAlpha()),t.color=e,t.updateOnHexChange())},updateOnHexChange:function(){var e=this;e.updateBoardPoint(),e.updateBoardBg(),e.updatePreview(),e.updateAlpha(),e.updateRibbon(),e.updateInputR(),e.updateInputG(),e.updateInputB()},onRedChange:function(){var e=this,t=i(e.inputR).val(),n=e.mode,r=e.color.toHsv(),l=e.color.toRgb(),s=e.color.toHsl();t=parseInt(t),o.isNumber(t)&&!o.isNaN(t)&&(t<0||t>c[n][0]||(e.color=1===n?a.fromRatio({h:t/360,s:r.s,v:r.v,a:r.a}):2===n?a.fromRatio({h:t/360,s:s.s,l:s.l,a:s.a}):a({r:t,g:l.g,b:l.b,a:l.a}),e.updateOnRedChange()))},updateOnRedChange:function(){var e=this;0===e.mode&&e.updateBoardPoint(),e.updateBoardBg(),e.updatePreview(),e.updateAlpha(),e.updateRibbon(),e.updateInputHex()},onGreenChange:function(){var e=this,t=i(e.inputG).val(),n=e.mode,r=e.color.toHsv(),l=e.color.toRgb(),s=e.color.toHsl();t=parseInt(t),o.isNumber(t)&&!o.isNaN(t)&&(t<0||t>c[n][1]||(e.color=1===n?a.fromRatio({h:r.h,s:t/100,v:r.v,a:r.a}):2===n?a.fromRatio({h:s.h,s:t/100,l:s.l,a:s.a}):a({r:l.r,g:t,b:l.b,a:l.a}),e.updateOnGreenChange()))},updateOnGreenChange:function(){var e=this;e.updateBoardPoint(),0===e.mode&&(e.updateBoardBg(),e.updateRibbon()),e.updatePreview(),e.updateAlpha(),e.updateInputHex()},onBlueChange:function(){var e=this,t=i(e.inputB).val(),n=e.mode,r=e.color.toHsv(),l=e.color.toRgb(),s=e.color.toHsl();t=parseInt(t),o.isNumber(t)&&!o.isNaN(t)&&(t<0||t>c[n][2]||(e.color=1===n?a.fromRatio({h:r.h,s:r.s,v:t/100,a:r.a}):2===n?a.fromRatio({h:s.h,s:s.s,l:t/100,a:s.a}):a({r:l.r,g:l.g,b:t,a:l.a}),e.updateOnBlueChange()))},updateOnBlueChange:function(){var e=this;e.updateBoardPoint(),0===e.mode&&(e.updateBoardBg(),e.updateRibbon()),e.updatePreview(),e.updateAlpha(),e.updateInputHex()},onAlphaChange:function(){var e=this,t=i(e.inputA).val();t=parseInt(t),o.isNumber(t)&&!o.isNaN(t)&&(t<0||t>100||(e.color.setAlpha(t/100),e.updateOnAlphaChange()))},updateOnAlphaChange:function(){var e=this;e.updatePreview(),e.updateAlpha()},onParamsLabelClick:function(){var e=this,t=e.mode;t+=1,t%=3,e.mode=t,e.updateInputR(),e.updateInputB(),e.updateInputG()},onKeyDown:function(e){var t=this;l.isMatch("enter",e.keyCode)&&(e.stopPropagation(),e.preventDefault(),t.hidePicker(),t.editor.focus())},onLastInputKeyDown:function(e){var t=this;(l.isMatch("enter",e.keyCode)||l.isMatch("tab",e.keyCode))&&(e.stopPropagation(),e.preventDefault(),t.hidePicker(),t.editor.focus())},inputValue:function(e,t){var n,o=this,i=o.color,r=i.toRgb(),a=i.toHsv(),l=i.toHsl(),c=1;switch(e){case 0:n=r;break;case 1:n=a;break;case 2:n=l;break;default:n=r}return(0===e||1!==t&&2!==t)&&3!==t||(c=100),Math.round(n[s[e][t]]*c)},updateInputHex:function(){var e=this,t=e.color;i(e.inputHex).val(t.toHex().toUpperCase())},updateInputR:function(){var e=this,t=e.mode;i(e.labelR).text(s[t][0].toUpperCase()),i(e.inputR).val(e.inputValue(t,0))},updateInputG:function(){var e=this,t=e.mode;i(e.labelG).text(s[t][1].toUpperCase()),i(e.inputG).val(e.inputValue(t,1))},updateInputB:function(){var e=this,t=e.mode;i(e.labelB).text(s[t][2].toUpperCase()),i(e.inputB).val(e.inputValue(t,2))},updateInputA:function(){var e=this,t=e.color,n=t.getAlpha();i(e.inputA).val(Math.round(100*n))},updateBoardBg:function(e){var t,n=this,o=n.color,i=o.toHsv(),r=n.boardBg;e>=0&&e<=360||(e=i.h),t=a.fromRatio({h:e/360,s:1,v:1}),r.css("background-color",t.toHexString())},updateBoardPoint:function(e,t){var n=this,o=n.color,r=o.toHsv(),a=i(n.board).find("span");e>=0&&e<=200||(e=200*r.s-4),t>=0&&t<=150||(t=150*(1-r.v)-4),a.css("left",e+"px"),a.css("top",t+"px")},updatePreview:function(){var e=this,t=e.color,n=t.getAlpha(),o=i(e.preview).find("span");o.css("background-color",t.toHexString()),o.css("opacity",n)},updateAlpha:function(e){var t,n=this,o=n.color,r=o.toRgb(),l=i(n.alpha).find(".color-picker-panel-alpha-bg"),s=i(n.alpha).find("span");e>=0&&e<=100||(e=100*r.a),t="linear-gradient(to right, "+a({r:r.r,g:r.g,b:r.b,a:0}).toRgbString()+", "+a({r:r.r,g:r.g,b:r.b,a:1}).toRgbString()+")",l.css("background",t),s.css("left",e+"%")},updateRibbon:function(e){var t=this,n=t.color,o=n.toHsv(),r=o.h,a=i(t.ribbon).find("span");e>=0&&e<=100||(e=Math.round(r/360*100)),a.css("left",e+"%")},updateUI:function(){var e=this;e.updateBoardBg(),e.updateBoardPoint(),e.updatePreview(),e.updateAlpha(),e.updateRibbon(),e.updateInputHex(),e.updateInputA(),e.updateInputR(),e.updateInputB(),e.updateInputG(),e.updateInputHex()},reset:function(){this.$el.hide()}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){"use strict";var o;void 0!==(o=function(e){var t=n(12),o=n(16),i=n(0),r=n(81),a=n(8),l=n(1),s=n(164),c=function(){};return o.View.extend({className:"image-title-input-wrapper",name:"ImageTitleInputView",events:{"keydown .image-title-input":"_onKeyDown","paste .image-title-input":"_onPaste","input .image-title-input":"_onInput"},zoom:1,initialize:function(e){var t=this;t.editor=e.editor,i.bindAll(t,"_onEditStart","_onEditEnd","_onKeyDown","_onExit","_onUpdate","_getPosition","_onPaste","_show","_hide","_onInput","_handlerPlaceholder","_onLockedChange"),t.on("img-title-edit-start",t._onEditStart),t.on("img-title-edit-end",t._onEditEnd),t.on("img-title-edit-focus",t._onFocus),t.on("img-title-edit-exit",t._onExit),t.on("img-title-edit-update",t._onUpdate),t.on("locked-change",t._onLockedChange),t._callback=c},render:function(){var e=t.render("common","image-title-input",{title:""});this.$el.html(e)},_getPosition:function(e){var t=this.editor.getNoteViewWrapper(),n=a.IS_PC?this.editor.getNoteViewFrame():this.editor.noteView.$el,o=n.offset(),i=parseInt(n.css("margin-top"));e.left=e.left-t.offset().left+t.scrollLeft(),e.top=e.top-o.top+i},_show:function(){var e=this._origialNode;this.$el.show(),e&&e.css("color","transparent")},_hide:function(){var e=this._origialNode;e&&(e.css("color",""),e.css("height","auto")),this.$el.hide()},_onEditStart:function(e,n,o,r,a){var l,s=this,u=n();s.getOffset=n,s._getPosition(u),s._callback!==c&&s._onEditEnd(),e||(e=""),l=t.render("common","image-title-input",i.defaults({title:e},u)),s.$el.html(l),s.$input=this.$el.find(".image-title-input"),s.$placeholder=this.$el.find(".image-title-placeholder"),s.$input.on("blur",function(){s._handlerPlaceholder(),s._onEditEnd()}).on("focus",function(){s._handlerPlaceholder(),s.editor.controller.lockBlockById(a)}),s._callback=o||c,s._origialNode=r,s._handlerPlaceholder(),e&&s._show(),s.$placeholder.click(function(){s.$input.focus()})},_onEditEnd:function(e,t){if(this.$input&&this.$input.is(":visible")){var n=this.$input.text();this._callback(n,e,t,this.$el.is(":visible"))}},_onKeyDown:function(e){if(this.$input.is(":visible")&&r.isMatch("enter",e.keyCode)&&i.isFunction(this._onEditEnd))return e.preventDefault(),this._onEditEnd(!0,this.editor.controller.getNextCaretBlockRange()),void this._onExit();(e.ctrlKey||e.metaKey)&&["B","b","U","u","I","i"].forEach(function(t){if(r.isMatch(t,e.keyCode))return void e.preventDefault()})},_onFocus:function(){var e=this.$input;e&&e.is(":visible")||this._show(),e.focus()},_onExit:function(){this._hide(),this._callback=c},_onUpdate:function(e){var t=e();this.getOffset=e,this._getPosition(t),this.$input.css({left:t.left,top:t.top,width:t.width+"px","min-height":t.height+"px"}),this.$placeholder.css({left:t.left,top:t.top,width:t.width+"px"})},_handlerPlaceholder:function(){var e=this;e.$input.text()?e.$placeholder.hide():e.$placeholder.show()},setZoom:function(e){var t=this;t.zoom=e,t.$el.css("zoom",t.zoom)},_transferString:function(e){var t=e;try{t=t.replace(/\r\n/g," "),t=t.replace(/\n/g," ")}catch(e){l.log("replace image title line break failed!")}return t},_onPaste:function(e){var t,n,o=e.originalEvent;e.preventDefault(),o.clipboardData&&o.clipboardData.getData?(t=o.clipboardData.getData("text/plain"),n=this._transferString(t),document.execCommand("insertHTML",!1,n)):window.clipboardData&&window.clipboardData.getData&&(t=window.clipboardData.getData("Text"),s(t))},_onInput:function(){var e=this.$input.height();e!==this._origialNode.height()&&this._origialNode.height(e),this._handlerPlaceholder()},_onLockedChange:function(){this.getOffset&&this._onUpdate(this.getOffset)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(16),o=n(0),i=n(7),r=n(12),a=n(81),l=n(8),s=n(2),c=n(87),u=n(14);return t.View.extend({className:"link-view",templateName:"link_view",zoom:1,events:{"click .link-confirm-button":"onConfirmButtonClick","click .link-modify-button":"onModifyButtonClick","click .link-remove-button":"onRemoveButtonClick","keydown .link-input":"onKeyDown",mousedown:"onMouseDown",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},initialize:function(e){var t=this;t.editor=e.editor,t.on("link-menu-show",t.timeoutToShowMenu),t.on("link-menu-hide",t.timeoutToHideMenu),t.bindDocumentEvents(),t.modifyMode=!1,t.on("locked-change",t.recalPosition),i(window).on("resize",t.recalPosition.bind(t))},render:function(){var e,t=this,n=t.$el;e=r.render("common",t.templateName,{link:c.safeHref(t.link),isReadOnly:t.editor.isReadOnly()}),n.html(e),t.menuPreviewLink=n.find(".hover-menu-show-link"),t.menuModifyLink=n.find(".hover-menu-modify-link"),t.input=n.find(".link-input"),t.hideModifyMenu()},bindDocumentEvents:function(){var e=this;o.bindAll(e,"onDocumentMouseDown"),i(document).on("mousedown",e.onDocumentMouseDown)},onKeyDown:function(e){var t=this;e.stopPropagation(),a.isMatch("enter",e.keyCode)&&(e.preventDefault(),t.onConfirmButtonClick())},onDocumentMouseDown:function(){this.fadeOutMenu()},onMouseDown:function(e){e.stopPropagation()},onConfirmButtonClick:function(){var e=this,t=e.range,n=c.safeHref(i(e.input).val());if(n===e.link)return void e.fadeOutMenu();window.focus(),n&&e.editor.execCommand("comp.InsertLink",{src:n,range:t}),e.fadeOutMenu()},onRemoveButtonClick:function(){var e=this,t=e.range,n={href:"",color:"#393939",underline:!1};s.isCatalogue(e.block)?e.editor.execCommand("atom.SetCatalogueHref",{range:t,block:e.block,href:null}):e.editor.execCommand("comp.ApplyStyles",{range:t,inlineStyles:n}),e.fadeOutMenu()},onModifyButtonClick:function(){var e=this;e.hidePreviewMenu(),e.showModifyMenu()},showMenu:function(e){var t=this,n=e.range.clone(),o=e.linkNode.href;if(s.isCatalogue(e.block)&&(o=e.block.getViewHref()),!t.modifyMode&&o){var i=new RegExp("^note://");o.match(i)||(t.hideTimerId&&(clearTimeout(t.hideTimerId),t.hideTimerId=null),t.link&&t.hideMenu(),t.linkNode=e.linkNode,t.link=o,t.block=e.block,t.blockId=e.block.getId(),t.range=new u({startRange:n,endRange:n}),t.render(),t.showPreviewMenu())}},recalPosition:function(){var e=this;e.link&&e.modifyMode&&e.setPosition()},setPosition:function(){var e,t,n,r,a,s,c,u,d,p,h,g,f,m=this,_=m.linkNode,y=m.editor.noteView,v=m.editor.getNoteViewWrapper(),b=this.editor.getNoteViewWrapper(),k=l.IS_PC?this.editor.getNoteViewFrame().offset():this.editor.noteView.$el.offset();e=i(_).offset(),e.left=e.left-b.offset().left+b.scrollLeft()/m.zoom,e.top=e.top-k.top,t=e.top+i(_).outerHeight(),n=e.left+i(_).outerWidth()/2,c=e.left,h=m.$el.find(".hover-menu-before"),a=i(h[0]).outerWidth()/2,s=i(h[0]).outerHeight(),u=t+s,n-c-a<15&&(c=n-15-a),d=m.modifyMode?m.$el.find(".hover-menu-modify-link .hover-menu-body").outerWidth():m.$el.find(".hover-menu-show-link .hover-menu-body").outerWidth(),p=y.$el.outerWidth()-30,v.hasClass("read-mode")&&(p+=parseInt(v.find(".note-view-frame").css("margin-left"))),c+d>p&&(c=p-d),r=n-c-a,g=i(_).outerHeight(),f=parseFloat(i(_).css("line-height")),g>f&&(c=e.left-15-a,r=15),m.$el.css("left",c),m.$el.css("top",u),o.each(h,function(e){i(e).css("left",r)})},setZoom:function(e){var t=this;t.zoom=e,t.$el.css("zoom",t.zoom)},showPreviewMenu:function(){var e=this,t=e.menuPreviewLink;e.setPosition(),i(t).show()},hidePreviewMenu:function(){var e=this,t=e.menuPreviewLink;i(t).hide()},fadeOutPreviewMenu:function(){var e=this,t=e.menuPreviewLink;i(t).fadeOut()},showModifyMenu:function(){var e=this,t=e.menuModifyLink;e.modifyMode=!0,e.editor.controller.lockBlockById(e.blockId),e.setPosition(),i(t).show()},hideModifyMenu:function(){var e=this,t=e.menuModifyLink;i(t).hide(),e.modifyMode=!1},fadeOutModifyMenu:function(){var e=this,t=e.menuModifyLink;i(t).fadeOut(),e.modifyMode=!1},hideMenu:function(){var e=this;e.stay||(e.hideModifyMenu(),e.hidePreviewMenu(),e.link=null)},fadeOutMenu:function(){var e=this;e.fadeOutModifyMenu(),e.fadeOutPreviewMenu(),e.link=null,e.range=null,e.linkNode=null,e.hideTimerId=null,e.blockId=null,e.block=null,e.showTimerId&&(clearTimeout(e.showTimerId),e.showTimerId=null)},onMouseEnter:function(e){var t=this;e.stopPropagation(),t.hideTimerId&&(clearTimeout(t.hideTimerId),t.hideTimerId=null)},onMouseLeave:function(){this.trigger("link-menu-hide")},timeoutToHideMenu:function(){var e=this;e.modifyMode||e.hideTimerId||(e.hideTimerId=setTimeout(function(){e.fadeOutMenu()},100))},timeoutToShowMenu:function(e){var t=this;t.showTimerId||(t.showTimerId=setTimeout(function(){t.showMenu(e)},500))}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(366);return[n(367),n(368),n(369),n(370),n(371),n(372),n(373),n(374),n(375),n(376),n(377),n(378),n(379),t,n(380),n(381),n(382),t,n(383),n(384),n(385),t,n(386),n(387)]}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(13)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){},t.prototype.selectAction=function(){},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="split",this.label="---",this.type=n.TYPE.SPLIT},t}(n),i=new o({});return function(){return i}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(13)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return this.block=t.imgBlock,!!t.imgBlock},t.prototype.selectAction=function(){this.block&&this.block.trigger("edit-image-title")},t.prototype.reset=function(){e.prototype.reset.call(this),this.block=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="imageTitle",this.label="标题"},t}(n),i=new o({});return function(){return i}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(13)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return this.editor.canUndo()},t.prototype.selectAction=function(){this.editor.undo()},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="undo",this.label="撤销",this.key="mod+z"},t}(n),i=new o({});return function(){return i}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(13)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return this.editor.canRedo()},t.prototype.selectAction=function(){this.editor.redo()},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="redo",this.label="重做",this.key="mod+y"},t}(n),i=new o({});return function(){return i}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(8),n(13)],void 0!==(i=function(e,t,n,o){"use strict";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){var n=e.target,o=n.ownerDocument;if(t.isRangeCollapsed)return void(this.isDisabled=!0);this.doc=o,this.targetEl=n},t.prototype.selectAction=function(){var e,t,o,i,r,a,l=this,s=l.doc,c=l.editor,u=l.targetEl;if(e=c.getNoteRange(),e.isSingleTableSelected()&&(t=e.getStartBlockRange(),o=t.block,i=c.getController().noteView,r=i.getBlockViewByBlock(o),u=r.getHiddenInputView()),u.focus(),n.IS_MAC)return void c.callMacNativeApi("menuCut");try{a=s.execCommand("cut")}catch(e){a=!1}a||c.trigger("yne-clipboard-error","cut",function(){c.focus()})},t.prototype.reset=function(){e.prototype.reset.call(this),this.doc=null,this.targetEl=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="cut",this.label="剪切",this.key="mod+x"},t}(o),a=new i({});return function(){return a}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(8),n(13)],void 0!==(i=function(e,t,n,o){"use strict";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){var n=e.target,o=n.ownerDocument;if(t.isRangeCollapsed)return void(this.isDisabled=!0);this.targetEl=n,this.doc=o},t.prototype.selectAction=function(){var e,t,o,i,r,a,l=this,s=l.doc,c=l.editor,u=l.targetEl;if(e=c.getNoteRange(),e.isSingleTableSelected()&&(t=e.getStartBlockRange(),o=t.block,i=c.getController().noteView,r=i.getBlockViewByBlock(o),u=r.getHiddenInputView()),u.focus(),n.IS_MAC)return void c.callMacNativeApi("menuCopy");try{a=s.execCommand("copy")}catch(e){a=!1}a||c.trigger("yne-clipboard-error","copy",function(){c.focus()})},t.prototype.reset=function(){e.prototype.reset.call(this),this.doc=null,this.targetEl=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="copy",this.label="复制",this.key="mod+c"},t}(o),a=new i({});return function(){return a}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(8),n(13)],void 0!==(i=function(e,t,n,o){"use strict";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){var o,i=e.target,r=i.ownerDocument;return this.targetEl=i,this.doc=r,n.IS_MAC&&(o=this.editor.callMacNativeApi("macClipboardAvailable"),this.isDisabled=!o),!0},t.prototype.selectAction=function(){var e,t,o,i,r,a=this,l=a.editor,s=l.getNoteRange(),c=a.doc,u=a.targetEl;if(s.isSingleTableSelected()&&(t=s.getStartBlockRange(),e=t.block,o=l.getController().noteView,i=o.getBlockViewByBlock(e),i.setPasteAsText(!1),u=i.getHiddenInputView()),u.focus(),n.IS_MAC)return l.setPasteAsText(!1),void l.callMacNativeApi("menuPaste");try{r=c.execCommand("paste")}catch(e){r=!1}r||this.editor.trigger("yne-clipboard-error","paste",function(){a.editor.focus()})},t.prototype.reset=function(){e.prototype.reset.call(this),this.doc=null,this.targetEl=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="paste",this.label="粘贴"},t}(o),a=new i({});return function(){return a}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(13),o=n(0);return function(){return new t({name:"pasteNoteLink",label:"粘贴引用链接",key:"mod+v",_linkId:null,_linkName:null,queryAction:function(){var e=this,t=e.editor;e._linkId=e._linkName=null,e.isDisabled=e.isHidden=!0,t.trigger("yne-require-innerlink",function(t,n){var i=o.isUndefined(t)||o.isUndefined(n);e.isDisabled=e.isHidden=i,i||(e._linkId=t,e._linkName=n)})},selectAction:function(){var e=this;e.editor.insertNoteLink(e._linkId,e._linkName)}})}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(8),n(13)],void 0!==(i=function(e,t,n,o){"use strict";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){var o,i=e.target;return this.targetEl=i,n.IS_MAC&&(this.isHidden=!1,o=this.editor.callMacNativeApi("macClipboardAvailable"),this.isDisabled=!o),!0},t.prototype.selectAction=function(){var e,t,o,i,r=this,a=this.editor,l=a.getNoteRange(),s=this.targetEl;if(l.isSingleTableSelected()&&(t=l.getStartBlockRange(),e=t.block,o=a.getController().noteView,i=o.getBlockViewByBlock(e),i.setPasteAsText(!0),s=i.getHiddenInputView()),s.focus(),n.IS_MAC)return a.setPasteAsText(!0),void a.callMacNativeApi("menuPaste");this.editor.trigger("yne-clipboard-error","paste-as-text",function(){r.editor.focus()})},t.prototype.reset=function(){e.prototype.reset.call(this),this.targetEl=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="pasteAsText",this.label="纯文本粘贴"},t}(o),a=new i({});return function(){return a}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(13)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){var n=this.editor.canRemoveFormat()&&!t.isImgAttachBlock&&!t.tableInfo;return this.isDisabled=!n,!t.tableInfo&&!t.isImgAttachBlock},t.prototype.selectAction=function(){this.editor.execCommand("comp.RemoveFormat")},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="removeFormat",this.label="清除格式"},t}(n),i=new o({});return function(){return i}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(13)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return!t.isImgAttachBlock&&!t.tableInfo},t.prototype.selectAction=function(){this.editor.selectAll()},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="selectAll",this.label="全选"},t}(n),i=new o({});return function(){return i}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(13)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return!t.isImgAttachBlock&&!t.tableInfo},t.prototype.selectAction=function(){var e=this.editor,t=this.editor.countWords(!0),n=t.count,o=t.isSelected,i=t.detail;e.trigger("yne-show-words",n,o,i)},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="countWords",this.label="统计字数"},t}(n),i=new o({});return function(){return i}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(53),n(13)],void 0!==(i=function(e,t,n,o){"use strict";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return this.block=t.imgBlock||t.attachmentBlock,this.isImg=!!t.imgBlock,this.tableInfo=t.tableInfo,!!t.isImgAttachBlock||!(!t.tableInfo||!t.tableInfo.cell)},t.prototype.selectAction=function(){var e=this.block,t=this.isImg,o=this.tableInfo;o&&(e=o.cell.getContent(),o.type===n.IMAGE&&(t=!0)),t?this.editor.trigger("yne-download-image",e.getSource()):this.editor.trigger("yne-download-attachment",e.getResource(),e.getFileName())},t.prototype.reset=function(){e.prototype.reset.call(this),this.block=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="download",this.label="另存为"},t}(o),a=new i({});return function(){return a}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(13)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){var n=this.editor;return this.noteRange=n.getNoteRange(),!!t.isImgAttachBlock},t.prototype.selectAction=function(){this.editor.execCommand("comp.DeleteNoteRange",{range:this.noteRange})},t.prototype.reset=function(){e.prototype.reset.call(this),this.noteRange=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="delete",this.label="删除"},t}(n),i=new o({});return function(){return i}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(43),n(13)],void 0!==(i=function(e,t,n,o){"use strict";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.InsertTableRowCol",{describe:{row:n.UP}})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="insertRowUp",this.label="在上方插入行"},t}(o),a=new i({});return function(){return a}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(43),n(13)],void 0!==(i=function(e,t,n,o){"use strict";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.InsertTableRowCol",{describe:{row:n.DOWN}})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="insertRowDown",this.label="在下方插入行"},t}(o),a=new i({});return function(){return a}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(13)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.DeleteTableRowCol",{describe:{row:!0}})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="deleteRow",this.label="删除整行"},t}(n),i=new o({});return function(){return i}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(43),n(13)],void 0!==(i=function(e,t,n,o){"use strict";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.InsertTableRowCol",{describe:{col:n.LEFT}})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="insertColLeft",this.label="在左侧插入列"},t}(o),a=new i({});return function(){return a}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(43),n(13)],void 0!==(i=function(e,t,n,o){"use strict";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.InsertTableRowCol",{describe:{col:n.RIGHT}})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="insertColRight",this.label="在右侧插入列"},t}(o),a=new i({});return function(){return a}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(13)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.DeleteTableRowCol",{describe:{col:!0}})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="deleteCol",this.label="删除整列"},t}(n),i=new o({});return function(){return i}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(13)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo&&(t.tableInfo.onlyMergePointAndCell?(this.label="取消合并单元格",!0):!1===t.tableInfo.onlyOneCell&&(this.label="合并单元格",!0))},t.prototype.selectAction=function(){this.editor.execCommand("comp.ToggleMergeTableCell",{})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="mergeCell",this.label="合并单元格"},t}(n),i=new o({});return function(){return i}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(13)],void 0!==(i=function(e,t,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.DeleteNoteRange",{isTableDelete:!0})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="deleteTable",this.label="删除整个表格"},t}(n),i=new o({});return function(){return i}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(389),o=n(0),i=n(1),r=!1;return{checkNativeApi:function(){var e=window.ynote||{};e?o.each(t,function(t,n){null==e[n]&&i.error("Native does not implement api: "+n)}):i.error("window.ynote does not exist!")},callNativeApi:function(e,t){var n,o=this,a=window.ynote||{};if(r||(o.checkNativeApi(),r=!0),n=a[e])return n.apply(a,t||[]);i.error("No native api: "+e)}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(){return{menuCopy:function(){},menuPaste:function(){},macClipboardAvailable:function(){},macClipboardData:function(e){}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){n(104);var t=n(16),o=n(0),i=n(7),r=n(2),a=n(391),l=n(8),s=n(392),c=[n(393),n(394),n(395),n(396),n(165),n(398),n(48),n(399),n(48),n(400),n(401),n(402),n(403),n(404),n(48),n(405),n(408),n(165),n(409),n(410),n(411),n(48),n(412),n(413),n(48),n(414),n(415),n(416),n(417),n(418),n(419),n(420),n(48),n(421),n(422),n(423),n(424),n(425),n(426),n(427)],u=n(428),d=[];return l.IS_MAC||c.push(s),t.View.extend({className:"bulb-toolbar",events:{mousedown:"_onMouseDown"},_lastRangeType:null,initialize:function(e){var t=this,n=e.editor;t.editor=n,t.items=[],t.initItems(),t.bindEvents(),t.isRendered=!1},initItems:function(){var e=this,t=e.editor;o.each(c,function(n){e.addItem(new n({editor:t}))}),e.showMore=new u({editor:t,items:d}),e.addItem(e.showMore)},bindEvents:function(){var e=this,t=e.editor,n=a.EDITOR_BUTTON_STATE_MAP;t.on("yne-editing-state-change",function(){var i,l=t.getNoteRange(),s=a.RANGE_DEFAULT;l&&(i=l.getStartBlockRange().block,r.isHeaderFooter(i)?s=a.RANGE_HEADER_FOOTER:r.isImage(i)?s=a.RANGE_IMAGE:r.isAttachment(i)?s=a.RANGE_ATTACHMENT:l.isSingleTableSelected()?s=a.RANGE_TABLE_CELL:r.isCatalogue(i)&&(s=a.RANGE_CATALOGUE)),e._lastRangeType!==s&&(e._lastRangeType=s,o.each(e.items,function(e){var t,i=n[e.name],r=a.ACTION_SHOW_ENABLE;switch(o.each(i,function(e){e.on===a.RANGE_DEFAULT&&(r=e.action),e.on===s&&(t=e.action)}),null==t&&(t=r),t){case a.ACTION_SHOW_ENABLE:e.show(),e.enable();break;case a.ACTION_HIDE:e.hide();break;case a.ACTION_ENABLE:e.enable();break;case a.ACTION_DISABLE:e.show(),e.disable()}}),e.reShrink())})},render:function(){var e=this,t=this.items,n=this.$el;o.each(t,function(t){n.append(t.$el),t.on("re-shrink",o.throttle(e.reShrink.bind(e),100))}),e.isRendered=!0,i(window).on("resize",e.reShrink.bind(e))},reset:function(){var e=this;o.each(e.items,function(e){e&&e.reset&&e.reset()})},addItem:function(e){this.items.push(e)},addItems:function(e){this.items.concat(e)},show:function(){var e=this,t=this.items;o.each(t,function(t){e.$el.append(t.$el)}),e.$el.show(),e.shrink()},hide:function(){var e=this;e.$el.hide(),e.showMore.hideMenu()},reShrink:function(){var e=this,t=this.items,n=this.$el;o.each(t,function(e){n.append(e.$el)}),e.shrink()},shrink:function(){var e,t,n=this,i=n.items,r=n.$el.parent().width(),a=o.last(i).$el,l=a.outerWidth(!0),s=l,c=0;d=[],o.map(i,function(n,o){var a,l=n.isVisible;if(o===i.length-1)return n.items=d,e=n.$el.find(".combo-menu"),t=r-100,c>t?e.css("width",t).css("white-space","normal"):e.css("width","").css("white-space",""),void n.resetMenu();l?(a=n.$el.outerWidth(!0),s+=a):a=0,r<s&&(c+=a,d.push(n))}),0===d.length?a.hide():a.show()},_onMouseDown:function(e){e.preventDefault()},_invoke:function(e){var t=this;o.each(t.items,function(t){t[e]&&t[e]()})},enable:function(){var e=this;e.$el.removeClass("disabled"),e._invoke("enable")},disable:function(){var e=this;e.$el.addClass("disabled"),e._invoke("disable")}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){"use strict";var t=n(0),o={ACTION_SHOW_ENABLE:1,ACTION_HIDE:2,ACTION_ENABLE:3,ACTION_DISABLE:4},i={RANGE_DEFAULT:1,RANGE_HEADER_FOOTER:2,RANGE_TABLE_CELL:3,RANGE_CATALOGUE:4,RANGE_IMAGE:5,RANGE_ATTACHMENT:6},r={EDITOR_BUTTON_STATE_MAP:{undo:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE}],redo:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE}],"remove-format":[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],"format-painter":[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],"no-table-split":[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_HIDE}],heading:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_HIDE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],"base-split":[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE}],"font-family":[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],"font-size":[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],bold:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],italic:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],underline:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],strike:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],color:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],"back-color":[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],"unordered-list":[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_HIDE},{on:i.RANGE_CATALOGUE,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],"ordered-list":[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_HIDE},{on:i.RANGE_CATALOGUE,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],todo:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_HIDE},{on:i.RANGE_CATALOGUE,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],quote:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_HIDE},{on:i.RANGE_CATALOGUE,action:o.ACTION_DISABLE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],align:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE}],"table-justify":[{on:i.RANGE_DEFAULT,action:o.ACTION_HIDE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_SHOW_ENABLE}],indent:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_HIDE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],outdent:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_HIDE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],"line-height":[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_HIDE},{on:i.RANGE_IMAGE,action:o.ACTION_DISABLE},{on:i.RANGE_ATTACHMENT,action:o.ACTION_DISABLE}],"table-wrap":[{on:i.RANGE_DEFAULT,action:o.ACTION_HIDE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_SHOW_ENABLE}],"table-operate":[{on:i.RANGE_DEFAULT,action:o.ACTION_HIDE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_SHOW_ENABLE}],"table-split":[{on:i.RANGE_DEFAULT,action:o.ACTION_HIDE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_SHOW_ENABLE}],"table-merge":[{on:i.RANGE_DEFAULT,action:o.ACTION_HIDE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_SHOW_ENABLE}],table:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_HIDE},{on:i.RANGE_CATALOGUE,action:o.ACTION_DISABLE}],hr:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_HIDE},{on:i.RANGE_CATALOGUE,action:o.ACTION_DISABLE}],link:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_CATALOGUE,action:o.ACTION_DISABLE}],img:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_CATALOGUE,action:o.ACTION_DISABLE}],attachment:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_CATALOGUE,action:o.ACTION_DISABLE}],catalogue:[{on:i.RANGE_DEFAULT,action:o.ACTION_SHOW_ENABLE},{on:i.RANGE_HEADER_FOOTER,action:o.ACTION_DISABLE},{on:i.RANGE_TABLE_CELL,action:o.ACTION_HIDE},{on:i.RANGE_CATALOGUE,action:o.ACTION_DISABLE}]}};return t.extend(r,o,i)}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(32),o=t.extend({name:"view-mode",label:"视图切换",defaultState:!1,state:!1,templateName:"toolbar-button-template",render:function(){var e,t=this;o.__super__.render.apply(t,arguments),e=t.$el.find(".button"),e.addClass("normal"),t.editor.on("view-mode-change",function(n){var o=2===n;o?(e.removeClass("normal"),e.addClass("page")):(e.removeClass("page"),e.addClass("normal")),t.state=o})},onClick:function(){var e=this,t=!0===e.state,n=t?0:2;e.editor.setViewMode(n,!0,!0)}});return o}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(32).extend({name:"undo",label:"撤销",defaultState:!1,state:!1,templateName:"toolbar-button-template",editorEvents:{"command-exec":"_onHistoryChange","undo-stack-change":"_onHistoryChange","cell-edit-view-exit":"_onHistoryChange","cell-edit-view-enter":"_onCellEditViewHistoryChange","cell-edit-view-history-change":"_onCellEditViewHistoryChange"},_onHistoryChange:function(){var e=this;e.setState(e.editor.canUndo())},_onCellEditViewHistoryChange:function(e){this.setState(e.canUndo)},onClick:function(){var e=this;!0===e.state&&e.editor.execCommandByToolbar("undo")}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(32).extend({name:"redo",label:"重做",defaultState:!1,state:!1,templateName:"toolbar-button-template",editorEvents:{"command-exec":"_onHistoryChange","redo-stack-change":"_onHistoryChange","cell-edit-view-exit":"_onHistoryChange","cell-edit-view-enter":"_onCellEditViewHistoryChange","cell-edit-view-history-change":"_onCellEditViewHistoryChange"},_onHistoryChange:function(){var e=this;e.setState(e.editor.canRedo())},_onCellEditViewHistoryChange:function(e){this.setState(e.canRedo)},onClick:function(){var e=this;!0===e.state&&e.editor.execCommandByToolbar("redo")}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(32),o=n(1);return t.extend({name:"remove-format",label:"清除格式",defaultState:!1,state:!1,templateName:"toolbar-button-template",editorEvents:{"yne-selection-change":"_onSelectionChange","yne-editing-state-change":"_onEditingStateChange"},_onEditingStateChange:function(e){var t=this;t.$el.hasClass("disabled")||(e&&null!==e.cellEditViewRangeCollapsed?t.setState(!1===e.cellEditViewRangeCollapsed):t.setState(!0))},_onSelectionChange:function(){var e=this;e.$el.hasClass("disabled")||e.setState(!0)},onClick:function(){var e,t=this;if(!(e=t.editor.getNoteRange())||e.isCollapsed())return o.log("no selected content. skip the action"),void t.editor.resetEditingInlineStates();t.editor.execCommandByToolbar("comp.RemoveFormat",{resetAllStyles:!0})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(32),o=n(397);return t.extend({name:"format-painter",label:"格式刷",events:{click:"onClick",dblclick:"onDblClick",mousedown:"onMouseDown"},defaultState:!1,state:!1,templateName:"toolbar-button-template",initialize:function(){var e=this;t.prototype.initialize.apply(e,arguments),e._initFormatPainterManager()},_initFormatPainterManager:function(){var e=this;e._formatPainterManager=new o({editor:e.editor}),e._formatPainterManager.on("formatpainter-state-change",e.onFormatPainterStateChange.bind(e))},clickAction:function(){var e=this;!0===e.state?e.reset():e.stash(!0)},onClick:function(){var e=this;clearTimeout(e._timer),e._timer=setTimeout(function(){e.clickAction()},300)},onDblClick:function(){var e=this;clearTimeout(e._timer),e.stash()},stash:function(e){this._formatPainterManager.stash(e)},reset:function(){this._formatPainterManager.reset()},onFormatPainterStateChange:function(e){this.setState(!!e)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(15),i=n(7),r=n(16),a=n(0),l=n(6),s=n(22),c={NONE:0,ONCE:1,REPEAT:2};return t={state:null,data:null,initialize:function(e){var t=this;t._editor=e.editor,t.state=c.NONE,a.bindAll(t,"stash","_paintWithDebounce","reset","_onSelectStart","_onCommandExec")},_isLinkStyle:function(e){return e&&e.color&&e.color!==l.INTERM&&s.equals(e.color,"blue")&&!0===e.underline},stash:function(e){var t,n=this,o=n._editor;n.reset(),t=o.querySelectionInlineStyles(),n._isLinkStyle(t)&&t.href&&(delete t.color,delete t.underline),n.data={inlineStyles:t,blockStyles:o.querySelectionBlockStyles()},e?n.setState(c.ONCE):n.setState(c.REPEAT),n.bindEvents()},paint:function(){var e=this;e.data&&e._editor.execCommandByToolbar("comp.FormatPainter",{data:e.data}),e.state===c.ONCE&&e.reset()},reset:function(){var e=this;e._clearPaintTimeout(),e.data=null,e.setState(c.NONE),e.unbindEvents()},setState:function(e){var t=this;t.state!==e&&(t.state=e,t.trigger("formatpainter-state-change",!!e),t.updateFormatPainterCursorUI(!!e))},updateFormatPainterCursorUI:function(e){this._editor.updateFormatPainterCursorUI(e)},bindEvents:function(){var e=this,t=e._editor;e.unbindEvents(),t.on("selectstart",e._onSelectStart),t.on("mouse-down",e._onSelectStart),t.on("esc",e.reset),t.on("command-exec",e._onCommandExec)},unbindEvents:function(){var e=this,t=e._editor;t.off("selectstart",e._onSelectStart),t.off("mouse-down",e._onSelectStart),t.off("esc",e.reset),t.off("command-exec",e._onCommandExec),i(document).off("mouseup",e._paintWithDebounce)},_onSelectStart:function(){var e=this;i(document).one("mouseup",e._paintWithDebounce)},_clearPaintTimeout:function(){var e=this;e._paintTimeout&&(window.clearTimeout(e._paintTimeout),e._paintTimeout=null)},_paintWithDebounce:function(){var e=this;e._clearPaintTimeout(),e._paintTimeout=window.setTimeout(function(){e.paint()},100)},_onCommandExec:function(e){"comp.FormatPainter"!==(e||{}).name&&this.reset()}},a.extend(t,r.Events),o.extend(t)}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(7),o=n(129),i=n(111);return o.extend({name:"heading",label:"标题",defaultValue:"default",items:i.headingArray,templateName:"toolbar-combo-box-heading",editorEvents:{"yne-editing-state-change":"onEditingStateChange","yne-selection-change":"onSelectionChange"},updateValueUI:function(e){var n=this,o=t(n.valueWrapperEl).find(".combo-value")[0];i.headingMap[e]?t(o).text(i.headingMap[e].name):t(o).text(n.getUnlistedText(e)||"")},getUnlistedText:function(e){var t=this;return e?i.headingMap[e].name:i.headingMap[t.defaultValue].name+""},onItemClick:function(e){var t,n,o=this,r=e.textContent.trim();for(t in i.headingMap)if(i.headingMap[t].name===r){n=t;break}o.editor.execCommandByToolbar("comp.InsertHeading",{level:n})},onEditingStateChange:function(){var e=this,t=e.editor.querySelectionBlockStyle(e.name);i.headingMap[t]?e.select(t):e.select(e.defaultValue)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(129),i=n(6),r=n(28),a=n(7);return t=o.extend({name:"font-family",label:"字体",defaultValue:r.DEFAULT_FONT,items:r.getItems(),templateName:"toolbar-combo-box-font-family",getUnlistedText:function(e){var t;return e&&e!==i.INTERM&&(t=r.getFont(e)),t=t||r.splitFontFamily(e)[0]||"微软雅黑"},render:function(){var e,n=this;t.__super__.render.apply(n,arguments),e=n.$el.find(".combo-value-font-family"),a(e).hover(function(){a(n.displayWrapperEl).tooltipster({animation:"",animationDuration:0,content:e.text(),delay:[800,300]})},function(){a(n.displayWrapperEl).tooltipster({animation:"",animationDuration:0,content:n.label,delay:[800,300]})})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(129).extend({name:"font-size",label:"字号",defaultValue:"14",items:{9:"9",12:"12",14:"14",16:"16",18:"18",22:"22",26:"26",30:"30",36:"36",42:"42"},templateName:"toolbar-combo-box-font-size",getUnlistedText:function(e){var t=this,n=parseInt(e,10);return n&&!isNaN(n)?n+"":t.defaultValue+""}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(101),o=n(6);return t.extend({name:"bold",label:"加粗",shortcut:o.IS_MAC?"Command+B":"Ctrl+B"})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(101),o=n(6);return t.extend({name:"italic",label:"斜体",shortcut:o.IS_MAC?"Command+I":"Ctrl+I"})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(101),o=n(6);return t.extend({name:"underline",label:"下划线",shortcut:o.IS_MAC?"Command+U":"Ctrl+U"})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(101),o=n(6);return t.extend({name:"strike",label:"删除线",shortcut:o.IS_MAC?"Command+E":"Ctrl+E"})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(166),o=n(1),i=n(22);return t.extend({name:"color",label:"文字颜色",defaultValue:"#393939",defaultSetValue:"#DF402A",doAction:function(e){var t=this,n={},r=e||t.value,a=i(r);if(!a||!1===a.isValid())return void o.error("tiny color object is not valid",a);n[t.name]=a.toHexString(),t.editor.execCommandByToolbar("comp.ApplyStyles",{inlineStyles:n})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(100),o=n(7),i=n(407);return t.extend({name:"color",defaultValue:"#000000",items:i,templateName:"toolbar-combo-box-color",editorEvents:{"yne-selection-change":"onSelectionChange"},onValueWrapperElClick:function(){var e=this,t=e.value;e.hideMenu(),t!==e.selectedValue&&e.onChange(t)},onChange:function(e){this.doAction(e)},doAction:function(){},onItemClick:function(e){var t=this,n=o(e).data("value");if(o(e).hasClass("color-section-other"))return t.editor.trigger("color-picker-show",t),void t.hideMenu();t.changeValue(n)},changeValue:function(e){var t=this;e&&e!==t.value&&t.select(e),e&&e!==t.selectedValue&&t.onChange(e)},updateValueUI:function(e){var t=this,n=o(t.valueWrapperEl).find(".combo-value-buttom-color")[0];o(n).css("background-color",e)},onSelectionChange:function(){var e=this,t=e.editor.querySelectionInlineStyle(e.name);e.selectedValue=t}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(){return{theme:["#ffffff","#000000","#eeece0","#1c487f","#4d80bf","#c24f4a","#9abc52","#7b5ba1","#46acc8","#f9963b"],other:[["#f2f2f2","#808080","#ddd9c2","#c5d9f2","#dce6f3","#f3dcdb","#ebf1dd","#e6e0ec","#daeef4","#feead9"],["#d9d9d9","#595959","#c4be95","#8db3e5","#b8cde6","#e7b9b7","#d7e5bb","#ccc0db","#b6dee9","#fdd5b3"],["#bfbfbf","#404040","#948b50","#528cd8","#94b2d9","#da9693","#c3d798","#b3a1c8","#91cdde","#fbc08c"],["#a6a6a6","#262626","#4a4528","#15365f","#355f94","#973632","#769436","#60487c","#2c859d","#e66c00"],["#808080","#0d0d0d","#1e1c10","#0f2340","#243f62","#642422","#4f6324","#403053","#1e5969","#994800"]],standard:["#df402a","#f77567","#fad4d3","#fae220","#b19067","#77c94b","#98dede","#184e87","#9896a4","#90a7d1"]}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(166).extend({name:"back-color",label:"背景色",defaultValue:"transparent",defaultSetValue:"#FAE220",templateName:"toolbar-combo-box-back-color",doAction:function(e){var t=this,n={};n[t.name]=e||t.value,t.editor.execCommandByToolbar("comp.ApplyStyles",{inlineStyles:n})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(130),o=n(33),i=n(6);return t.extend({name:"unordered-list",label:"无序列表",defaultState:!1,state:!1,templateName:"toolbar-button-template",shortcut:i.IS_MAC?"Command+L":"Ctrl+L",querySelectionState:function(){return this.editor.isSameList("unordered")},onClick:function(){this.editor.execCommandByToolbar("comp.InsertList",{type:o.UNORDERED})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(130),o=n(33),i=n(6);return t.extend({name:"ordered-list",label:"项目编号",defaultState:!1,state:!1,templateName:"toolbar-button-template",shortcut:i.IS_MAC?"Command+Shift+L":"Ctrl+Shift+L",querySelectionState:function(){return this.editor.isSameList("ordered")},onClick:function(){this.editor.execCommandByToolbar("comp.InsertList",{type:o.ORDERED})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(82),o=n(6);return t.extend({name:"todo",label:"待办",defaultState:!1,state:!1,templateName:"toolbar-button-template",shortcut:o.IS_MAC?"Command+D":"Ctrl+D",onClick:function(){this.editor.execCommandByToolbar("comp.InsertTodo",{checked:!1})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(102),o=n(2),i=n(0),r=n(7),a=t.extend({name:"align",label:"对齐方式",defaultValue:"left",items:{justify:"两端对齐",left:"左对齐",center:"居中对齐",right:"右对齐"},templateName:"toolbar-combo-box-align",updateValueUI:function(e){var t=this,n=r(t.valueWrapperEl).find(".combo-value")[0];r(n).removeClass(i.keys(t.items).join(" ")),r(n).addClass(e)},onChange:function(e){var t,n,i,r,l=this;if(t=l.editor,(i=t.getNoteRange())&&(n=i.getStartBlockRange(),(r=n.block)&&o.isHeaderFooter(r)))return void t.execCommandByToolbar("comp.SetHeaderFooter",{align:e,headerFooter:r,range:n});a.__super__.onChange.apply(l,arguments)},onSelectionChange:function(){var e,t=this,n=t.editor.getNoteRange(),i=n&&n.getStartBlockRange().block;e=i&&o.isHeaderFooter(i)?i.getAlign():t.editor.querySelectionBlockStyle(t.name),t.items[e]?t.select(e):t.select(t.defaultValue)}});return a}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(102),o=n(0),i=n(7);return t.extend({name:"table-justify",label:"垂直对齐",defaultValue:"middle",isVisible:!1,items:{top:"顶端对齐",middle:"水平居中",bottom:"底端对齐"},templateName:"toolbar-combo-box-align",updateValueUI:function(e){var t=this,n=i(t.valueWrapperEl).find(".combo-value")[0];i(n).removeClass(o.keys(t.items).join(" ")),i(n).addClass(e)},onEditingStateChange:function(){this.enable()},onChange:function(e){var t=this,n=t.editor;e&&n.execCommandByToolbar("comp.SetTableCellBlockStyle",{styles:{verticalAlign:e}})},onSelectionChange:function(){var e,t=this;e=t.editor.querySelectionBlockStyle("verticalAlign"),t.items[e]?t.select(e):t.select(t.defaultValue)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(130).extend({name:"indent",label:"增加缩进",defaultState:!1,state:!1,templateName:"toolbar-button-template",onClick:function(){this.editor.execCommandByToolbar("comp.IndentOutdent",{indentStep:1})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(32).extend({name:"outdent",label:"减少缩进",defaultState:!1,state:!1,templateName:"toolbar-button-template",onClick:function(){this.editor.execCommandByToolbar("comp.IndentOutdent",{indentStep:-1})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(102),o=n(0),i=n(7);return t.extend({name:"line-height",label:"行高",defaultValue:1.75,keys:[1,1.25,1.5,1.75,2,2.5,3],items:[{key:1,value:"1.0"},{key:1.25,value:"1.25"},{key:1.5,value:"1.5"},{key:1.75,value:"1.75"},{key:2,value:"2.0"},{key:2.5,value:"2.5"},{key:3,value:"3.0"}],templateName:"toolbar-combo-box-line-height",updateValueUI:function(e){var t=this,n=i(t.menuWrapperEl),r=o.indexOf(t.keys,e);n.find(".active").removeClass("active svg-common"),-1!==r&&n.find(".line-height-"+r).addClass("active svg-common")},onSelectionChange:function(){var e,t,n=this,i=n.editor.querySelectionBlockStyle(n.name);-1!==o.indexOf(n.keys,i)?n.select(i):parseFloat(i)==i?(e=parseFloat(i),o.each(n.keys,function(n){var o=Math.abs(n-i);o<e&&(t=n,e=o)}),n.select(t)):(n.select(n.defaultValue),n._isForceSelectWhenClick=!0)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(32).extend({name:"table-wrap",label:"自动换行",defaultState:!1,isVisible:!1,templateName:"toolbar-button-template",onEditingStateChange:function(){var e,t=this;e=t.editor.querySelectionBlockStyle("wrap"),t.setState(e||!1)},onClick:function(){this.editor.execCommandByToolbar("comp.SetTableCellBlockStyle",{toggle:"wrap"})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(102),o=n(43),i=n(0),r=n(7);return t.extend({name:"table-operate",label:"操作表格",defaultValue:"",isVisible:!1,items:{insertRowUp:"在上方插入行",insertRowDown:"在下方插入行",deleteRow:"删除整行",insertColLeft:"在左侧插入列",insertColRight:"在右侧插入列",deleteCol:"删除整列",deleteTable:"删除整个表格"},templateName:"toolbar-combo-box-align",updateValueUI:function(e){var t=this,n=r(t.valueWrapperEl).find(".combo-value")[0];r(n).removeClass(i.keys(t.items).join(" ")),r(n).addClass(e)},onChange:function(e){var t,n,i=this,r=i.editor;e&&("insertRowUp"===e&&(t=o.UP),"insertRowDown"===e&&(t=o.DOWN),"insertColLeft"===e&&(n=o.LEFT),"insertColRight"===e&&(n=o.RIGHT),t&&r.execCommandByToolbar("comp.InsertTableRowCol",{describe:{row:t}}),n&&r.execCommandByToolbar("comp.InsertTableRowCol",{describe:{col:n}}),"deleteRow"===e&&r.execCommandByToolbar("comp.DeleteTableRowCol",{describe:{row:!0}}),"deleteCol"===e&&r.execCommandByToolbar("comp.DeleteTableRowCol",{describe:{col:!0}}),"deleteTable"===e&&r.execCommandByToolbar("comp.DeleteNoteRange",{isTableDelete:!0}),i.value="")}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(48),o=n(0);return t.extend({name:"table-split",isVisible:!1,initialize:function(e){this.editor=e.editor,this.bindEditorEvents(),this.isVisible||this.hide()},editorEvents:{"yne-selection-change":"onSelectionChange"},bindEditorEvents:function(){var e=this,t=e.editor,n=e.editorEvents;n&&o.each(n,function(n,o){t.on(o,e[n].bind(e))})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(32).extend({name:"table-merge",label:"合并单元格",defaultState:!1,isVisible:!1,templateName:"toolbar-button-template",onClick:function(){this.editor.execCommandByToolbar("comp.ToggleMergeTableCell")}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(7),i=n(12),r=n(69);return r.extend({className:"toolbar-item toolbar-combo-box toolbar-combo-box-table",events:{"click .combo-value-wrapper":"onValueWrapperClick","mouseleave .combo-menu":"onMenuMouseLeave","mouseenter .combo-item":"onItemMouseEnter","click .combo-item":"onItemClick",mousedown:"onMouseDown"},editorEvents:{"yne-editing-state-change":"onEditingStateChange","yne-selection-change":"onSelectionChange"},name:"table",label:"表格",templateName:"toolbar-combo-box-table",initialize:function(e){var t=this;t.editor=e.editor,t.render(),t.bindDocumentEvents(),t.bindEditorEvents()},render:function(){var e,t=this,n=t.$el;e=i.render("web",t.templateName,{name:t.name,label:t.label,maxRows:10,maxCols:8}),n.html(e),t.menuWrapperEl=n.find(".combo-menu-wrapper")[0],t.menuLabelEl=n.find(".combo-menu-label-table")[0],t.comboItems=n.find(".combo-item"),n.find(".combo-display-wrapper").tooltipster({animation:"",animationDuration:0,theme:["tooltipster-borderless","tooltipster-borderless-customized"],side:"bottom",delay:[800,300]})},bindDocumentEvents:function(){var e=this;t.bindAll(e,"onDocumentMouseDown"),o(document).on("mousedown",e.onDocumentMouseDown)},bindEditorEvents:function(){var e=this,n=e.editor,o=e.editorEvents;o&&t.each(o,function(t,o){n.on(o,e[t].bind(e))})},onDocumentMouseDown:function(e){var t=this,n=e.target;o.contains(t.el,n)||t.hideMenu()},onValueWrapperClick:function(){this.toggleMenu()},onItemMouseEnter:function(e){var t=e.target,n=this.getItemCoordinate(t);this.selectItems(n.row+1,n.col+1)},onItemClick:function(e){var t=this,n=e.target,o=t.getItemCoordinate(n);t.insertTable(o.row+1,o.col+1),t.hideMenu()},onMenuMouseLeave:function(){this.resetSelected()},onMouseDown:function(e){e.preventDefault()},getItemCoordinate:function(e){var t=o(e);return{row:t.data("row"),col:t.data("col")}},resetSelected:function(){this.selectItems(0,0)},selectItems:function(e,t){this.updateSelectedLabelText(e,t),this.updateSelectedItemsUI(e,t)},updateSelectedLabelText:function(e,t){var n=o(this.menuLabelEl);e>0&&t>0?n.html(e+" 行 "+t+" 列"):n.html("插入表格")},updateSelectedItemsUI:function(e,t){var n,i,r=this;for(o(r.comboItems).removeClass("selected"),n=0;n<e;n++)for(i=0;i<t;i++)o(r.comboItems[8*n+i]).addClass("selected")},insertTable:function(e,t){this.editor.execCommandByToolbar("comp.InsertTable",{rows:e,cols:t})},toggleMenu:function(){var e=this;o(e.menuWrapperEl).hasClass("show")?e.hideMenu():e.showMenu()},showMenu:function(){var e,t=this,n=t.menuWrapperEl;o(n).removeClass("menu-position-fix"),o(n).addClass("show"),e=n.getBoundingClientRect(),e.right>document.documentElement.offsetWidth&&o(n).addClass("menu-position-fix")},hideMenu:function(){var e=this;o(e.menuWrapperEl).removeClass("show"),e.resetSelected()},onEditingStateChange:function(){}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(82),o=n(6);return t.extend({name:"hr",label:"水平线",defaultState:!1,state:!1,templateName:"toolbar-button-template",shortcut:o.IS_MAC?"Command+H":"Ctrl+H",onClick:function(){this.editor.execCommandByToolbar("comp.InsertHorizontalRule")}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(7),i=n(12),r=n(81),a=n(87);return n(69).extend({className:"toolbar-item toolbar-combo-box toolbar-combo-link",name:"link",label:"链接",templateName:"toolbar-combo-box-insert-link",events:{"mousedown .combo-value-wrapper-link":"onValueWrapperMouseDown","click .combo-value-wrapper-link":"onValueWrapperClick","click .link-button":"onConfirmButtonClick",mousedown:"onMouseDown"},initialize:function(e){var t=this;t.editor=e.editor,t.items=e.items,t.render(),t.bindDocumentEvents(),t.bindEditorEvents()},render:function(){var e,t=this,n=t.$el;e=i.render("web",t.templateName,{name:t.name,label:t.label}),n.html(e),t.menuWrapperEl=n.find(".combo-menu-wrapper")[0],t.menuItemContainer=n.find(".combo-menu")[0],t.input=n.find(".link-input"),o(t.input).keydown(function(e){e.stopPropagation(),r.isMatch("enter",e.keyCode)&&(e.preventDefault(),t.onConfirmButtonClick())}),n.find(".combo-display-wrapper").tooltipster({animation:"",animationDuration:0,theme:["tooltipster-borderless","tooltipster-borderless-customized"],side:"bottom",delay:[800,300]})},bindDocumentEvents:function(){var e=this;t.bindAll(e,"onDocumentMouseDown"),o(document).on("mousedown",e.onDocumentMouseDown)},onDocumentMouseDown:function(){this.hideMenu()},bindEditorEvents:function(){var e=this,n=e.editor,o=e.editorEvents;o&&t.each(o,function(t,o){n.on(o,e[t].bind(e))})},onMouseDown:function(e){e.stopPropagation(),e.preventDefault()},onConfirmButtonClick:function(){var e=this,t=a.safeHref(o(e.input).val().trim());t&&e.editor.execCommandByToolbar("comp.InsertLink",{src:t}),e.hideMenu(),window.focus()},onValueWrapperMouseDown:function(e){e.preventDefault()},onValueWrapperClick:function(){this.toggleMenu()},toggleMenu:function(){var e=this,t=o(e.menuWrapperEl);t.toggleClass("show"),t.is(":visible")&&e.input.focus()},showMenu:function(){var e=this,t=e.menuWrapperEl;o(t).addClass("show"),e.input.focus()},hideMenu:function(){var e=this,t=e.menuWrapperEl;o(t).removeClass("show"),o(e.input).val("")},reset:function(){this.hideMenu()}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(82).extend({name:"img",label:"图片",defaultState:!1,state:!1,templateName:"toolbar-button-template",onClick:function(){var e=this,t=e.editor;t.trigger("yne-insert-photo",function(e){t.insertImage(e)})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(82).extend({name:"attachment",label:"附件",defaultState:!1,state:!1,templateName:"toolbar-button-template",onClick:function(){var e=this,t=e.editor;t.trigger("yne-insert-attachment",function(e){t.insertAttachment(e)})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){return n(82).extend({name:"catalogue",label:"目录",defaultState:!1,state:!1,templateName:"toolbar-button-template",onClick:function(){this.editor.execCommandByToolbar("comp.InsertCatalogue")}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(100),o=n(7),i=n(0),r=n(6),a=n(1);return t.extend({name:"set-background",defaultValue:r.DEFAULT_BACKGROUND,label:"笔记背景",items:{},templateName:"toolbar-combo-box-set-background",editorEvents:{"set-all-backgrounds":"onAllBackgroundsSet","set-background":"onBackgroundChanged","yne-background-changed":"onBackgroundChanged"},_isAllBackgroundsReady:!1,_isVIPUser:!1,_normalBackground:null,_vipBackground:null,_CSS_SHADOW:"0px 0px 0px 1.5px #4C98EF",enable:function(){this._updateEnableState()},disable:function(){this._updateEnableState()},render:function(){var e=this;i.isEmpty(e.items)&&e._isAllBackgroundsReady&&(e.items={normalUser:e._normalBackground,VIP:e._vipBackground}),t.prototype.render.apply(e)},onAllBackgroundsSet:function(e,t){var n=this,o=0,a=0,l={};n._isVIPUser=!!t,n._normalBackground=[],n._vipBackground=[],l.URI=r.DEFAULT_BACKGROUND,l.isForVIP=!1,e.unshift(l),i.each(e,function(e){e.isForVIP?(n._vipBackground[a]||(n._vipBackground[a]=[]),n._vipBackground[a].push(e.URI),3===n._vipBackground[a].length&&a++):(n._normalBackground[o]||(n._normalBackground[o]=[]),n._normalBackground[o].push(e.URI),3===n._normalBackground[o].length&&o++)}),n.items={},n._isAllBackgroundsReady=!0,n.render(),n.onBackgroundChanged(null,n.defaultValue),n.show(),n.trigger("re-shrink")},onBackgroundChanged:function(e,t){var n,r,l,s=this,c=[t,s.defaultValue];s._resetAllSelection(),i.some(c,function(e){return r=s.$el.find('[data-value="'+e+'"]'),0!==r.length&&(n=e,!0)}),o(r[0]).css("box-shadow",s._CSS_SHADOW),l=o(r[0]).find(".background-cell-check-mark"),o(l).css("visibility","visible"),s.value=n,n!==t&&(a.error("failed to find specified URI:",t),s.editor.trigger("background-failed-update",1,n))},onChange:function(e){this.editor.updateBackground(e)},onItemClick:function(e){var n=this,i=o(e).data("value");if(n.editor.trigger("yne-is-vip-user",function(e){null!==e&&(n._isVIPUser=!!e)}),!n._isVIPUser&&n._isVIPBackground(i))return void n.editor.trigger("background-failed-update",0);t.prototype.onItemClick.apply(n,[e])},show:function(){var e=this,t=!1;return e._isAllBackgroundsReady?(t=!0,e.$el.show(),e._updateEnableState()):e.$el.hide(),t},reset:function(){var e=this;e.value=null,e.$el.find(".background-cell").css("box-shadow",""),e.$el.find(".background-cell-check-mark").css("visibility","hidden"),e._updateEnableState()},_isBackgroundDisabled:function(){return(this.editor.getEditorProps()||{}).disableBackground},_isVIPBackground:function(e){var t=this,n=!0;return i.some(t._normalBackground,function(t){if(i.contains(t,e))return n=!1,!0}),n},_resetAllSelection:function(){var e=this;e.$el.find(".background-cell-check-mark").css("visibility","hidden"),e.$el.find(".background-cell").css("box-shadow","")},_updateEnableState:function(){var e=this;e._isBackgroundDisabled()?t.prototype.disable.apply(e):t.prototype.enable.apply(e)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(7),i=n(12);return n(69).extend({className:"toolbar-item toolbar-combo-box toolbar-combo-more",name:"showmore",label:"查看更多",templateName:"toolbar-combo-box-show-more",events:{"click .combo-value-wrapper-showmore":"onValueWrapperClick",mousedown:"onMouseDown"},initialize:function(e){var t=this;t.editor=e.editor,t.items=e.items,t.render(),t.bindDocumentEvents()},render:function(){var e,t=this,n=t.$el;e=i.render("web",t.templateName,{name:t.name,label:t.label}),n.html(e),t.menuWrapperEl=n.find(".combo-menu-wrapper")[0],t.menuItemContainer=n.find(".combo-menu")[0],t.$split=n.find(".toolbar-more-split"),n.find(".combo-display-wrapper").tooltipster({animation:"",animationDuration:0,theme:["tooltipster-borderless","tooltipster-borderless-customized"],side:"bottom",delay:[800,300]})},bindDocumentEvents:function(){var e=this;t.bindAll(e,"onDocumentMouseDown"),o(document).on("mousedown",e.onDocumentMouseDown)},onDocumentMouseDown:function(e){var t=this,n=e.target;o.contains(t.el,n)||t.hideMenu()},onMouseDown:function(e){e.preventDefault()},onValueWrapperClick:function(){this.toggleMenu()},toggleMenu:function(){o(this.menuWrapperEl).toggleClass("show")},showMenu:function(){var e=this,t=e.menuWrapperEl;o(t).addClass("show")},hideMenu:function(){var e=this,t=e.menuWrapperEl;o(t).removeClass("show")},resetMenu:function(){var e,n=this,i=n.items,r=o(n.menuItemContainer);t.map(i,function(e){r.append(e.$el)}),r.children().length>0?(e=n.$el.prev(),(e.hasClass("toolbar-split")||e.hasClass("table-split"))&&e.hide(),n.$el.show()):n.$el.hide()}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(430),o=n(20),i=n(0),r=n(22),a=new t({}),l={color:{valueInView:"#393939",compareEqual:function(e,t){return r.equals(e,t)}},"font-family":{valueInView:["-apple-system","BlinkMacSystemFont","PingFang SC","Helvetica","Tahoma","Arial","Hiragino Sans GB","Microsoft YaHei","微软雅黑","SimSun","宋体","Heiti","黑体","sans-serif"].join(",")},"color-catalogue":{valueInView:"#003884",value:o.getDefault("color"),compareEqual:function(e,t){return r.equals(e,t)}}};return i.each(l,function(e,t){var n={name:t,valueInView:e.valueInView,value:o.getDefault(t)||e.value,compareEqual:e.compareEqual};a.addMappingRule(n)}),a}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(431);return t.extend({name:"InlineStyleViewMapper"})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(15),o=n(1);return t.extend({initialize:function(){var e=this;e._mappingRules={},delete e.options},_isValidMappingRule:function(e){return!(!e||!e.name||null==e.value||null==e.valueInView)},addMappingRule:function(e){var t,n=this,i=n._mappingRules;return n._isValidMappingRule(e)?(t=e.name,i[t]?void o.error("Failed to add mapping rule, mapping rule do exists",e):void(n._mappingRules[t]=e)):void o.error("Failed to add mapping rule, parameter is not valid",e)},valueFromView:function(e,t){var n=this._mappingRules[e],i=t;return n&&(n.compareEqual?n.compareEqual(t,n.valueInView):t===n.valueInView)&&(i=n.value),o.log("valueFromView name/valueInView => value: "+e+"/"+t+" => "+i),i},valueToView:function(e,t){var n=this._mappingRules[e],i=t;return n&&(n.compareEqual?n.compareEqual(t,n.value):t===n.value)&&(i=n.valueInView),o.log("valueToView name/value => valueInView: "+e+"/"+t+" => "+i),i}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(433);return t=o.extend({render:function(){var e=this;t.__super__.render.apply(e,arguments)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(7),i=n(16),r=n(6),a=n(103),l=n(95),s=n(96),c=n(14),u=n(37),d=n(434),p=n(2),h=n(438),g=n(59),f=n(41),m=n(24),_=n(1),y=n(27),v=n(68),b=n(24),k=n(487),C=n(154),S=n(488),I=n(170);return i.View.extend({className:"note-view",attributes:{tabIndex:1,spellcheck:!1,contenteditable:"true"},directionKeyJustMoved:!1,_isOnMouseDown:!1,events:{textInput:"_onTextInput",compositionstart:"_onCompositionStart",compositionend:"_onCompositionEnd",mousedown:"_onMouseDown",mouseup:"_onMouseUp",selectstart:"_onSelectStart",contextmenu:"_onContextMenu",dragstart:"_onDragDropEvent",dragover:"_onDragDropEvent",drop:"_onDragDropEvent",dragend:"_onDragEnd",copy:"_onCopy",cut:"_onCut",paste:"_onPaste","click a[href]":"_onAnchorClick",click:"_onClick",blur:"_onBlur",focus:"_onFocus"},note:null,blockViews:null,tableViews:null,headerView:null,footerView:null,_keyMonitor:null,_inlineStyleViewMapper:null,isOnComposition:!1,_isSilent:!1,_noteEvents:{"insert-block":"_onInsertBlock","remove-block":"_onRemoveBlock","replace-block":"_onReplaceBlock","read-only-change":"_onReadOnlyChange","high-light":"_onHighlight","next-high-light":"_onNextHighlight","pre-high-light":"_onPreHighlight","content-parse-done":"_onContentParseDone","header-footer-changed":"_OnHeaderFooterChanged","clear-high-light":"_onClearHighlight"},_docEvents:{selectionchange:"_onSelectionChange"},_shouldStopComposition:!1,_affectedViewsByComposition:null,_pageBatchTimer:null,_pageBatchPendingQueue:null,_viewMode:null,_renderBatchTimer:null,_currentZoom:null,_disableOCR:null,initialize:function(e){var t=this;t._bindEventHandlers(),t.setOptions(e),t._bindEventsForDoc(),t._bindEventsForThis(),t.highlightView=new k,t._pageBatchPendingQueue=[],e.inlineStyleViewMapper&&(t._inlineStyleViewMapper=e.inlineStyleViewMapper),t._currentZoom=1},createHeaderFooterView:function(e){var t,n,o,i;if(t=this,null!=(n=t.note))return o=n.getHeaderFooter(e),o||(o=C.createBlank(e),n.setHeaderFooter(o,e)),i=new S(o,t.isReadOnly()),i.on("focus",function(){t.trigger("set-range",c.createForHeaderFooter(o),!0,!0)}).on("blur",function(e){t.trigger("selectionchange",e)}).on("text-input",function(e){t.trigger("header-footer-view-text-change",e,i.block)}),i},_renderHeaderFooterView:function(e){e.prepend(this.headerView.$el),e.append(this.footerView.$el)},_removeHeaderFooterView:function(){null!=this.headerView&&(this.headerView.remove(),this.headerView=null),null!=this.footerView&&(this.footerView.remove(),this.footerView=null)},_OnHeaderFooterChanged:function(e){var t=this,n=t.options.noteviewFrame;t.isInPageMode()&&(e?(null!=t.footerView&&t.footerView.remove(),t.footerView=t.createHeaderFooterView(e),null!=n&&n.append(this.footerView.$el)):(null!=t.headerView&&t.headerView.remove(),t.headerView=t.createHeaderFooterView(e),null!=n&&n.prepend(this.headerView.$el)))},_bindEventHandlers:function(){var e=this,n=function(n){_.log("bindHandlers: "+n),t.bindAll(e,n)};t.each(e._noteEvents,n),t.each(e._docEvents,n)},_setNote:function(e){var t=this;t.removeNote(),t.note=e,t._bindEventsForNote()},removeNote:function(){var e=this;e.note&&e._unbindEventsForNote(),e.note=null},reset:function(){var e,t=this;if(t.removeNote(),t.$el.html(""),t.blockViews=t._clearBlockViews(t.blockViews),t.options&&(t.options.note=null,t.options.isNoteSet=!1,(e=t.options.noteviewFrame)&&(e.find(".header-footer-input").prop("contenteditable",!0),e.removeClass("has-handwrite"))),t.$el.removeClass("read-only"),t._keyMonitor&&t._keyMonitor.clearCache(),o(document.head).find("style.note-style").remove(),t._isSilent=!1,window.parent!==window){window.getSelection().removeAllRanges()}t._pageBatchTimer&&(window.clearTimeout(t._pageBatchTimer),t._pageBatchTimer=null),t._renderBatchTimer&&(clearTimeout(t._renderBatchTimer),t._renderBatchTimer=null),t._pageBatchPendingQueue=[],t._removeHeaderFooterView()},setOptions:function(e){var n=this;if(e=e||{},null==n.options)n.options=t.clone(e);else for(var o in e)e.hasOwnProperty(o)&&(n.options[o]=e[o]);null!=n.options.note&&n._setNote(n.options.note),null!=n.options.viewMode&&(n._viewMode=n.options.viewMode),n._disableOCR=!!n.options.disableOCR},render:function(){var e=this,t=e.$el,n=e.highlightView,i=e.options.noteviewFrame;e.blockViews=e.blockViews?e._clearBlockViews(e.blockViews):[],e.tableViews=[],t.html(""),o(document.head).find("style.note-style").remove(),o(document.head).append('<style class="note-style"></style>'),t.append(n.$el),e.isInPageMode()?e._enablePageMode(!1):e._disablePageMode(e._viewMode),window.YNE_PLATFORM&&t.addClass("platform-"+window.YNE_PLATFORM),null!=i&&i.find(".header-footer-input").prop("contenteditable",!e.isReadOnly()),null!=e._renderBatchTimer&&(clearTimeout(e._renderBatchTimer),e._renderBatchTimer=null),e._renderInBatch(0)},_renderInBatch:function(e){var t,n,o=this,i=o.note,r=Date.now();if(null!=i){for(;e<i.blocks.length&&(t=i.blocks[e],n=o._createBlockView(t),n||_.warn("Failed to create block view!"),o.blockViews.push(n),o.$el.append(n.$el),n.render(),o._bindEventsForBlockView(t,n),o._setPageInfo(e),e++,!(Date.now()-r>100)););e<i.blocks.length&&(o._renderBatchTimer=setTimeout(o._renderInBatch.bind(o,e),10))}},_repairBlockViews:function(e){var n,o,i,r=this,a=[];e&&e.length>0&&(n=e.shift(),a.push(n),e.length>0&&(o=e.pop(),a.push(o)),r._isElementExisting(n.cid)||(i=r.getBlockViewIndex(n)-1,i>=0?r.getBlockViewAt(i).$el.after(n.$el):r.getBlockViewAt(0).$el.before(n.$el)),o&&!r._isElementExisting(o.cid)&&n.$el.after(o.$el),r.reRenderTextBlockView(a),t.each(e,function(e){r._isElementExisting(e.cid)||o.$el.before(e.$el)}))},_isElementExisting:function(e){var t,n=this;return t=n.$el.find('[data-yne-cid="'+e+'"]'),t.length>0},reRenderTextBlockView:function(e){var n=this;e=e||n.blockViews,t.each(e,function(e){var t=e.block;p.isTextBlock(t)&&e.render()})},_listenerEventsForBlockView:function(e){var n={command:"onCommand","get-read-only-status":"_onGetReadOnlyStatus"};return p.isTable(e)&&(n=t.extend(n,{"select-all":"onSelectAll","save-content":"_onSaveContent"})),n},_bubbleEventsForBlockView:function(e){var n={"locked-change":!0};switch(p.getType(e)){case p.IMAGE:n=t.extend(n,{"yne-replace-image":!0,"yne-open-image":!0,"yne-download-image":!0,"get-image-items":!0,"img-title-edit-start":!0,"img-title-edit-end":!0,"img-title-edit-focus":!0,"img-title-edit-exit":!0,"img-title-edit-update":!0,"yne-image-ocr":!0});break;case p.ATTACHMENT:n=t.extend(n,{"yne-replace-attachment":!0,"yne-open-attachment":!0,"yne-download-attachment":!0});break;case p.TABLE:n=t.extend(n,{"yne-download-attachment":!0,"yne-on-paste":!0,"get-note-range":!0,"link-menu-show":!0,"link-menu-hide":!0,"move-caret":!0,"set-range":!0,"global-redo":!0,"global-undo":!0,copy:!0,cut:!0,"cell-edit-view-selection-change":!0,"cell-edit-view-enter":!0,"cell-edit-view-exit":!0,"cell-edit-view-history-change":!0,"cell-edit-view-command-executed":!0,"yne-blob-paste":!0});break;case p.PARAGRAPH:case p.HEADING:n=t.extend(n,{"link-menu-show":!0,"link-menu-hide":!0});break;case p.LIST_ITEM:n=t.extend(n,{"get-editing-styles":!0,"link-menu-show":!0,"link-menu-hide":!0});break;case p.CATALOGUE:n=t.extend(n,{"inner-goto":!0})}return n},_unbindEventsForBlockView:function(e,n){var o=this,i=function(e){e&&t.each(e,function(e,t){n.off(t)})};i(o._listenerEventsForBlockView(e)),i(o._bubbleEventsForBlockView(e))},_bindEventsForBlockView:function(e,t,n){var o,i=this;n=!1!==n,n&&i._unbindEventsForBlockView(e,t),o=i._listenerEventsForBlockView(e),y.addListeners(o,t,i),o=i._bubbleEventsForBlockView(e),y.bubble(o,t,i)},setHtmlContentEditable:function(e){this.$el.attr("contenteditable",!!e)},getHtmlContentEditable:function(){return"true"==this.el.contentEditable+""},updateFormatPainterCursorUI:function(e){e?this.$el.addClass("format-painter-active"):this.$el.removeClass("format-painter-active")},_handleNoteEvents:function(e){var n=this,o=n.note;if(!o||!o.on||!o.off)return void _.warn("Failed to bind note events!");t.each(n._noteEvents,function(t,i){e?o.on(i,n[t]):o.off(i,n[t])})},_bindEventsForNote:function(){this._handleNoteEvents(!0)},_unbindEventsForNote:function(){this._handleNoteEvents(!1)},_bindEventsForDoc:function(){var e=this,n=o(document);t.each(e._docEvents,function(t,o){_.log("bind document event: "+o+" -> "+t),_.log(e[t]),n.on(o,e[t])})},_bindEventsForThis:function(){var e=this;e.on("draw-range",e._onDrawRange.bind(e)),e.on("resize",e._onResize.bind(e))},_onChangeHandwriteBlock:function(e){var t=this.options.noteviewFrame;e?t.addClass("has-handwrite"):this.note.hasHandWriteBlock()||t.removeClass("has-handwrite")},bindKey:function(e){var t=this,n=t._keyMonitor;e&&(n||(t._keyMonitor=n=new a({el:t.el})),n.unbind(e),n.bind(e,function(n){t.trigger("key-pressed",e,n)}),t._keyMonitor=n)},unbindKey:function(e){var t=this,n=t._keyMonitor;n&&e&&n.unbind(e)},_onDrawRange:function(e,t){var n=this;n._silentDo(function(){n._drawRange(e,t)})},_updateSelectionUI:function(e){var t,n,o,i,r,a,l=this;return _.log("_updateSelectionUI....."),e?null==l.note?void _.warn("Note has been dettached."):(c.isNoteRange(e)?(o=e.getStartBlockRange(),i=e.getEndBlockRange(),t=l.note.getBlockIndex(o.block),n=l.note.getBlockIndex(i.block)):(r=l.getBlockViewContainer(e.startContainer),a=l.getBlockViewContainer(e.endContainer),t=l.getBlockViewIndex(r),n=l.getBlockViewIndex(a)),l._selectAttachments(t,n,e),void l._selectCatalogueTables(t,n)):void _.warn("The range is not valid!")},_selectAttachments:function(e,n){var o=this;if(-1===e||-1===n)return void _.warn("start or end is -1");e!==n&&t.each(o.blockViews,function(t,o){if(t){var i=o>=e&&o<=n;t.selectAttachment&&t.selectAttachment(i)}})},_selectCatalogueTables:function(e,n){var o,i=this,r=[];-1!==e&&-1!==n&&t.each(i.blockViews,function(t,i){if(t){var a=i>=e&&i<=n;if(t.selectTable)return void t.selectTable(a);if(t.selectCatalogue){if(o=t.getOwnerId(),!a&&r[o])return;r[o]=!0,t.selectCatalogue(a)}}})},_drawRange:function(e,t){if(!e||!e.canDrawedByNative)return void _.log("note range is not valid!");_.log("on draw range",e);var n,o,i,r=this,a=e.getStartBlockRange(),l=a.block;if(t=!1!==t,r._clearCustomSelectionUI(l),e.canDrawedByNative())r.setHtmlContentEditable(!0),r._updateSelectionUI(e),n=e.toNativeRange(r),u.setRange(n,window),t&&r._scrollNativeSelectionIntoWrapper(n);else{if(r.setHtmlContentEditable(!1),e.isInMultiBlock())return void _.warn("The note range is note valid!");a=e.getStartBlockRange(),null!=r.note&&(o=r.note.getBlockIndex(a.block),(i=r.getBlockViewAt(o))&&i.trigger("draw-range",a,l))}},_isZeroRect:function(e){return!e||0===e.width&&0===e.height},_scrollNativeSelectionIntoWrapper:function(e){var t,n,o=this;if(!o._isOnMouseDown){if(!e)return void _.warn("range not found");if(e.collapsed?(t=e.getClientRects()[0],o._isZeroRect(t)&&(t=e.getBoundingClientRect())):t=e.getBoundingClientRect(),o._isZeroRect(t)&&(n=e.commonAncestorContainer,1!==n.nodeType&&(n=n.parentNode),t=n.getBoundingClientRect()),o._isZeroRect(t))return void _.error("can not get selection client rect");o._scrollRectIntoWrapper(t)}},_getWrapper:function(){for(var e=this,t=e.el.parentNode;t;){if(o(t).is(".note-view-wrapper"))return t;t=t.parentNode}},_scrollRectIntoWrapper:function(e){var t=this,n=t._getWrapper(),o=n.getBoundingClientRect(),i=o.top,r=o.bottom,a=o.height,l=o.left,s=o.right,c=e.top*t._currentZoom,u=e.bottom*t._currentZoom,d=e.height*t._currentZoom,p=e.left*t._currentZoom,h=null,g=null;t._isZeroRect(e)||(n.scrollHeight!==n.clientHeight&&(r-=11,a-=11),n.scrollBarWidth!==n.clientWidth&&(s-=11),d>a?(u<0||c>a)&&(g=u-a):c<i||c-i<=10?g=-1*Math.abs(c-i):u>r||r-u<=10?g=Math.abs(u-r):u===r&&(g=10),p>=s||s-p<=10?h=Math.abs(p-s):(p<=l||p-l<=10)&&(h=-1*Math.abs(p-l)),t._scrollWrapperBy(h,g))},_scrollWrapperBy:function(e,n){var o=this._getWrapper();e>0?e+=20:e<0&&(e-=20),n>0?n+=20:n<0&&(n-=20),t.isNumber(e)&&(o.scrollLeft+=e),t.isNumber(n)&&(o.scrollTop+=n)},parseNativeRange:function(e){if(!e||!e.startContainer)return void _.warn("no native range!");var t=this,n=e.startContainer,o=e.endContainer;if(S.isHeaderView(n))return[new d[p.HEADER_FOOTER]({block:t.note.getHeaderFooter(!1)})];if(S.isFooterView(n))return[new d[p.HEADER_FOOTER]({block:t.note.getHeaderFooter(!0)})];var i,r,a,l,s=t.getBlockViewContainer(n),c=t.getBlockViewContainer(o),u=t.getBlockViewIndex(s),h=t.getBlockViewIndex(c),g=[];if(-1===u||-1===h)return void _.warn("start/end block index is -1 !");if(null==t.note)return void _.warn("note has been dettached.");for(_.log("start/end block index "+u+"/"+h),i=u;i<=h;i++)a=t.blockViews[i],r=t.note.getBlockAt(i),l=a.parseNativeRange(e,r,i!==u&&i!==h),l?g.push(l):_.warn("Failed to parse native range to block range!");return g},_isRangeInTableBlock:function(){return u.isRangeInSelector(".block-view.table-view")},_onSelectionChange:function(e){var t=this,n=!u.isRangeInNode(t.el),o=u.getRange(),i=null;if(t._updateSelectionUI(o),n?i="The native range is not in note view!":I.isRangeInCellEditArea(o)?i="The native range is in table cell edit area":t._isSilent?i="The _isSilent flag is true!":t.isOnComposition&&(i="The isOnComposition flag is true!"),i)return _.log("XXXXXXXdocument selection change deprecated!XXXXXXXX"),void _.log(i);if(t._isRangeInTableBlock()){if(!t.directionKeyJustMoved)return i="The selection/range is in table box!",_.log("  selection change deprecated!XXXXXXX"),void _.log(i);t.directionKeyJustMoved=!1}_.log("-------------document selection change--------"),t.trigger("selectionchange",e),t._scrollNativeSelectionIntoWrapper(o)},_silentDo:function(e){var t=this;if(t._isSilent=!0,_.DEBUG)e();else try{e()}catch(e){_.warn("silent do error")}window.setTimeout(function(){t._isSilent=!1},0)},clearNativeSelectionUI:function(){u.getSelection(window).removeAllRanges()},_clearCustomSelectionUI:function(e){var n=this,o=n.blockViews;t.each(o,function(t){t.trigger("draw-range",null,e)})},_appendBlankLineIfNeed:function(){var e,t=this,n=t.note;n&&((e=n.getLastBlock())&&(!e||n.lastBlockIsEasyInput()&&!e.isLocked())||t.trigger("note-append-blankparagraph",e))},focusLastBlankLine:function(){var e=this;e._appendBlankLineIfNeed(),window.setTimeout(function(){var t=e.getLastBlockView();o(t.el).trigger("mousedown")},50)},isReadOnly:function(){var e=this,t=e.note;return null==t||t&&t.isReadOnly()},_onGetReadOnlyStatus:function(e){var t=this;e&&e(t.isReadOnly())},_isAtEndOfTextBlock:function(e,t){if(!document.caretRangeFromPoint)return!1;var n,i,r=document.caretRangeFromPoint(e.clientX,e.clientY),a=t.querySelector(".para-text");if(!a||!r||!r.collapsed)return!1;if(n=r.commonAncestorContainer,f.isText(n)){if(r.startOffset!==n.nodeValue.length)return!1;n=n.parentNode}if(!o.contains(a,n))return!1;for(;n&&n!==a;){if(i=n.parentNode,i.lastChild!==n)return!1;n=i}return!0},_onMouseDown:function(e){var t,n,i,r,a,l,s,u=this,h=3===(e.keyCode||e.which);if(u._isOnMouseDown=!0,u._clearHighlight(),u.$el.removeClass("highlight"),!u.isReadOnly()&&(t=u.getBlockViewContainer(e.target),n=u.getBlock(e.target),u._preventSelectStart=!1,!h||(b.isSafari()&&t&&u._isAtEndOfTextBlock(e,t)&&(u._preventSelectStart=!0),o(t).is(".image-view, .attachment-view, .table-view")))){if(!n||n.isLocked())return _.log("_onMouseDown(): block is null or locked!"),void u.focusLastBlankLine();if(u.trigger("mouse-down",e),i=p.getType(n),l=d[i])switch(r=new l({block:n}),a=new c({startRange:r,endRange:r}),i){case p.IMAGE:case p.ATTACHMENT:case p.HANDWRITE:u.setHtmlContentEditable(!0),t.focus(),u.trigger("set-range",a,!0,!0);break;case p.QUOTE:case p.TODO:case p.PARAGRAPH:case p.LIST_ITEM:case p.HEADING:case p.CATALOGUE:e=e.originalEvent||e,e.detail>2?(e.preventDefault(),r.expandToEnd(),s=!0):(s=!1,a=document.caretRangeFromPoint(e.clientX,e.clientY)),u.setHtmlContentEditable(!0),u._clearCustomSelectionUI(),u.trigger("backup-drag-range"),u.trigger("set-range",a,s,!0);break;case p.TABLE:break;case p.HR:u.trigger("set-range",a,!0,!0);break;case p.UNKNOWN:u.setHtmlContentEditable(!1),u.trigger("set-range",a,!0,!0)}else _.warn("_onMouseDown is not handled, block type is "+i);u.lastBlock=n}},_clearHighlight:function(){this.highlightView.$el.remove(),this._onClearHighlight()},_onMouseUp:function(){this._isOnMouseDown=!1},_onAnchorClick:function(e){var t,n=e.currentTarget;if(e.preventDefault(),t=n&&n.getAttribute("href"))return v.isNoteLinkUrl(t)?this.trigger("open-link",v.getNoteId(t),!0):void this.trigger("open-link",t)},_onSelectStart:function(e){if(!0===this._preventSelectStart)return e.preventDefault(),e.stopPropagation(),!1;this.trigger("selectstart",e)},_onTextInput:function(e){var t,n,o=this;_.log("------------------ noteview text input event ----------"),e.preventDefault(),o.isReadOnly()||(n=e.originalEvent||e)&&(t=n.data+"")&&o.trigger("text-input",t)},_onCompositionStart:function(e){var t=this;return t.isReadOnly()?void e.preventDefault():(_.log("note view compositionstart ----------\x3e>>>>>"),window.clearTimeout(t._compositionEndTimer),t.setCompositionState(!0),t._shouldStopComposition=!1,t._affectedViewsByComposition=null,t.trigger("onCompositionStart",function(e,n){t._shouldStopComposition=e,t._affectedViewsByComposition=n}),t._shouldStopComposition?(e.preventDefault(),void e.stopPropagation()):void t.trigger("delete-selection"))},_onCompositionEnd:function(e){var t=this,n=e.originalEvent||e;if(t.isReadOnly()||t._shouldStopComposition)return e.preventDefault(),void(t._affectedViewsByComposition&&t._repairBlockViews(t._affectedViewsByComposition));_.log("note view compositionend ----------\x3e>>>>>"),n.data||t.trigger("delete-selection"),t._compositionEndTimer=window.setTimeout(function(){t.setCompositionState(!1)},0)},setCompositionState:function(e){var t,n=this;e&&(t=u.getRange(),n.trigger("set-range",t,!1,!1)),n.isOnComposition=e},_onInsertBlock:function(e,t){var n=this,o=n._createBlockView(t);g(o),n._bindEventsForBlockView(t,o),n._insertBlockView(e,o)},_onRemoveBlock:function(e,t){var n=this;n._removeBlockView(e),!1!==t&&n._setPageInfo(e)},_onReplaceBlock:function(e,t){var n=this,o=n._createBlockView(t);g(o),n._replaceBlockView(e,o)},_createBlockView:function(e){var t,n=this,o=p.getType(e),i=h(o),a={};return _.log("block Type",e,o),n.isInPageMode()?n.options.pageType===r.PAGE_TYPE_A4?(a.height=r.PAGE_HEIGHT_A4,a.width=r.PAGE_WIDTH_A4):n.options.pageType===r.PAGE_TYPE_B5?(a.height=r.PAGE_HEIGHT_B5,a.width=r.PAGE_WIDTH_B5):n.options.pageType===r.PAGE_TYPE_TEST?(a.height=r.PAGE_HEIGHT_TEST,a.width=r.PAGE_WIDTH_TEST):n.options.pageType===r.PAGE_TYPE_NONE?(a.height=r.PAGE_HEIGHT_NONE,a.width=r.PAGE_WIDTH_NONE):(_.debugAlert("Invalid pageType in PageMode:",n.options.pageType),a.height=r.PAGE_HEIGHT_NONE,a.width=r.PAGE_WIDTH_NONE):(a.height=r.PAGE_HEIGHT_NONE,a.width=r.PAGE_WIDTH_NONE),g(!!i),t=new i({editor:n.options.editor,block:e,isReadOnly:e.isReadOnly(),inlineStyleViewMapper:n._inlineStyleViewMapper,pageSize:a,pageBreakContainer:n.options.noteviewFrame,noteView:n,disableOCR:n._disableOCR}),t.on("view-height-changed",n._onBlockViewHeightChanged.bind(n)),t.on("pageBreak-inserted",n._onPageBreakInserted.bind(n)),t.on("pageBreak-positionChanged",n._onPageBreakPosChanged.bind(n)),t instanceof h(p.HANDWRITE)&&n._onChangeHandwriteBlock(!0),t},_insertBlockView:function(e,t){var n=this,o=n.blockViews,i=n.$el,r=i.children().filter(".block-view"),a=r.length;o.splice(e,0,t),e===a?i.append(t.$el):r.eq(e).before(t.$el),t.render()},_removeBlockView:function(e){var n,o,i,r,a,l=this,s=l.blockViews,c=l.$el,u=l.tableViews;n=s.splice(e,1),o=n[0],r=t.indexOf(u,o),r>=0&&u.splice(r,1),a=c.children().filter(".block-view"),i=a.eq(e),i&&(i.attr("data-yne-cid")===o.cid?a.eq(e).remove():_.warn("skip div deletion whose attr is "+i.attr("data-yne-cid"))),o instanceof h(p.HANDWRITE)&&l._onChangeHandwriteBlock(!1),o.clearPageBreaks(),o.off(),o.onDestroy()},_replaceBlockView:function(e,t){var n=this,o=n.blockViews,i=n.$el;n._clearBlockViews(o.splice(e,1,t)),i.children().filter(".block-view").eq(e).replaceWith(t.$el),t.render()},getBlockViewAt:function(e){return this.blockViews[e]},getLastBlockView:function(){var e=this,t=e.blockViews;return t[t.length-1]},getBlockViewContainer:function(e){var t,n,i=this;return o(e).is(".highlight-view")?(t=i.getBlockViewAt(0))&&(n=t.el):n=o(e).closest(".block-view")[0],n},getBlockViewIndex:function(e){if(!e)return-1;return this.$el.find(">.block-view").index(e)},getBlock:function(e){var t,n,o=this,i=o.note;if(null!=i)return t=o.getBlockViewContainer(e),n=o.getBlockViewIndex(t),i.getBlockAt(n)},getBlockViewByBlock:function(e){var t,n=this;if(null!=n.note)return t=n.note.getBlockIndex(e),n.getBlockViewAt(t)},onCommand:function(e,t){var n,o,i,r=this;null==t.range&&(t.imageBlockView?(n=t.imageBlockView,t.imageBlockView=null,i=new s({block:n.block}),o=new c({blockRanges:[i]}),t.range=o):t.attachmentBlockView&&(n=t.attachmentBlockView,t.attachmentBlockView=null,i=new l({block:n.block}),o=new c({blockRanges:[i]}),t.range=o)),r.trigger("command",e,t)},_onCopy:function(e){this.trigger("copy",e)},_onCut:function(e){var t=this;if(t.isReadOnly())return void e.preventDefault();t.trigger("cut",e)},_onPaste:function(e){var t=this;if(t.isReadOnly())return void e.preventDefault();t.trigger("paste",e)},_onContextMenu:function(e){var t=this;e.preventDefault(),e.stopPropagation(),t.isReadOnly()||t.trigger("contextmenu",e)},_onDragDropEvent:function(e){var t,n=this;if(!n.isReadOnly())switch(e=e.originalEvent,e.type){case"dragstart":t=n.getBlock(e.srcElement),n.trigger("dragstart",e,t);break;case"dragover":t=n.getBlock(e.srcElement),n.trigger("dragover",e,t);break;case"drop":n.trigger("drop",e)}},_onDragEnd:function(e){this.trigger("dragend",e)},_onBlur:function(){this.trigger("blur")},_onFocus:function(){window.parent!==window&&m.isSafari()&&window.parent.getSelection().removeAllRanges()},_onClick:function(){this.trigger("yne-click")},onSelectAll:function(){var e,n=this,o=document.createRange();e=p.isTodo(t.first(n.note.blocks))?n.el.firstChild.querySelector(".todo-input"):n.el.firstChild,o.setStart(e,0),o.setEnd(n.el.lastChild,1),u.setRange(o,window),n.parseNativeRange(o)},_onSaveContent:function(){this.trigger("save-content")},_onReadOnlyChange:function(){var e=this,t=e.isReadOnly(),n=e.options.noteviewFrame;e.setHtmlContentEditable(!t),t?(e.$el.addClass("read-only"),null!=n&&n.find(".header-footer-input").prop("contenteditable",!1)):(e.$el.removeClass("read-only"),null!=n&&n.find(".header-footer-input").prop("contenteditable",!0))},_checkHighlightView:function(){var e=this;e.$el.children()[0]!==e.highlightView.$el.get(0)&&e.$el.prepend(e.highlightView.$el)},_onHighlight:function(e){var t,n=this,o=n.options.noteviewFrame,i=n.options.noteviewWrapper.get(0);e.length?(i.style.background=this.$el.css("background"),o.css("background","transparent"),this.$el.css("background",""),n.$el.addClass("highlight"),n._checkHighlightView()):(t=i.style.background,t&&this.$el.css("background",t),n.$el.removeClass("highlight")),n.highlightView.showHighlight(n.el,e)},_onClearHighlight:function(){t.each(this.blockViews,function(e){e.clearHighlight()})},_onNextHighlight:function(){var e=this;e._checkHighlightView(),e.highlightView.nextHighlight()},_onPreHighlight:function(){var e=this;e._checkHighlightView(),e.highlightView.preHighlight()},_onResize:function(e){var n=this;t.isNumber(e)&&(n._currentZoom=e),t.each(n.blockViews,function(e){e.trigger("resize"),n.isInPageMode()&&e.coincideAllPageBreaks()}),n._scrollNativeSelectionIntoWrapper(u.getRange())},_clearBlockViews:function(e){return t.each(e,function(e){e.onDestroy()}),[]},isInPageMode:function(){return 2===this._viewMode},setViewMode:function(e,t){var n=this;n._viewMode=e,n.isInPageMode()?n._enablePageMode(t):n._disablePageMode(e)},_calcNoteViewFrameHeight:function(){var e,n,o,i,a,l=this,s=t.last(l.blockViews),c=l.options.noteviewFrame;if(null!=s){if(e=(s.getLastTransPageIndex()||0)+1,l.options.pageType===r.PAGE_TYPE_A4?n=r.PAGE_HEIGHT_A4:l.options.pageType===r.PAGE_TYPE_B5?n=r.PAGE_HEIGHT_B5:l.options.pageType===r.PAGE_TYPE_TEST&&(n=r.PAGE_HEIGHT_TEST),null!=n&&e>1){if(o=e-2,i=c.find('[data-page-id="'+o+'"]'),0===i.length)return void _.debugAlert("Failed to find pageBreak:",o);i.length>1&&(_.debugAlert("Should not find more than one pageBreak:",o),i=i.first()),a=n-(c.height()-parseInt(l.$el.css("padding-bottom"))-parseInt(i.css("top"))-i.height()),a<0&&_.log("lastPageShortHeight < 0",a),c.height(c.height()+a),s.$el.position().top-parseInt(l.$el.css("padding-top"))+s.$el.height()>l.$el.height()&&(_.debugAlert("noteview content is overflowed"),c.height("auto"))}else c.height(n+parseInt(l.$el.css("padding-top"))+parseInt(l.$el.css("padding-bottom")));l._coincideAllPageBreaks()}},_coincideAllPageBreaks:function(){var e=this;t.each(e.blockViews,function(e){e.coincideAllPageBreaks()})},_disablePageMode:function(e){var n=this,o=n.options.noteviewFrame;if(n._pageBatchTimer&&(window.clearTimeout(n._pageBatchTimer),n._pageBatchTimer=null),!o)return void _.debugAlert("noteviewFrame should NOT be null when _disablePageMode");o.removeClass(r.PAGE_CLASS_A4),o.removeClass(r.PAGE_CLASS_B5),o.removeClass(r.PAGE_CLASS_TEST),t.each(n.blockViews,function(e){e.disablePageMode()}),n._viewMode=e,n._removeHeaderFooterView(),o.css("height","auto")},_enablePageMode:function(e){var n=this,o=n.options.noteviewFrame;if(n._pageBatchTimer&&(window.clearTimeout(n._pageBatchTimer),n._pageBatchTimer=null),n._pageBatchPendingQueue=[],!o)return void _.debugAlert("noteviewFrame should NOT be null when _enablePageMode");o.removeClass(r.PAGE_CLASS_A4),o.removeClass(r.PAGE_CLASS_B5),o.removeClass(r.PAGE_CLASS_TEST),n.options.pageType===r.PAGE_TYPE_A4?o.addClass(r.PAGE_CLASS_A4):n.options.pageType===r.PAGE_TYPE_B5?o.addClass(r.PAGE_CLASS_B5):n.options.pageType===r.PAGE_TYPE_TEST&&o.addClass(r.PAGE_CLASS_TEST),n._removeHeaderFooterView(),n.headerView=n.createHeaderFooterView(!1),n.footerView=n.createHeaderFooterView(!0),n._renderHeaderFooterView(o),!0===e&&null!=n.note&&(t.each(n.blockViews,function(e){e.enablePageMode(n.options.pageType)}),n._setPageInfo(0))},_getBlockViewIndexByCID:function(e){var n,o=this;return t.some(o.blockViews,function(t,o){return t.cid===e&&(n=o,!0)}),n},_onBlockViewHeightChanged:function(e){var t,n=this;null!=(t=n._getBlockViewIndexByCID(e))&&n._setPageInfo(t)},_onContentParseDone:function(){this.isInPageMode()&&this._calcNoteViewFrameHeight()},_onPageBreakInserted:function(){},_onPageBreakPosChanged:function(){},_setPageInfo:function(e,t){var n,o,i,r,a=this;if(a.isInPageMode()&&null!=a.blockViews&&0!==a.blockViews.length&&null!=(n=a.blockViews[e])&&null!=n.cid)if(a._setPageInfoInBatch(e),!0===t&&(a._pageBatchTimer=null),a._pageBatchPendingQueue.length>0){if(null==a._pageBatchTimer){for(r=null;null==r&&a._pageBatchPendingQueue.length>0;)i=a._pageBatchPendingQueue.shift(),o=a.blockViews[i.index],r=null!=o&&o.cid===i.cid?i.index:a._getBlockViewIndexByCID(i.cid);_.log("resetPageInfo: startTimer for ",r),null!=r&&(a._pageBatchTimer=setTimeout(a._setPageInfo.bind(a,r,!0),10))}}else a._pageBatchTimer=null,a.note.isParsingData()?a.options.noteviewFrame.height("auto"):a._calcNoteViewFrameHeight()},_setPageInfoInBatch:function(e){var t,n,o,i,r,a,l,s,c=this,u=Date.now();if(null!=c.blockViews&&0!==c.blockViews.length&&null!=e&&null!=(o=c.blockViews[e]))for(_.log("Start PageInfoInBatch from:",o,e),t=0===e?0:o.getFirstTransPageIndex();e<c.blockViews.length;){if(o=c.blockViews[e],0===e)l=o.resetPageInfo(0,0),n=0;else{if(i=c.blockViews[e-1],null==(n=i.getLastTransPageIndex()))break;a=i.getBottomPosInPage(n),-1===a&&(a=0),l=o.resetPageInfo(n,a)}if(e++,null!=n&&null!=t&&n-t,!0===l){if(p.isImage(o.block)&&o.isOnFloat()&&(s=n+1),(null==s||s<=n)&&Date.now()-u>100){r=c.blockViews[e],null!=r&&c._pageBatchPendingQueue.push({cid:r.cid,index:e});break}}else if(null==s||s<=n)break}}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(2),n(95),n(435),n(120),n(94),n(436),n(121),n(96),n(437),n(35),n(167),n(42),n(159),n(123)],void 0!==(i=function(e,t,n,o,i,r,a,l,s,c,u,d,p,h,g,f){"use strict";var m={};return m[n.ATTACHMENT]=o,m[n.CATALOGUE]=i,m[n.HEADING]=l,m[n.HR]=s,m[n.IMAGE]=c,m[n.LIST_ITEM]=u,m[n.PARAGRAPH]=d,m[n.TABLE]=h,m[n.TODO]=g,m[n.QUOTE]=p,m[n.HANDWRITE]=r,m[n.HEADER_FOOTER]=a,m[n.UNKNOWN]=f,m}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(2),n(35)],void 0!==(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.HEADING},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(2),n(35)],void 0!==(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.HEADING},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(2),n(35)],void 0!==(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.LIST_ITEM},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(2),o=n(49),i={};return i[t.ATTACHMENT]=n(440),i[t.CATALOGUE]=n(441),i[t.HANDWRITE]=n(442),i[t.HEADING]=n(443),i[t.HR]=n(444),i[t.IMAGE]=n(445),i[t.LIST_ITEM]=n(448),i[t.PARAGRAPH]=n(70),i[t.TABLE]=n(170),i[t.TODO]=n(484),i[t.QUOTE]=n(485),i[t.UNKNOWN]=n(486),function(e){var t=i[e];return t||o}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(16),o=n(6),i=n(12),r=n(1),a=n(7);return t.View.extend({className:"page-break-view",templateName:"page_break_view",PLACEHOLDER_PREFIX:"p_",_$placeholder:null,_$pageBreak:null,_$container:null,_isAtViewBeginning:null,_topBlankHeight:null,_bottomBlankHeight:null,coincide:function(){var e,t,n=this;e=n._getOffsetTopPos(n.getPlaceholder()),t=e+n.getTopBlankHeight(),r.log("placeHolderTop/pageBreakTop/topBlankHeight:",e,t,n.getTopBlankHeight()),n.getPageBreak().offset({top:t})},destroy:function(){var e=this;e._$pageBreak.remove(),e._$placeholder.remove()},getPlaceholder:function(){return this._$placeholder},getPageBreak:function(){return this._$pageBreak},getTopBlankHeight:function(){return this._topBlankHeight},initialize:function(e){var t,n,l,s,c=this,u=e.pageIndex;c._topBlankHeight=e.topBlankHeight||0,c._bottomBlankHeight=e.bottomBlankHeight||0,c._$placeholder=e.placeholder||a('<div class="page-break-placeholder"></div>'),c._$pageBreak=a(i.render("common",c.templateName,{})),c._$container=e.container,c._$pageBreak.prepend(e.noteView.createHeaderFooterView(!0).$el),c._$pageBreak.append(e.noteView.createHeaderFooterView(!1).$el),s=c._$container.find('[data-page-id="'+u+'"]'),0!==s.length&&s.attr("data-page-cid")===c.cid&&(r.debugAlert("should not create existing pageBreak for same view"),s.remove()),c._topBlankHeight<0&&(r.debugAlert("topBlankHeight should not be less than 0"),c._topBlankHeight=0),c._bottomBlankHeight<0&&(r.debugAlert("bottomBlankHeight should not be less than 0"),c._bottomBlankHeight=0),c._$pageBreak.attr("data-page-id",u),c._$pageBreak.attr("data-page-cid",c.cid),c._$pageBreak.attr("contenteditable","false"),t=c._$pageBreak.find(".bottomSpan"),n=c._$pageBreak.find(".topSpan"),l=c._$pageBreak.find(".middleSpan"),n.outerHeight(o.PAGE_SPLIT_BLANK_HEIGHT),t.outerHeight(o.PAGE_SPLIT_BLANK_HEIGHT),l.outerHeight(o.PAGE_SPLIT_MIDDLE_HEIGHT),c._$pageBreak.appendTo(c._$container),c._$pageBreak.height(n.outerHeight()+l.outerHeight()+t.outerHeight()),c._$placeholder.attr("data-page-id",c.PLACEHOLDER_PREFIX+c._$pageBreak.attr("data-page-id")),c._$placeholder.attr("data-page-cid",c.PLACEHOLDER_PREFIX+c._$pageBreak.attr("data-page-cid")),c._$placeholder.attr("contenteditable","false"),c._$placeholder.height(c._$pageBreak.height()+c._topBlankHeight+c._bottomBlankHeight)},isAtViewBeginning:function(){return!0===this._isAtViewBeginning},setAtViewBeginning:function(e){this._isAtViewBeginning=!0===e},_getOffsetTopPos:function(e){return e.offset().top}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){n(104);var t=n(49),o=n(7),i=n(0),r=n(12),a=n(95),l=n(1),s=n(37),c=n(24),u=n(8),d=n(62),p=n(6),h=n(168);return t.extend({className:"block-view attachment-view",DEFAULT_HEIGHT:100,timer:null,events:{"dblclick .attachment-container":"_onImgDblclick","mousemove .attachment-container":"_onMouseMove","mouseout .attachment-container":"_onMouseOut","click .attachment-download":"_onDownloadClick","dragstart .attachment-mask":"_onDragstart","dragend .attachment-mask":"_onDragEnd"},_isFloatSwitch:!1,_viewFrameHeight:null,initialize:function(){var e=this;t.prototype.initialize.apply(e,arguments),i.bindAll(e,"_onStyleChange","_onContentChange","_onMouseMove","_onMouseOut"),e.block.on("style-change",e._onStyleChange),e.block.on("content-change",i.debounce(e._onContentChange,100)),e.bindSelectionEvents()},render:function(){var e,n,i,a,s,g=this,f=g.block,m=f.getSource(!0),_=f.getFileName(),y=f.getFileLength();u.IS_PC&&(m=d(m)),(u.IS_WEB_NOTE||u.IS_WEB_GROUP)&&!0===f.getFakeLoading()&&(m=p.LOADING_IMAGE_PATH,f.setFakeLoading(!1)),e=h.getFileType(_),n=e?"src--svg--type_"+e+"_large":"src--svg--type_other_large",a=void 0===y?"未知大小":h.getSizeString(y),s=h.splitFileFullName(_),i=r.render("common","attachment-view-attachment-container",{name:n,fileName:s.fileName,fileType:s.fileType,size:a,title:_,draggable:!0}),g.$el.find(".attachment-container").remove(),g.$el.append(i),g._viewFrameHeight=g.$el.outerHeight(!0)-g.$el.height(),g.$el.find(".attachment-container").tooltipster({animation:"",animationDuration:0,theme:["tooltipster-attachment","tooltipster-attachment-customized"],side:"bottom",delay:[800,300],arrow:!1,functionPosition:function(e,t,n){var i,r,a=o(t.tooltipClone);return i=g.mousePosY+a.height()>document.body.clientHeight?g.mousePosY-a.height()+10:g.mousePosY-10,r=g.mousePosX+a.width()>document.body.clientWidth?g.mousePosX-a.width()-10:g.mousePosX+10,n.coord.top=i>0?i:0,n.coord.left=r>0?r:0,n}}),g._renderStyles(),c.isSafari()&&g.$el.find(".attachment-container").attr("contenteditable","true"),t.prototype.render.apply(g,arguments),l.log("Attachment width/height",g.$el.width(),g.$el.height())},_renderStyles:function(){var e=this,t=e.block.getBlockStyles();i.each(t,function(t,n){e._setStyle(n,t)})},_setStyle:function(e,t){var n=this,o=n.$el,i=o.find(".attachment-block-container");switch(e){case"align":o.css("text-align",t);break;case"float":o.css("float")!==t?(n._isFloatSwitch=!0,o.css("float",t)):n._isFloatSwitch=!1;break;case"back-color":i.css("background-color",t),t?o.css("margin","-3px 0"):o.css("margin","");break;case"padding":i.css("padding",t)}},_onStyleChange:function(e,t){var n=this;n._setStyle(e,t),n.trigger("view-height-changed",n.cid)},_onContentChange:function(){var e=this;e.render(),l.log("redraw attachment"),e.trigger("view-height-changed",e.cid)},getImgElement:function(){return this.$el.find("img").get(0)},getAttachmentContainerElm:function(){return this.$el.find(".attachment-container").get(0)},convertToNativeRange:function(){var e=this,t=document.createRange(),n=e.$el.get(0);return t.setStart(n,0),t.setEnd(n,n.childNodes.length),t},parseNativeRange:function(e,t,n){var o=this;if(n||s.isNodeInRange(o.getAttachmentContainerElm(),e)||s.isRangeInNode(o.el,e)||o._isSelected())return new a({block:t})},_removeFocusedClass:function(){this.$el.removeClass("focused")},_addFocusedClass:function(){this.$el.addClass("focused")},onDrawRange:function(e){var t,n=this;e?(n._addFocusedClass(),t=document.createRange(),t.selectNodeContents(n.el.firstChild),s.setRange(t,window)):(n._removeFocusedClass(),n.selectAttachment())},_onImgDblclick:function(){var e=this,t=e.block.getResource(),n=e.block.getFileName();u.IS_PC&&e.trigger("yne-open-attachment",t,n)},_onDownloadClick:function(){var e=this,t=e.block,n=t.getResource(),o=t.getFileName();(u.IS_WEB_GROUP||u.IS_WEB_NOTE||u.IS_MAC||u.IS_PC)&&e.trigger("yne-download-attachment",n,o)},_onDragstart:function(){this.$el.find(".attachment-mask").css("opacity",1)},_onDragEnd:function(){this.$el.find(".attachment-mask").css("opacity",0)},_isSelected:function(){return this.$el.find(".attachment-container").hasClass("selected")},selectAttachment:function(e){e?this.$el.find(".attachment-container").addClass("selected"):this.$el.find(".attachment-container").removeClass("selected")},disablePageMode:function(){var e=this;t.prototype.disablePageMode.apply(e),e.$el.css("max-height","none")},_isPagingContinue:function(){return this._isFloatSwitch},_setViewMaxHeight:function(e){var t,n=this,o=n._pageInfo[e-1],i=0,r=n._getTopPosInPage(e);o&&(i=n._getPageBreakBottomPosInView(e-1)),t=n.PAGE_HEIGHT+i-n._viewFrameHeight-r,t<p.PAGE_SPLIT_BLANK_HEIGHT/2&&(t=p.PAGE_SPLIT_BLANK_HEIGHT/2),n.$el.css("max-height",t),l.log("Attachment max-height",n.$el.css("max-height"))},_onMouseMove:function(e){var t=this;clearTimeout(t.timer),t.timer=setTimeout(function(){t.mousePosX=e.originalEvent.x||e.originalEvent.layerX||0,t.mousePosY=e.originalEvent.y||e.originalEvent.layerY||0},200)},_onMouseOut:function(){clearTimeout(this.timer)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(7),o=n(12),i=n(6),r=n(22),a=n(70),l=n(35),s=n(30),c=n(92),u=n(20),d=n(28),p=n(68),h=a.extend({className:"block-view catalogue-view",events:{"click a":"_onAnchorClick"},_forcePageBreakBegin:!0,initialize:function(){a.prototype.initialize.apply(this,arguments);var e=this,t=e.block;t.on("sorting-change",function(){e._renderSorting()}),t.on("focus",e.focus.bind(e)),t.on("blur",e.blur.bind(e))},_renderTemplate:function(){var e=this;e.$el.html(o.render("common","catalogue_view",{isFirst:e.block.isFirst()}))},_renderText:function(){var e,n=this,o=n.block,i=o.getReadOnlyText(),a=n._inlineStyleViewMapper,l=n.$el.find(".para-text"),c=t("<a></a>");e=s.rich2html(i,{styleRules:{color:function(e){var t=e.color;return e.href!==u.getDefault("href")&&r.equals(e.color,"blue")?"#003884":null!=t&&a?a.valueToView("color-catalogue",t):void 0},"font-family":function(e){var t,n=e["font-family"];return null!=n&&a&&(t=a.valueToView("font-family",n)),n!==t?t:d.getAllValueByFont(n)||n}}}),c.html(e),l.html(c),n._renderSorting(),n._addLinkMenu()},_onAnchorClick:function(e){var t=this,n=t.block.getHref();e.stopPropagation(),c.test(n)?t.trigger("open-link",n):t.trigger("inner-goto",n)},_addLinkMenu:function(){var e,t=this,n=t.block,o=t.$el.find("a");o.off("hover"),o.hover(function(){p.isNoteLinkUrl(n.getHref())||t.isCollabLocked()||(e=new l({start:0,end:n.getLength(),block:n}),t.trigger("link-menu-show",{linkNode:o[0],href:n.getViewHref(),range:e,block:n}))},function(){t.trigger("link-menu-hide")})},_renderSorting:function(){this._renderFirst(),this._renderLast()},_renderFirst:function(){var e,t,n=this,o=n.block,i=n.$el;if(!o.isFirst())return i.removeClass("catalogue-first");i.addClass("catalogue-first"),e=i.find(".catalogue-refresh"),t=i.find(".catalogue-delete"),e.off("click"),t.off("click"),e.on("click",function(){n.trigger("command","comp.RefreshCatalogue",{ownerId:o.getOwnerId()})}),t.on("click",function(){n.trigger("command","comp.RefreshCatalogue",{ownerId:o.getOwnerId(),delete:!0})})},_renderLast:function(){var e=this;if(!e.block.isLast())return e.$el.removeClass("catalogue-last");e.$el.addClass("catalogue-last")},_setStyle:function(e,t){var n,o=this,r=o.$el,l=r.find(".para-text"),s=o.block;switch(e){case"indent":n=s.getBlockStyle("text-indent"),t=n+t,t=t>0?t:0,l.css("text-indent",t*i.INDENT_WIDTH||"");break;case"text-indent":n=s.getBlockStyle("indent"),t=n+t,t=t>0?t:0,l.css("text-indent",t*i.INDENT_WIDTH||"");break;case"href":r.find("a").attr("href",s.getViewHref());break;case"back-color":r.css("background-color",t);break;case"padding":r.css({padding:t});break;default:a.prototype._setStyle.call(o,e,t)}},_onLockedChange:function(e){var t=this,n=t.block.getOwnerList();a.prototype._onLockedChange.call(t,e),n.updateLockState(t.isLocked())},getOwnerId:function(){return this.block.getOwnerId()},selectCatalogue:function(e){var t=this.block;e?t.trigger("select"):t.trigger("remove-select")},focus:function(){this.$el.addClass("catalogue-focus")},blur:function(){this.$el.removeClass("catalogue-focus")},_getHeightInPage:function(e){var t=h.__super__._getHeightInPage.apply(this,[e]),n=parseInt(this.$el.css("marginTop")),o=parseInt(this.$el.css("marginBottom"));return isNaN(n)||(t+=n),isNaN(o)||(t+=o),t}});return h}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(49),n(12),n(8),n(120),n(37),n(24)],void 0!==(i=function(e,t,n,o,i,a,l,s){"use strict";var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(t){var n=this;e.prototype.initialize.call(this,t),n._viewProps={block:t.block},n.bindSelectionEvents()},t.prototype.convertToNativeRange=function(){var e=this,t=document.createRange(),n=e.$el.get(0);return t.setStart(n,0),t.setStart(n,n.childNodes.length),t},t.prototype.getImgElement=function(){return this.$el.find("img").get(0)},t.prototype.onDrawRange=function(e){var t,n=this;e?(n._addFocusedClass(),t=document.createRange(),t.selectNodeContents(n.$el.children(".handwrite-copy-hack")[0]),l.setRange(t,window)):(n._removeFocusedClass(),n.selectHandWrite(!1))},t.prototype.parseNativeRange=function(e,t,n){var o=this;if(n||o._isHandWriteInNativeRange(e)||o._isNativeRangeInHandWriteView(e)||o._isSelected())return new a({block:t})},t.prototype.selectHandWrite=function(e){e?this.$el.find(".attachment-container").addClass("selected"):this.$el.find(".attachment-container").removeClass("selected")},t.prototype.render=function(){var t,n,r=this;e.prototype.render.call(this),n=r.block.getSource(i.IS_PC),t=o.render("common","handwrite-view-container",{src:n,needCopyHack:i.IS_MAC||s.isSafari()}),r.$el.html(t)},t.prototype._addFocusedClass=function(){this.$el.addClass("focused")},t.prototype._isHandWriteInNativeRange=function(e){var t,n=this,o=n.getImgElement(),i=window.Range;return t=o.ownerDocument.createRange(),t.selectNode(o),e.compareBoundaryPoints(i.START_TO_START,t)<1&&e.compareBoundaryPoints(i.END_TO_END,t)>-1},t.prototype._isNativeRangeInHandWriteView=function(e){var t,n=this,o=n.el;return t=e.commonAncestorContainer,3===t.nodeType&&(t=t.parentNode),!(t!==o&&!$.contains(o,t))},t.prototype._isSelected=function(){return this.$el.find(".attachment-container").hasClass("selected")},t.prototype._removeFocusedClass=function(){this.$el.removeClass("focused")},t}(n);return delete c.prototype.constructor,c.prototype.className="block-view handwrite-view",n.extend(c.prototype)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(70);return t.extend({initialize:function(){t.prototype.initialize.apply(this,arguments)},className:"block-view heading-view",_renderText:function(){this.$el.find(".para-text").attr("id",this.block.getId()),t.prototype._renderText.apply(this)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(49),i=n(121);return o.extend({className:"block-view hr-view",initialize:function(){var e=this;o.prototype.initialize.apply(e,arguments),t.bindAll(e,"_onStyleChange"),e.block.on("style-change",e._onStyleChange)},render:function(){var e=this,t=e.block,n=t.getBlockStyle("width"),i=t.getBlockStyle("height");e.$el.html('<div class="hr-container"></div>').css({"text-align":t.getBlockStyle("align")}).find(".hr-container").css({width:n+"%",height:i,backgroundColor:t.getBlockStyle("color")}),o.prototype.render.apply(e,arguments),e._renderStyles()},_renderStyles:function(){var e=this,n=e.block,o=n.getBlockStyles();t.each(o,function(t,n){e._setStyle(n,t)})},_setStyle:function(e,t){var n=this.$el;switch(e){case"margin":n.css("margin",t);break;case"back-color":n.css("background-color",t);break;case"padding":t?n.css({padding:t,margin:"0 20px"}):n.css({padding:t})}},_onStyleChange:function(e,t){this._setStyle(e,t)},convertToNativeRange:function(){var e=this,t=document.createRange(),n=e.$el.get(0);return t.setStart(n,0),t.setEnd(n,n.childNodes.length),t},parseNativeRange:function(e,t,n){var o=this;if(n||o._isHrInNativeRange(e))return new i({block:t})},_isHrInNativeRange:function(e){var t,n=this,o=n.$el.find(".hr-container").get(0);return t=o.ownerDocument.createRange(),t.selectNode(o),e.compareBoundaryPoints(Range.START_TO_START,t)<1&&e.compareBoundaryPoints(Range.END_TO_END,t)>-1}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){"use strict";var t=n(49),o=n(7),i=n(0),r=n(12),a=n(96),l=n(1),s=n(446),c=n(37),u=n(24),d=n(62),p=n(169),h=n(119),g=n(8),f=n(6),m=n(447);return t.extend({className:"block-view image-view",DEFAULT_HEIGHT:100,_isFloatSwitch:!1,_$imgDiv:null,_$imgContainerDiv:null,_$imgTitle:null,_viewFrameHeight:null,_isImgLoaded:null,events:{"mousedown .resize-handle":"_onMouseDownResizeHandle","mousedown img":"_onMouseDownImgPreview",mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave","mouseleave .menu-wrapper":"_onMouseLeaveMenuWrapper","click .yne-button-item":"_onButtonItemClick","click .yne-popup-item":"_onPopupMenuItemClick","dblclick img":"_onImgDblclick","click img":"_onImgClick","mousedown .image-title":"_onMouseDownImageTitleHandle"},_imageResizeStartInfo:null,_imageResizeEventNS:null,_imgHeightInData:null,_imgWidthInData:null,_imgHeightBeforeLoad:null,_imgLoadWidth:null,_disableOCR:null,_OCRHighlightInfo:null,_OCRHighlightItem:null,initialize:function(e){var n=this;t.prototype.initialize.apply(n,[e]),n._imageResizeEventNS=".img-resize-"+i.uniqueId(),i.bindAll(n,"_onStyleChange","_onContentChange","_onChangeImageTitle","_onUpdateImageTitle","_editImgTitle","_handlerImgTitle","_onWinResize","_onHighlight"),n.block.on("edit-image-title",n._editImgTitle),n.block.on("style-change",n._onStyleChange),n.block.on("content-change",n._onContentChange),n.block.on("extra-info-change",n._onContentChange),n.block.on("view-resize",n._onWinResize),n.block.on("high-light",n._onHighlight),n.bindSelectionEvents(),n.on("resize",n._onWinResize),n.on("locked-change",function(){n.isLocked()&&(n.trigger("img-title-edit-exit"),n._removeFocusedClass())}),n._disableOCR=!!e.disableOCR||!g.IS_PC,n._OCRHighlightItem=[],n._OCRHighlightInfo=null},render:function(){var e,n=this,o=n.block,a=o.getSource(!0),l=o.getTitle(),s=o.getImageInfo(),c=null,m=null,_=a;s&&(a="/yws/res/thumb/"+s.resId,s.rawWide<=620?(c=s.rawWide,m=s.rawHeight):c=620),n._imgLoadWidth=c,g.IS_PC&&(a=d(a)),(g.IS_WEB_NOTE||g.IS_WEB_GROUP)&&!0===o.getFakeLoading()&&(a=f.LOADING_IMAGE_PATH,o.setFakeLoading(!1)),e=r.render("common","image-view-image-container",{randomId:i.uniqueId("img-view"),width:c,height:m,src:"",hasOCR:!n._disableOCR,needCopyHack:g.IS_MAC||u.isSafari()}),n.$el.html(e),n._isImgLoaded=!1,n._$imgContainerDiv=n.$el.find(".image-container"),n._$imgDiv=n.$el.find("img"),n._$imgTitle=n.$el.find(".image-title"),n._viewFrameHeight=n.$el.outerHeight(!0)-n.$el.height(),n._imgHeightInData=o.getBlockStyle("height",!0),n._imgWidthInData=o.getBlockStyle("width",!0),n._imgHeightBeforeLoad=n._$imgDiv.height(),n._$imgDiv.load(function(){n.$el.hasClass("focused")&&n._onUpdateImageTitle(!0),n._onImgLoaded()}),/^\//.test(a)&&(a=window.location.origin+a),n._$imgDiv.attr("src",h.getURL(p.addIfNeeded(a))),n._renderStyles(),u.isSafari()&&n._$imgContainerDiv.attr("contenteditable","true"),t.prototype.render.apply(n,arguments),n.title=l,l?n._$imgTitle.text(l):n._$imgTitle.hide(),(g.IS_WEB_NOTE||g.IS_WEB_GROUP)&&n._loadOriginImg(_)},_renderStyles:function(){var e=this,t=e.block.getBlockStyles();i.each(t,function(t,n){e._setStyle(n,t)})},_setStyle:function(e,t){var n,i=this,r=i.$el,a=r.find(".image-block-container"),s=o("body").find(".image-title-hidden");switch(e){case"align":r.css("text-align",t),s.length&&s.css("text-align",t);break;case"width":n=i.getImgElement(),l.log("set image width: "+t),null==t&&null==i._imgLoadWidth?o(n).css("width",""):null==t&&i._imgLoadWidth?o(n).css("width",i._imgLoadWidth):i._setImageWidth(t);break;case"float":r.css("float")!==t?(i._isFloatSwitch=!0,r.css("float",t)):i._isFloatSwitch=!1,!1===i.isOnFloat()&&i._resetImageMaxWidth();break;case"height":break;case"back-color":a.css("background-color",t),t?r.css({"padding-top":0,"padding-bottom":0}):r.css({"padding-top":"","padding-bottom":""});break;case"padding":a.css("padding",t);break;default:l.error("unkown style name:",e)}},_onStyleChange:function(e,t){var n=this;n._setStyle(e,t),n.trigger("view-height-changed",n.cid)},_onContentChange:function(){var e=this,t=e.block,n=e.$el,o=t.getTitle(),i=t.getSource(!0);g.IS_PC&&(i=d(i)),i=h.getURL(p.addIfNeeded(i)),n.find("img").attr("src",i),e._$imgTitle.text(o),e.title=o,e._handlerImgTitle(),this.trigger("img-title-edit-exit"),e.trigger("view-height-changed",e.cid)},getImgElement:function(){return this.$el.find("img").get(0)},convertToNativeRange:function(){var e=this,t=document.createRange(),n=e.$el.get(0);return t.setStart(n,0),t.setEnd(n,n.childNodes.length),t},parseNativeRange:function(e,t,n){var o=this;if(n||c.isNodeInRange(o.getImgElement(),e)||c.isRangeInNode(o.el,e))return new a({block:t})},_showButtonGroup:function(){var e=this;e._hidePopupMenu(),s.adjustMenu(e.$el)},_hideButtonGroup:function(){var e=this;e.$el.find(".menu-wrapper").hide(),e._hidePopupMenu()},_onButtonItemClick:function(e){var t=this,n=e.currentTarget,o=n.dataset.buttonName;if(!t.isLocked())switch(o){case"menu":default:t._togglePopupMenu()}},_togglePopupMenu:function(){var e,t,n,o,i,r,a=this,l=a.$el.find(".yne-popup-menu");l.toggle(),l.is(":visible")?(e=a.$el.find(".yne-button-group").outerHeight(),t=l.get(0).getBoundingClientRect(),n=t.top,i=t.height,r=document.documentElement.clientHeight,o=n+i>r?-(i+5):e+5,l.css({top:o+"px"})):l.css({top:""})},_hidePopupMenu:function(){var e=this,t=e.$el.find(".yne-popup-menu");t.hide(),t.css({top:""})},_onMouseEnter:function(){var e=this,t=e.block;e.isLocked()||t.isReadOnly()||e._showButtonGroup()},_onMouseLeave:function(){var e=this;e.isLocked()||e._hideButtonGroup()},_onMouseLeaveMenuWrapper:function(){var e=this;e.isLocked()||e._hidePopupMenu()},_onPopupMenuItemClick:function(e){l.log("click on menu item",e.currentTarget);var t=this,n=e.currentTarget,r=o(n).attr("data-cm-name"),a={},s=t.block;if(!t.isLocked()&&!s.isReadOnly()){switch(t._hidePopupMenu(),r){case"image-title":t._editImgTitle();break;case"float-left":case"float-right":case"clear-float":a.float="float-left"===r?"left":"float-right"===r?"right":"none";break;case"clear-resize":a.width=null;break;case"delete":t.trigger("command","comp.DeleteNoteRange",{range:null,imageBlockView:t});break;case"download":t.trigger("yne-download-image",s.getSource(!0));break;case"image-ocr":t.trigger("yne-image-ocr",m(s))}i.isEmpty(a)||t.trigger("command","comp.ApplyStyles",{range:null,imageBlockView:t,blockStyles:a})}},_removeFocusedClass:function(){var e=this;!e.$el.hasClass("focused")||e.isLocked()||e.block.isReadOnly()||(e.trigger("img-title-edit-end"),e.trigger("img-title-edit-exit"),e._handlerImgTitle()),e.$el.removeClass("focused")},_onUpdateImageTitle:function(e){var t=this,n=function(){var e=t._$imgTitle.offset();return{left:e.left,top:e.top,width:t.$el.width(),height:t._$imgTitle.height(),textAlign:t.block.getStyles("align")}};if(!t.isLocked()&&!t.block.isReadOnly())return e?void t.trigger("img-title-edit-update",n):t.$el.hasClass("focused")?void 0:void t.trigger("img-title-edit-start",t.block.getTitle(),n,t._onChangeImageTitle,t._$imgTitle,t.block.getId())},_addFocusedClass:function(){var e=this;e._onUpdateImageTitle(),e.$el.addClass("focused")},_drawNativeRange:function(){var e=this,t=document.createRange(),n=e.getImgElement();t.selectNode(n),t.collapse(!0),c.setRange(t)},onDrawRange:function(e){var t,n=this;e&&!n.isLocked()?(n._addFocusedClass(),t=document.createRange(),t.selectNodeContents(n.el.lastChild),c.setRange(t,window)):n._removeFocusedClass()},_onMouseDownResizeHandle:function(e){var t,n,i=this,r=i.getImgElement(),a=e.pageX,l=e.pageY,s={centerX:0,centerY:0,startWidth:0,startHeight:0,startToCenter:0},c=i.block;i.isLocked()||c.isReadOnly()||r&&(t=o(r),s.startWidth=t.width(),s.startHeight=t.height(),n=t.offset(),s.centerX=n.left+s.startWidth/2,s.centerY=n.top+s.startHeight/2,s.startToCenter=Math.sqrt(Math.pow(s.centerX-a,2)+Math.pow(s.centerY-l,2)),i._imageResizeStartInfo=s,i._bindEventsForResize(),e.preventDefault(),i.$el.css("height",i.$el.height()))},_bindEventsForResize:function(){var e=this,t=e.el.ownerDocument,n=e._imageResizeEventNS;e._unbindEventsForResize(),o(t).bind("mousemove"+n,e._onResizeMove.bind(e)).bind("mouseup"+n,e._onResizeEnd.bind(e))},_unbindEventsForResize:function(){var e=this,t=e.el.ownerDocument;o(t).unbind(e._imageResizeEventNS)},_onResizeMove:function(e){this._handleImageResize(e.pageX,e.pageY)},_onResizeEnd:function(e){var t=this;t.$el.css("height","auto"),t._unbindEventsForResize(),t._handleImageResize(e.pageX,e.pageY,!0)},_handleImageResize:function(e,t,n){var o,i,r=this,a=r._imageResizeStartInfo,s={};if(a){if(o=Math.sqrt(Math.pow(a.centerX-e,2)+Math.pow(a.centerY-t,2)),i=o*a.startWidth/a.startToCenter,o*a.startHeight/a.startToCenter,!r.getImgElement())return void l.warn("no image element!");if(r._setImageWidth(i),!0!==n)return void r._onUpdateImageTitle(!0);s.width=r._$imgDiv.width(),s.height=r._$imgDiv.height(),r.trigger("command","comp.ApplyStyles",{range:null,imageBlockView:r,blockStyles:s})}},_onImgDblclick:function(){var e=this,t=e.block.getSource(!0);g.IS_PC&&e.trigger("yne-open-image",t)},_onImgClick:function(e){var t=this;t.trigger("img-title-edit-end"),(g.IS_WEB_GROUP||g.IS_WEB_NOTE||g.IS_MAC)&&(t.showImgPreview||t.isLocked()||t.block.isReadOnly())&&t.trigger("get-image-items",t.block),e.preventDefault(),e.stopPropagation()},_onMouseDownImgPreview:function(){var e=this;e.showImgPreview=e.$el.hasClass("focused")},_onChangeImageTitle:function(e,t,n,o){var r=this,a=r.block,l=[],s=[],c={};return e!==a.getTitle()&&(l.push({source:a.getSource(),title:e}),s.push(a),i.extend(c,{resources:s,resProps:l}),t&&i.extend(c,{endingRange:n}),r.trigger("command","comp.ReplaceResource",c)),!e&&o&&r._$imgTitle.hide(),!0},_onMouseDownImageTitleHandle:function(e){e.preventDefault()},onDestroy:function(){this.trigger("img-title-edit-exit")},_onWinResize:function(){var e=this;e.$el.hasClass("focused")&&e._onUpdateImageTitle(!0)},_onHighlight:function(e,t,n){var o=this,i=o.block,r=i.getHighlight(e,t);r&&o._convertToData(r,n)},_convertToData:function(e,t){var n,o=this,r=o._$imgTitle.get(0).firstChild;o._OCRHighlightInfo=null,i.each(e,function(e){null==e.imageInfo?(n=document.createRange(),n.setStart(r,e.start),n.setEnd(r,e.end),t(n)):o._OCRHighlightInfo=e.imageInfo}),o._createHighlightMark()},_editImgTitle:function(){var e=this;setTimeout(function(){e._$imgTitle.show(),e._onUpdateImageTitle(!0),e.trigger("img-title-edit-focus")},0)},_handlerImgTitle:function(){var e=this;e.title?e._$imgTitle.show():e._$imgTitle.hide()},clearHighlight:function(){this._OCRHighlightInfo=null,this._clearHighlightMark()},_clearHighlightMark:function(){i.each(this._OCRHighlightItem,function(e){e.remove()}),this._OCRHighlightItem=[]},disablePageMode:function(){var e=this;t.prototype.disablePageMode.apply(e),e.$el.hasClass("focused")&&e._onUpdateImageTitle(!0),e.$el.css("max-height","none"),e._resetImageMaxWidth()},_contentHeightOverflowCheck:function(){var e,t,n,o,i=this,r=i._$imgTitle.height(),a=0,s=i._$imgDiv.height();return i._isInPageMode()?(e=i.getLastTransPageIndex(),null!=e&&(t=i._getTopPosInPage(e),s=Math.ceil(s),a=Math.ceil(t+s+r+i._viewFrameHeight)-i.PAGE_HEIGHT,l.log("topPos/imgHeight/imgTitleHeight/page_height:",t,s,r,i.PAGE_HEIGHT)),a>0&&(n=i._$imgDiv.height()-a,n<f.PAGE_SPLIT_BLANK_HEIGHT/2&&(n=f.PAGE_SPLIT_BLANK_HEIGHT/2),o=i._$imgDiv.width()*n/i._$imgDiv.height(),i._$imgDiv.css("max-width",o)),a):a},_isPagingContinue:function(){return this._isFloatSwitch},_onImgLoaded:function(){var e,t=this;t._isImgLoaded=!0,t.$el.height("auto"),t._$imgDiv.height("auto"),e=t._$imgDiv.height(),t._imgHeightInData!==e||null==t._imgWidthInData?(t.block.setStyles("height",e),t.block.setStyles("width",t._$imgDiv.width()),t._imgHeightInData=e):t._imgHeightBeforeLoad!==e?t.trigger("view-height-changed",t.cid):l.log("No height change after image loaded",t),t._createHighlightMark()},_createHighlightMark:function(){var e=this,t=e._OCRHighlightInfo;if(e._clearHighlightMark(),null!=t){var n=e._$imgContainerDiv.width()/t.width;i.each(t.pos,function(t){var i=o(r.render("common","high_light_item",{top:t.top*n-1,left:t.left*n-2,height:(t.bottom-t.top)*n,width:(t.right-t.left)*n}));i.appendTo(e._$imgContainerDiv),e._OCRHighlightItem.push(i)})}},_resetImageMaxWidth:function(){var e=this;null!=e._$imgDiv&&e._$imgDiv.css("max-width","")},_setImageWidth:function(e){var t=this;null!=e&&(e=Math.ceil(e),t._$imgDiv.width(e),t._resetImageMaxWidth(),null!=t._imgHeightInData&&!1===t._isImgLoaded&&t._$imgDiv.height(Math.ceil(t._imgHeightInData*t._$imgDiv.width()/e)))},_setViewMaxHeight:function(e){var t=this,n=t._pageInfo[e-1],o=0,i=t._getTopPosInPage(e);n&&(o=t._getPageBreakBottomPosInView(e-1)),t.$el.css("max-height",t.PAGE_HEIGHT+o-t._viewFrameHeight-i),t._contentHeightOverflowCheck()},_loadOriginImg:function(e){var t=this;e=h.getURL(p.addIfNeeded(e)),o("<img />").attr("src",e).load(function(){t._$imgDiv.attr("src",e),t._$imgDiv.removeClass("filter-blur")}).error(function(){t._$imgDiv.unbind("error")}),t._$imgDiv.error(function(){t._$imgDiv.attr("src",e),t._$imgDiv.removeClass("filter-blur")})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(7);return{adjustMenu:function(e){var n=e.find(".menu-wrapper"),o=n.width(),i=t(e.children()[0]),r=e.offsetParent().width(),a=i.position().left;a<o&&i.width()<o?n.addClass("menu-wrapper-left"):n.removeClass("menu-wrapper-left"),r-a-i.width()<o?i.width()<o?(n.addClass("menu-wrapper-mini"),n.removeClass("menu-wrapper-right")):(n.addClass("menu-wrapper-right"),n.removeClass("menu-wrapper-mini")):(n.removeClass("menu-wrapper-mini"),n.removeClass("menu-wrapper-right")),n.show()}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";return function(e){var t=e.getSource();if(t.startsWith("http")){var n=t.split("/");n.length>=2&&(t=n[n.length-2])}return t}}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(70),i=n(12),r=n(116);return o.extend({className:"block-view list-item-view paragraph-view",_template:i.getTemplate("common","list_item_view"),_styleSheet:null,initialize:function(){var e=this;o.prototype.initialize.apply(e,arguments),e._initEvents()},_initEvents:function(){var e=this,n=e.block,o=n.getOwnerList();if(!o)throw"no ownerList!";t.bindAll(e,"_onLevelChange","_onIndexChange","_onTypeChange","_onStyleChange"),n.on("level-change",e._onLevelChange),n.on("index-change",e._onIndexChange),o.on("type-change",e._onTypeChange),n.on("style-change",e._onStyleChange)},_renderLevel:function(){var e=this,t=e.block,n=t.getLevel(),o=e.$el.find(".li-box"),i=r.makeHtmlMarker(t);o.attr("data-level",n),i&&i.listStyleType&&o.attr("data-style-type",i.listStyleType)},_renderText:function(){var e=this;o.prototype._renderText.apply(e,arguments),e._renderMarkerText(),e._renderBlockstyles()},_renderMarkerText:function(){var e,t=this,n=t.block.getText(),o=t.$el.find("li");o.attr("style",""),n.getLength()?e=r.convertToCssStyle(n.getStylesAtIndex(0),t._inlineStyleViewMapper):t.trigger("get-editing-styles",function(n){e=r.convertToCssStyle(n,t._inlineStyleViewMapper)}),e&&o.css(e)},_renderIndex:function(){var e=this,t=e.block;e.$el.find(".li-box").attr("start",t.getIndex())},_setContainerStyles:function(){var e=this,n=e.block,o=n.getBlockStyles();t.each(o,function(t,n){e._setContainerStyle(n,t)})},_setContainerStyle:function(e,t){var n=this.$el,o=n.find(".li-box");switch(e){case"back-color":o.css("background-color",t);break;case"padding":o.css("padding",t)}},render:function(){var e=this;o.prototype.render.apply(e,arguments),e._renderLevel(),e._renderIndex(),e._setContainerStyles(),e.trigger("view-height-changed",e.cid)},_renderTemplate:function(){var e=this,t=e.block;e.$el.html(e._template({isOrdered:t.isOrdered()}))},_onLevelChange:function(){var e=this;e._renderLevel(),e._renderIndex(),e.trigger("view-height-changed",e.cid)},_onIndexChange:function(){var e=this;e._renderIndex(),e.trigger("view-height-changed",e.cid)},_onTypeChange:function(){this.block.setLocked(!1),this.render()},_onStyleChange:function(e,t){var n=this,i=n.$el.find("li");switch(o.prototype._onStyleChange.apply(n,arguments),n._setContainerStyle(e,t),e){case"align":i.css("text-align",t)}},_renderBlockstyles:function(){var e=this,t=e.$el.find("li"),n=e.block.getBlockStyle("align"),o=e.block.getBlockStyle("line-height");n&&t.css("text-align",n),o&&t.css("line-height",o)},_onContentChange:function(){var e=this;0===e.$el.find(".para-text").length&&e.render(),e._renderText(),e.trigger("view-height-changed",e.cid)},_getContentContainer:function(){return this.$el.find(".li-box")}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(41);return function(e,n){if(t.isNode(e)){if(n=!1!==n,e.removeNode&&n)return e.removeNode(e,n);if(e.parentNode&&e.parentNode.removeChild){if(!n)for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);return e.parentNode.removeChild(e)}}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(16),o=n(122);return t.View.extend({tagName:"div",className:"selection-layer",initialize:function(e){var t=e.tableView;this._tableView=t},render:function(){this.$el.attr("contenteditable","false")},hide:function(){this.$el.hide()},_computeViewRect:function(e){if(e){var t,n,i,r,a=this,l=a._tableView,s=e.getAsRectRange();if(s&&(t=s.getFirstCell(),n=s.getLastCell(),t&&t.cell&&n&&n.cell))return i=l.getBoundingRectByCell(t.cell),r=l.getBoundingRectByCell(n.cell),o.union(i,r)}},draw:function(e){var t=this,n=t._computeViewRect(e);n&&n.width>0&&n.height>0?t.$el.css({top:n.top,left:n.left,width:n.width,height:n.height}).show():t.$el.hide()}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(16),i=n(7),r=n(1),a=n(0),l=n(52),s=n(103),c=n(27),u=n(5),d=n(452),p=n(53),h=n(140),g=n(10),f=n(75),m=n(41),_=n(453),y=n(37),v=n(44),b=n(148),k=n(28),C=n(22),S=n(12),I=n(461),w=n(131),E=n(462),T=n(463),N=n(110),A=n(77);return n(464),t=o.View.extend({tagName:"div",className:"cell-edit",_editBox:null,_changeMonitor:null,_isDirty:!1,_editingCellId:null,_rangeWhenBlur:null,_editingInlineStates:null,events:{contextmenu:"_onPreventAndStop",mousedown:"_onStopPropagation",copy:"_onStopPropagation",cut:"_onStopPropagation",paste:"_onPaste",dblclick:"_onDblclick"},_onPreventAndStop:function(e){e.preventDefault(),e.stopPropagation()},_onStopPropagation:function(e){e.stopPropagation()},initialize:function(e){var t=this;t._table=e.table,t._tableView=e.tableView,t._styleRules=e.styleRules,t._mapper=e.mapper,t._isRendered=!1,t._commander=_({editHost:t}),t._uid=a.unique("cell-edit-view-"),t._eventNS="."+t._uid,delete t.options},render:function(){var e=this,t=S.render("common","table_cell_edit",{}),n=e.el;!0!==e._isRendered&&(e._isRendered=!0,n.innerHTML=t,e._editBox=n.querySelector(".cell-edit-box"),e._initEvents())},_initEvents:function(){var e=this,t=e._editBox;c.addListeners({focus:"_onFocus",blur:"_onBlur",textInput:"_onTextInput",compositionstart:"_onCompositionStart",compositionend:"_onCompositionEnd",click:"_onClick"},i(t),e),e._initKeyHandlerManager(),e._changeMonitor=d.create({el:t}),c.addListeners({"content-change":"_onContentChange"},e._changeMonitor,e),e._history=T.create(),c.addListeners({undo:"_onHistoryUndo",redo:"_onHistoryRedo",change:"_onHistoryChange"},e._history,e)},_bindKey:function(e){var t=this,n=t._keyMonitor;e&&(n||(t._keyMonitor=n=new s({el:t._editBox,beforeMatch:function(e){e.stopPropagation()}})),n.unbind(e),n.bind(e,function(n){t._keyHandlerManager&&t._keyHandlerManager.execWithKey(e,t,n)}))},_unbindKey:function(e){var t=this,n=t._keyMonitor;n&&e&&n.unbind(e)},_initKeyHandlerManager:function(){var e=this,t=new u({scope:"table-cell-edit"}),n=t.getAvailableHandlerNames();t.on("bind-key",e._bindKey.bind(e)),t.on("unbind-key",e._unbindKey.bind(e)),a.each(n,function(e){t.bind(e)}),e._keyHandlerManager=t},blur:function(){this._editBox.blur()},_onBlur:function(){var e=this;if(e._isOnToolbarLinkView())return void(e._rangeWhenBlur=e.getNativeRange());this.trigger("blur"),this._commitChange()},_onFocus:function(){r.log("on focus")},_recognizeLink:function(e){var t,n,o=this,i=o.getNativeRange(),r=o.getEditBox(),a=w.getUrlInfoBeforeRange(i,r)||{},l=o._compositionStartUriInfo||{};if(l.alreadyUrl||a.alreadyUrl)return e.preventDefault(),n=document.createElement("div"),n.innerHTML=e.data,t=v.create({name:"insertHTML",value:"<span></span>"+n.innerText,isNative:!0}),void o.execCommand(t);a.startNode&&(" "!==e.data||a.alreadyUrl||(e.preventDefault(),i=document.createRange(),i.setStart(a.startNode,a.startOffset),i.setEnd(a.endNode,a.endOffset),o.setNativeRange(i),t=v.create({name:"insertLink",value:a.uri}),o.execCommand(t),i=o.getNativeRange(),i.collapse(!1),o.setNativeRange(i),t=v.create({name:"insertHTML",value:" ",isNative:!0}),o.execCommand(t)))},_onTextInput:function(e){var t=this,n=e.originalEvent||e;n.stopPropagation(),r.log("text",n.data),t._recognizeLink(n)},_onCompositionStart:function(e){var t=this,n=t.getNativeRange(),o=t.getEditBox();e.stopPropagation(),r.log("composition start"),this._isOnComposition=!0,this._compositionStartUriInfo=w.getUrlInfoBeforeRange(n,o)},_onCompositionEnd:function(e){e.stopPropagation(),r.log("composition end"),this._isOnComposition=!1,this._compositionStartUriInfo=null},_onClick:function(e){e.stopPropagation()},_onContentChange:function(){var e=this;e._isDirty=!0,e._handleChangeWithDebounce()},_snapshot:function(){var e,t=this,n=t._editBox,o=t.getNativeRange();return o?(e=E.jsonlify(n,o),{html:n.innerHTML,jsonRange:e}):void r.warn("Failed to create snapshot",o)},_saveHistory:function(){var e=this,t=e._lastSnapshot||e._baseSnapshot,n=e._snapshot();e._history.save({snapshotBefore:t,snapshotAfter:n}),e._lastSnapshot=n},_clearTimeoutOfHandleChange:function(){var e=this;e._timeoutOfHandleChange&&(window.clearTimeout(e._timeoutOfHandleChange),e._timeoutOfHandleChange=null)},_handleChangeWithDebounce:function(){var e=this;e._clearTimeoutOfHandleChange(),e._timeoutOfHandleChange=window.setTimeout(function(){if(e._isOnComposition)return!1;e._saveHistory()},500)},_silentDo:function(e){var t=this;t._changeMonitor&&!1===t._changeMonitor.isMonitoring()?e():(t._changeMonitor.disconnect(),e(),t._changeMonitor.observe())},silentDocSelectionChangeDo:function(e){var t=this;t._stopListenerDocSelectionChange?e():(t._stopListenerDocSelectionChange=!0,e(),window.clearTimeout(t._timeoutForStopListenerDocSelectionChange),t._timeoutForStopListenerDocSelectionChange=window.setTimeout(function(){t._stopListenerDocSelectionChange=!1},0))},undo:function(){var e=this,t=e._history;return e._clearTimeoutOfHandleChange(),!!t&&t.undo()},redo:function(){var e=this,t=e._history;return e._clearTimeoutOfHandleChange(),!!t&&t.redo()},_restoreSnapshot:function(e){if(e){var t=this;t._clearTimeoutOfHandleChange(),t._silentDo(function(){var n;t._editBox.innerHTML=e.html,n=E.parseJSON(t._editBox,e.jsonRange),t.setNativeRange(n)})}},_onHistoryUndo:function(e){this._restoreSnapshot(e)},_onHistoryRedo:function(e){this._restoreSnapshot(e)},_onHistoryChange:function(){var e=this,t=e._history;e.trigger("cell-edit-view-history-change",{canUndo:t.canUndo(),canRedo:t.canRedo()})},_handleContentWhenShowAndEdit:function(e,t){var n,o,i=!1;return null!=e?e instanceof f||(n=e instanceof g?e:g.create(e+""),o=f.create({richText:n}),i=!o.isEmpty()):t.getType()===p.TEXT&&(o=t.getContent(),o.isEmpty()&&(o=null)),{lines:o,isDirty:i}},showAndEdit:function(e){if(!e||null==e.row||null==e.col)return void r.warn("Failed to show cell edit view, parameter is not valid",e);var t,n,o,l,s=this,c=s._table.getCell(e.row,e.col),u=i(s._editBox),d={};c&&(s._changeMonitor.disconnect(),s._editingCellId=c.getCellId(),(t=s._tableView.getBoundingRectAt(e.row,e.col))&&(n=s._handleContentWhenShowAndEdit(e.content,c),o=n.lines,o||(o=f.createBlank(!0),l=!0),s._isDirty=n.isDirty,u.css({left:t.left,top:t.top,width:t.width,minHeight:t.height-3}),s._renderLines(o),s.$el.show(),s._focusEditBox(!0),l&&(a.each(c.getStylesForEmpty(),function(e,t){var n,o={};if(o[t]=e,n=I.createCmdBall("comp.ApplyStyles",{inlineStyles:o}),r.log("stylesForEmpty to cmdBall",t,e,n),!n)return!1;d[n.name]=n}),d.fontSize&&(s.execCommand(d.fontSize),delete d.fontSize),a.each(d,function(e){s.execCommand(e)})),s._changeMonitor.observe(),s._addListenerForDocSelectionChange(),s._baseSnapshot=s._snapshot(),s.trigger("cell-edit-view-enter",{canUndo:s._history.canUndo(),canRedo:s._history.canRedo()})))},_onSelectionChange:function(){var e=this,t=e.getNativeRange();e._clearEditingInlineStates(),e.trigger("cell-edit-view-selection-change",t)},_addListenerForDocSelectionChange:function(){var e=this;i(document).on("selectionchange"+e._eventNS,function(t){return e.getNativeRange()?e._stopListenerDocSelectionChange?void r.log("selection change NOT listener"):void e._onSelectionChange(t):void r.log("native range is not in cell edit view")})},_removeListenerForDocSelectionChange:function(){i(document).off("selectionchange"+this._eventNS)},_renderLines:function(e){var t=this,n=e.toHtml({styleRules:t._styleRules}),o=t._editBox;i(o).html(n)},_focusEditBox:function(e){var t,n,o=this,i=o._editBox;if(e){var r=y.getRange(),a=i.querySelector(".table-cell-line");if(!a||!r)return;t=a.lastChild,n=t||a,r.setStart(n,n.childNodes.length),r.setEnd(n,n.childNodes.length),y.setRange(r)}i.focus()},hide:function(){this.$el.hide()},_filterToLinesHtml:function(){var e=this,t=e._editBox,n=function(e){a.each(e,function(e){var t=e.style.textDecorationLine;t&&(e.style.textDecoration=t),e.hasChildNodes()&&n(e.children)})};n(t.children)},_getContentAsLines:function(){var e,t,n=this,o=f.createBlank();return n._viewStyleToData(),n._filterToLinesHtml(),e=n._editBox.innerHTML,t=h(e,{holdSpaces:!0})||[],a.each(t,function(e){var t=A.blockToCellContent(e);t instanceof f&&o.appendLines(t)}),o},_viewStyleToData:function(){var e=this,t=e._editBox,n=e._styleRules,o=e._mapper;a.map(n,function(n,i){var r,l,s;if(r=t.querySelectorAll("font"),"font-family"===i)return void a.forEach(r,function(e){l=e.getAttribute("face"),(l=k.getFontFirstValue(l))&&(s=o.valueFromView(i,l))&&e.setAttribute("face",s)});e._elsViewStyleToData(r,o,i),e._elsViewStyleToData(t.querySelectorAll("span"),o,i)})},_elsViewStyleToData:function(e,t,n){var o,i,r=!1;a.forEach(e,function(e){o=e.getAttribute(n),o?r=!0:o=e.style[n],o&&("color"===n&&(o=C(o).toHexString()),(i=t.valueFromView(n,o))&&(r?e.setAttribute(n,i):e.style[n]=i))})},_commitChange:function(){var e,t=this;r.log("commit change"),t._isDirty&&(e=t._getContentAsLines(),t.trigger("set-cell-content",t._editingCellId,e)),t.exit()},_isOnToolbarLinkView:function(){return i(".combo-menu-link .link-input").is(":visible")},isFocused:function(){var e=this,t=document.activeElement;return t===e.el||i.contains(e.el,t)},_isShow:function(){return this.$el.is(":visible")},isOnEdit:function(){var e=this;return!!e.isFocused()||e._isOnToolbarLinkView()&&e._isShow()},getNativeRange:function(){var e=this,t=y.getRange();if(y.isRangeInNode(e._editBox,t))return t;r.warn("native range is null or not in cell edit view",t)},setNativeRange:function(e){var t=this;y.isRangeInNode(t._editBox,e)?y.setRange(e):r.warn("Failed to set native range to cell edit view",e)},_formatStyles:function(e){return e},_queryStyles:function(e){var t,n,o=this,i=o.getNativeRange();if(i)return t=i.startContainer,m.isText(t)&&(t=t.parentNode),n=window.getComputedStyle(t,null),n=o._formatStyles(n),e?n[e]:n},_queryInlineStylesForBulb:function(){var e=this,t=e._queryStyles(),n={},o={style:t},i=a.keys(I.INLINE_STYLES_CMD_MAP);return a.forEach(i,function(e){n[e]=N[e].action(o)}),n},queryInlineStylesForBulb:function(){var e,t,n,o=this,i=o.getNativeRange();if(i)return e=o._queryInlineStylesForBulb(),i.collapsed&&o._editingInlineStates?(t=a.clone(o._editingInlineStates),a.defaults(t,e),n=t):n=e,n.cellEditViewRangeCollapsed=i.collapsed,n},toggleInlineStyle:function(e){var t,n,o=this;if(-1===a.keys(I.TOGGLE_INLINE_STYLES_CMD_MAP).indexOf(e))return void r.warn("toggleInlineStyle does NOT supprot",e);n=I.getCmdNameByStyleName(e),t=v.create({name:n,tryNativeIfNeeded:!0}),o.execCommand(t)},_shouldModifyEditingInlineStates:function(e,t,n){return!!(e&&e.name&&t&&t.collapsed&&1===n)&&a.values(I.INLINE_STYLES_CMD_MAP).indexOf(e.name)>-1},_grabEditingInlineStates:function(e){if(e&&e.name){var t,n=this;n._editingInlineStates||(t=n._queryInlineStylesForBulb(),n._editingInlineStates=t)}},_updateEditingInlineStates:function(e){if(e&&e.name){var t=this,n=e.name,o=e.value,i=I.getStyleNameByCmdName(n),r=a.keys(I.TOGGLE_INLINE_STYLES_CMD_MAP);i&&t._editingInlineStates&&(r.indexOf(i)>-1&&!0!==o&&!1!==o&&(o=!t._editingInlineStates[i]),t._editingInlineStates[i]=o)}},_clearEditingInlineStates:function(){this._editingInlineStates=null},execCommand:function(e){var t,n,o=this,i=o.getNativeRange();return r.log("execCommand",e),i?(o._nestLevel||(o._nestLevel=0),o._nestLevel++,t=o._shouldModifyEditingInlineStates(e,i,o._nestLevel),1===o._nestLevel&&(t?o._grabEditingInlineStates(e):o._clearEditingInlineStates()),n=o._commander.exec(e),n&&1===o._nestLevel&&(t?o._updateEditingInlineStates(e):o._clearEditingInlineStates(),o.trigger("cell-edit-view-command-executed")),o._nestLevel--,n):(r.warn("nativeRange  is not in editBox"),!1)},exit:function(){var e=this;e._isDirty=!1,e._editingCellId=null,e._clearTimeoutOfHandleChange(),e._lastSnapshot=null,e._baseSnapshot=null,e._removeListenerForDocSelectionChange(),e._changeMonitor.disconnect(),e._history.reset(),e.trigger("cell-edit-view-exit"),e.hide()},_filterTable:function(e){var t=e.querySelectorAll("table");a.each(t,function(e){var t=e.querySelectorAll("td"),n="";a.each(t,function(e){n+=e.innerHTML}),e.innerHTML=n})},_filterHtml:function(e){var t=l(e),n=["img"];return t?(this._filterTable(t),a.each(b,function(e,t){!1===e&&n.push(t)}),a.each(n,function(e){var n=t.querySelectorAll(e);a.each(n,function(e){e&&e.parentNode&&e.parentNode.removeChild(e)})}),t.innerHTML.trim()):""},_onPaste:function(e){var t,n,o=this,i=e.originalEvent||e,r=i.clipboardData;e.stopPropagation(),e.preventDefault(),r&&r.types&&(-1!==a.indexOf(r.types,"text/html")?(t=r.getData("text/html"),t=o._filterHtml(t),n=v.create({name:"insertHTML",isNative:!0,value:t})):-1!==a.indexOf(r.types,"text/plain")&&(t=r.getData("text/plain"),n=v.create({name:"insertText",isNative:!0,value:t})),o.execCommand(n))},_onDblclick:function(e){e.stopPropagation()},editFromToolbar:function(e,t){var n,o=this,i=o.getNativeRange(),r=o.queryInlineStylesForBulb();return o._rangeWhenBlur&&(i=o._rangeWhenBlur,y.setRange(i)),!!i&&(!!(n=I.createCmdBall(e,t,r))&&(o.execCommand(n),o._rangeWhenBlur=null,!0))},getEditBox:function(){return this._editBox}},{create:function(e){return e&&e.table&&e.tableView?new t(e):void r.warn("Failed to create CellEditView",e)},isRangeIn:function(e){if(!e)return!1;return y.isRangeInSelector("div.cell-edit",e)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(17),i=n(7),r=n(1),a=window.MutationObserver||window.WebKitMutationObserver;return t=o.extend({initialize:function(e){var t=this;e=e||{},t._el=e.el,t._monitoring=!1,t._hasBindDOMSubtreeModified=!1,delete t.options,a&&(t._observer=new a(function(){t._fireChange()}))},_fireChange:function(){var e=this;!0===e._monitoring&&e.trigger("content-change")},observe:function(){var e=this;e.isMonitoring()||(e._observer?e._observer.observe(e._el,{childList:!0,attributes:!0,subtree:!0,characterData:!0,attributeFilter:["style"]}):!1===e._hasBindDOMSubtreeModified&&(e._hasBindDOMSubtreeModified=!0,i(e._el).on("DOMSubtreeModified",e._fireChange.bind(e))),e._monitoring=!0)},disconnect:function(){var e=this;e._monitoring=!1,e._observer&&e._observer.disconnect()},destroy:function(){var e=this;e._observer?(e._observer.disconnect(),e._observer=null):!0===e._hasBindDOMSubtreeModified&&i(e._el).off("DOMSubtreeModified")},isMonitoring:function(){return this._monitoring}},{create:function(e){return e&&e.el?new t(e):void r.warn("Failed to create ChangeMonitor")}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(454),o=n(455),i=n(456),r=n(457),a=n(458),l=n(459),s=n(460),c=[i,r,o,a,l,s];return function(e){var n=t.create(e);return n.addCmds(c),n}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(0),i=n(1),r=n(15),a=["undo","redo","fontSize"];return t=r.extend({initialize:function(e){var t=this;e=o.defaults(e||{},{editHost:null}),t._commands={},t._editHost=e.editHost,delete t.options},addCmd:function(e){var t=this,n=t._commands;if(e&&e.name&&e.action){if(n[e.name])return void i.warn("command has defined: ",e.name);n[e.name]=e}},addCmds:function(e){var t=this;o.each(e,function(e){t.addCmd(e)})},exec:function(e){var t,n=this;return e&&e.name?(!0===e.stopSelectionChange?n._editHost.silentDocSelectionChangeDo(function(){t=n._exec(e)}):t=n._exec(e),t):(i.warn("Failed to exec cmdBall",e),!1)},_exec:function(e){var t,n,o,r=this,l=r._commands;if(t=e.name,!e.isNative){if((o=l[t])&&o.action)return n=o.action.apply(o,[e.value,r,r._editHost]),e.callback&&e.callback(n),n;if(i.warn("no command",t),!e.tryNativeIfNeeded)return!1;i.warn("try to exec native command",t)}return a.indexOf(t)>-1?(i.error("native command is unvalid",t),!1):(n=r.execNative(t,e.value),e.callback&&e.callback(n),n)},execNative:function(e,t){if(!document.queryCommandSupported(e))return void i.error("command is not supported",e);document.execCommand("styleWithCSS",!1,!0);var n=document.execCommand(e,!1,t||"");return n||i.error("Failed to exec command",e,t),n}},{create:function(e){return new t(e)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(44);return{name:"fontSize",action:function(e,n,o){var i,r=o.getNativeRange();return!!r&&(r.collapsed?(o.execCommand(t.create({name:"insertHTML",isNative:!0,value:'<span style="font-size: '+e+'px;"> </span>'})),o.execCommand(t.create({name:"delete",isNative:!0}))):(i=t.create({name:"applyInlineStyle",value:{name:"fontSize",value:e+"px"},isNative:!1}),o.execCommand(i)))}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(41),i=n(1),r=function(e,t){if(e&&e.tagName)return(e.tagName+"").toLowerCase()===(t+"").toLowerCase()},a=function(e,t){for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1},l=function(e,t,n){if(n===e)return null;if(e.firstChild&&!t)return e.firstChild;if(!e.parentNode)return null;for(var o=e.nextSibling||l(e.parentNode,!0,n);a(o,n);)o=o.firstChild;return o},s=function(e){var t=e.startContainer,n=e.endContainer,o=e.startOffset,i=e.endOffset;return t===n&&o===i},c=function(e){var t,n=e.startContainer,i=e.endContainer,r=e.startOffset,a=e.endOffset;o.isText(i)&&a!==i.length&&i.splitText(a),o.isText(n)&&0!==r&&(t=n.splitText(r),n===i&&(i=t,a=t.length),n=t,r=0),e.setStart(n,r),e.setEnd(i,a)},u=function(e,t,n){var i,r=e.startContainer,a=e.startOffset,s=e.endContainer,c=e.endOffset;for(o.isElement(r)&&0!==a&&(i=r.childNodes[a],r=i||r.nextSibling,a=0),o.isElement(s)&&c!==s.length&&(0===c?s=s.previousSibling:(i=s.childNodes[c-1],s=i||s.previousSibling),c=s.length),i=r;i;i=l(i,t,s))n(i)},d=function(e){if(e.parentNode){var n=t.toArray(e.childNodes),o=e.parentNode;r(e,"span")&&0===e.attributes.length&&(t.each(n,function(t){e.removeChild(t),o.insertBefore(t,e)}),o.removeChild(e)),t.each(n,function(e){d(e)})}},p=function(e,t){u(e,!1,function(e){o.isElement(e)&&(e.style[t]="")}),d(e.commonAncestorContainer)},h=function(e){return{startNode:e.startContainer,endNode:e.endContainer,startOffset:e.startOffset,endOffset:e.endOffset}},g=function(e,t){e.setStart(t.startNode,t.startOffset),e.setEnd(t.endNode,t.endOffset)},f=function(e,t,n){var i;c(e),i=h(e),p(e,t),u(e,!0,function(i){var r,a;o.isElement(i)?i.style[t]=n:o.isText(i)&&!/^\s*$/.test(i.data)&&(r=e.startContainer.ownerDocument,a=r.createElement("span"),a.style[t]=n,i.parentNode.insertBefore(a,i),i.parentNode.removeChild(i),a.appendChild(i))}),g(e,i)};return{name:"applyInlineStyle",action:function(e,t,n){var o=e.name,r=e.value,a=n.getNativeRange();return a&&!s(a)?(f(a,o,r),n.setNativeRange(a),!0):(i.warn("Failed to execute applyInlineStyle",a),!1)}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(44),i=n(172);return{name:"applyInlineStyles",action:function(e,n,r){var a=!1;return t.map(i.INLINE_STYLES_CMD_MAP,function(n,i){if(t.has(e,i)){if(null==e[i])return;r.execCommand(o.create({name:n,value:e[i],stopSelectionChange:"fontSize"===n})),a=!0}}),a}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(44),o=n(79),i=n(87);return{name:"insertLink",action:function(e,n,r){return!!(e=i.safeHref(e))&&(r.execCommand(t.create({name:"underline",value:!0})),r.execCommand(t.create({name:"createLink",value:o.completeUrl(e||"")})),!0)}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(){return{name:"undo",action:function(e,t,n){return n.undo()}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(){return{name:"redo",action:function(e,t,n){return n.redo()}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(44),o=n(28),i=n(0),r=n(1),a=n(172);return{TOGGLE_INLINE_STYLES_CMD_MAP:a.TOGGLE_INLINE_STYLES_CMD_MAP,INLINE_STYLES_CMD_MAP:a.INLINE_STYLES_CMD_MAP,getStyleNameByCmdName:function(e){var t,n=this;return i.some(n.INLINE_STYLES_CMD_MAP,function(n,o){if(n===e)return t=o,!0}),t},getCmdNameByStyleName:function(e){if(e)return this.INLINE_STYLES_CMD_MAP[e]},_createInlineStyleCmdBall:function(e){e=e||{};var n,r=this;return i.some(r.INLINE_STYLES_CMD_MAP,function(r,a){if(i.has(e,a))return"font-family"===a&&(e[a]=o.getAllValueByFont(e[a])||e[a]),n=t.create({name:r,value:e[a],stopSelectionChange:"fontSize"===r}),!0}),n},_createFormatPainterCmdBall:function(e,n){return i.map(n,function(t,o){e[o]===n[o]&&delete e[o]}),t.create({name:"applyInlineStyles",value:e})},createCmdBall:function(e,n,o){var i,a=this;switch(n=n||{},e){case"comp.RemoveFormat":i=t.create({name:"removeFormat"});break;case"comp.FormatPainter":if(!n.data||!n.data.inlineStyles)return;i=a._createFormatPainterCmdBall(n.data.inlineStyles,o);break;case"comp.ApplyStyles":n.inlineStyles&&(i=a._createInlineStyleCmdBall(n.inlineStyles));break;case"comp.InsertLink":if(!n.src)return;i=t.create({name:"insertLink",value:n.src});break;case"undo":i=t.create({name:"undo",isNative:!1,tryNativeIfNeeded:!1});break;case"redo":i=t.create({name:"redo",isNative:!1,tryNativeIfNeeded:!1})}return i?r.log("toolbarAdapter handles name/args/ball",e,n,i):r.warn("toolbarAdapter do NOT handle: ",e,n),i}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(41),i=n(1);return{jsonlify:function(e,n){if(e&&n){var r=function(n){var i,r={};return o.isText(n)?(i=n.parentNode,r.childIndex=t.indexOf(i.childNodes,n)):i=n,r.isRoot=i===e,r.isRoot?r:(r.tagName=i.tagName,r.tagIndex=t.indexOf(e.querySelectorAll(r.tagName),i),r)},a={collapsed:n.collapsed,startContainer:r(n.startContainer),startOffset:n.startOffset};return i.log(a),a.collapsed?a:(a.endContainer=r(n.endContainer),a.endOffset=n.endOffset,a)}},parseJSON:function(e,t){if(e&&t){var n,o=function(t){var n,o;return t.isRoot?null!=t.childIndex?e.childNodes[t.childIndex]:e:(o=e.querySelectorAll(t.tagName),n=o[t.tagIndex],null!=t.childIndex?n.childNodes[t.childIndex]:n)},i=e.ownerDocument,r=i.createRange(),a=o(t.startContainer);return r.setStart(a,t.startOffset),t.collapsed?r.setEnd(a,t.startOffset):(n=o(t.endContainer),r.setEnd(n,t.endOffset)),r}}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(17),i=n(1);return t=o.extend({initialize:function(){var e=this;delete e.options,e.reset()},reset:function(){var e=this;e._undo=[],e._redo=[],e.trigger("change")},save:function(e){if(!e||!e.snapshotBefore||!e.snapshotAfter)return i.warn("parameter is unvalid",e),!1;var t=this;return t._undo.push(e),t._redo=[],t.trigger("change"),i.log("history save operation",t._undo.length,e),!0},canUndo:function(){return this._undo.length>0},canRedo:function(){return this._redo.length>0},undo:function(e){var t,n=this;for(e=e||1,i.log("history undo",e);e&&e>0&&n.canUndo();)t=n._undo.pop(),n._redo.push(t),e--;return!!t&&(i.log("history undo",t.snapshotBefore),n.trigger("undo",t.snapshotBefore),n.trigger("change"),!0)},redo:function(e){var t,n=this;for(e=e||1,i.log("history redo",e);e&&e>0&&n.canRedo();)t=n._redo.pop(),n._undo.push(t),e--;return!!t&&(i.log("history redo",t.snapshotAfter),n.trigger("redo",t.snapshotAfter),n.trigger("change"),!0)}},{create:function(e){return new t(e)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){n(465),n(466),n(467),n(468),n(469),n(470),n(471)}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(5),o=n(44),i=n(131),r=function(e){var t,n,r=e.getNativeRange(),a=e.getEditBox();t=i.getUrlInfoBeforeRange(r,a),t?(t.alreadyUrl||(r=document.createRange(),r.setStart(t.startNode,t.startOffset),r.setEnd(t.endNode,t.endOffset),e.setNativeRange(r),n=o.create({name:"insertLink",value:t.uri}),e.execCommand(n),r=e.getNativeRange(),r.collapse(!1),e.setNativeRange(r)),n=o.create({name:"insertHTML",value:"<div><br/></div>",isNative:!0})):n=o.create({name:"insertLineBreak",isNative:!0}),e.execCommand(n)};t.register({name:"enter",scope:"table-cell-edit",key:"enter",action:r})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(5),o=n(44),i=n(131),r=function(e){var t,n,r=e.getNativeRange(),a=e.getEditBox();t=i.getUrlInfoBeforeRange(r,a),t?(t.alreadyUrl||(r=document.createRange(),r.setStart(t.startNode,t.startOffset),r.setEnd(t.endNode,t.endOffset),e.setNativeRange(r),n=o.create({name:"insertLink",value:t.uri}),e.execCommand(n),r=e.getNativeRange(),r.collapse(!1),e.setNativeRange(r)),n=o.create({name:"insertHTML",value:"<div><br/></div>",isNative:!0})):n=o.create({name:"insertLineBreak",isNative:!0}),e.execCommand(n)};t.register({name:"altEnter",scope:"table-cell-edit",key:"alt+enter",action:r}),t.register({name:"shiftEnter",scope:"table-cell-edit",key:"shift+enter",action:r})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){n(5).register({name:"esc",scope:"table-cell-edit",key:"esc",action:function(e){e.exit()}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(5),o=n(0),i={"mod+b":"bold","mod+i":"italic","mod+e":"strike","mod+u":"underline"};o.each(i,function(e,n){t.register({name:e,scope:"table-cell-edit",key:n,action:function(t){t.toggleInlineStyle(e)}})})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(5),o=n(44);t.register({name:"modZ",scope:"table-cell-edit",key:"mod+z",action:function(e){var t=o.create({name:"undo",isNative:!1,tryNativeIfNeeded:!1});e.execCommand(t)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(5),o=n(44),i=function(e){var t=o.create({name:"redo",isNative:!1,tryNativeIfNeeded:!1});e.execCommand(t)};t.register({name:"modShiftZ",scope:"table-cell-edit",key:"mod+shift+z",action:i}),t.register({name:"modY",scope:"table-cell-edit",key:"mod+y",action:i})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){n(5).register({name:"save",scope:"table-cell-edit",key:"mod+s",action:function(){}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t,o=n(16),i=n(0),r=n(1),a=n(27),l=n(103),s=n(37),c=new Array(3).join(" "),u=[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46,91,92,93,112,113,114,115,116,117,118,119,120,121,122,123,144,145,229];return t=o.View.extend({tagName:"input",className:"hidden-input",_lastKeyDownCode:null,initialize:function(){var e=this;e._initEvents(),delete e.options},_initEvents:function(){var e=this;a.addListeners({keydown:"_onKeyDown",textInput:"_onTextInput",compositionstart:"_onCompositionStart",compositionend:"_onCompositionEnd",copy:"_onCopyCutPaste",cut:"_onCopyCutPaste",paste:"_onCopyCutPaste"},e.$el,e)},bindKey:function(e){var t=this,n=t._keyMonitor;e&&(n||(t._keyMonitor=n=new l({el:t.el,beforeMatch:function(e){e.stopPropagation()},afterMatch:function(e,n){n||-1!==i.indexOf(u,e.keyCode)||e.ctrlKey||e.metaKey||t._onPrintableKeyDown(e)}})),n.unbind(e),n.bind(e,function(n){t.trigger("key-monitor",e,n)}))},unbindKey:function(e){var t=this,n=t._keyMonitor;n&&e&&n.unbind(e)},render:function(){this.$el.val(c)},isFocused:function(){return document.activeElement===this.el},isOnEdit:function(){var e=this;return e.isFocused()&&e.getValue()!==c},focus:function(e){var t=this,n=t.el;e&&this.setPosition(e.left,e.top),n.select()},blur:function(){this.el.blur()},setPosition:function(e,t){var n=this,o=n.el;o.style.left=e+"px",o.style.top=t+"px"},setWidth:function(e){this.el.style.width=e+"px"},bringToFront:function(){this.el.value="",this.el.style.zIndex=255},hideBehind:function(){this.el.style.zIndex=-255},_onPrintableKeyDown:function(e){this._printableKeyDown=!0,32===e.keyCode&&(e.preventDefault(),this.$el.trigger("textInput",e))},_onKeyDown:function(e){this._lastKeyDownCode=e.keyCode},_onTextInput:function(e){e=e.originalEvent||e,r.log("hiddenInputView textInput",e),e.stopPropagation();var t=this,n=e.data;if(this._printableKeyDown)return e.preventDefault(),this._triggerTextInput(n),void(this._printableKeyDown=!1);229===t._lastKeyDownCode&&window.setTimeout(function(){t._triggerTextInput(n)},50)},_onCompositionStart:function(e){r.log("hiddenInputView compositionstart",e),e.stopPropagation(),this.bringToFront()},_onCompositionEnd:function(e){if(e=e.originalEvent||e,r.log("hiddenInputView compositionend",e),e.stopPropagation(),!this.locked){var t=e.data||this.$el.val();t&&i.defer(function(){this._triggerTextInput(t)}),this.hideBehind()}},_onCopyCutPaste:function(e){var t=this,n=e.type;e.preventDefault(),e.stopPropagation(),r.log("on copy/cut/paste",n,e),t.trigger(n,e)},_triggerTextInput:function(e){var t=this;t.trigger("text-input",e),t.clearValue()},clearValue:function(){this.el.value=c},getValue:function(){return this.el.value}},{create:function(e){return new t(e)},isRangeIn:function(e){if(e){return s.isRangeInSelector("input.hidden-input",e)}}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(16),o=n(171),i=n(27),r=n(43),a=n(12),l=n(0);return t.View.extend({className:"cell-resize-layer",initialize:function(e){var t=this,n=e.tableView,i=n.$el;t._tableView=n,t._draggable=new o({el:t.el,disableDocSelection:!0}),t._active=!0,t._onDrag=!1,t._resizeDirection=null,t._cellInfo=null,this._rowLine=i.find(".row-resize-line"),this._colLine=i.find(".col-resize-line"),t._bindEvents()},onDestroy:function(){this.draggable.off()},_bindEvents:function(){var e=this,t=e._draggable,n=e._tableView,r={};l.bindAll(e,"_onCellEnter"),r[o.DRAG_START]="_onDragStart",r[o.DRAGGING]="_onDragging",r[o.DRAG_END]="_onDragEnd",i.addListeners(r,t,e),n.on("cell-enter",e._onCellEnter)},render:function(){var e=this,t=a.render("common","table_cell_resize",{});e.$el.html(t),e.showAt()},showAt:function(e){var t=this;e&&null!=e.width&&t.$el.css({width:e.width,height:e.height,top:e.top,left:e.left}).show()},hide:function(){this.$el.hide()},enable:function(){this._active=!0},disable:function(){var e=this;e._active=!1,e.hide()},isActive:function(){return this._active},_parseType:function(e){var t,n=e.className;return l.some(r,function(e,o){var i=o.toLowerCase();if(n.indexOf(i)>-1)return t=e,!0}),t||r.UP},_onDragStart:function(e){var t,n=this,o=n._tableView;o&&!o.isLocked()&&(e.stopPropagation(),n._onDrag=!0,n._resizeDirection=n._parseType(e.target),t=o.getEventBoundingRect(e),n._startRect=t,n._updateResizeLine(t.left,t.top),o.focusOutTbody())},_onDragging:function(e){var t,n=this,o=n._tableView;o&&!o.isLocked()&&(e.stopPropagation(),n._onDrag=!0,t=o.getEventBoundingRect(e),n._updateResizeLine(t.left,t.top))},_onDragEnd:function(e){var t,n,o,i=this,a=i._tableView,l=i._cellInfo;a&&!a.isLocked()&&(e.stopPropagation(),i._onDrag=!1,t=a.getEventBoundingRect(e),i._updateResizeLine(t.left,t.top,!0),n=t.left-i._startRect.left,o=t.top-i._startRect.top,l&&(0===l.row&&i._resizeDirection===r.TOP&&(o=0-o),0===l.col&&i._resizeDirection===r.LEFT&&(n=0-n)),i._execResizeCommand(n,o))},_updateResizeLine:function(e,t,n){switch(this._resizeDirection){case r.UP:case r.DOWN:n?this._rowLine.hide():this._rowLine.css({top:t}).show();break;case r.RIGHT:case r.LEFT:n?this._colLine.hide():this._colLine.css({left:e}).show()}},_execResizeCommand:function(e,t){var n,o,i,a,s,c,u,d,p,h,g=this,f=g._tableView,m=f.block,_=g._cellInfo;switch(g._resizeDirection){case r.UP:case r.DOWN:n=_.row,g._resizeDirection===r.UP?n-=1:(c=m.getMergePointAttrAt(_.row,_.col).height||0)>1&&(n+=c-1),n=n<0?0:n,i=f.getRowElHeight(n),i+=t,i=l.max([i,10]),g.trigger("set-row-height",n,i);break;case r.RIGHT:case r.LEFT:if(o=_.col,g._resizeDirection===r.LEFT?o-=1:(s=m.getMergePointAttrAt(_.row,_.col).width||0)>1&&(o+=s-1),u=o+1,o=o<0?0:o,d=f.getColElWidth(o),a=l.max([d+e,35]),u>=m.getColumnCount()){g.trigger("set-col-width",o,d+e);break}u!==o?(p=d+m.getColumnWidth(u),h=l.max([p-a,35]),g.trigger("set-cells-size",[{col:u,width:h},{col:o,width:p-h}])):g.trigger("set-col-width",o,a)}},_onCellEnter:function(e){var t,n,o,i=this,r=i._tableView,a=r.block;!a.locked&&r&&i.isActive()&&!i._onDrag&&(n=r.getCellElementByTarget(e),(t=a.getCellById(n))&&(i._cellInfo={row:t.row,col:t.col},o=r.getBoundingRect(n),i.showAt(o)))}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(12),o=n(168),i=n(169),r=n(119);return{_renderWrap:function(e){return'<div class="resource-wrap">'+e+"</div>"},renderImage:function(e,t){var n=e.getSource(t),o=document.createElement("img");return o.setAttribute("draggable","false"),o.setAttribute("src",r.getURL(i.addIfNeeded(n))||""),o.setAttribute("width","100%"),o.setAttribute("height","auto"),this._renderWrap(o.outerHTML)},renderAttachment:function(e){var n,i,r,a,l=e.getInfo();return n=o.splitFileFullName(l.fileName),i=o.getSizeString(l.fileLength),a=o.getFileIconByName(l.fileName),r=t.render("common","attachment-view-attachment-container",{name:a,fileName:n.fileName.replace(/ /g,"&nbsp;"),fileType:n.fileType.replace(/ /g,"&nbsp;"),size:i,title:l.fileName.replace(/ /g,"&nbsp;"),draggable:!1}),this._renderWrap(r)}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){n(476),n(477),n(478),n(479),n(480),n(481),n(482),n(483)}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(5),o=n(0),i={"mod+b":"bold","mod+i":"italic","mod+u":"underline","mod+e":"strike"};o.each(i,function(e,n){t.register({name:e,scope:"table-hidden-input",key:n,action:function(t){t.toggleInlineStyle(e)}})})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(5),o=n(43),i=n(0),r={left:o.LEFT,right:o.RIGHT,up:o.UP,down:o.DOWN,tab:o.RIGHT,"shift+tab":o.LEFT,enter:o.DOWN};i.each(r,function(e,n){t.register({name:n,scope:"table-hidden-input",key:n,action:function(t,n){t.moveWithDirection(e,n)}})})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(5),o=n(0),i=["backspace","del"];o.each(i,function(e){t.register({name:e,scope:"table-hidden-input",key:e,action:function(e){e.clearSelectedCells()}})})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){n(5).register({name:"save",scope:"table-hidden-input",key:"mod+s",action:function(e){e.trigger("save-content")}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){n(5).register({name:"select-all",scope:"table-hidden-input",key:"mod+a",action:function(e){e.selectAll(!0)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(5);t.register({name:"undo",scope:"table-hidden-input",key:"mod+z",action:function(e){e.trigger("global-undo")}}),t.register({name:"redo",scope:"table-hidden-input",key:"mod+y",action:function(e){e.trigger("global-redo")}}),t.register({name:"redo_2",scope:"table-hidden-input",key:"mod+shift+z",action:function(e){e.trigger("global-redo")}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(5),o=n(0),i=n(1),r=n(8),a=n(24),l=["mod+1","mod+2","mod+3","mod+4","mod+d","mod+h","mod+l"];a.isSafari()&&!r.IS_MAC||o.each(l,function(e){t.register({name:e,scope:"table-hidden-input",key:e,preventDefault:!0,action:function(){i.log("shortcut prevented on table")}}),t.register({name:e,scope:"table-cell-edit",key:e,action:function(){i.log("shortcut prevented on table")}})})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(5);t.register({name:"paste",key:"mod+v",scope:"table-hidden-input",preventDefault:!1,action:function(e){e.setPasteAsText(!1)}}),t.register({name:"pasteAsText",key:"mod+shift+v",scope:"table-hidden-input",preventDefault:!1,action:function(e){e.setPasteAsText(!0)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(70),o=n(0),i=n(12);return t.extend({$checkbox:null,_checked:!1,name:"todo",className:"block-view todo-view",events:{"mousedown .todo-mark":"_onClick"},initialize:function(e){var n=this;t.prototype.initialize.apply(n,arguments),n.options=e,n.block=e.block,o.bindAll(n,"_blockCheckedChange","_onStyleChange"),n.block.on("checked-change",n._blockCheckedChange),n.block.on("style-change",n._onStyleChange)},_renderTemplate:function(){var e=this;e.$el.html(i.render("common",e.name))},render:function(){var e=this,n=e.block;t.prototype.render.apply(e,arguments),e._blockCheckedChange(n.getChecked()),e._setContainerStyles()},_setContainerStyles:function(){var e=this,t=e.block,n=t.getBlockStyles();o.each(n,function(t,n){e._setContainerStyle(n,t)})},_setContainerStyle:function(e,t){var n=this.$el,o=n.find(".todo-content");switch(e){case"back-color":o.css("background-color",t);break;case"padding":o.css("padding",t)}},_onStyleChange:function(e,n){var o=this;t.prototype._onStyleChange.apply(o,arguments),o._setContainerStyle(e,n)},_blockCheckedChange:function(e){e?this.$el.addClass("checked"):this.$el.removeClass("checked"),this._checked=e},_onClick:function(e){e.preventDefault(),e.stopPropagation();var t=this._checked;this.trigger("command","comp.SetBlockProps",{blocks:[this.block],props:{checked:!t}})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(0),o=n(7),i=n(70),r=n(93),a=n(22),l=n(167),s=n(30),c=n(20),u=n(68),d=n(28);return i.extend({name:"quote",className:"block-view paragraph-view quote-view",_renderText:function(){var e,n,i=this,p=i.block,h=p.getReadOnlyText(),g=i._inlineStyleViewMapper,f=i.$el.find(".para-text");e=h.isEmpty()?this._createHtmlForBlankLine():s.rich2html(h,{styleRules:{color:function(e){var t=e.color;return e.href!==c.getDefault("href")&&a.equals(e.color,"blue")?"#003884":null!=t&&g?g.valueToView("color",t):void 0},"font-family":function(e){var t,n=e["font-family"];return null!=n&&g&&(t=g.valueToView("font-family",n)),n!==t?t:d.getAllValueByFont(n)||n},"font-weight":function(){return r.DEFAULT_STYLES["font-weight"]}}}),f.html(e),n=p.getStyleRanges("href"),t.each(n,function(e){var t,n,r;t=new l({start:e.from,end:e.to,block:p}),n=i.convertToNativeRange(t),(r=i._findLinkNode(n.endContainer))&&(o(r).off("hover"),o(r).hover(function(){u.isNoteLinkUrl(r.href)||i.isCollabLocked()||i.trigger("link-menu-show",{linkNode:r,range:t,block:p})},function(){i.trigger("link-menu-hide")}))})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(49),o=n(123);return t.extend({className:"block-view unknown-view",initialize:function(){var e=this;t.prototype.initialize.apply(e,arguments)},render:function(){var e=this;this.$el.html("<div>当前版本不支持的内容</div>"),t.prototype.render.apply(e,arguments)},convertToNativeRange:function(){},parseNativeRange:function(e,t,n){if(n)return new o({block:t})}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){var t=n(16),o=n(7),i=n(0),r=n(12);return t.View.extend({className:"highlight-view",_baseRect:null,_focusIndex:-1,_list:[],initialize:function(){var e=this;i.bindAll(e,"_extractData","onHide","nextHighlight")},_extractData:function(e){var t=this,n=e.getClientRects(),a=[];i.each(n,function(e){e.width<2||a.push(o(r.render("common","high_light_item",{top:e.top-t._baseRect.top-1,left:e.left-t._baseRect.left-2,height:e.height-2,width:e.width})).appendTo(t.$el).get(0))}),t._list.push(o(a))},_reset:function(){this._list=[],this._focusIndex=-1,this.$el.empty()},showHighlight:function(e,t){var n=this;return e&&t?0===t.length?(n._reset(),void n.onHide()):(n.$el.empty(),n.$el.show(),n._list=[],n._baseRect=n.el.getBoundingClientRect(),i.each(t,n._extractData),n._focusIndex=0,n._list[n._focusIndex].addClass("focused"),void n._list[n._focusIndex].get(0).scrollIntoViewIfNeeded()):(n._reset(),void n.onHide())},nextHighlight:function(e){var t=this;0!==t._list.length&&(t.$el.show(),e=e||1,t._list[t._focusIndex].removeClass("focused"),t._focusIndex=(t._focusIndex+t._list.length+e)%t._list.length,t._list[t._focusIndex].addClass("focused"),t._list[t._focusIndex].get(0).scrollIntoViewIfNeeded())},preHighlight:function(){this.nextHighlight(-1)},onHide:function(){this.$el.hide()}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){function t(e){var t=null;do{a.contains(e.classList,d)&&(a.contains(e.classList,"page-header")?t="header":a.contains(e.classList,"page-footer")&&(t="footer")),e=e.parentElement}while(e);return t}var o=n(16),i=n(12),r=n(7),a=n(0),l=n(1),s=n(103),c=n(164),u=r('<div class="collab-editing-view-wrapper"><div class="collab-session-view"></div></div>'),d="header-footer-view";return o.View.extend({className:d,name:"header-footer",_focus:!1,_isReadOnly:!1,$input:null,events:{"focus .header-footer-input":"_onFocus","blur .header-footer-input":"_onBlur","keydown .header-footer-input":"_onKeyDown","input .header-footer-input":"_onTextInput","paste .header-footer-input":"_onPaste"},initialize:function(e,t){e=e||{};var n=this;n.block=e,n._contentOnFocus=null,n._keyMonitor=new s({el:n.el}),n.isFooter=!0===e.isFooter,n._isReadOnly=!!t,a.bindAll(n,"_onLockedChange","_updateViewByModel","_onPaste","_onHighlight"),e.on("high-light",n._onHighlight),e.on("locked-change",n._onLockedChange),e.on("change",n._updateViewByModel),this.render()},render:function(){var e,t=this,n=t.block,o=t.$el,r="page-"+(n.isFooter?"footer":"header"),a="点击编辑"+(n.isFooter?"页脚":"页眉");e=i.render("common",t.name,{readonly:t._isReadOnly}),o.html(e),o.addClass(r).attr("title",a),t.$input=o.find(".header-footer-input"),t._updateViewByModel(n.getContent(),n.getAlign()),t._updateLockState(t.isLocked())},_updateViewByModel:function(e,t){this._focus||void 0===e||this.setContent(e),void 0!==t&&this.setAlign(t)},_onHighlight:function(e,t,n){var o=this,i=o.block,r=i.getHighlight(e,t);r&&o._convertToData(r,n)},_convertToData:function(e,t){var n,o=this,i=o.$input.get(0).firstChild;a.each(e,function(e){n=document.createRange(),n.setStart(i,e.start),n.setEnd(i,e.end),t(n)})},_onPaste:function(e){var t,n,o=e.originalEvent;e.preventDefault(),o.clipboardData&&o.clipboardData.getData?(t=o.clipboardData.getData("text/plain"),n=t&&t.replace(/\r?\n/g," "),document.execCommand("insertHTML",!1,n)):window.clipboardData&&window.clipboardData.getData&&(t=window.clipboardData.getData("Text"),c(t))},_onLockedChange:function(e){var t=this;t._updateLockState(t.isLocked()),t._updateLockIndicator(t.block.isLocked(),e),t.trigger("locked-change")},isLocked:function(){var e=this,t=e.block,n=!1;return t&&(n=t.isLocked()),n},_updateLockIndicator:function(e,t){var n=this,o=u.clone(),i=o.find(".collab-session-view"),r=t&&t.lockColor,a=t&&t.nickname;e?(n.$el.addClass("collab-editing-view"),void 0!==a&&(i.css("background-color",r),i.text(a),n.$el.find(".collab-editing-view-wrapper").remove(),n.$el.prepend(o))):(n.$el.removeClass("collab-editing-view"),n.$el.find(".collab-editing-view-wrapper").remove())},_updateLockState:function(e){var t=this;e?t.$el.addClass("collab-locked"):t.$el.removeClass("collab-locked")},_onTextInput:function(){this.trigger("text-input",this.$input.text())},_onFocus:function(){var e=this;e._focus=!0,e._contentOnFocus=e.$input.text()||"",l.log("content on focus: "+e._contentOnFocus),e.trigger("focus")},_onBlur:function(){var e=this,t=e.$input.text();e._focus=!1,l.log("content on blur: "+t),t!==e._contentOnFocus&&e.trigger("text-change",t),e.trigger("blur"),e._contentOnFocus=null},_stopPropagation:function(e){e.stopPropagation()},_onKeyDown:function(e){var t=this,n=["mod+s","mod+shift+r","mod+f"],o=!1,i=t._keyMonitor;i.isEventMatchKey(e,"enter")?(e.stopPropagation(),e.preventDefault(),t.$el.blur()):i.isEventMatchKey(e,"tab")?(e.stopPropagation(),e.preventDefault(),document.execCommand("insertHTML",!1,"&emsp;")):i.isEventMatchKey(e,"mod+z")||i.isEventMatchKey(e,"mod+y")?(e.stopPropagation(),e.preventDefault()):(o=a.some(n,function(t){return i.isEventMatchKey(e,t)}),o?e.preventDefault():e.stopPropagation())},getAlign:function(){return this.$input.css("text-align")},setAlign:function(e){var t=this,n="left"===e||"right"===e?e:"center";t.$input.css("text-align",n)},setContent:function(e){this.$input.text(e)},getContent:function(){return this.$input.text()},checkChange:function(){var e=this,t=e.$input.text()||"";null!=e._contentOnFocus&&t!==e._contentOnFocus&&(e.trigger("text-change",t),e._contentOnFocus=t)}},{isHeaderView:function(e){return"header"===t(e)},isFooterView:function(e){return"footer"===t(e)}})}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(17),n(0)],void 0!==(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.stop=function(){this.trigger("progress-stop")},t.prototype.updateContentSetProgress=function(e){o.isNumber(e.percent)&&this.trigger("progress-update",e)},t.prototype.initialize=function(e){},t}(n)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(491),n(1)],void 0!==(i=function(e,t,n,o,i){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.canRedo=function(){return this.coreEditor.canRedo()},t.prototype.canUndo=function(){return this.coreEditor.canUndo()},t.prototype.clearHighlight=function(){this.coreEditor.clearHighlight()},t.prototype.focusHighlight=function(e){if(!0===e)return void this.coreEditor.preHighlight();this.coreEditor.nextHighlight()},t.prototype.getPlain=function(){return this.coreEditor.getPlainContent()},t.prototype.highlight=function(e,t){e&&0!==e.length&&this.coreEditor.highlight(e,t)},t.prototype.insertAttachment=function(e){this.coreEditor.execCommand("comp.InsertAttachment",n.extend({retainStartBlock:!0},e))},t.prototype.insertImage=function(e){this.coreEditor.execCommand("comp.InsertImage",{retainStartBlock:!0,src:e})},t.prototype.redo=function(){return this.coreEditor.redo()},t.prototype.setDefaultFont=function(e,t){t=parseInt(t+"",10),this.coreEditor.setDefaultFont(e,t)},t.prototype.undo=function(){return this.coreEditor.undo()},t.prototype.setPrintNote=function(){this.coreEditor.setPrintNote(!0)},t.prototype.getNoteContentStatus=function(){return this.coreEditor.getNoteContentStatus()},t.prototype.getFirstLineTextContent=function(){return i.log("getFirstLineTextContent"),this.coreEditor.getFirstLineTextContent()},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(6),n(492),n(1)],void 0!==(i=function(e,t,n,o,i){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.buildCollabSession=function(e,t){var n,o=0;try{if(t=t||function(){},n=this.coreEditor.getEditorProps(),null==e&&(e={},e.shareKey=n.shareKey,e.sessionType=n.sessionType,null!=n.sessionId&&(e.sessionId=n.sessionId)),e.buildVersion=n.buildVersion,e.userInfo=n.userInfo,e.collabServer=n.collabServer,null==e.shareKey||"undefined"===e.shareKey)return t({resultCode:0,message:"shareKey should NOT be null"}),0;this.closeCollabSession(),this.coreEditor.buildCollabSession(e,t),o=1}catch(e){t({resultCode:0,message:e.message})}return o},t.prototype.closeCollabSession=function(){this.coreEditor.closeCollabSession(n.WSEVENTID_HOST_CLOSE,"NormalQuit")},t.prototype.getCollabContent=function(e,t){var n;e=e||function(){};try{return this.coreEditor&&this.coreEditor.isCollabEnabled()?n=this.coreEditor.getCollabContent(e,t):(n={status:2,resultCode:2,message:"Not-Collab-Enabled"},e(n),n)}catch(t){return n={status:3,resultCode:3,message:t.message},e(n),n}},t.prototype.getModifiers=function(e,t){var n;t=t||function(){};try{return this.coreEditor&&this.coreEditor.isCollabEnabled()?this.coreEditor.getModifiers(e,t):(n={status:2,resultCode:2,message:"Not-Collab-Enabled"},t(n),n)}catch(e){return n={status:3,resultCode:3,message:e.message},t(n),n}},t.prototype.isReadyToClose=function(){var e=!0;return this.coreEditor&&!this.coreEditor.isLegacyHost()?(i.debugAlert("isReadyToClose should NOT be called in new host"),!1):(this.coreEditor&&this.coreEditor.isCollabEnabled()&&(e=!this.coreEditor.hasCachedDataCmd()),e)},t.prototype.reset=function(){this.coreEditor.reset()},t.prototype.resetEditorOptions=function(e){if(this.coreEditor&&!this.coreEditor.isLegacyHost())return void i.debugAlert("resetEditorOptions should NOT be called in new Host");this.coreEditor.updateEditorOptions(e)},t.prototype.saveNotification=function(e,t){this.coreEditor&&this.coreEditor.isCollabEnabled()&&this.coreEditor.saveNotification(e,t)},t.prototype.toggleAttendeeHint=function(e){if(this.coreEditor&&!this.coreEditor.isLegacyHost())return void i.debugAlert("toggleAttendeeHint should NOT be called in New Host")},t.prototype.destroyCollabEngine=function(){this.closeCollabSession()},t.prototype.isNotSetContent=function(){return this.coreEditor.isNotSetContent()},t.prototype.saveFile=function(e){this.coreEditor.testSendMsgToCollabServer(e)},t}(o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();o=[n,t,n(0),n(6),n(17),n(1)],void 0!==(i=function(e,t,n,o,i,a){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.focus=function(){return this.coreEditor.focus()},t.prototype.getContent=function(e,t,n,o){e=!!e||this.coreEditor.hasHandWriteBlock(),o=!!o;try{return!0===e?this.coreEditor.getHtmlContent(o,t,n):this.coreEditor.getXmlContent(t,n)}catch(e){null!=t&&t({status:0,resultCode:2,message:e.message})}},t.prototype.getNoteVersion=function(){return this.coreEditor.getNoteVersion()},t.prototype.getSchemaVersion=function(){return this.coreEditor.getSchemaVersion()},t.prototype.resetFont=function(){return this.coreEditor.resetFont()},t.prototype.setAllBackgrounds=function(e,t){return this.coreEditor&&!this.coreEditor.isLegacyHost()?void a.debugAlert("setAllBackgrounds shoud NOT be called in new host"):this.coreEditor.setAllBackgrounds(e,t)},t.prototype.setBackground=function(e){return this.coreEditor&&!this.coreEditor.isLegacyHost()&&this.coreEditor.isNotSetContent()?void a.debugAlert("setBackground shoud NOT be called before setContent"):this.coreEditor.setBackground(e)},t.prototype.setContent=function(e,t,i,r,l){var s=this;try{var c=function(e){s.coreEditor.isCollabEnabled()&&1===e.resultCode&&s.coreEditor.noteSetNotification(),null!=l&&l(e)};null==r&&(r=this.options||{}),r=n.defaults(r,{bgImageId:o.DEFAULT_BACKGROUND,disableBackground:!1,isCollabEnabled:!1,isReadOnly:!1,isAsync:!1}),!0===t?this.coreEditor.setHtmlContent(e,i,r,c):this.coreEditor.setXmlContent(e,i,r,c)}catch(e){a.error(e),null!=l&&l({resultCode:0,message:e.message})}},t.prototype.setFont=function(e,t){return this.coreEditor.setFont(e,t)},t.prototype.setReadOnly=function(e){if(this.coreEditor&&!this.coreEditor.isLegacyHost())return void a.debugAlert("setReadOnly shoud NOT be called in new host");this.coreEditor.setReadOnly(e)},t.prototype.initialize=function(e){},t}(i)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(494)],void 0!==(i=function(e,t,n,o){"use strict";return n.union(["require-innerlink","find"],o)}.apply(t,o))&&(e.exports=i)},function(e,t,n){var o,i;o=[n,t],void 0!==(i=function(e,t){"use strict";return["content-change","insert-photo","insert-link","insert-attachment","replace-image","replace-attachment","open-link","download-attachment","download-image","preview-image","context-menu","show-words","save-content","blob-paste","upload-image","clipboard-error","background-failed-update","background-changed","is-vip-user","table-click","image-ocr","collabsession-change","datacommand-success","session-built","session-closed","session-initialized","useraction-failed","user-action-collection","view-mode-change","note-version-change"]}.apply(t,o))&&(e.exports=i)}],[182])});